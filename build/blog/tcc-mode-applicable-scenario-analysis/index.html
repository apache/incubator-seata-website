<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">TCC适用模型与适用场景分析 | Seata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://chai001125.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="http://chai001125.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="http://chai001125.github.io/blog/tcc-mode-applicable-scenario-analysis"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="TCC适用模型与适用场景分析 | Seata"><meta data-rh="true" name="description" content="Fescar 0.4.0 版本发布了 TCC 模式，由蚂蚁金服团队贡献，欢迎大家试用，文末也提供了项目后续的 Roadmap，欢迎关注。"><meta data-rh="true" property="og:description" content="Fescar 0.4.0 版本发布了 TCC 模式，由蚂蚁金服团队贡献，欢迎大家试用，文末也提供了项目后续的 Roadmap，欢迎关注。"><meta data-rh="true" name="keywords" content="seata、分布式事务、TCC、roadmap"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-03-27T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/seata_logo_small.jpeg"><link data-rh="true" rel="canonical" href="http://chai001125.github.io/blog/tcc-mode-applicable-scenario-analysis"><link data-rh="true" rel="alternate" href="http://chai001125.github.io/blog/tcc-mode-applicable-scenario-analysis" hreflang="en-US"><link data-rh="true" rel="alternate" href="http://chai001125.github.io/zh-cn/blog/tcc-mode-applicable-scenario-analysis" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="http://chai001125.github.io/blog/tcc-mode-applicable-scenario-analysis" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Seata RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Seata Atom Feed">




<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR" async></script><link rel="stylesheet" href="/assets/css/styles.c84d55f4.css">
<link rel="preload" href="/assets/js/runtime~main.6888d26e.js" as="script">
<link rel="preload" href="/assets/js/main.96f5711d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/">Home</a><a class="navbar__item navbar__link" href="/docs/overview/what-is-seata">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Solutions</a><ul class="dropdown__menu"><li><a href="https://cn.aliyun.com/product/aliware/mse?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Seata in cloud<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://cn.aliyun.com/product/aliware/mse?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Microservice solutions<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.aliyun.com/product/ahas?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">High-availability solution<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://cn.aliyun.com/product/aliware/sae?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Serverless solution for microservices<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.aliyun.com/product/edas?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">PaaS solution<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.aliyun.com/product/servicemesh?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">Service mesh solution<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://help.aliyun.com/document_detail/132903.html?spm=seata-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">SOFA distributed transaction<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/docs/developers/developers_dev">Developers</a><a href="https://mp.weixin.qq.com/s/nvDmIJEuDaNEY3RfTA3UyA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Recruitment</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/docs/download">Download</a><a href="http://demo.seata.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Console sample</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/blog/tcc-mode-applicable-scenario-analysis" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/blog/tcc-mode-applicable-scenario-analysis" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-community-meetup-hangzhou-ready">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-meetup-hangzhou">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-observable-practice">Seata的可观测实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-connect-data-and-application">Seata：连接数据与应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-go-1.2.0">生产环境可用的 seata-go 1.2.0 来了！！！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/iscas2023">6大课题现已开放挑选 | 欢迎报名 Seata 开源之夏</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-1.6.0">Seata 1.6.0 重磅发布，大幅提升性能</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-1.5.2">Seata 1.5.2 重磅发布，支持xid负载均衡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-tcc-fence">阿里 Seata 新版本终于解决了 TCC 模式的幂等、悬挂和空回滚问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-tcc">深度剖析 Seata TCC 模式（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-lock">详解 Seata AT 模式事务隔离级别与全局锁设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome">Welcome</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-snowflake-explain">关于新版雪花算法的答疑</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-UUID-generator">Seata基于改良版雪花算法的分布式UUID生成器分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-feature-undo-log-compress">Seata新特性支持 -- undo_log压缩</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-dsproxy-deadlock">ConcurrentHashMap导致的Seata死锁问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-client-start-analysis-02">Seata应用侧启动过程剖析——注册中心与配置中心模块</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-client-start-analysis-01">Seata应用侧启动过程剖析——RM &amp; TM如何与TC建立连接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/integrate-seata-tcc-mode-with-spring-cloud">Spring Cloud集成Seata分布式事务-TCC模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-config-manager">Seata配置管理原理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-golang-communication-mode">seata-golang 通信模型详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-datasource-proxy">Seata数据源代理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-sourcecode-client-bootstrap">分布式事务Seata源码-Client端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-demo-in-mac">Mac下的Seata Demo环境搭建（AT模式）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-rpc-refactor">Seata RPC 模块的重构之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-sourcecode-server-bootstrap">分布式事务Seata源码-Server端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-xa-introduce">分布式事务如何实现？深入解读 Seata 的 XA 模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-quick-start">Seata 极简入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-ha-practice">Seata 高可用部署实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-config-modular">Seata config 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-dubbo-transmit-xid">源码分析Seata-XID传递 Dubbo篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-tcc-modular">Seata tcc 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-core-modular">Seata core 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-spring-boot-aop-aspectj">通过AOP动态创建/关闭Seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-dynamic-config-and-dynamic-disable">Seata 动态配置订阅与降级实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-config-center">Seata 配置中心实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-nacos-docker">Docker部署Seata与Nacos整合</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-nacos-analysis">Seata分布式事务启用Nacos做配置中心</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-mybatisplus-analysis">透过源码解决SeataAT模式整合Mybatis-Plus失去MP特性的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/springboot-dubbo-mybatisplus-seata">SpringBoot+Dubbo+MybatisPlus整合seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-start-rm-tm">Seata 客户端需要同时启动 RM 和 TM 吗？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-start">Seata AT 模式启动源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/design-more-flexable-application-by-saga">基于 Seata Saga 设计更有弹性的金融应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-tcc-saga">分布式事务 Seata 及其三种模式详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-design">分布式事务中间件 Seata 的设计原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-go-server">Seata分布式Go Server正式开源-TaaS设计简介</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/how-to-support-spring-cloud">Fescar 与 Spring Cloud 集成源码深度剖析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/integrate-seata-with-spring-cloud">Seata（Fescar）分布式事务 整合 Spring Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-java-client">分布式事务之Seata-Client原理及流程详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-java-server">深度剖析一站式分布式事务方案Seata-Server</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/tcc-mode-applicable-scenario-analysis">TCC适用模型与适用场景分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tcc-mode-design-principle">TCC 理论及设计实现指南介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/quick-start-use-seata-and-dubbo-services">How to use Seata to ensure consistency between Dubbo Microservices</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-simple">Fescar分布式事务原理解析探秘</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/manual-transaction-mode">MT mode</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">TCC适用模型与适用场景分析</h1><div class="container_mt6G margin-vert--md"><time datetime="2019-03-27T00:00:00.000Z" itemprop="datePublished">March 27, 2019</time> · <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">zhangthen</span></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Fescar 0.4.0 版本发布了 TCC 模式，由蚂蚁金服团队贡献，欢迎大家试用，文末也提供了项目后续的 Roadmap，欢迎关注。</p><a name="2143093f"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言基于-tcc-模型的应用场景">前言：基于 TCC 模型的应用场景<a href="#前言基于-tcc-模型的应用场景" class="hash-link" aria-label="Direct link to 前言：基于 TCC 模型的应用场景" title="Direct link to 前言：基于 TCC 模型的应用场景">​</a></h2><p> <br>
<img loading="lazy" alt="1.png" src="/assets/images/TCC1-1d4e4883f0a4310852d664b2d0336227.png" width="625" height="303" class="img_ev3q"><br></p><p>TCC 分布式事务模型直接作用于服务层。不与具体的服务框架耦合，与底层 RPC 协议无关，与底层存储介质无关，可以灵活选择业务资源的锁定粒度，减少资源锁持有时间，可扩展性好，可以说是为独立部署的 SOA 服务而设计的。</p><a name="d9b462de"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一tcc-模型优势">一、TCC 模型优势<a href="#一tcc-模型优势" class="hash-link" aria-label="Direct link to 一、TCC 模型优势" title="Direct link to 一、TCC 模型优势">​</a></h2><p>对于 TCC 分布式事务模型，笔者认为其在业务场景应用上，有两方面的意义。</p><a name="95179108"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-跨服务的分布式事务">1.1 跨服务的分布式事务<a href="#11-跨服务的分布式事务" class="hash-link" aria-label="Direct link to 1.1 跨服务的分布式事务" title="Direct link to 1.1 跨服务的分布式事务">​</a></h3><p>服务的拆分，也可以认为是资源的横向扩展，只不过方向不同而已。</p><p>横向扩展可能沿着两个方向发展：</p><ol><li>功能扩展，根据功能对数据进行分组，并将不同的功能组分布在多个不同的数据库上，这实际上就是 SOA 架构下的服务化。</li><li>数据分片，在功能组内部将数据拆分到多个数据库上，为横向扩展增加一个新的维度。</li></ol><p>下图简要阐释了横向数据扩展策略：</p><p><img loading="lazy" alt="2.png" src="/assets/images/TCC2-a511d666420fec7625e3fba934fcdea6.png" width="559" height="464" class="img_ev3q"></p><p>因此，TCC 的其中一个作用就是在按照功能横向扩展资源时，保证多资源访问的事务属性。</p><a name="240e4d15"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-两阶段拆分">1.2 两阶段拆分<a href="#12-两阶段拆分" class="hash-link" aria-label="Direct link to 1.2 两阶段拆分" title="Direct link to 1.2 两阶段拆分">​</a></h3><p>TCC 另一个作用就是把两阶段拆分成了两个独立的阶段，通过资源业务锁定的方式进行关联。资源业务锁定方式的好处在于，既不会阻塞其他事务在第一阶段对于相同资源的继续使用，也不会影响本事务第二阶段的正确执行。</p><p><strong>传统模型的并发事务：</strong><br>
<img loading="lazy" alt="3.png" src="/assets/images/TCC3-d1a3451fceeb603af33003ed849ff422.png" width="668" height="619" class="img_ev3q"></p><p><strong>TCC 模型的并发事务：</strong><br>
<img loading="lazy" alt="4.png" src="/assets/images/TCC4-d88fd6484677d822f4924241cf806e26.png" width="676" height="458" class="img_ev3q"></p><p>这对业务有什么好处呢？拿支付宝的担保交易场景来说，简化情况下，只需要涉及两个服务，交易服务和账务服务。交易作为主业务服务，账务作为从业务服务，提供 Try、Commit、Cancel 接口：</p><ol><li>Try 接口扣除用户可用资金，转移到预冻结资金。预冻结资金就是业务锁定方案，每个事务第二阶段只能使用本事务的预冻结资金，在第一阶段执行结束后，其他并发事务也可以继续处理用户的可用资金。</li><li>Commit 接口扣除预冻结资金，增加中间账户可用资金（担保交易不能立即把钱打给商户，需要有一个中间账户来暂存）。</li></ol><p>假设只有一个中间账户的情况下，每次调用支付服务的 Commit 接口，都会锁定中间账户，中间账户存在热点性能问题。 但是，在担保交易场景中，七天以后才需要将资金从中间账户划拨给商户，中间账户并不需要对外展示。因此，在执行完支付服务的第一阶段后，就可以认为本次交易的支付环节已经完成，并向用户和商户返回支付成功的结果，并不需要马上执行支付服务二阶段的 Commit 接口，等到低锋期时，再慢慢消化，异步地执行。<br>
<img loading="lazy" alt="5.png" src="/assets/images/TCC5-bad845fca6acd73c946d159389616705.png" width="730" height="647" class="img_ev3q"></p><p>这就是 TCC 分布式事务模型的二阶段异步化功能，从业务服务的第一阶段执行成功，主业务服务就可以提交完成，然后再由框架异步的执行各从业务服务的第二阶段。</p><a name="ad5fc026"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二通用型-tcc-解决方案">二、通用型 TCC 解决方案<a href="#二通用型-tcc-解决方案" class="hash-link" aria-label="Direct link to 二、通用型 TCC 解决方案" title="Direct link to 二、通用型 TCC 解决方案">​</a></h2><p>通用型 TCC 解决方案就是最典型的 TCC 分布式事务模型实现，所有从业务服务都需要参与到主业务服务的决策当中。<br>
<img loading="lazy" alt="6.png" src="/assets/images/TCC6-30c79677bf0dd24ab9e6cf9edf68a7ea.png" width="654" height="554" class="img_ev3q"><br> </p><a name="62b37e99"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景">适用场景<a href="#适用场景" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3><p>由于从业务服务是同步调用，其结果会影响到主业务服务的决策，因此通用型 TCC 分布式事务解决方案适用于执行时间确定且较短的业务，比如互联网金融企业最核心的三个服务：交易、支付、账务：<br>
<img loading="lazy" alt="7.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5gAAACqCAYAAAG/ldAQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACSkSURBVHhe7Z3LrxzHdcbzf3oTL7zIIogXgQECQZCHswvgFVcOHCgOHAegg9DPGDYBS05EStckE8lybBMxJdGEpStRl5cU75vs1NfdNV3dUzPTM1PTc7r6d6CfONOPme4+dc5X3zzu/FFBZBOzZH7h6+8NzstXr+pnXz+efn4SfcxdsGm8+fbd6OPtAsWek1k/+QZx9HwEyXyLZPYKktlGQTJ7sGmQzJ5BMtsoSGYPNg2S2TNIZhsFyezBpmE6mY/ntntQ/quciPa61QyVzFcPHzW33b7i8f3q2PuwaSxLpo7heuv+WWud8Pf7oOidTP/gPqHXgnVf+Pqj1pO31y1m02Rq31XJXHZBwnXl7aPDuW1CNgnttzyZZ8XBUec46tv+/sGt+rY7vlXXVLFWZTZP1oz0+P33ZgeyjH212VfFcev2TXdRw/VdNo1ebfZWdSzX7jeVKcKq1e0w0TEUaGYPNg0mQD2DZLZRkMwebBoks2eQzDYKktmDTYNk9gyS2UZBMnuwaZDMnkEy2yhmybxz587gbJPM5ycX0cfcBZvGwf13o4+3CxSzZBLjD5KZUZTJVJnG+vAu+cEb98oD2DRij7kLjk+v6mdcP2KPtwtOLl6Wz0cyV/D05LJ+xvUj9ni74MU5yewFyewByUwHyewJyewByUwHyewJyewByUzHVslsf4ZGB/1g9hmV8FNmy9h1MrsfgPKf0NOHo/yx+s/fLGNXydQx6BOC3eO8/rAolzXXc/W5bpjM+Q9uVckLk7n4U3Eh2yQz9ngh4THog2XX7h9Hk6kPUa061k2TGXusEB1PeJw+qbFkrjrGLSvTPYG7KDdv+E/hKZnxT5ktYteV2e0Quni6UDpu/RuuW8auKlPXqfvZXV1LXdswmX1AM3vCBKgHJDMdJLMnJLMHJDMdJLMnJLMHJDMdJLMnJLMHJDMd7WQe3C0TOiS377xVHsCmEXvMXXD0YvNkxh5vF7SSSeQRrWQqy7Eyzo0f/Xy7Fr9NnJyeRo9pzFzptceB4/aAf8puKMI/PzjJwtTca5sP028TQ36rYii2mSNuGkN+82Mo/NRHQWEOHBRmmqAwM4TCTAuFmQYKk8JMCoWZBgqTwkwKhZkGCpPCTAqFmQYKk8JMCoWZBgqTwkwKhZmGnRfm49nftW9/WSz8BqD/G/3Vcn23R9s2f7e/Wedu19+4C5dvw9gLs/vtv+r6NF8mE+F3kaovvB2Xy5u/Ev6o+SvhPb7RuIwxFabGmr47pmuoa+S/FFiti481//0y7dP9y+oH9W3/XS+/fBMGUMz6G5BzX8Vt/4jG7JuS5XZ1YboLE34ZUPu1CC7kpuyjMPW8r//maOvCVJHp37niFDeqdc01qhtdXZgaiOHPH3SvrV++LkMWpp7vxfnVVoWpa6ACKwuzM0Zb1NfR/wyDL0y/vSi/HNrZL1y/DjstzO6B+Y7SXdfdrrr/YO7Xb5btsynjVMxK4cJlsesRXr/rDzXo/CykHoCBIugb0rpdfW28GaDrMi7FbM7Tzyqu3fDXKD7WdN19cR7UotGISnufbo7WAY+Jx0wKHjMNFCaFmRQKMw0UJoWZFAozDRQmhZkUCjMNFCaFmRQKMw0UJoWZFAozDRQmhZkUCjMNFCaFmRQKMw0LC/Ps8mX516d0oXPm+dlV+WbwPuLSdYTYMY0VjZdzN26GDj1nbmNVY8NHqzAJgrARs8JUrcbkNUf2NY1VxI5nzHzlW+8UwR93GyT0fLFjGTOykWHMCvPKjdbYDjnyfIvfGN4mXrkRFTueMaPCHLrR6flixzJmVJgaHz6CwpyOYj7bW2HmqZhq6kNGjiJSFWZ9gi4ozAGDwkwTFGamUJjpoDDTQGE6KMx0UJhpoDAdFGY6KMw0UJgOCjMdFGYaKEwHhZkOCjMNFKaDwkwHhZkGCtNBYaaDwkwDhemgMNNBYaaBwnRQmOmgMNNAYToozHRQmGmgMB0UZjoozDRQmA4KMx0UZhooTAeFmQ4KMw2DFWb4a1MV7R8Dmvsxl/KHb9y/jta+W/4SVYwxF2b4WzCe8EeYwuvlr6d+v6S53exX/cpac38TxlaYs+sQ+VWvRWPN76PfL5ntH6z3vwGzDYMqZvuAFxdmeX/HPxUXMnRhfvP2R+W/uypMXZ8u1fLd/7zhkIX5/qen5b9bKeaNw+oaunNvX8vFY03jWNuqMKtf92rW+zGr2+Evqa3LzgszPOjZic7WLX6OUDHD7apfoqqX1z9Bty1DF6Z/XhVoeBxr4QZUeH1889KA0f3ZdsGgCgvT7zfbrlxflD8t112+DkMWpn/O3x1u8ZcG68L01yM890VjLSzM7j5C9/3P8YXL12EQxSwPsNN1/EHPd6W6m9eKuavfcAzZV2FurZj+9y+Dxwzvl4XYKkzdrhXTLd/F744OXZhfeu3XWymmrkGplOV1atut7jXxyzVmFxVmuH24fF0GKcy5Lu7w9/3vDPp//a/1+sL090O8Cvt9tmXMHjOW/NayoDCrBhdOZZt1IizUTadhY/SYpcWqr1P3miwaa74wddvPVjzN9W8X+jrstDBVVIsPWj9FXl8Ed1F8hx7qx1VDxliYzXWs6Kpf7HZzf3c/CDymwiyVsrz9qHX9hM5g2VjTTE6FGTawavoaz8O6DPrij1XGrJjWGJtiWoXCdFCY6aAw00BhOijMdFCYaaAwHRRmOijMNFCYDgozHRRmGihMB4WZDgozDRSmg8JMB4WZBgrTQWGmg8JMA4XpoDDTQWGmgcJ0UJjpoDDTQGE6KMx0UJhpoDAdFGY6KMw0UJgOCjMdFGYaKEwHhZkOCjMNFKaDwkwHhZkGCtNBYaaDwkzD0sLUyimwz8KMHc/Y2Udhxo5jzNx++268MLXw+PSyeHqSO1fFxdWwA8mHnvXzs6vIMY0XNblwQA0Rej49b+x4xorGRXgZZ4VJEISdWFiYZ2dnxdOnx5AJz58/rzM7vTg+jl8TsMNU4uLiInr+YAdp36KICqasvPxo7MUjGCc/fONecXrx0tmzgf3gHkNn+vzFafR6gB30wv6L8yvXd/Iemzq/N9++G70GYAdp3/nVq9ZLPj6igunfOIk9GIyTHzjB1OuYA7+vsddQ/z16vsWPKcAgSDD1uvTQb7oNHTq/N99CMK0j7XtxLnNRJy4IBHMiIJhgFQQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRL5COaNw/I3yqLr9sxjo8flQTD3h8bG9cjyeR4Urx4+iizfDVbGLII5LNfunxWP7z+Irusy2BhRbx9w7C9jtIJ588g1PXc8fbh5I9z3UXSbhuNg24pXxVl92+17dOj+dc0r2O76w6I4uNXep0LbVY8bLtegjD3PvkAwh6HKezjWFtPdN7as5NZxtJnkMmYRzN3RjJH3igN3DNd0240nL5haFheq9caIxprvwf551L/DiWL3sTy+z3dFXMv6TTTTMnqHWSbV0V5eJ7RsFOFysUowm0HkWdV8+tA0SztC6ZmCYPpz/ebtj8r7VhzmrFEtwY/N2LpNBbMPFsZsroLpz+/9T0/L+3sTzNq9dQXzZk+X2WeM9BHMPvg62IdQekYtmI/rRqEkhDMQ3Y/PnkUzO1pIR2jn11XNR0mvmp1vSvPP4Y+jHFitbbxw719A/+477xR//d2Hxd9+//3iq5kSO+8fvfNxdPkQKPetZWpcnXEnrt+vloXbt8b3QsHMY8x++Z/fLf5KY/N78byOle55fum1Xxc/e3MPglkLZFcwNR67rm7TMSLB9PuJRjDd49X7zp6/xjtL4Zf5ff197aNlQwro6B2mp5npLJiJd9B24azHDwAltzVQWq+f+yZTNR8t6/uc3feq5p5nj0zFYb7+G1eFdVhwmGoKvlnNBHABC8dYTDAzGrO5OkwJ5Ivzq/rePhymxsNZLVzBci+Y7rbyHwpUjD5jJHyv0wujf15tf/AwPulroTHdmaj1GcOpGb1g+uJvGk4zCxLd7Rvq7TqJ0rJwAOj+bNDMmlPdfHTfDTolfdFzlc8RWdd9nn3Ce5jD4sdL62XT8r5jQePQutjycqIYGcO5jFnew9wdfsKm27q6GjNd41G5uLZQ+e39Nt3l4RjpOlC/jxdM3Zdx0b/RSWM5XiMTtXL5/HHtmmwcJmwOgglWQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESGwjmq+LYDeDHR2fFB5+eFh88cf/CaPnQ8Yen58XnZxLM6SjmK3eupxcvi4+fXRQffha/NrBnXH95fHReTuamIJg6T50vfdUm6hPqF+ob6h/diAqmQtsqwZAPsQGQe+iM3alHrwfYYSpDk75qH/df2TdisVAwCYIgCIJoYqFgHh8fF0+fQi5MNU5OTqLXA+xwdXVVZyv/oK/aZ1lEBVMvG8TeDIXx8tnR08m9JKuzfeP2L6LXA+xwcP/dSbwkq3P8k9fejV4DsINell00HOcEUxteXL2KPhCMlz98cuQGQpXjqYQGPoJpn7fuvVNcqkllLJo6N50jgmkffThSvSMWUcHUJ4RiDwTj5YM/PCnOL+Mflc411KBev30QvR5gh9t33ynOLhfP6nMInZvOEcG0z2cvLsveEYt5wXQd9eQcwcyNUjCvpvNpRIVeKUEw7SPBLD/GX+ctx9C56RwRTPs8+fyy7B2xQDAnAoIJVkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEggmIJhgFgQTLIFgAoIJZkEwwRIIJiCYYBYEEyyBYAKCCWZBMMESCCYgmGAWBBMsgWACgglmQTDBEtkI5mMd38NH0XV75cahzeMKQDD3hMZGcRxf1+HmURFdvhMMjVkEc1h0LLHlcww4RtTbY8v3QT4Os2w+qy/sgdvmemS5UFPqrrv+sBrQnmv1duEyEe4TonU3b8TXWQHB3BePildHh5Hl8ywaY7HlOY1ZBHM3dMeIn7jp9my7W8cLx6e26ztGWs9TPt6D9jLH4/sP5vYr0TEUZ/F1e2Ckgjl/wRfTvtgSzPh2FTHB9AND+/rmE26n/fztEN+kuoMh9jz7BMEcBl3ePsw1DzWNBbN5bd9dltOYRTB3QzhGwolbMy7cstntNuuOkaYH++dR/25eWdGxHNxq71PR9Plw+bX7Z639h2T8DtM5y+6ygyUzkk0c5qLmo3VVQueTVwlzM2vzAyK8bYXcBfPpyWVJGGNymH7MVGNqMX77nMZsjoL5zdsf1beq0LntSzCrlzu7grlYLDcZI8sEU/uJ+Z5cHUO5vHSZ9fGEt/fAyAWzuqjdRPkZkBpFuFysajrNrKtiWfMJt1uFf/x19xuC3AXz8NlFeZ5//I1fzYRzLIJZzaaXNaP55pHTmM1RML/87d+W5/a1n3xY3te5WRPM7vaL6DNGVjnMPvg6WHe/1IxWMP0FVKKu3Wi/NHCgi1q/pxlrNOW+KxqVZ1HzqZLXsKyhlbjn02P5+zEx3xdTEUyPhPOT5xd7Eczyw2kL6TaDepbtxk04vsJJndb7256cxmzOgumRcO5fMCvnFiM2Tmbre4yRuGA2+3i6+4lGKKvHnm3fs3+nZrwOc/ZSbNVUmnXd+21ijaNLmPRwMPh11WzdJb1Omm9Ksefwy/y+/r720TILjvMv/u1B8Tffe7/46vfz5C///eHcOf+Za1p7c5iR9yTVuMLx4dEyjcGmabXHd3jbk9OY/cq/vOfG5sNoXsfKF//xV3Pn+a8HH+9FMKt8eyFrxlMlpO19Nh0jfp+SmWAel49X7ds8f0UjqH7cz5ucqg6Gdpzjfw/ToST5N6B1KrGC9jOV2RvVpQOtLrYGT7i/30dUjaa67ZuMX+a37e4juk0rRneffTElh6nZvWLfL8m2BFIC2moGbdqCWe3rHWRsHOU0ZnN3mN+5W70Sti+HWeVU4lP1Qp/jcAyFrD9GKnGsbnthrJe5ca++q9681MUuYg9ffcpCMIW/iN1PbsWokh68TOD28+vC2yKcaXWbT9nIHs67hTkCcfZ0n2efTEEwvVD62Ldg+ll0d/zFKMdZpKGI2L45jdlcBVNC6UPnNrRgajzcvBGKWcUsx8r/kklcSZ8xom1mY60jmPX2c/tE0JgOBVzjuE+vT00mglk1nZIljUDNQ9s0zadqWrOZfnm//Qlbrfe3u83Hr4/NxELmt/HNMly2P3IXzFjsXzD9xK1xi4tYVzDDZWMfszkKZjd0bkMLppCzk+iEPS/M8fwYaDO/fn6MtMfuvGBWNdAW3S7Vq4PtbTSeF9XELhm1YPqGEyZJF9IvWzYD8duFy7qJKe8Hsyy/vW8+uu9f1ogmr/4I9NxxlMuXD5IhQTCHRZfZjx3d9xM50d1WrCOYuY1ZBHNXNOJW9tF6zGhZk//KiMyJ5hpjRNvNDInWl4amFsxy+7NZHw/382h5bJ2WLRPzXTFawawu5LICrpLdbQq+OXUvdvV484nx26nh+AGi2weuMYWPHTrbRsjbblX459lHsheBYA5DNfaWi45S0B2zUcEsXw5zjxd5RSWnMYtg7oJ5Ibxejwstb7Zrs8kYuf7Qj/fQfVaCGb51IPGc3Xb4x+u++lKZGq1bXke7Ipv3MGFzEEywCoIJlkAwAcEEsyCYYAkEExBMMAuCCZZAMAHBBLMgmGAJBBMQTDALggmWQDABwQSzIJhgCQQTEEwwC4IJlkAwAcEEsyCYYAkEExBMMAuCCZZAMAHBBLMgmGAJBBMQTDALggmWQDABwQSzIJhgCQQTEEwwC4IJlkAwAcEEsyCYYAkEExBMMAuCCZZAMAHBBLMgmGAJBBMQTDALggmWQDABwQSzIJhgCQQTEEwwC4IJlkAwAcEEsyCYYAkEExBMMAuCCZZAMAHBBLMgmGAJBBMQTDALggmWQDABwQSzIJhgCQQTEEwwC4IJlkAwAcEEsyCYYAkEExBMMAuCCZZAMAHBBLMgmGAJBBMQTDALggmWQDABwQSzIJhgCQQTEEwwC4IJlkAwAcEEsyCYYAkEExBMMAuCCZbYQDCvijt37kBG/P6TZ8X55fQE885bB9HrAXa498vfTkYwY+cPtnjy+cUagulQYg+fnRcfPjkrPoDR8+izs3rW9LJK8kRCp/v05Kr4vTv/Dz49jV4b2C8fPjktPnl+UU3m6rzlGDo3naPOVeccuxawZ1yPUK9Qz1jUKiMOsygunbq+OH/pdryEDDh2A+DETYKuXubckubjpRvMmvw9O70qjl7Erw3snxfnalB5v/qhc9M56lxj1wD2j3qEeoV6hnpHLOYEU6FN1VuVYBg/7r9yAOTckBZF2agYy2Zx/5VMYWjqHP35xq4FGEBjcclgjAomQRAEQRDtQDAJgiAIgiAIgiCIJLGWwdRLu3fePih+9PN7AGCQN+8cFM+ePZvEW4JEUZxfXBS336InA2zDT//rbvHfv/zfsm9O8aM+OYby+Pa9/yl+/J93ozkHgH7I9+kvDqzbGnsbTBWrPkOkr3XG/jYCAOyfH7pm8MmTp+UXw1y5YjQzDfVj8eLkrHjj9i+iYwEA+vGVb71TvH3/3eL8Ul8oUm3ROcccyp/yePvtu/xtNYAtke/TX5HQXyfwc48+0ctg6rFUrGeu+WIwAezywzfuFb8//Kz8qyOXrmiZJ+UZmkDpBb+nn5/wx5IBtkQG887dd4pnp5elyVRt0TrHGcqb8qc8vonBBNga+T79ZR//18/6vgDXz2CWk5li9gfZYwcAAPvnB85g6ldp9Oe99IqT6wWYzAxDOdULCEfPMZgA2yKDqV9M0t8Q1p9FxGCON5Q35U95fPMtDCbAtsj36QdJ1n3jYk2DyTuYAJZpGUz/MVlmStmFcqpfn8JgAmxPYzAvMZgjD+UNgwmQjspg6jdyXpbzDgwmwATBYE4jMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTADAYE4kMJgA6cBg5hPKGwYTIB0YTLM8KK7diC0HSA8GcxqBwQRIBwYzn1DeMJgA6cBgGuT6w6rZvSqOi+uR9evxqDgoH2tTzoqbK4xuc7wRjg6La+V2D4qbR5H1HR7ffzD3+KsIn//gVnwbWA4GcxqBwQype+OsRyXgxmHxWI/p6NOLrt0/q3rXw0fR9SH0WXtgMPMJ5S1/g9mnPwTzzlvH5bJF/eLarUdr985d9BF6o00wmCapCyHJxMcbzHXNqi/G1ftVxdU1ot3J2/LH8wW6XnFubp5pAm0wmNMIDGZIaoPp+9HqF+Vm1BO4/gaTPmsJDGY+obxN4R3MeB8RkX64yGAGL6S9OnK9ple/210foTfaBIM5KH6Ap2bZhGbzAqgYwmD6dcvOIyS4juXjN+cYLVo/iVu0HjCYE4mpGMzZO4MJWf7KdtOT1uoxgxpM+mxqMJj5hPI2OYPpjWLZf7q9xDFnMJse0KdnVey+j9AbbYLB3DtBwS4c3OE2676F7/ddbRTbLCvGNlVxL2BZcYevgjlWF15Q1LHj6hRxeFxTKupNwGCOPw6fXZS5/ONv/Kr45u2PyklvN6ZiMPvRnYBsSrs/V72mvWxdYj2ePmsPDOZ44svf/m2Zs6/95MPi/U9P66VNKG8YTHc77Iczg/mo6QmbGMsd9xF6o00wmPuiNbD7vmrSfWW+/34VTXGsZ1KX02pYs+XdZhUW5nI2PrZOs6hY9xpNEwzm+MMbzC6h4cRghiQwmLOec1wc1JOJtSYSfkKS/B3M1dBntweDOZ7wBrOLN5zKGwbT3Y4azHTzxRkJ+wi90SYYzIGpCqGmHviNaYy8IlIzv42Kp//A7fMcm7JecbvnbzU1v71fHz+nPh95U1OIfuk8eFUpSthQJ8qffytPMYV5ZDj/4Y3fF//x819E1+dKvE/N43v0KqM46+V1H1u036x3xUzkzgwmfXYI/vSf3i2++I34Ohgnf//jD4rv/uweBlN0DWZ9f1VvHLqP0BttgsE0QjN45w2gn7j0mYS0aA3qzuP6deFjzl59Cbb1yxYWgC/KBcSK292fawix49kAfx1nDRF6wTuY449F72B69Ar+z359NOF3MJtetWiC5HvtWu9C1izbd9bfu320d9+jz1qEdzDHE4vewRRfeu3XxXfuHjr9q/I4mXcw635Q1XEPgxnbZgvS9BF6o1UwmJbwA9xRTlJmhi/+ispSysfqmMrZ8shjzpa391ldLIsazpJXj+bW17djxxvBT+S2geJvg8Ecf3QNpiZUr//GFV0QyunUPyI76x/RF9c26LU1/nHj5rTqfwe3Or9v3HtSQ5+1CAZzPBEaTG8oX5xf1Wur8Tq1j8j6+V3VsyL9oe5PYR2391nN7vsIvdEqGExz+CJINwh9QyiZK8Lg+SKTHF9IC5tJpAFVrCpux2xSJzaf2Hn8sS67ZivPZ6JgMMcfmuR2DWU3MJgeP6Fo2LbXbtRb+hpM+qxJMJjjiZ/+6rOWoeyG8jYFg9nQ7R0Ron2nmTNuU9/J+gi90SwYTBMEJk/4gvCTj+7yPtx44LatHjc6kMPCWvi4fhK2qPD8+tirPquLu2V8Fz7OasLHWVbYzTFs30hyA4M5jcBgNgJf4vrTzfD+hj1IbDRx6GUw6bNWwWDmE8rbZAzmbP6nXuD7i78fbBeat3Ifv97XuGOdeakjbR+hN1oGgzkkXcMYsHpSEhT0HKsHa79CChtNQHTy02wbFlT3eZp1QXEH1yE879a+iyZc0Wu44Pxbr04FrNkQpwAGcxoxDYO5oI+VrJpAbN5n+xrMlsGtWTwpoc9aBoOZTyhv+RvMoL/N1Wezruon3V4Yq/+g18Z6yU77CL3ROhhMGBVlA1hU+LAxGMxpxDQMJmwLfbYfGMx8QnmbhsFc9SJbOnLsI/TG/mAwAQCDOZHAYAKkA4OZTyhv+RtMgOHAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOnAYAIABnMigcEESAcGM59Q3jCYAOkYwGBWBasG/NHxRfHBk9Pid5+cOE6L/zs8AYA9ojp8/9PT4tFnZ8Xhs4vi+ZkzmJcvncHs3wyI8YRyeul68onryU8+vyj+8PS8+MDlX+OAngzQD9XKQ8eHT87cvOYcg5lBhAazmq+el/lVnumNAP3wcwnNKzS/0DxD8w3NO9IaTIcK9vzyVfG5m7gevbgsJ7Efu8KV2dSTA8D+kIh+7Gry0+cXxXE9SVqnERDjirInu//pRQT1ZDX/w2fVOIiNDwCYR/MX1cwnrm/KjLw4vypfoXetE4M50lDelD/lUflUXpVf5Zn5KkB/VDOaV2h+oXmG5huad/Ttjb0MpqIq2uqjsircMzeB1SQWAGxw5opfXLr6LJtADZFnVD25eidTjV+5j40LAFiOXjzXvEYvpJef+qhKjBhpVL2xyqfyqvzG8g4Ay9G8QvMLzTM031inN/Y2mD7KSav+BQCb6H/EZIKeDJAGIr+I5RkA1kT/WzPWNpgEQRAEQRAEQRAEMR9F8f8LOFSWczz3MAAAAABJRU5ErkJggg==" width="920" height="170" class="img_ev3q"><br> <br>当用户发起一笔交易时，首先访问交易服务，创建交易订单；然后交易服务调用支付服务为该交易创建支付订单，执行收款动作，最后支付服务调用账务服务记录账户流水和记账。</p><p>为了保证三个服务一起完成一笔交易，要么同时成功，要么同时失败，可以使用通用型 TCC 解决方案，将这三个服务放在一个分布式事务中，交易作为主业务服务，支付作为从业务服务，账务作为支付服务的嵌套从业务服务，由 TCC 模型保证事务的原子性。<br>
<img loading="lazy" alt="8.png" src="/assets/images/TCC8-29009ae632454b1a2c8048a7ffe74166.png" width="1102" height="348" class="img_ev3q"></p><p>支付服务的 Try 接口创建支付订单，开启嵌套分布式事务，并调用账务服务的 Try 接口；账务服务在 Try 接口中冻结买家资金。一阶段调用完成后，交易完成，提交本地事务，由 TCC 框架完成分布式事务各从业务服务二阶段的调用。</p><p>支付服务二阶段先调用账务服务的 Confirm 接口，扣除买家冻结资金；增加卖家可用资金。调用成功后，支付服务修改支付订单为完成状态，完成支付。</p><p>当支付和账务服务二阶段都调用完成后，整个分布式事务结束。</p><a name="827f0f82"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三异步确保型-tcc-解决方案">三、异步确保型 TCC 解决方案<a href="#三异步确保型-tcc-解决方案" class="hash-link" aria-label="Direct link to 三、异步确保型 TCC 解决方案" title="Direct link to 三、异步确保型 TCC 解决方案">​</a></h2><p>异步确保型 TCC 解决方案的直接从业务服务是可靠消息服务，而真正的从业务服务则通过消息服务解耦，作为消息服务的消费端，异步地执行。<br>
<img loading="lazy" alt="9.png" src="/assets/images/TCC9-2552443ebc043eeec8c4131709ce880a.png" width="1004" height="555" class="img_ev3q"><br> <br>可靠消息服务需要提供 Try，Confirm，Cancel 三个接口。Try 接口预发送，只负责持久化存储消息数据；Confirm 接口确认发送，这时才开始真正的投递消息；Cancel 接口取消发送，删除消息数据。</p><p>消息服务的消息数据独立存储，独立伸缩，降低从业务服务与消息系统间的耦合，在消息服务可靠的前提下，实现分布式事务的最终一致性。</p><p>此解决方案虽然增加了消息服务的维护成本，但由于消息服务代替从业务服务实现了 TCC 接口，从业务服务不需要任何改造，接入成本非常低。</p><a name="62b37e99-1"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景-1">适用场景<a href="#适用场景-1" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3><p>由于从业务服务消费消息是一个异步的过程，执行时间不确定，可能会导致不一致时间窗口增加。因此，异步确保性 TCC 分布式事务解决方案只适用于对最终一致性时间敏感度较低的一些被动型业务（从业务服务的处理结果不影响主业务服务的决策，只被动的接收主业务服务的决策结果）。比如会员注册服务和邮件发送服务：<br>
<img loading="lazy" alt="10.png" src="data:image/png;base64,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" width="613" height="199" class="img_ev3q"><br> <br>当用户注册会员成功，需要给用户发送一封邮件，告诉用户注册成功，并提示用户激活该会员。但要注意两点：</p><ol><li>如果用户注册成功，一定要给用户发送一封邮件；</li><li>如果用户注册失败，一定不能给用户发送邮件。</li></ol><p>因此，这同样需要会员服务和邮件服务保证原子性，要么都执行，要么都不执行。不一样的是，邮件服务只是一种被动型的业务，并不影响用户是否能够注册成功，它只需要在用户注册成功以后发送邮件给用户即可，邮件服务不需要参与到会员服务的活动决策中。</p><p>对于此种业务场景，可以使用异步确保型TCC分布式事务解决方案，如下：<br>
<img loading="lazy" alt="11.png" src="/assets/images/TCC11-7a885661dbcb087ae8b687c2a12a070f.png" width="1050" height="342" class="img_ev3q"><br> <br> <br>由可靠消息服务来解耦会员和邮件服务，会员服务与消息服务组成 TCC 事务模型，保证事务原子性。然后通过消息服务的可靠特性，确保消息一定能够被邮件服务消费，从而使得会员与邮件服务在同一个分布式事务中。同时，邮件服务也不会影响会员服务的执行过程，只在会员服务执行成功后被动接收发送邮件的请求。</p><a name="69910d05"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四补偿型-tcc-解决方案">四、补偿型 TCC 解决方案<a href="#四补偿型-tcc-解决方案" class="hash-link" aria-label="Direct link to 四、补偿型 TCC 解决方案" title="Direct link to 四、补偿型 TCC 解决方案">​</a></h2><p>补偿型 TCC 解决方案与通用型 TCC 解决方案的结构相似，其从业务服务也需要参与到主业务服务的活动决策当中。但不一样的是，前者的从业务服务只需要提供 Do 和 Compensate 两个接口，而后者需要提供三个接口。<br>
<img loading="lazy" alt="12.png" src="/assets/images/TCC12-a0d59ce31dd8be48cba507fe17290b93.png" width="654" height="554" class="img_ev3q"><br> <br>Do 接口直接执行真正的完整业务逻辑，完成业务处理，业务执行结果外部可见；Compensate 操作用于业务补偿，抵消或部分抵消正向业务操作的业务结果，Compensate操作需满足幂等性。<br>与通用型解决方案相比，补偿型解决方案的从业务服务不需要改造原有业务逻辑，只需要额外增加一个补偿回滚逻辑即可，业务改造量较小。但要注意的是，业务在一阶段就执行完整个业务逻辑，无法做到有效的事务隔离，当需要回滚时，可能存在补偿失败的情况，还需要额外的异常处理机制，比如人工介入。</p><a name="62b37e99-2"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景-2">适用场景<a href="#适用场景-2" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3><p>由于存在回滚补偿失败的情况，补偿型 TCC 分布式事务解决方案只适用于一些并发冲突较少或者需要与外部交互的业务，这些外部业务不属于被动型业务，其执行结果会影响主业务服务的决策，比如机票代理商的机票预订服务：<br>
<img loading="lazy" alt="13.png" src="/assets/images/TCC13-5ae384dd97cb075f35297395f95c1c5c.png" width="960" height="501" class="img_ev3q"><br> <br>该机票服务提供多程机票预订服务，可以同时预订多趟行程航班机票，比如从北京到圣彼得堡，需要第一程从北京到莫斯科，以及第二程从莫斯科到圣彼得堡。</p><p>当用户预订机票时，肯定希望能同时预订这两趟航班的机票，只预订一趟航班对用户来说没有意义。因此，对于这样的业务服务同样提出了原子性要求，如果其中一趟航班的机票预订失败，另外一趟需要能够取消预订。</p><p>但是，由于航空公司相对于机票代理商来说属于外部业务，只提供订票接口和取消预订接口，想要推动航空公司改造是极其困难的。因此，对于此类业务服务，可以使用补偿型 TCC 分布式事务解决方案，如下：<br>
<img loading="lazy" alt="14.png" src="/assets/images/TCC14-fc2e32a764cde16ce3573ffe65211c7b.png" width="1064" height="587" class="img_ev3q"></p><p>网关服务在原有逻辑基础上增加 Compensate 接口，负责调用对应航空公司的取消预订接口。</p><p>在用户发起机票预订请求时，机票服务先通过网关 Do 接口，调用各航空公司的预订接口，如果所有航班都预订成功，则整个分布式事务直接执行成功；一旦某趟航班机票预订失败，则分布式事务回滚，由 TCC 事务框架调用各网关的 Compensate 补偿接口，其再调用对应航空公司的取消预订接口。通过这种方式，也可以保证多程机票预订服务的原子性。</p><a name="acfe75a0"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五-总结">五. 总结<a href="#五-总结" class="hash-link" aria-label="Direct link to 五. 总结" title="Direct link to 五. 总结">​</a></h2><p>对于现在的互联网应用来说，资源横向扩展提供了更多的灵活性，是一种比较容易实现的向外扩展方案，但是同时也明显增加了复杂度，引入一些新的挑战，比如资源之间的数据一致性问题。</p><p>横向数据扩展既可以按数据分片扩展，也可以按功能扩展。TCC 模型能在功能横向扩展资源的同时，保证多资源访问的事务属性。</p><p>TCC 模型除了跨服务的分布式事务这一层作用之外，还具有两阶段划分的功能，通过业务资源锁定，允许第二阶段的异步执行，而异步化思想正是解决热点数据并发性能问题的利器之一。<br> </p><a name="Roadmap"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="roadmap">Roadmap<a href="#roadmap" class="hash-link" aria-label="Direct link to Roadmap" title="Direct link to Roadmap">​</a></h2><p>当前已经发布到 0.4.0，后续我们会发布 0.5 ~ 1.0 版本，继续对 AT、TCC 模式进行功能完善和和丰富，并解决服务端高可用问题，在 1.0 版本之后，本开源产品将达到生产环境使用的标准。<br><br><br><img loading="lazy" alt="图片1.png" src="/assets/images/roadmap-30821aa2e9d0cc93e4697af4cd6a2393.png" width="1680" height="652" class="img_ev3q"><br></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/seata-analysis-java-server"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">深度剖析一站式分布式事务方案Seata-Server</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tcc-mode-design-principle"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">TCC 理论及设计实现指南介绍</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言基于-tcc-模型的应用场景" class="table-of-contents__link toc-highlight">前言：基于 TCC 模型的应用场景</a></li><li><a href="#一tcc-模型优势" class="table-of-contents__link toc-highlight">一、TCC 模型优势</a><ul><li><a href="#11-跨服务的分布式事务" class="table-of-contents__link toc-highlight">1.1 跨服务的分布式事务</a></li><li><a href="#12-两阶段拆分" class="table-of-contents__link toc-highlight">1.2 两阶段拆分</a></li></ul></li><li><a href="#二通用型-tcc-解决方案" class="table-of-contents__link toc-highlight">二、通用型 TCC 解决方案</a><ul><li><a href="#适用场景" class="table-of-contents__link toc-highlight">适用场景</a></li></ul></li><li><a href="#三异步确保型-tcc-解决方案" class="table-of-contents__link toc-highlight">三、异步确保型 TCC 解决方案</a><ul><li><a href="#适用场景-1" class="table-of-contents__link toc-highlight">适用场景</a></li></ul></li><li><a href="#四补偿型-tcc-解决方案" class="table-of-contents__link toc-highlight">四、补偿型 TCC 解决方案</a><ul><li><a href="#适用场景-2" class="table-of-contents__link toc-highlight">适用场景</a></li></ul></li><li><a href="#五-总结" class="table-of-contents__link toc-highlight">五. 总结</a></li><li><a href="#roadmap" class="table-of-contents__link toc-highlight">Roadmap</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Vision</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Seata is ...</a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/overview/what-is-seata">What is Seata?</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/user/quickstart">Quick Start</a></li><li class="footer__item"><a href="https://github.com/seata/seata.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report a doc issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/seata/seata.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Edit This Page on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/community">Community</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="//img.alicdn.com/tfs/TB1dGrSwVT7gK0jSZFpXXaTkpXa-4802-1285.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="120" height="36"><img src="//img.alicdn.com/tfs/TB1dGrSwVT7gK0jSZFpXXaTkpXa-4802-1285.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="120" height="36"></div><div class="footer__copyright">Copyright © 2023 Seata</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6888d26e.js"></script>
<script src="/assets/js/main.96f5711d.js"></script>
</body>
</html>