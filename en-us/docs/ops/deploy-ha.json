{
  "filename": "deploy-ha.md",
  "__html": "<h1>High Available Usage Deployment</h1>\n<blockquote>\n<p>High available usage deployment of Seata depends on registry center, configuration center and database.</p>\n</blockquote>\n<h2>Seata-Server</h2>\n<p>The Seata-Server need registry center, and save transaction data into database, for example, use Nacos</p>\n<ul>\n<li>Modify configuration in <code>registry.conf</code></li>\n</ul>\n<pre><code>registry {\n  type = &quot;nacos&quot;\n\n  nacos {\n    application = &quot;seata-server&quot;\n    serverAddr = &quot;192.168.199.2&quot;\n    namespace = &quot;&quot;\n    cluster = &quot;default&quot;\n    username = &quot;&quot;\n    password = &quot;&quot;\n  }\n}\n\nconfig {\n  type = &quot;nacos&quot;\n  \n  nacos {\n    serverAddr = &quot;192.168.199.2&quot;\n    namespace = &quot;&quot;\n    group = &quot;SEATA_GROUP&quot;\n    username = &quot;&quot;\n    password = &quot;&quot;\n  }\n}\n</code></pre>\n<ul>\n<li>Modify configuration in configuration center</li>\n</ul>\n<pre><code>service.vgroupMapping.my_test_tx_group=default\nstore.mode=db\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://192.168.199.2:30060/seata?useUnicode=true\nstore.db.user=root\nstore.db.password=123456\n</code></pre>\n<ul>\n<li>Create table <code>global_table</code>, <code>branch_table</code>, <code>lock_table</code> in database</li>\n</ul>\n<p>Please reference script on <a href=\"https://github.com/seata/seata/tree/develop/script/server/db\">/script/server/db/</a></p>\n<p>Now, startup multiple seata-server, and then the server is support high available usage.</p>\n<hr>\n<p>For example, using Kubernetes deploy, the configuration file like:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  type:</span> <span class=\"hljs-string\">ClusterIP</span>\n<span class=\"hljs-attr\">  ports:</span>\n<span class=\"hljs-attr\">    - port:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">      protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">      name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">  selector:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n\n<span class=\"hljs-meta\">---</span>\n\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">3</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n      <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n        <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_CONFIG_NAME</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-attr\">file:/root/seata-config/registry</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">          volumeMounts:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">              mountPath:</span> <span class=\"hljs-string\">/root/seata-config</span>\n<span class=\"hljs-attr\">      volumes:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">          configMap:</span>\n<span class=\"hljs-attr\">            name:</span> <span class=\"hljs-string\">seata-ha-server-config</span>\n\n\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server-config</span>\n<span class=\"hljs-attr\">data:</span>\n  <span class=\"hljs-string\">registry.conf:</span> <span class=\"hljs-string\">|\n    registry {\n        type = \"nacos\"\n        nacos {\n          application = \"seata-server\"\n          serverAddr = \"192.168.199.2\"\n        }\n    }\n    config {\n      type = \"nacos\"\n      nacos {\n        serverAddr = \"192.168.199.2\"\n        group = \"SEATA_GROUP\"\n      }\n    }\n</span></code></pre>\n<p>You can reference <a href=\"https://seata.io/zh-cn/blog/seata-ha-practice.html\">seata-ha-deploy-practice</a> for more detail about practice of HA deploy.</p>\n",
  "link": "/en-us/docs/ops/deploy-ha.html",
  "meta": {
    "hidden": "true",
    "title": "High Available Usage Deployment",
    "keywords": "kubernetes,ops",
    "description": "High Available Usage Deployment",
    "author": "helloworlde",
    "date": "2020-04-10"
  }
}