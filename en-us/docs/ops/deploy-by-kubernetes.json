{
  "filename": "deploy-by-kubernetes.md",
  "__html": "<h1>Deploy Seata Server By Kubernetes</h1>\n<h3>Last Updated</h3>\n<ul>\n<li>2022.07.23 适配 Seata 1.5.x 增加控制台默认端口7091；seata-sever 在1.5.x 以下版本读取conf配置更改为yml配置文件。</li>\n</ul>\n<h3>Quick Start</h3>\n<p>Create file <code>seata-server.yaml</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  type:</span> <span class=\"hljs-string\">NodePort</span>\n<span class=\"hljs-attr\">  ports:</span>\n<span class=\"hljs-attr\">    - port:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">      nodePort:</span> <span class=\"hljs-number\">30091</span>\n<span class=\"hljs-attr\">      protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">      name:</span> <span class=\"hljs-string\">service</span>\n<span class=\"hljs-attr\">    - port:</span> <span class=\"hljs-number\">7091</span>\n<span class=\"hljs-attr\">      nodePort:</span> <span class=\"hljs-number\">30092</span>\n<span class=\"hljs-attr\">      protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">      name:</span> <span class=\"hljs-string\">console</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n\n<span class=\"hljs-meta\">---</span>\n\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n<span class=\"hljs-attr\">      k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n<span class=\"hljs-attr\">        k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_PORT</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-string\">\"8091\"</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">STORE_MODE</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-string\">file</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">service</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">console</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">7091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n</code></pre>\n<pre><code class=\"language-bash\">$ kubectl apply -f seata-server.yaml\n</code></pre>\n<h2>Custom configuration</h2>\n<h3>Environment</h3>\n<p>The environment is same with Docker, can reference <a href=\"./deploy-by-docker.md\">Deploy Seata Server By Docker</a></p>\n<h3>Use specify configuration file</h3>\n<p>Can specify configuration file by mount files or use ConfigMap, and then need specify environment <code>SEATA_CONFIG_NAME</code>, the value need start with <code>file:</code>, like <code>file:/root/seata-config/registry</code></p>\n<ul>\n<li>Deployment</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n<span class=\"hljs-attr\">      k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n<span class=\"hljs-attr\">        k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_CONFIG_NAME</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-attr\">file:/seata-server/conf/</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">service</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">console</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">7091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">          volumeMounts:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">              mountPath:</span> <span class=\"hljs-string\">/root/seata-config</span>\n<span class=\"hljs-attr\">      volumes:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">          configMap:</span>\n<span class=\"hljs-attr\">            name:</span> <span class=\"hljs-string\">seata-server-config</span>\n\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-number\">1.5</span><span class=\"hljs-string\">.x</span> <span class=\"hljs-string\">以下版本</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server-config</span>\n<span class=\"hljs-attr\">data:</span>\n  <span class=\"hljs-string\">registry.conf:</span> <span class=\"hljs-string\">|\n    registry {\n        type = \"nacos\"\n        nacos {\n          application = \"seata-server\"\n          serverAddr = \"127.0.0.1:8848\"\n        }\n    }\n    config {\n      type = \"nacos\"\n      nacos {\n        serverAddr = \"127.0.0.1:8848\"\n        group = \"SEATA_GROUP\"\n      }\n    }\n\n---\n1.5.x 版本 ConfigMap\n---\n\n</span><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server-config</span>\n<span class=\"hljs-attr\">data:</span>\n  <span class=\"hljs-string\">application.yml:</span> <span class=\"hljs-string\">|\n</span><span class=\"hljs-attr\">    server:</span>\n<span class=\"hljs-attr\">      port:</span> <span class=\"hljs-number\">7091</span>\n    \n<span class=\"hljs-attr\">    spring:</span>\n<span class=\"hljs-attr\">      application:</span>\n<span class=\"hljs-attr\">        name:</span> <span class=\"hljs-string\">seata-server</span>\n    \n<span class=\"hljs-attr\">    logging:</span>\n<span class=\"hljs-attr\">      config:</span> <span class=\"hljs-attr\">classpath:logback-spring.xml</span>\n<span class=\"hljs-attr\">      file:</span>\n<span class=\"hljs-attr\">        path:</span> <span class=\"hljs-string\">${user.home}/logs/seata</span>\n    \n<span class=\"hljs-attr\">    console:</span>\n<span class=\"hljs-attr\">      user:</span>\n<span class=\"hljs-attr\">        username:</span> <span class=\"hljs-string\">seata</span>\n<span class=\"hljs-attr\">        password:</span> <span class=\"hljs-string\">seata</span>\n    \n<span class=\"hljs-attr\">    seata:</span>\n<span class=\"hljs-attr\">      config:</span>\n        <span class=\"hljs-comment\"># support: nacos, consul, apollo, zk, etcd3</span>\n<span class=\"hljs-attr\">        type:</span> <span class=\"hljs-string\">nacos</span>\n<span class=\"hljs-attr\">        nacos:</span>\n<span class=\"hljs-attr\">          server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n<span class=\"hljs-attr\">          group:</span> <span class=\"hljs-string\">SEATA_GROUP</span>\n<span class=\"hljs-attr\">          username:</span> <span class=\"hljs-string\">xxx</span>\n<span class=\"hljs-attr\">          password:</span> <span class=\"hljs-string\">xxx</span>\n          <span class=\"hljs-comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span>\n          <span class=\"hljs-comment\">#access-key: \"\"</span>\n          <span class=\"hljs-comment\">#secret-key: \"\"</span>\n<span class=\"hljs-attr\">          data-id:</span> <span class=\"hljs-string\">seataServer.properties</span>\n<span class=\"hljs-attr\">      registry:</span>\n        <span class=\"hljs-comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span>\n<span class=\"hljs-attr\">        type:</span> <span class=\"hljs-string\">nacos</span>\n<span class=\"hljs-attr\">        nacos:</span>\n<span class=\"hljs-attr\">          application:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">          server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n<span class=\"hljs-attr\">          group:</span> <span class=\"hljs-string\">SEATA_GROUP</span>\n<span class=\"hljs-attr\">          cluster:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">          username:</span> <span class=\"hljs-string\">xxx</span>\n<span class=\"hljs-attr\">          password:</span> <span class=\"hljs-string\">xxx</span>\n          <span class=\"hljs-comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span>\n          <span class=\"hljs-comment\">#access-key: \"\"</span>\n          <span class=\"hljs-comment\">#secret-key: \"\"</span>\n<span class=\"hljs-attr\">      store:</span>\n        <span class=\"hljs-comment\"># support: file 、 db 、 redis</span>\n<span class=\"hljs-attr\">        mode:</span> <span class=\"hljs-string\">db</span>\n<span class=\"hljs-attr\">        db:</span>\n<span class=\"hljs-attr\">          datasource:</span> <span class=\"hljs-string\">druid</span>\n<span class=\"hljs-attr\">          db-type:</span> <span class=\"hljs-string\">mysql</span>\n<span class=\"hljs-attr\">          driver-class-name:</span> <span class=\"hljs-string\">com.mysql.cj.jdbc.Driver</span>\n<span class=\"hljs-attr\">          url:</span> <span class=\"hljs-attr\">jdbc:mysql://xxx:3306/seata</span>\n<span class=\"hljs-attr\">          user:</span> <span class=\"hljs-string\">xxx</span>\n<span class=\"hljs-attr\">          password:</span> <span class=\"hljs-string\">xxx</span>\n<span class=\"hljs-attr\">          min-conn:</span> <span class=\"hljs-number\">5</span>\n<span class=\"hljs-attr\">          max-conn:</span> <span class=\"hljs-number\">100</span>\n<span class=\"hljs-attr\">      security:</span>\n<span class=\"hljs-attr\">        secretKey:</span> <span class=\"hljs-string\">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span>\n<span class=\"hljs-attr\">        tokenValidityInMilliseconds:</span> <span class=\"hljs-number\">1800000</span>\n<span class=\"hljs-attr\">        ignore:</span>\n<span class=\"hljs-attr\">          urls:</span> <span class=\"hljs-string\">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login</span>\n</code></pre>\n",
  "link": "/en-us/docs/ops/deploy-by-kubernetes.html",
  "meta": {
    "hidden": "true",
    "title": "Deploy Seata Server By Kubernetes",
    "keywords": "kubernetes,ops",
    "description": "Deploy Seata Server By Kubernetes",
    "author": "helloworlde",
    "date": "2022-07-23"
  }
}