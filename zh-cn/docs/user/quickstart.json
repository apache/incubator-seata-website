{
  "filename": "quickstart.md",
  "__html": "<h1>快速开始</h1>\n<p>让我们从一个微服务示例开始。</p>\n<h2>用例</h2>\n<p>用户购买商品的业务逻辑。整个业务逻辑由3个微服务提供支持：</p>\n<ul>\n<li>仓储服务：对给定的商品扣除仓储数量。</li>\n<li>订单服务：根据采购需求创建订单。</li>\n<li>帐户服务：从用户帐户中扣除余额。</li>\n</ul>\n<h3>架构图</h3>\n<p><img src=\"/img/architecture.png\" alt=\"Architecture\"></p>\n<h3>仓储服务</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">StorageService</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 扣除存储数量\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">deduct</span><span class=\"hljs-params\">(String commodityCode, <span class=\"hljs-keyword\">int</span> count)</span></span>;\n}\n</code></pre>\n<h3>订单服务</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OrderService</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 创建订单\n     */</span>\n    <span class=\"hljs-function\">Order <span class=\"hljs-title\">create</span><span class=\"hljs-params\">(String userId, String commodityCode, <span class=\"hljs-keyword\">int</span> orderCount)</span></span>;\n}\n</code></pre>\n<h3>帐户服务</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">AccountService</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 从用户账户中借出\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">debit</span><span class=\"hljs-params\">(String userId, <span class=\"hljs-keyword\">int</span> money)</span></span>;\n}\n</code></pre>\n<h3>主要业务逻辑</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BusinessServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">BusinessService</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> StorageService storageService;\n\n    <span class=\"hljs-keyword\">private</span> OrderService orderService;\n\n    <span class=\"hljs-comment\">/**\n     * 采购\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">purchase</span><span class=\"hljs-params\">(String userId, String commodityCode, <span class=\"hljs-keyword\">int</span> orderCount)</span> </span>{\n\n        storageService.deduct(commodityCode, orderCount);\n\n        orderService.create(userId, commodityCode, orderCount);\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">OrderService</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> OrderDAO orderDAO;\n\n    <span class=\"hljs-keyword\">private</span> AccountService accountService;\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Order <span class=\"hljs-title\">create</span><span class=\"hljs-params\">(String userId, String commodityCode, <span class=\"hljs-keyword\">int</span> orderCount)</span> </span>{\n\n        <span class=\"hljs-keyword\">int</span> orderMoney = calculate(commodityCode, orderCount);\n\n        accountService.debit(userId, orderMoney);\n\n        Order order = <span class=\"hljs-keyword\">new</span> Order();\n        order.userId = userId;\n        order.commodityCode = commodityCode;\n        order.count = orderCount;\n        order.money = orderMoney;\n\n        <span class=\"hljs-comment\">// INSERT INTO orders ...</span>\n        <span class=\"hljs-keyword\">return</span> orderDAO.insert(order);\n    }\n}\n</code></pre>\n<h2>SEATA 的分布式交易解决方案</h2>\n<p><img src=\"/img/solution.png\" alt=\"\">\n我们只需要使用一个 <code>@GlobalTransactional</code> 注解在业务方法上:</p>\n<pre><code class=\"language-java\">\n    <span class=\"hljs-meta\">@GlobalTransactional</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">purchase</span><span class=\"hljs-params\">(String userId, String commodityCode, <span class=\"hljs-keyword\">int</span> orderCount)</span> </span>{\n        ......\n    }\n</code></pre>\n<h2>由Dubbo + SEATA提供支持的示例</h2>\n<h3>步骤 1：建立数据库</h3>\n<ul>\n<li>要求：具有InnoDB引擎的MySQL。</li>\n</ul>\n<p><strong>注意:</strong> 实际上，在示例用例中，这3个服务应该有3个数据库。 但是，为了简单起见，我们只创建一个数据库并配置3个数据源。</p>\n<p>使用您刚创建的数据库 URL/username/password 修改Spring XML。</p>\n<p>dubbo-account-service.xml\ndubbo-order-service.xml\ndubbo-storage-service.xml</p>\n<pre><code class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"url\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"jdbc:mysql://x.x.x.x:3306/xxx\"</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"username\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"xxx\"</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"xxx\"</span> /&gt;</span>\n</code></pre>\n<h3>步骤 2：创建 UNDO_LOG 表</h3>\n<p>SEATA AT 模式需要 <code>UNDO_LOG</code> 表</p>\n<pre><code class=\"language-sql\"><span class=\"hljs-comment\">-- 注意此处0.3.0+ 增加唯一索引 ux_undo_log</span>\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`undo_log`</span> (\n  <span class=\"hljs-string\">`id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`branch_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`xid`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`context`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`rollback_info`</span> longblob <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`log_status`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`log_created`</span> datetime <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`log_modified`</span> datetime <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`ext`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`id`</span>),\n  <span class=\"hljs-keyword\">UNIQUE</span> <span class=\"hljs-keyword\">KEY</span> <span class=\"hljs-string\">`ux_undo_log`</span> (<span class=\"hljs-string\">`xid`</span>,<span class=\"hljs-string\">`branch_id`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n</code></pre>\n<h3>步骤 3：为示例业务创建表</h3>\n<pre><code class=\"language-sql\">\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`storage_tbl`</span>;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`storage_tbl`</span> (\n  <span class=\"hljs-string\">`id`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`commodity_code`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`count`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`id`</span>),\n  <span class=\"hljs-keyword\">UNIQUE</span> <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`commodity_code`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`order_tbl`</span>;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`order_tbl`</span> (\n  <span class=\"hljs-string\">`id`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`commodity_code`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`count`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-string\">`money`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`id`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`account_tbl`</span>;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`account_tbl`</span> (\n  <span class=\"hljs-string\">`id`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`money`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`id`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n</code></pre>\n<h3>步骤 4: 启动服务</h3>\n<ul>\n<li>从 <a href=\"https://github.com/seata/seata/releases\">https://github.com/seata/seata/releases</a>,下载服务器软件包，将其解压缩。</li>\n</ul>\n<pre><code class=\"language-shell\">Usage: sh seata-server.sh(for linux and mac) or cmd seata-server.bat(for windows) [options]\n  Options:\n    --host, -h\n      The address is expose to registration center and other service can access seata-server via this ip\n      Default: 0.0.0.0\n    --port, -p\n      The port to listen.\n      Default: 8091\n    --storeMode, -m\n      log store mode : file、db\n      Default: file\n    --help\n\ne.g.\n\nsh seata-server.sh -p 8091 -h 127.0.0.1 -m file\n</code></pre>\n<h3>步骤 5: 运行示例</h3>\n<p>示例仓库: <a href=\"https://github.com/seata/seata-samples\">seata-samples</a></p>\n<ul>\n<li>启动 DubboAccountServiceStarter</li>\n<li>启动 DubboStorageServiceStarter</li>\n<li>启动 DubboOrderServiceStarter</li>\n<li>运行 DubboBusinessTester for demo test</li>\n</ul>\n<p>TBD: 运行演示应用程序的脚本</p>\n",
  "link": "/zh-cn/docs/user/quickstart.html",
  "meta": {
    "title": "Seata 快速开始",
    "keywords": "Seata",
    "description": "Seata 快速开始。"
  }
}