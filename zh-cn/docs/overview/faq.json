{
  "filename": "faq.md",
  "__html": "<h1>常见问题</h1>\n<h3>Q: 发生下面异常是啥原因？ java.lang.NoSuchMethodError: com.fasterxml.jackson.databind.jsontype.TypeSerializer.typeId(Ljava/lang/Object;Lcom/fasterxml/jackson/core/JsonToken;) ？</h3>\n<p><strong>A:</strong>\nundolog序列化配置为jackson时，jackson版本需要为2.9.9+</p>\n<hr>\n<h3>Q: Seata 目前支持高可用吗？</h3>\n<p><strong>A:</strong>\n0.6版本开始支持，tc使用db模式共享全局事务会话信息，注册中心使用非file的seata支持的第三方注册中心</p>\n<hr>\n<h3>Q: undo_log表log_status=1的记录是做什么用的？</h3>\n<p><strong>A:</strong></p>\n<ul>\n<li>场景 ： 分支事务a注册TC后，a的本地事务提交前发生了全局事务回滚</li>\n<li>后果 ： 全局事务回滚成功，a资源被占用掉，产生了资源悬挂问题</li>\n<li>防悬挂措施： a回滚时发现回滚undo还未插入，则插入一条log_status=1的undo记录，a本地事务（业务写操作sql和对应undo为一个本地事务）提交时会因为undo表主键冲突而提交失败。</li>\n</ul>\n<hr>\n<h3>Q: 怎么使用Seata框架，来保证事务的隔离性？</h3>\n<p><strong>A:</strong>\n因seata一阶段本地事务已提交，为防止其他事务脏读脏写需要加强隔离。</p>\n<ol>\n<li>脏读 select语句加for update，代理方法增加@GlobalLock或@GlobalTransaction</li>\n<li>脏写 必须使用@GlobalTransaction\n注：如果你查询的业务的接口没有GlobalTransactional 包裹，也就是这个方法上压根没有分布式事务的需求，这时你可以在方法上标注@GlobalLock 注解，并且在查询语句上加 for update。\n如果你查询的接口在事务链路上外层有GlobalTransactional注解，那么你查询的语句只要加for update就行。设计这个注解的原因是在没有这个注解之前，需要查询分布式事务读已提交的数据，但业务本身不需要分布式事务。\n若使用GlobalTransactional注解就会增加一些没用的额外的rpc开销比如begin 返回xid，提交事务等。GlobalLock简化了rpc过程，使其做到更高的性能。</li>\n</ol>\n<hr>\n<h3>Q: 脏数据回滚失败如何处理 ?</h3>\n<p><strong>A:</strong></p>\n<ol>\n<li>脏数据需手动处理，根据日志提示修正数据或者将对应undo删除（可自定义实现FailureHandler做邮件通知或其他）</li>\n<li>关闭回滚时undo镜像校验，不推荐该方案。\n注：建议事前做好隔离保证无脏数据</li>\n</ol>\n<hr>\n<h3>Q: 为什么分支事务注册时, 全局事务状态不是begin ？</h3>\n<p><strong>A:</strong><br>\n异常：Could not register branch into global session xid = status = Rollbacked（还有Rollbacking、AsyncCommitting等等二阶段状态） while expecting Begin\n描述：分支事务注册时，全局事务状态需是一阶段状态begin，非begin不允许注册。属于seata框架层面正常的处理，用户可以从自身业务层面解决。\n有以下几种情况会出现该异常（可继续补充）</p>\n<ol>\n<li>分支事务是异步，全局事务无法感知它的执行进度，全局事务已进入二阶段，该异步分支才来注册</li>\n<li>服务a rpc 服务b超时（dubbo、feign等默认1秒超时），a上抛异常给tm，tm通知tc回滚，但是b还是收到了请求（网络延迟或rpc框架重试），然后去tc注册时发现全局事务已在回滚</li>\n<li>tc感知全局事务超时(@GlobalTransactional(timeoutMills = 默认60秒))，主动变更状态并通知各分支事务回滚，此时有新的分支事务来注册</li>\n</ol>\n<hr>\n<h3>Q: Nacos 作为 Seata 配置中心时，项目启动报错找不到服务。如何排查，如何处理?</h3>\n<p><strong>A：</strong>\n异常：io.seata.common.exception.FrameworkException: can not register RM,err:can not connect to services-server.</p>\n<ol>\n<li>查看nacos配置列表，seata配置是否已经导入成功</li>\n<li>查看nacos服务列表，serverAddr是否已经注册成功</li>\n<li>检查client端的registry.conf里面的namespace，registry.nacos.namespace和config.nacos.namespace填入nacos的命名空间ID，默认&quot;&quot;，server端和client端对应，namespace\n为public是nacos的一个保留控件，如果您需要创建自己的namespace，最好不要和public重名，以一个实际业务场景有具体语义的名字来命名</li>\n<li>nacos上服务列表，serverAddr地址对应ip地址应为seata启动指定ip地址，如：sh <a href=\"http://seata-server.sh\">seata-server.sh</a> -p 8091 -h 122.51.204.197 -m file</li>\n<li>查看seata/conf/nacos-config.txt 事务分组service.vgroup_mapping.trade_group=default配置与项目分组配置名称是否一致</li>\n<li>telnet ip 端口 查看端口是都开放，以及防火墙状态\n注：1.080版本启动指定ip问题，出现异常Exception in thread &quot;main&quot; java.lang.RuntimeException: java.net.BindException: Cannot assign request address，请升级到081以上版本\n2.项目使用jdk13，启动出现</li>\n</ol>\n<pre><code class=\"language-verilog\">Error: Could <span class=\"hljs-keyword\">not</span> create the Java Virtual Machine.\nError: A fatal exception has occurred. Program will exit.\n</code></pre>\n<pre><code>    如环境为sh，替换脚本中最后一段：\n</code></pre>\n<pre><code class=\"language-shell\">        exec \"$JAVACMD\" $JAVA_OPTS -server -Xmx2048m -Xms2048m -Xmn1024m -Xss512k -XX:SurvivorRatio=10 -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m -XX:MaxDirectMemorySize=1024m -XX:-OmitStackTraceInFastThrow -XX:-UseAdaptiveSizePolicy -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=\"$BASEDIR\"/logs/java_heapdump.hprof -XX:+DisableExplicitGC -XX:+CMSParallelRemarkEnabled -XX:+\nUseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=75 -verbose:gc -Dio.netty.leakDetectionLevel=advanced \\\n      -classpath \"$CLASSPATH\" \\\n          -Dapp.name=\"seata-server\" \\\n          -Dapp.pid=\"$$\" \\\n          -Dapp.repo=\"$REPO\" \\\n          -Dapp.home=\"$BASEDIR\" \\\n          -Dbasedir=\"$BASEDIR\" \\\n          io.seata.server.Server \\\n          \"$@\"\n</code></pre>\n",
  "link": "/zh-cn/docs/overview/faq.html",
  "meta": {}
}