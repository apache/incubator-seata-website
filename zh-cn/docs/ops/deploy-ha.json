{
  "filename": "deploy-ha.md",
  "__html": "<h1>Seata 高可用部署</h1>\n<blockquote>\n<p>Seata 的高可用依赖于注册中心、配置中心和数据库来实现</p>\n</blockquote>\n<h2>Seata-Server</h2>\n<p>Seata-Server 需要使用注册中心，并把事务数据保存到数据库中，以 Nacos 为例</p>\n<ul>\n<li>修改<code>registry.conf</code>的注册中心配置</li>\n</ul>\n<pre><code>registry {\n  type = &quot;nacos&quot;\n\n  nacos {\n    application = &quot;seata-server&quot;\n    serverAddr = &quot;192.168.199.2&quot;\n    namespace = &quot;&quot;\n    cluster = &quot;default&quot;\n    username = &quot;&quot;\n    password = &quot;&quot;\n  }\n}\n\nconfig {\n  type = &quot;nacos&quot;\n  \n  nacos {\n    serverAddr = &quot;192.168.199.2&quot;\n    namespace = &quot;&quot;\n    group = &quot;SEATA_GROUP&quot;\n    username = &quot;&quot;\n    password = &quot;&quot;\n  }\n}\n</code></pre>\n<ul>\n<li>需要修改配置中心的以下几个配置</li>\n</ul>\n<pre><code>service.vgroupMapping.my_test_tx_group=default\nstore.mode=db\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://192.168.199.2:30060/seata?useUnicode=true\nstore.db.user=root\nstore.db.password=123456\n</code></pre>\n<ul>\n<li>在数据库创建 <code>global_table</code>, <code>branch_table</code>, <code>lock_table</code>表</li>\n</ul>\n<p>相应的脚本在GitHub 的 <a href=\"https://github.com/seata/seata/tree/develop/script/server/db\">/script/server/db/</a> 目录下</p>\n<p>这样，启动多个seata-server，即可实现其高可用</p>\n<hr>\n<p>以 Kubernetes 为例，部署文件参考:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  type:</span> <span class=\"hljs-string\">ClusterIP</span>\n<span class=\"hljs-attr\">  ports:</span>\n<span class=\"hljs-attr\">    - port:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">      protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">      name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">  selector:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n\n<span class=\"hljs-meta\">---</span>\n\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n    <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">3</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n      <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n        <span class=\"hljs-string\">app.kubernetes.io/name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-ha-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_CONFIG_NAME</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-attr\">file:/root/seata-config/registry</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">          volumeMounts:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">              mountPath:</span> <span class=\"hljs-string\">/root/seata-config</span>\n<span class=\"hljs-attr\">      volumes:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">          configMap:</span>\n<span class=\"hljs-attr\">            name:</span> <span class=\"hljs-string\">seata-ha-server-config</span>\n\n\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-ha-server-config</span>\n<span class=\"hljs-attr\">data:</span>\n  <span class=\"hljs-string\">registry.conf:</span> <span class=\"hljs-string\">|\n    registry {\n        type = \"nacos\"\n        nacos {\n          application = \"seata-server\"\n          serverAddr = \"192.168.199.2\"\n        }\n    }\n    config {\n      type = \"nacos\"\n      nacos {\n        serverAddr = \"192.168.199.2\"\n        group = \"SEATA_GROUP\"\n      }\n    }\n</span></code></pre>\n<p>关于 Seata 高可用部署的实践可以参考 <a href=\"https://seata.io/zh-cn/blog/seata-ha-practice.html\">Seata 高可用部署实践</a></p>\n",
  "link": "/zh-cn/docs/ops/deploy-ha.html",
  "meta": {
    "hidden": "true",
    "title": "Seata 高可用部署",
    "keywords": "kubernetes,ops",
    "description": "Seata 高可用部署",
    "author": "helloworlde",
    "date": "2020-04-10"
  }
}