{
  "filename": "deploy-by-kubernetes.md",
  "__html": "<h1>使用 Kubernetes 部署 Seata Server</h1>\n<h3>快速启动</h3>\n<p>创建 <code>seata-server.yaml</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  type:</span> <span class=\"hljs-string\">NodePort</span>\n<span class=\"hljs-attr\">  ports:</span>\n<span class=\"hljs-attr\">    - port:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">      nodePort:</span> <span class=\"hljs-number\">30091</span>\n<span class=\"hljs-attr\">      protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">      name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n\n<span class=\"hljs-meta\">---</span>\n\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n<span class=\"hljs-attr\">      k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n<span class=\"hljs-attr\">        k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_PORT</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-string\">\"8091\"</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">STORE_MODE</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-string\">file</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n</code></pre>\n<pre><code class=\"language-bash\">$ kubectl apply -f seata-server.yaml\n</code></pre>\n<h2>自定义配置</h2>\n<h3>环境变量</h3>\n<p>支持的环境变量和 Docker 相同，可以参考 <a href=\"./deploy-by-docker.md\">使用 Docker 部署 Seata Server</a></p>\n<h3>使用自定义配置文件</h3>\n<p>指定配置文件可以通过挂载文件或使用 ConfigMap 的方式实现，挂载后需要通过指定 <code>SEATA_CONFIG_NAME</code> 指定配置文件位置，并且环境变量的值需要以<code>file:</code>开始, 如: <code>file:/root/seata-config/registry</code></p>\n<ul>\n<li>Deployment</li>\n</ul>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  namespace:</span> <span class=\"hljs-string\">default</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  replicas:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n<span class=\"hljs-attr\">      k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">  template:</span>\n<span class=\"hljs-attr\">    metadata:</span>\n<span class=\"hljs-attr\">      labels:</span>\n<span class=\"hljs-attr\">        k8s-app:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">    spec:</span>\n<span class=\"hljs-attr\">      containers:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-server</span>\n<span class=\"hljs-attr\">          image:</span> <span class=\"hljs-string\">docker.io/seataio/seata-server:latest</span>\n<span class=\"hljs-attr\">          imagePullPolicy:</span> <span class=\"hljs-string\">IfNotPresent</span>\n<span class=\"hljs-attr\">          env:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">SEATA_CONFIG_NAME</span>\n<span class=\"hljs-attr\">              value:</span> <span class=\"hljs-attr\">file:/root/seata-config/registry</span>\n<span class=\"hljs-attr\">          ports:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">http</span>\n<span class=\"hljs-attr\">              containerPort:</span> <span class=\"hljs-number\">8091</span>\n<span class=\"hljs-attr\">              protocol:</span> <span class=\"hljs-string\">TCP</span>\n<span class=\"hljs-attr\">          volumeMounts:</span>\n<span class=\"hljs-attr\">            - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">              mountPath:</span> <span class=\"hljs-string\">/root/seata-config</span>\n<span class=\"hljs-attr\">      volumes:</span>\n<span class=\"hljs-attr\">        - name:</span> <span class=\"hljs-string\">seata-config</span>\n<span class=\"hljs-attr\">          configMap:</span>\n<span class=\"hljs-attr\">            name:</span> <span class=\"hljs-string\">seata-server-config</span>\n\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ConfigMap</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">seata-server-config</span>\n<span class=\"hljs-attr\">data:</span>\n  <span class=\"hljs-string\">registry.conf:</span> <span class=\"hljs-string\">|\n    registry {\n        type = \"nacos\"\n        nacos {\n          application = \"seata-server\"\n          serverAddr = \"192.168.199.2\"\n        }\n    }\n    config {\n      type = \"nacos\"\n      nacos {\n        serverAddr = \"192.168.199.2\"\n        group = \"SEATA_GROUP\"\n      }\n    }\n</span></code></pre>\n",
  "link": "/zh-cn/docs/ops/deploy-by-kubernetes.html",
  "meta": {
    "hidden": "true",
    "title": "使用 Kubernetes 部署 Seata Server",
    "keywords": "kubernetes,ops",
    "description": "使用 Kubernetes 部署 Seata Server",
    "author": "helloworlde",
    "date": "2019-12-01"
  }
}