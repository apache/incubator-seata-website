<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Seata 极简入门 | Seata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://seata.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://seata.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://seata.io/zh-cn/blog/seata-quick-start"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Seata 极简入门 | Seata"><meta data-rh="true" name="description" content="从 0 开始入门 Seata，搭建 Seata 服务，并接入 Java 项目中实现分布式事务"><meta data-rh="true" property="og:description" content="从 0 开始入门 Seata，搭建 Seata 服务，并接入 Java 项目中实现分布式事务"><meta data-rh="true" name="keywords" content="fescar、seata、分布式事务"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-04-19T00:00:00.000Z"><link data-rh="true" rel="icon" href="/zh-cn/img/seata_logo_small.jpeg"><link data-rh="true" rel="canonical" href="https://seata.io/zh-cn/blog/seata-quick-start"><link data-rh="true" rel="alternate" href="https://seata.io/blog/seata-quick-start" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://seata.io/zh-cn/blog/seata-quick-start" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://seata.io/blog/seata-quick-start" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ICHFIJRDZF-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh-cn/blog/rss.xml" title="Seata RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-cn/blog/atom.xml" title="Seata Atom Feed">


<link rel="search" type="application/opensearchdescription+xml" title="Seata" href="/zh-cn/opensearch.xml">

<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=seata">
<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-X4LJGF90X2" async></script><link rel="stylesheet" href="/zh-cn/assets/css/styles.4de6876d.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.ac869c1d.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.1a37f6d2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>


<script src="https://hm.baidu.com/hm.js?104e73ef0c18b416b27abb23757ed8ee"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-cn/">首页</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/overview/what-is-seata" href="/zh-cn/docs/overview/what-is-seata">v2.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/docs/next/overview/what-is-seata">预览版</a></li><li><a class="dropdown__link" href="/zh-cn/docs/overview/what-is-seata">v2.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.8/overview/what-is-seata">v1.8</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.7/overview/what-is-seata">v1.7</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.6/overview/what-is-seata">v1.6</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.5/overview/what-is-seata">v1.5</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.4/overview/what-is-seata">v1.4</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.3/overview/what-is-seata">v1.3</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.2/overview/what-is-seata">v1.2</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.1/overview/what-is-seata">v1.1</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.0/overview/what-is-seata">v1.0</a></li></ul></div><a class="navbar__item navbar__link" href="/zh-cn/docs/developers/contributor-guide/new-contributor-guide_dev">开发者</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/blog">博客</a><a class="navbar__item navbar__link" href="/zh-cn/community">社区</a><a class="navbar__item navbar__link" href="/zh-cn/docs/download">下载</a><a href="http://demo.seata.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">控制台样例</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中</a><ul class="dropdown__menu"><li><a href="/blog/seata-quick-start" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">En</a></li><li><a href="/zh-cn/blog/seata-quick-start" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/explore-seata-journey">探索 Seata 项目开源开发之旅</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-raft-detailed-explanation">Seata-Raft 存储模式详解及入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-connect-data-and-application">Seata：连接数据与应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-observable-practice">Seata的可观测实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-go-1.2.0">生产环境可用的 seata-go 1.2.0 来了！！！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/iscas2023">6大课题现已开放挑选 | 欢迎报名 Seata 开源之夏</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-1.6.0">Seata 1.6.0 重磅发布，大幅提升性能</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-1.5.2">Seata 1.5.2 重磅发布，支持xid负载均衡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-tcc-fence">阿里 Seata 新版本终于解决了 TCC 模式的幂等、悬挂和空回滚问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-tcc">深度剖析 Seata TCC 模式（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-lock">详解 Seata AT 模式事务隔离级别与全局锁设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-snowflake-explain">关于新版雪花算法的答疑</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-UUID-generator">Seata基于改良版雪花算法的分布式UUID生成器分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-feature-undo-log-compress">Seata新特性支持 -- undo_log压缩</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-dsproxy-deadlock">ConcurrentHashMap导致的Seata死锁问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-client-start-analysis-02">Seata应用侧启动过程剖析——注册中心与配置中心模块</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-client-start-analysis-01">Seata应用侧启动过程剖析——RM &amp; TM如何与TC建立连接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/integrate-seata-tcc-mode-with-spring-cloud">Spring Cloud集成Seata分布式事务-TCC模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-config-manager">Seata配置管理原理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-golang-communication-mode">seata-golang 通信模型详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-datasource-proxy">Seata数据源代理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-sourcecode-client-bootstrap">分布式事务Seata源码-Client端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-demo-in-mac">Mac下的Seata Demo环境搭建（AT模式）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-rpc-refactor">Seata RPC 模块的重构之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-sourcecode-server-bootstrap">分布式事务Seata源码-Server端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-xa-introduce">分布式事务如何实现？深入解读 Seata 的 XA 模式</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zh-cn/blog/seata-quick-start">Seata 极简入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-ha-practice">Seata 高可用部署实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-config-modular">Seata config 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-dubbo-transmit-xid">源码分析Seata-XID传递 Dubbo篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-tcc-modular">Seata tcc 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-community-meetup-hangzhou-ready">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-core-modular">Seata core 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-spring-boot-aop-aspectj">通过AOP动态创建/关闭Seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-dynamic-config-and-dynamic-disable">Seata 动态配置订阅与降级实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-config-center">Seata 配置中心实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-nacos-docker">Docker部署Seata与Nacos整合</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-nacos-analysis">Seata分布式事务启用Nacos做配置中心</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-meetup-hangzhou">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-mybatisplus-analysis">透过源码解决SeataAT模式整合Mybatis-Plus失去MP特性的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/springboot-dubbo-mybatisplus-seata">SpringBoot+Dubbo+MybatisPlus整合seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-start-rm-tm">Seata 客户端需要同时启动 RM 和 TM 吗？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-start">Seata AT 模式启动源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/design-more-flexable-application-by-saga">基于 Seata Saga 设计更有弹性的金融应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-tcc-saga">分布式事务 Seata 及其三种模式详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-design">分布式事务中间件 Seata 的设计原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-go-server">Seata分布式Go Server正式开源-TaaS设计简介</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/how-to-support-spring-cloud">Fescar 与 Spring Cloud 集成源码深度剖析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/integrate-seata-with-spring-cloud">Seata（Fescar）分布式事务 整合 Spring Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-java-client">分布式事务之Seata-Client原理及流程详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-java-server">深度剖析一站式分布式事务方案Seata-Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/tcc-mode-applicable-scenario-analysis">TCC适用模型与适用场景分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/tcc-mode-design-principle">TCC 理论及设计实现指南介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/quick-start-use-seata-and-dubbo-services">如何使用Seata保证Dubbo微服务间的一致性</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-simple">Fescar分布式事务原理解析探秘</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/manual-transaction-mode">MT 模式</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Seata 极简入门</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-04-19T00:00:00.000Z" itemprop="datePublished">2020年4月19日</time> · <!-- -->阅读需 14 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">芋道源码</span></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><ul><li><a href="#">1. 概述</a></li><li><a href="#">2. 部署单机 TC Server</a></li><li><a href="#">3. 部署集群 TC Server</a></li><li><a href="#">4. 接入 Java 应用</a></li></ul><h1>1. 概述</h1><p><a href="https://github.com/seata/seata" target="_blank" rel="noopener noreferrer">Seata</a> 是<strong>阿里</strong>开源的一款开源的<strong>分布式事务</strong>解决方案，致力于提供高性能和简单易用的分布式事务服务。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-四种事务模式">1.1 四种事务模式<a href="#11-四种事务模式" class="hash-link" aria-label="1.1 四种事务模式的直接链接" title="1.1 四种事务模式的直接链接">​</a></h2><p>Seata 目标打造<strong>一站式</strong>的分布事务的解决方案，最终会提供四种事务模式：</p><ul><li>AT 模式：参见<a href="https://seata.io/zh-cn/docs/dev/mode/at-mode.html" target="_blank" rel="noopener noreferrer">《Seata AT 模式》</a>文档</li><li>TCC 模式：参见<a href="https://seata.io/zh-cn/docs/dev/mode/tcc-mode.html" target="_blank" rel="noopener noreferrer">《Seata TCC 模式》</a>文档</li><li>Saga 模式：参见<a href="https://seata.io/zh-cn/docs/dev/mode/saga-mode.html" target="_blank" rel="noopener noreferrer">《SEATA Saga 模式》</a>文档</li><li>XA 模式：正在开发中...</li></ul><p>目前使用的<strong>流行度</strong>情况是：AT &gt; TCC &gt; Saga。因此，我们在学习 Seata 的时候，可以花更多精力在 <strong>AT 模式</strong>上，最好搞懂背后的实现原理，毕竟分布式事务涉及到数据的正确性，出问题需要快速排查定位并解决。</p><blockquote><p>友情提示：具体的流行度，胖友可以选择看看 <a href="https://github.com/seata/seata/issues/1246" target="_blank" rel="noopener noreferrer">Wanted: who&#x27;s using Seata</a> 每个公司登记的使用方式。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-三种角色">1.2 三种角色<a href="#12-三种角色" class="hash-link" aria-label="1.2 三种角色的直接链接" title="1.2 三种角色的直接链接">​</a></h2><p>在 Seata 的架构中，一共有三个角色：</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/02.png" alt="三个角色" class="img_ev3q"></p><ul><li><strong>TC</strong> (Transaction Coordinator) - 事务协调者：维护全局和分支事务的状态，驱动<strong>全局事务</strong>提交或回滚。</li><li><strong>TM</strong> (Transaction Manager) - 事务管理器：定义<strong>全局事务</strong>的范围，开始全局事务、提交或回滚全局事务。</li><li><strong>RM</strong> ( Resource Manager ) - 资源管理器：管理<strong>分支事务</strong>处理的资源( Resource )，与 TC 交谈以注册分支事务和报告分支事务的状态，并驱动<strong>分支事务</strong>提交或回滚。</li></ul><p>其中，TC 为单独部署的 <strong>Server</strong> 服务端，TM 和 RM 为嵌入到应用中的 <strong>Client</strong> 客户端。</p><p>在 Seata 中，一个分布式事务的<strong>生命周期</strong>如下：</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/01.png" alt="架构图" class="img_ev3q"></p><blockquote><p>友情提示：看下艿艿添加的红色小勾。</p></blockquote><ul><li><p>TM 请求 TC 开启一个全局事务。TC 会生成一个 <strong>XID</strong> 作为该全局事务的编号。</p><blockquote><p><strong>XID</strong>，会在微服务的调用链路中传播，保证将多个微服务的子事务关联在一起。</p></blockquote></li><li><p>RM 请求 TC 将本地事务注册为全局事务的分支事务，通过全局事务的 <strong>XID</strong> 进行关联。</p></li><li><p>TM 请求 TC 告诉 <strong>XID</strong> 对应的全局事务是进行提交还是回滚。</p></li><li><p>TC 驱动 RM 们将 <strong>XID</strong> 对应的自己的本地事务进行提交还是回滚。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-框架支持情况">1.3 框架支持情况<a href="#13-框架支持情况" class="hash-link" aria-label="1.3 框架支持情况的直接链接" title="1.3 框架支持情况的直接链接">​</a></h2><p>Seata 目前提供了对主流的<strong>微服务框架</strong>的支持：</p><ul><li><p>Dubbo</p><blockquote><p>通过 <a href="https://github.com/seata/seata/blob/develop/integration/dubbo/" target="_blank" rel="noopener noreferrer"><code>seata-dubbo</code></a> 集成</p></blockquote></li><li><p>SOFA-RPC</p><blockquote><p>通过 <a href="https://github.com/seata/seata/blob/develop/integration/sofa-rpc/" target="_blank" rel="noopener noreferrer"><code>seata-sofa-rpc</code></a> 集成</p></blockquote></li><li><p>Motan</p><blockquote><p>通过 <a href="https://github.com/seata/seata/blob/develop/integration/motan/" target="_blank" rel="noopener noreferrer"><code>seata-motan</code></a> 集成</p></blockquote></li><li><p>gRPC</p><blockquote><p>通过 <a href="https://github.com/seata/seata/blob/develop/integration/gprc/" target="_blank" rel="noopener noreferrer"><code>seata-grpc</code></a> 集成</p></blockquote></li><li><p>Apache HttpClient</p><blockquote><p>通过 <a href="https://github.com/seata/seata/blob/develop/integration/http/" target="_blank" rel="noopener noreferrer"><code>seata-http</code></a> 集成</p></blockquote></li><li><p>Spring Cloud OpenFeign</p><blockquote><p>通过 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/" target="_blank" rel="noopener noreferrer"><code>spring-cloud-starter-alibaba-seata</code></a> 的 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/feign/" target="_blank" rel="noopener noreferrer"><code>feign</code></a> 模块</p></blockquote></li><li><p>Spring RestTemplate   </p><blockquote><p>通过 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/feign/SeataBeanPostProcessor.java" target="_blank" rel="noopener noreferrer"><code>spring-cloud-starter-alibaba-seata</code></a> 的 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/rest/" target="_blank" rel="noopener noreferrer"><code>rest</code></a> 模块</p></blockquote></li></ul><p>同时方便我们集成到 Java 项目当中，Seata 也提供了相应的 Starter 库：</p><ul><li><a href="https://mvnrepository.com/artifact/io.seata/seata-spring-boot-starter" target="_blank" rel="noopener noreferrer"><code>seata-spring-boot-starter</code></a></li><li><a href="https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-seata" target="_blank" rel="noopener noreferrer"><code>spring-cloud-starter-alibaba-seata</code></a></li></ul><p>因为 Seata 是基于 <a href="https://docs.oracle.com/javase/7/docs/api/javax/sql/DataSource.html" target="_blank" rel="noopener noreferrer">DataSource</a> 数据源进行<strong>代理</strong>来拓展，所以天然对主流的 ORM 框架提供了非常好的支持：</p><ul><li>MyBatis、MyBatis-Plus</li><li>JPA、Hibernate</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-案例情况">1.4 案例情况<a href="#14-案例情况" class="hash-link" aria-label="1.4 案例情况的直接链接" title="1.4 案例情况的直接链接">​</a></h2><p>从 <a href="https://github.com/seata/seata/issues/1246" target="_blank" rel="noopener noreferrer">Wanted: who&#x27;s using Seata</a> 的登记情况，Seata 已经在国内很多团队开始落地，其中不乏有滴滴、韵达等大型公司。可汇总如下图：</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/03.png" alt="汇总图" class="img_ev3q"></p><p>另外，在 <a href="https://github.com/seata/awesome-seata" target="_blank" rel="noopener noreferrer">awesome-seata</a> 仓库中，艿艿看到了滴滴等等公司的落地时的技术分享，还是非常真实可靠的。如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/04.png" alt="awesome-seata 滴滴" class="img_ev3q"></p><p>从案例的情况来说，Seata 可能给是目前已知最可靠的分布式事务解决方案，至少对它进行技术投入是非常不错的选择。</p><h1>2. 部署单机 TC Server</h1><p>本小节，我们来学习部署<strong>单机</strong> Seata <strong>TC</strong> Server，常用于学习或测试使用，不建议在生产环境中部署单机。</p><p>因为 TC 需要进行全局事务和分支事务的记录，所以需要对应的<strong>存储</strong>。目前，TC 有两种存储模式( <code>store.mode</code> )：</p><ul><li>file 模式：适合<strong>单机</strong>模式，全局事务会话信息在<strong>内存</strong>中读写，并持久化本地文件 <code>root.data</code>，性能较高。</li><li>db 模式：适合<strong>集群</strong>模式，全局事务会话信息通过 <strong>db</strong> 共享，相对性能差点。</li></ul><p>显然，我们将采用 file 模式，最终我们部署单机 TC Server 如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/11.png" alt="单机 TC Server" class="img_ev3q"></p><p>哔哔完这么多，我们开始正式部署单机 TC Server，这里艿艿使用 macOS 系统，和 Linux、Windows 是差不多的，胖友脑补翻译。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-下载-seata-软件包">2.1 下载 Seata 软件包<a href="#21-下载-seata-软件包" class="hash-link" aria-label="2.1 下载 Seata 软件包的直接链接" title="2.1 下载 Seata 软件包的直接链接">​</a></h2><p>打开 <a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">Seata 下载页面</a>，选择想要的 Seata 版本。这里，我们选择 <a href="https://github.com/seata/seata/releases/tag/v1.1.0" target="_blank" rel="noopener noreferrer">v1.1.0</a> 最新版本。</p><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir -p /Users/yunai/Seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /Users/yunai/Seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://github.com/seata/seata/releases/download/v1.1.0/seata-server-1.1.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tar -zxvf seata-server-1.1.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">24 -rw-r--r--    1 yunai  staff  11365 May 13  2019 LICENSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x    4 yunai  staff    128 Apr  2 07:46 bin # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x    9 yunai  staff    288 Feb 19 23:49 conf # 配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x  138 yunai  staff   4416 Apr  2 07:46 lib #  seata-*.jar + 依赖库 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-启动-tc-server">2.2 启动 TC Server<a href="#22-启动-tc-server" class="hash-link" aria-label="2.2 启动 TC Server的直接链接" title="2.2 启动 TC Server的直接链接">​</a></h2><p>执行 <code>nohup sh bin/seata-server.sh &amp;</code> 命令，启动 TC Server 在后台。在 <code>nohup.out</code> 文件中，我们看到如下日志，说明启动成功：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 File 存储器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-02 08:36:01.302 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load TransactionStoreManager[FILE] extension by class[io.seata.server.store.file.FileTransactionStoreManager]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-02 08:36:01.302 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load SessionManager[FILE] extension by class[io.seata.server.session.file.FileBasedSessionManager]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-02 08:36:01.597 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>默认配置下，Seata TC Server 启动在 <strong>8091</strong> 端点。</li></ul><p>因为我们使用 file 模式，所以可以看到用于持久化的本地文件 <code>root.data</code>。操作命令如下：</p><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -ls sessionStore/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 -rw-r--r--  1 yunai  staff  0 Apr  2 08:36 root.data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>后续，胖友可以阅读<a href="#">「4. 接入 Java 应用」</a>小节，开始使用 Seata 实现分布式事务。</p><h1>3. 部署集群 TC Server</h1><p>本小节，我们来学习部署<strong>集群</strong> Seata <strong>TC</strong> Server，实现高可用，生产环境下必备。在集群时，多个 Seata TC Server 通过 <strong>db</strong> 数据库，实现全局事务会话信息的共享。</p><p>同时，每个 Seata TC Server 可以注册自己到注册中心上，方便应用从注册中心获得到他们。最终我们部署 集群 TC Server 如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/21.png" alt="集群 TC Server" class="img_ev3q"></p><p>Seata TC Server 对主流的注册中心都提供了集成，具体可见 <a href="https://github.com/seata/seata/tree/develop/discovery" target="_blank" rel="noopener noreferrer">discovery</a> 目录。考虑到国内使用 Nacos 作为注册中心越来越流行，这里我们就采用它。</p><blockquote><p>友情提示：如果对 Nacos 不了解的胖友，可以参考<a href="http://www.iocoder.cn/Nacos/install/?self" target="_blank" rel="noopener noreferrer">《Nacos 安装部署》</a>文章。</p></blockquote><p>哔哔完这么多，我们开始正式部署单机 TC Server，这里艿艿使用 macOS 系统，和 Linux、Windows 是差不多的，胖友脑补翻译。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-下载-seata-软件包">3.1 下载 Seata 软件包<a href="#31-下载-seata-软件包" class="hash-link" aria-label="3.1 下载 Seata 软件包的直接链接" title="3.1 下载 Seata 软件包的直接链接">​</a></h2><p>打开 <a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">Seata 下载页面</a>，选择想要的 Seata 版本。这里，我们选择 <a href="https://github.com/seata/seata/releases/tag/v1.1.0" target="_blank" rel="noopener noreferrer">v1.1.0</a> 最新版本。</p><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir -p /Users/yunai/Seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /Users/yunai/Seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://github.com/seata/seata/releases/download/v1.1.0/seata-server-1.1.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tar -zxvf seata-server-1.1.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd seata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">24 -rw-r--r--    1 yunai  staff  11365 May 13  2019 LICENSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x    4 yunai  staff    128 Apr  2 07:46 bin # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x    9 yunai  staff    288 Feb 19 23:49 conf # 配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0 drwxr-xr-x  138 yunai  staff   4416 Apr  2 07:46 lib #  seata-*.jar + 依赖库 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="32-初始化数据库">3.2 初始化数据库<a href="#32-初始化数据库" class="hash-link" aria-label="3.2 初始化数据库的直接链接" title="3.2 初始化数据库的直接链接">​</a></h2><p>① 使用 <a href="https://github.com/seata/seata/blob/develop/script/server/db/mysql.sql" target="_blank" rel="noopener noreferrer"><code>mysql.sql</code></a> 脚本，初始化 Seata TC Server 的 db 数据库。脚本内容如下：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- the table to store GlobalSession data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE IF NOT EXISTS `global_table`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `xid`                       VARCHAR(128) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `transaction_id`            BIGINT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `status`                    TINYINT      NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `application_id`            VARCHAR(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `transaction_service_group` VARCHAR(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `transaction_name`          VARCHAR(128),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `timeout`                   INT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `begin_time`                BIGINT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `application_data`          VARCHAR(2000),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_create`                DATETIME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_modified`              DATETIME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIMARY KEY (`xid`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_transaction_id` (`transaction_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE = InnoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEFAULT CHARSET = utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- the table to store BranchSession data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE IF NOT EXISTS `branch_table`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `branch_id`         BIGINT       NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `xid`               VARCHAR(128) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `transaction_id`    BIGINT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `resource_group_id` VARCHAR(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `resource_id`       VARCHAR(256),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `branch_type`       VARCHAR(8),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `status`            TINYINT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `client_id`         VARCHAR(64),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `application_data`  VARCHAR(2000),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_create`        DATETIME(6),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_modified`      DATETIME(6),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIMARY KEY (`branch_id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_xid` (`xid`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE = InnoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEFAULT CHARSET = utf8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- the table to store lock data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE IF NOT EXISTS `lock_table`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `row_key`        VARCHAR(128) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `xid`            VARCHAR(96),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `transaction_id` BIGINT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `branch_id`      BIGINT       NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `resource_id`    VARCHAR(256),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `table_name`     VARCHAR(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `pk`             VARCHAR(36),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_create`     DATETIME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_modified`   DATETIME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIMARY KEY (`row_key`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_branch_id` (`branch_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE = InnoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEFAULT CHARSET = utf8;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 MySQL 中，创建 <code>seata</code> 数据库，并在该库下执行该脚本。最终结果如下图：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/22.png" alt="`seata` 数据库 - MySQL 5.X" class="img_ev3q"></p><p>② 修改 <code>conf/file</code> 配置文件，修改使用 db 数据库，实现 Seata TC Server 的全局事务会话信息的共享。如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/23.png" alt="`conf/file` 配置文件" class="img_ev3q"></p><p>③ MySQL8 的支持</p><blockquote><p>如果胖友使用的 MySQL 是 8.X 版本，则需要看该步骤。否则，可以直接跳过。</p></blockquote><p>首先，需要下载 MySQL 8.X JDBC 驱动，命令行操作如下：</p><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.19/mysql-connector-java-8.0.19.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，修改 <code>conf/file</code> 配置文件，使用该 MySQL 8.X JDBC 驱动。如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/24.png" alt="`seata` 数据库 - MySQL 8.X" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="33-设置使用-nacos-注册中心">3.3 设置使用 Nacos 注册中心<a href="#33-设置使用-nacos-注册中心" class="hash-link" aria-label="3.3 设置使用 Nacos 注册中心的直接链接" title="3.3 设置使用 Nacos 注册中心的直接链接">​</a></h2><p>修改 <code>conf/registry.conf</code> 配置文件，设置使用 Nacos 注册中心。如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/25.png" alt="`conf/registry.conf` 配置文件" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="34-启动-tc-server">3.4 启动 TC Server<a href="#34-启动-tc-server" class="hash-link" aria-label="3.4 启动 TC Server的直接链接" title="3.4 启动 TC Server的直接链接">​</a></h2><p>① 执行 <code>nohup sh bin/seata-server.sh -p 18091 -n 1 &amp;</code> 命令，启动<strong>第一个</strong> TC Server 在后台。</p><ul><li><code>-p</code>：Seata TC Server 监听的端口。</li><li><code>-n</code>：Server node。在多个 TC Server 时，需区分各自节点，用于生成不同区间的 transactionId 事务编号，以免冲突。</li></ul><p>在 <code>nohup.out</code> 文件中，我们看到如下日志，说明启动成功：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 DB 存储器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:12.793 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load DataSourceGenerator[dbcp] extension by class[io.seata.server.store.db.DbcpDataSourceGenerator]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loading class `com.mysql.jdbc.Driver&#x27;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#x27;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load LogStore[DB] extension by class[io.seata.core.store.db.LogStoreDataBaseDAO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load TransactionStoreManager[DB] extension by class[io.seata.server.store.db.DatabaseTransactionStoreManager]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load SessionManager[DB] extension by class[io.seata.server.session.db.DataBaseSessionManager]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:13.779 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 Nacos 注册中心</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-05 16:54:13.788 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load RegistryProvider[Nacos] extension by class[io.seata.discovery.registry.nacos.NacosRegistryProvider]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>② 执行 <code>nohup sh bin/seata-server.sh -p 28091 -n 2 &amp;</code> 命令，启动<strong>第二个</strong> TC Server 在后台。</p><p>③ 打开 Nacos 注册中心的控制台，我们可以看到有<strong>两个</strong> Seata TC Server 示例。如下图所示：<img loading="lazy" src="http://www.iocoder.cn/images/Seata/2017-01-01/26.png" alt="Nacos 控制台" class="img_ev3q"></p><h1>4. 接入 Java 应用</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="41-at-模式">4.1 AT 模式<a href="#41-at-模式" class="hash-link" aria-label="4.1 AT 模式的直接链接" title="4.1 AT 模式的直接链接">​</a></h2><p><strong>① Spring Boot</strong></p><p>1、<a href="http://www.iocoder.cn/Spring-Boot/Seata/?self" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot 分布式事务 Seata 入门》</a>的<a href="#">「2. AT 模式 + 多数据源」</a>小节，实现单体 Spring Boot 项目在多数据源下的分布式事务。</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Spring-Boot/2020-10-01/01.png" alt="整体图" class="img_ev3q"></p><p>2、<a href="http://www.iocoder.cn/Spring-Boot/Seata/?self" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot 分布式事务 Seata 入门》</a>的<a href="#">「AT 模式 + HttpClient 远程调用」</a>小节，实现多个 Spring Boot 项目的分布事务。</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Spring-Boot/2020-10-01/21.png" alt="整体图" class="img_ev3q"></p><p><strong>② Dubbo</strong></p><p><a href="http://www.iocoder.cn/Dubbo/Seata/?sef" target="_blank" rel="noopener noreferrer">《Dubbo 分布式事务 Seata 入门》</a>的<a href="#">「2. AT 模式」</a>小节，实现多个 Dubbo 服务下的分布式事务。</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Dubbo/2020-04-15/01.png" alt="整体图" class="img_ev3q"></p><p><strong>③ Spring Cloud</strong></p><p><a href="http://www.iocoder.cn/Spring-Cloud-Alibaba/Seata/?self" target="_blank" rel="noopener noreferrer">《芋道 Spring Cloud Alibaba 分布式事务 Seata 入门》</a>的<a href="#">「3. AT 模式 + Feign」</a>小节，实现多个 Spring Cloud 服务下的分布式事务。</p><p><img loading="lazy" src="http://www.iocoder.cn/images/Spring-Cloud/2020-07-15/01.png" alt="整体图" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="42-tcc-模式">4.2 TCC 模式<a href="#42-tcc-模式" class="hash-link" aria-label="4.2 TCC 模式的直接链接" title="4.2 TCC 模式的直接链接">​</a></h2><ul><li>文档：<a href="https://seata.io/zh-cn/docs/dev/mode/tcc-mode.html" target="_blank" rel="noopener noreferrer">《Seata 文档 —— TCC 模式》</a></li><li>示例：<a href="https://github.com/seata/seata-samples/blob/master/tcc" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-samples/blob/master/tcc</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="43-saga-模式">4.3 Saga 模式<a href="#43-saga-模式" class="hash-link" aria-label="4.3 Saga 模式的直接链接" title="4.3 Saga 模式的直接链接">​</a></h2><ul><li>文档：<a href="https://seata.io/zh-cn/docs/dev/mode/saga-mode.html" target="_blank" rel="noopener noreferrer">《Seata 文档 —— Saga 模式》</a></li><li>示例：<a href="https://github.com/seata/seata-samples/tree/master/saga" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-samples/tree/master/saga</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="44-xa-模式">4.4 XA 模式<a href="#44-xa-模式" class="hash-link" aria-label="4.4 XA 模式的直接链接" title="4.4 XA 模式的直接链接">​</a></h2><p>Seata 正在开发中...</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-cn/blog/seata-xa-introduce"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">分布式事务如何实现？深入解读 Seata 的 XA 模式</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/blog/seata-ha-practice"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Seata 高可用部署实践</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#11-四种事务模式" class="table-of-contents__link toc-highlight">1.1 四种事务模式</a></li><li><a href="#12-三种角色" class="table-of-contents__link toc-highlight">1.2 三种角色</a></li><li><a href="#13-框架支持情况" class="table-of-contents__link toc-highlight">1.3 框架支持情况</a></li><li><a href="#14-案例情况" class="table-of-contents__link toc-highlight">1.4 案例情况</a></li><li><a href="#21-下载-seata-软件包" class="table-of-contents__link toc-highlight">2.1 下载 Seata 软件包</a></li><li><a href="#22-启动-tc-server" class="table-of-contents__link toc-highlight">2.2 启动 TC Server</a></li><li><a href="#31-下载-seata-软件包" class="table-of-contents__link toc-highlight">3.1 下载 Seata 软件包</a></li><li><a href="#32-初始化数据库" class="table-of-contents__link toc-highlight">3.2 初始化数据库</a></li><li><a href="#33-设置使用-nacos-注册中心" class="table-of-contents__link toc-highlight">3.3 设置使用 Nacos 注册中心</a></li><li><a href="#34-启动-tc-server" class="table-of-contents__link toc-highlight">3.4 启动 TC Server</a></li><li><a href="#41-at-模式" class="table-of-contents__link toc-highlight">4.1 AT 模式</a></li><li><a href="#42-tcc-模式" class="table-of-contents__link toc-highlight">4.2 TCC 模式</a></li><li><a href="#43-saga-模式" class="table-of-contents__link toc-highlight">4.3 Saga 模式</a></li><li><a href="#44-xa-模式" class="table-of-contents__link toc-highlight">4.4 XA 模式</a></li></ul></div></div></div></div></div></div>
<script src="/zh-cn/assets/js/runtime~main.ac869c1d.js"></script>
<script src="/zh-cn/assets/js/main.1a37f6d2.js"></script>
</body>
</html>