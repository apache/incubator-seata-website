{
  "filename": "seata-analysis-go-server.md",
  "__html": "<h1>Seata 高可用服务端 TaaS 正式开源</h1>\n<h3>前言</h3>\n<p>TaaS 是 Seata 服务端（TC, Transaction Coordinator）的一种高可用实现，使用 <code>Golang</code> 编写。Taas 由InfiniVision (<a href=\"http://infinivision.cn\">http://infinivision.cn</a>) 贡献给Seata开源社区。现已正式开源，并贡献给 Seata 社区。</p>\n<p>在Seata开源之前，我们内部开始借鉴GTS以及一些开源项目来实现分布式事务的解决方案TaaS(Transaction as a Service)。</p>\n<p>在我们完成TaaS的服务端的开发工作后，Seata（当时还叫Fescar）开源了，并且引起了开源社区的广泛关注，加上阿里巴巴的平台影响力以及社区活跃度，我们认为Seata会成为今后开源分布式事务的标准，我们决定TaaS兼容Seata。</p>\n<p>在发现Seata的服务端的实现是单机的，高可用等并没有实现，于是我们与Seata社区负责人取得联系，并且决定把TaaS开源，回馈开源社区。 同时，我们会长期维护，并且和Seata版本保持同步。</p>\n<p>目前，Seata官方的Java高可用版本也在开发中，TaaS和该高可用版本的设计思想不同，在今后会长期共存。</p>\n<p>TaaS已经开源， github (<a href=\"https://github.com/seata/seata-go-server\">https://github.com/seata/seata-go-server</a>)，欢迎大家试用。</p>\n<h3>设计原则</h3>\n<ol>\n<li>高性能，性能和机器数量成正比，即通过加入新机器到集群中，就可以提升性能</li>\n<li>高可用，一台机器出现故障，系统能依旧可以对外提供服务，或者在较短的时间内恢复对外服务（Leader切换的时间）</li>\n<li>Auto-Rebalance，集群中增加新的机器，或者有机器下线，系统能够自动的做负载均衡</li>\n<li>强一致，系统的元数据强一致在多个副本中存储</li>\n</ol>\n<h3>设计</h3>\n<p><img src=\"/img/blog/taas.png\" alt=\"\"></p>\n<h4>高性能</h4>\n<p>TaaS的性能和机器数量成正比，为了支持这个特性，在TaaS中处理全局事务的最小单元称为<code>Fragment</code>，系统在启动的时候会设定每个Fragment支持的活跃全局事务的并发数，同时系统会对每个Fragment进行采样，一旦发现Fragment超负荷，会生成新的Fragment来处理更多的并发。</p>\n<h4>高可用</h4>\n<p>每个<code>Fragment</code>有多个副本和一个Leader，由Leader来处理请求。当Leader出现故障，系统会产生一个新的Leader来处理请求，在新Leader的选举过程中，这个Fragment对外不提供服务，通常这个间隔时间是几秒钟。</p>\n<h4>强一致</h4>\n<p>TaaS本身不存储全局事务的元数据，元数据存储在Elasticell   (<a href=\"https://github.com/deepfabric/elasticell\">https://github.com/deepfabric/elasticell</a>) 中，Elasticell是一个兼容redis协议的分布式的KV存储，它基于Raft协议来保证数据的一致性。</p>\n<h4>Auto-Rebalance</h4>\n<p>随着系统的运行，在系统中会存在许多<code>Fragment</code>以及它们的副本，这样会导致在每个机器上，<code>Fragment</code>的分布不均匀，特别是当旧的机器下线或者新的机器上线的时候。TaaS在启动的时候，会选择3个节点作为调度器的角色，调度器负责调度这些<code>Fragment</code>，用来保证每个机器上的Fragment的数量以及Leader个数大致相等，同时还会保证每个Fragment的副本数维持在指定的副本个数。</p>\n<h5>Fragment副本创建</h5>\n<p><img src=\"/img/blog/taas_add.png\" alt=\"\"></p>\n<ol>\n<li>t0时间点，Fragment1在Seata-TC1机器上创建</li>\n<li>t1时间点，Fragment1的副本Fragment1'在Seata-TC2机器上创建</li>\n<li>t2时间点，Fragment1的副本Fragment1&quot;在Seata-TC3机器上创建</li>\n</ol>\n<p>在t2时间点，Fragment1的三个副本创建完毕。</p>\n<h5>Fragment副本迁移</h5>\n<p><img src=\"/img/blog/taas_move.png\" alt=\"\"></p>\n<ol>\n<li>t0时刻点，系统一个存在4个Fragment，分别存在于Seata-TC1，Seata-TC2，Seata-TC3三台机器上</li>\n<li>t1时刻，加入新机器Seata-TC4</li>\n<li>t2时刻，有3个Fragment的副本被迁移到了Seata-TC4这台机器上</li>\n</ol>\n<h3>在线快速体验</h3>\n<p>我们在公网搭建了一个体验的环境：</p>\n<ul>\n<li>Seata服务端地址： 39.97.115.141:8091</li>\n<li>UI： <a href=\"http://39.97.115.141:8084/ui/index.html\">http://39.97.115.141:8084/ui/index.html</a></li>\n</ul>\n<h3>本地快速体验</h3>\n<p>使用docker-compose快速体验TaaS的功能。</p>\n<pre><code class=\"language-bash\">git <span class=\"hljs-built_in\">clone</span> https://github.com/seata/taas.git\ndocker-compse up -d\n</code></pre>\n<p>由于组件依赖较多，docker-compose启动30秒后，可以对外服务</p>\n<h4>Seata服务地址</h4>\n<p>服务默认监听在8091端口，修改Seata对应的服务端地址体验</p>\n<h4>Seata UI</h4>\n<p>访问WEB UI <code>http://127.0.0.1:8084/ui/index.html</code></p>\n<h3>关于InfiniVision</h3>\n<p>深见网络是一家技术驱动的企业级服务提供商，致力于利用人工智能、云计算、区块链、大数据，以及物联网边缘计算技术助力传统企业的数字化转型和升级。深见网络积极拥抱开源文化并将核心算法和架构开源，知名人脸识别软件 InsightFace (<a href=\"https://github.com/deepinsight/insightface\">https://github.com/deepinsight/insightface</a>) (曾多次获得大规模人脸识别挑战冠军)，以及分布式存储引擎 Elasticell (<a href=\"https://github.com/deepfabric/elasticell\">https://github.com/deepfabric/elasticell</a>) 等均是深见网络的开源产品。</p>\n<h3>关于作者</h3>\n<p>作者张旭，开源网关Gateway (<a href=\"https://github.com/fagongzi/gateway\">https://github.com/fagongzi/gateway</a>) 作者，目前就职于InfiniVision，负责基础架构相关的研发工作。</p>\n",
  "link": "/zh-cn/blog/seata-analysis-go-server.html",
  "meta": {
    "title": "Seata分布式Go Server正式开源-TaaS设计简介",
    "author": "fagongzi(zhangxu19830126@gmail.com)",
    "date": "2019/04/23",
    "keywords": "seata、分布式事务、高可用"
  }
}