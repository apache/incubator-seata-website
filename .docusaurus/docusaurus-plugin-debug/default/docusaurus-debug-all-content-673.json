{
  "docusaurus-plugin-content-docs": {
    "default": {
      "loadedVersions": [
        {
          "versionName": "current",
          "label": "Next",
          "banner": null,
          "badge": false,
          "noIndex": false,
          "className": "docs-version-current",
          "path": "/docs",
          "tagsPath": "/docs/tags",
          "isLast": true,
          "routePriority": -1,
          "sidebarFilePath": "/Users/chaixinyi/Documents/new/sidebars.js",
          "contentPath": "/Users/chaixinyi/Documents/new/docs",
          "contentPathLocalized": "/Users/chaixinyi/Documents/new/i18n/en/docusaurus-plugin-content-docs/current",
          "docs": [
            {
              "unversionedId": "dev/domain/overviewDomainModel",
              "id": "dev/domain/overviewDomainModel",
              "title": "overviewDomainModel",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/dev/domain/overviewDomainModel.md",
              "sourceDirName": "dev/domain",
              "slug": "/dev/domain/overviewDomainModel",
              "permalink": "/docs/dev/domain/overviewDomainModel",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "xa-mode",
                "permalink": "/docs/dev/mode/xa-mode"
              },
              "next": {
                "title": "tm",
                "permalink": "/docs/dev/domain/tm"
              }
            },
            {
              "unversionedId": "dev/domain/rm",
              "id": "dev/domain/rm",
              "title": "rm",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/dev/domain/rm.md",
              "sourceDirName": "dev/domain",
              "slug": "/dev/domain/rm",
              "permalink": "/docs/dev/domain/rm",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "tm",
                "permalink": "/docs/dev/domain/tm"
              },
              "next": {
                "title": "tc",
                "permalink": "/docs/dev/domain/tc"
              }
            },
            {
              "unversionedId": "dev/domain/tc",
              "id": "dev/domain/tc",
              "title": "tc",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/dev/domain/tc.md",
              "sourceDirName": "dev/domain",
              "slug": "/dev/domain/tc",
              "permalink": "/docs/dev/domain/tc",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "rm",
                "permalink": "/docs/dev/domain/rm"
              },
              "next": {
                "title": "Metrics design",
                "permalink": "/docs/dev/seata-mertics"
              }
            },
            {
              "unversionedId": "dev/domain/tm",
              "id": "dev/domain/tm",
              "title": "tm",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/dev/domain/tm.md",
              "sourceDirName": "dev/domain",
              "slug": "/dev/domain/tm",
              "permalink": "/docs/dev/domain/tm",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "overviewDomainModel",
                "permalink": "/docs/dev/domain/overviewDomainModel"
              },
              "next": {
                "title": "rm",
                "permalink": "/docs/dev/domain/rm"
              }
            },
            {
              "unversionedId": "dev/mode/at-mode",
              "id": "dev/mode/at-mode",
              "title": "Seata AT Mode",
              "description": "Seata AT mode.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/dev/mode/at-mode.md",
              "sourceDirName": "dev/mode",
              "slug": "/dev/mode/at-mode",
              "permalink": "/docs/dev/mode/at-mode",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Seata AT Mode",
                "keywords": [
                  "Seata",
                  "AT mode"
                ],
                "description": "Seata AT mode."
              },
              "sidebar": "docs",
              "previous": {
                "title": "isolation",
                "permalink": "/docs/user/appendix/isolation"
              },
              "next": {
                "title": "Seata TCC Mode",
                "permalink": "/docs/dev/mode/tcc-mode"
              }
            },
            {
              "unversionedId": "dev/mode/saga-mode",
              "id": "dev/mode/saga-mode",
              "title": "Seata Saga Mode",
              "description": "The Saga model is a long transaction solution provided by SEATA. In the Saga model, each participant in the business process submits a local transaction. When a participant fails, the previous successful participant is compensated. One stage is positive serving and The two-stage compensation services are implemented by business development.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/dev/mode/saga-mode.md",
              "sourceDirName": "dev/mode",
              "slug": "/dev/mode/saga-mode",
              "permalink": "/docs/dev/mode/saga-mode",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Seata Saga Mode",
                "keywords": [
                  "Seata",
                  "Saga mode"
                ],
                "description": "The Saga model is a long transaction solution provided by SEATA. In the Saga model, each participant in the business process submits a local transaction. When a participant fails, the previous successful participant is compensated. One stage is positive serving and The two-stage compensation services are implemented by business development."
              },
              "sidebar": "docs",
              "previous": {
                "title": "Seata TCC Mode",
                "permalink": "/docs/dev/mode/tcc-mode"
              },
              "next": {
                "title": "xa-mode",
                "permalink": "/docs/dev/mode/xa-mode"
              }
            },
            {
              "unversionedId": "dev/mode/tcc-mode",
              "id": "dev/mode/tcc-mode",
              "title": "Seata TCC Mode",
              "description": "Seata TCC mode.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/dev/mode/tcc-mode.md",
              "sourceDirName": "dev/mode",
              "slug": "/dev/mode/tcc-mode",
              "permalink": "/docs/dev/mode/tcc-mode",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Seata TCC Mode",
                "keywords": [
                  "Seata",
                  "TCC Mode"
                ],
                "description": "Seata TCC mode."
              },
              "sidebar": "docs",
              "previous": {
                "title": "Seata AT Mode",
                "permalink": "/docs/dev/mode/at-mode"
              },
              "next": {
                "title": "Seata Saga Mode",
                "permalink": "/docs/dev/mode/saga-mode"
              }
            },
            {
              "unversionedId": "dev/mode/xa-mode",
              "id": "dev/mode/xa-mode",
              "title": "xa-mode",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/dev/mode/xa-mode.md",
              "sourceDirName": "dev/mode",
              "slug": "/dev/mode/xa-mode",
              "permalink": "/docs/dev/mode/xa-mode",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "Seata Saga Mode",
                "permalink": "/docs/dev/mode/saga-mode"
              },
              "next": {
                "title": "overviewDomainModel",
                "permalink": "/docs/dev/domain/overviewDomainModel"
              }
            },
            {
              "unversionedId": "dev/seata-mertics",
              "id": "dev/seata-mertics",
              "title": "Metrics design",
              "description": "Seata Metrics.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/dev/seata-mertics.md",
              "sourceDirName": "dev",
              "slug": "/dev/seata-mertics",
              "permalink": "/docs/dev/seata-mertics",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Metrics design",
                "keywords": [
                  "Seata",
                  "Metrics"
                ],
                "description": "Seata Metrics."
              },
              "sidebar": "docs",
              "previous": {
                "title": "tc",
                "permalink": "/docs/dev/domain/tc"
              },
              "next": {
                "title": "upgrade",
                "permalink": "/docs/ops/upgrade"
              }
            },
            {
              "unversionedId": "developers/committer-guide/label-an-issue-guide_dev",
              "id": "developers/committer-guide/label-an-issue-guide_dev",
              "title": "Label an Issue",
              "description": "Label an Issue.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/committer-guide/label-an-issue-guide_dev.md",
              "sourceDirName": "developers/committer-guide",
              "slug": "/developers/committer-guide/label-an-issue-guide_dev",
              "permalink": "/docs/developers/committer-guide/label-an-issue-guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Label an Issue",
                "keywords": [
                  "Seata"
                ],
                "description": "Label an Issue."
              },
              "sidebar": "developers",
              "previous": {
                "title": "Contributing to Seata",
                "permalink": "/docs/developers/guide_dev"
              },
              "next": {
                "title": "Website Guide",
                "permalink": "/docs/developers/committer-guide/website-guide_dev"
              }
            },
            {
              "unversionedId": "developers/committer-guide/release-guide_dev",
              "id": "developers/committer-guide/release-guide_dev",
              "title": "release-guide_dev",
              "description": "TBD",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/committer-guide/release-guide_dev.md",
              "sourceDirName": "developers/committer-guide",
              "slug": "/developers/committer-guide/release-guide_dev",
              "permalink": "/docs/developers/committer-guide/release-guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "developers",
              "previous": {
                "title": "Website Guide",
                "permalink": "/docs/developers/committer-guide/website-guide_dev"
              }
            },
            {
              "unversionedId": "developers/committer-guide/website-guide_dev",
              "id": "developers/committer-guide/website-guide_dev",
              "title": "Website Guide",
              "description": "Website Guide.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/committer-guide/website-guide_dev.md",
              "sourceDirName": "developers/committer-guide",
              "slug": "/developers/committer-guide/website-guide_dev",
              "permalink": "/docs/developers/committer-guide/website-guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Website Guide",
                "keywords": [
                  "Seata"
                ],
                "description": "Website Guide."
              },
              "sidebar": "developers",
              "previous": {
                "title": "Label an Issue",
                "permalink": "/docs/developers/committer-guide/label-an-issue-guide_dev"
              },
              "next": {
                "title": "release-guide_dev",
                "permalink": "/docs/developers/committer-guide/release-guide_dev"
              }
            },
            {
              "unversionedId": "developers/contributor-activity/top-contributer_dev",
              "id": "developers/contributor-activity/top-contributer_dev",
              "title": "top-contributer_dev",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/developers/contributor-activity/top-contributer_dev.md",
              "sourceDirName": "developers/contributor-activity",
              "slug": "/developers/contributor-activity/top-contributer_dev",
              "permalink": "/docs/developers/contributor-activity/top-contributer_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "developers/contributor-guide/new-contributor-guide_dev",
              "id": "developers/contributor-guide/new-contributor-guide_dev",
              "title": "New contributor guide",
              "description": "This is a guide for new comers who wants to contribute to Seata.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/contributor-guide/new-contributor-guide_dev.md",
              "sourceDirName": "developers/contributor-guide",
              "slug": "/developers/contributor-guide/new-contributor-guide_dev",
              "permalink": "/docs/developers/contributor-guide/new-contributor-guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "New contributor guide",
                "keywords": [
                  "Seata",
                  "contributor"
                ],
                "description": "This is a guide for new comers who wants to contribute to Seata."
              },
              "sidebar": "developers",
              "previous": {
                "title": "Developers",
                "permalink": "/docs/developers/developers_dev"
              },
              "next": {
                "title": "Test coverage guide",
                "permalink": "/docs/developers/contributor-guide/test-coverage-guide_dev"
              }
            },
            {
              "unversionedId": "developers/contributor-guide/reporting-security-issues_dev",
              "id": "developers/contributor-guide/reporting-security-issues_dev",
              "title": "New contributor guide",
              "description": "This is a guide for new comers who wants to contribute to Seata.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/contributor-guide/reporting-security-issues_dev.md",
              "sourceDirName": "developers/contributor-guide",
              "slug": "/developers/contributor-guide/reporting-security-issues_dev",
              "permalink": "/docs/developers/contributor-guide/reporting-security-issues_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "New contributor guide",
                "keywords": [
                  "Seata",
                  "contributor"
                ],
                "description": "This is a guide for new comers who wants to contribute to Seata."
              },
              "sidebar": "developers",
              "previous": {
                "title": "Test coverage guide",
                "permalink": "/docs/developers/contributor-guide/test-coverage-guide_dev"
              },
              "next": {
                "title": "Contributing to Seata",
                "permalink": "/docs/developers/guide_dev"
              }
            },
            {
              "unversionedId": "developers/contributor-guide/test-coverage-guide_dev",
              "id": "developers/contributor-guide/test-coverage-guide_dev",
              "title": "Test coverage guide",
              "description": "Test coverage guide.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/contributor-guide/test-coverage-guide_dev.md",
              "sourceDirName": "developers/contributor-guide",
              "slug": "/developers/contributor-guide/test-coverage-guide_dev",
              "permalink": "/docs/developers/contributor-guide/test-coverage-guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Test coverage guide",
                "keywords": [
                  "Seata",
                  "coverage"
                ],
                "description": "Test coverage guide."
              },
              "sidebar": "developers",
              "previous": {
                "title": "New contributor guide",
                "permalink": "/docs/developers/contributor-guide/new-contributor-guide_dev"
              },
              "next": {
                "title": "New contributor guide",
                "permalink": "/docs/developers/contributor-guide/reporting-security-issues_dev"
              }
            },
            {
              "unversionedId": "developers/developers_dev",
              "id": "developers/developers_dev",
              "title": "Developers",
              "description": "Seata Team.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/developers_dev.md",
              "sourceDirName": "developers",
              "slug": "/developers/developers_dev",
              "permalink": "/docs/developers/developers_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Developers",
                "keywords": [
                  "Seata",
                  "Developers"
                ],
                "description": "Seata Team."
              },
              "sidebar": "developers",
              "next": {
                "title": "New contributor guide",
                "permalink": "/docs/developers/contributor-guide/new-contributor-guide_dev"
              }
            },
            {
              "unversionedId": "developers/guide_dev",
              "id": "developers/guide_dev",
              "title": "Contributing to Seata",
              "description": "It is warmly welcomed if you have interest to hack on Seata. First, we encourage this kind of willing very much. And here is a list of contributing guide for you.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/developers/guide_dev.md",
              "sourceDirName": "developers",
              "slug": "/developers/guide_dev",
              "permalink": "/docs/developers/guide_dev",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Contributing to Seata",
                "keywords": [
                  "Seata"
                ],
                "description": "It is warmly welcomed if you have interest to hack on Seata. First, we encourage this kind of willing very much. And here is a list of contributing guide for you."
              },
              "sidebar": "developers",
              "previous": {
                "title": "New contributor guide",
                "permalink": "/docs/developers/contributor-guide/reporting-security-issues_dev"
              },
              "next": {
                "title": "Label an Issue",
                "permalink": "/docs/developers/committer-guide/label-an-issue-guide_dev"
              }
            },
            {
              "unversionedId": "download",
              "id": "download",
              "title": "Downloads",
              "description": "This article will introduce you how to understand the details of each version and upgrade matters needing attention.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/download.md",
              "sourceDirName": ".",
              "slug": "/download",
              "permalink": "/docs/download",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Downloads",
                "keywords": [
                  "Seata",
                  "Downloads",
                  "Version"
                ],
                "description": "This article will introduce you how to understand the details of each version and upgrade matters needing attention."
              },
              "sidebar": "download"
            },
            {
              "unversionedId": "intro",
              "id": "intro",
              "title": "Tutorial Intro",
              "description": "Let's discover Docusaurus in less than 5 minutes.",
              "source": "@site/docs/intro.md",
              "sourceDirName": ".",
              "slug": "/intro",
              "permalink": "/docs/intro",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 1,
              "frontMatter": {
                "sidebar_position": 1
              }
            },
            {
              "unversionedId": "ops/config-center",
              "id": "ops/config-center",
              "title": "config-center",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/config-center.md",
              "sourceDirName": "ops",
              "slug": "/ops/config-center",
              "permalink": "/docs/ops/config-center",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "ops/deploy-by-docker",
              "id": "ops/deploy-by-docker",
              "title": "Deploy Seata Server By Docker",
              "description": "Deploy Seata Server By Docker",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/ops/deploy-by-docker.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-docker",
              "permalink": "/docs/ops/deploy-by-docker",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "hidden": true,
                "title": "Deploy Seata Server By Docker",
                "keywords": [
                  "docker"
                ],
                "description": "Deploy Seata Server By Docker",
                "author": "helloworlde",
                "date": "2019-11-25T00:00:00.000Z"
              },
              "sidebar": "docs",
              "previous": {
                "title": "Deploy Server",
                "permalink": "/docs/ops/deploy-server"
              },
              "next": {
                "title": "deploy-by-docker-compose",
                "permalink": "/docs/ops/deploy-by-docker-compose"
              }
            },
            {
              "unversionedId": "ops/deploy-by-docker-142",
              "id": "ops/deploy-by-docker-142",
              "title": "deploy-by-docker-142",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/deploy-by-docker-142.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-docker-142",
              "permalink": "/docs/ops/deploy-by-docker-142",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "ops/deploy-by-docker-compose",
              "id": "ops/deploy-by-docker-compose",
              "title": "deploy-by-docker-compose",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/deploy-by-docker-compose.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-docker-compose",
              "permalink": "/docs/ops/deploy-by-docker-compose",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "Deploy Seata Server By Docker",
                "permalink": "/docs/ops/deploy-by-docker"
              },
              "next": {
                "title": "Deploy Seata Server By Kubernetes",
                "permalink": "/docs/ops/deploy-by-kubernetes"
              }
            },
            {
              "unversionedId": "ops/deploy-by-docker-compose-142",
              "id": "ops/deploy-by-docker-compose-142",
              "title": "deploy-by-docker-compose-142",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/deploy-by-docker-compose-142.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-docker-compose-142",
              "permalink": "/docs/ops/deploy-by-docker-compose-142",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "ops/deploy-by-helm",
              "id": "ops/deploy-by-helm",
              "title": "Deploy Seata Server By Helm",
              "description": "Deploy Seata Server By Helm",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/ops/deploy-by-helm.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-helm",
              "permalink": "/docs/ops/deploy-by-helm",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "hidden": true,
                "title": "Deploy Seata Server By Helm",
                "keywords": [
                  "kubernetes",
                  "helm",
                  "ops"
                ],
                "description": "Deploy Seata Server By Helm",
                "author": "helloworlde",
                "date": "2019-12-01T00:00:00.000Z"
              },
              "sidebar": "docs",
              "previous": {
                "title": "Deploy Seata Server By Kubernetes",
                "permalink": "/docs/ops/deploy-by-kubernetes"
              },
              "next": {
                "title": "High Available Usage Deployment",
                "permalink": "/docs/ops/deploy-ha"
              }
            },
            {
              "unversionedId": "ops/deploy-by-kubernetes",
              "id": "ops/deploy-by-kubernetes",
              "title": "Deploy Seata Server By Kubernetes",
              "description": "Deploy Seata Server By Kubernetes",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/ops/deploy-by-kubernetes.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-by-kubernetes",
              "permalink": "/docs/ops/deploy-by-kubernetes",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "hidden": true,
                "title": "Deploy Seata Server By Kubernetes",
                "keywords": [
                  "kubernetes",
                  "ops"
                ],
                "description": "Deploy Seata Server By Kubernetes",
                "author": "helloworlde",
                "date": "2022-07-23T00:00:00.000Z"
              },
              "sidebar": "docs",
              "previous": {
                "title": "deploy-by-docker-compose",
                "permalink": "/docs/ops/deploy-by-docker-compose"
              },
              "next": {
                "title": "Deploy Seata Server By Helm",
                "permalink": "/docs/ops/deploy-by-helm"
              }
            },
            {
              "unversionedId": "ops/deploy-guide-beginner",
              "id": "ops/deploy-guide-beginner",
              "title": "deploy-guide-beginner",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/deploy-guide-beginner.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-guide-beginner",
              "permalink": "/docs/ops/deploy-guide-beginner",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "upgrade",
                "permalink": "/docs/ops/upgrade"
              },
              "next": {
                "title": "Deploy Server",
                "permalink": "/docs/ops/deploy-server"
              }
            },
            {
              "unversionedId": "ops/deploy-ha",
              "id": "ops/deploy-ha",
              "title": "High Available Usage Deployment",
              "description": "High Available Usage Deployment",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/ops/deploy-ha.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-ha",
              "permalink": "/docs/ops/deploy-ha",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "hidden": true,
                "title": "High Available Usage Deployment",
                "keywords": [
                  "kubernetes",
                  "ops"
                ],
                "description": "High Available Usage Deployment",
                "author": "helloworlde",
                "date": "2020-04-10T00:00:00.000Z"
              },
              "sidebar": "docs",
              "previous": {
                "title": "Deploy Seata Server By Helm",
                "permalink": "/docs/ops/deploy-by-helm"
              }
            },
            {
              "unversionedId": "ops/deploy-server",
              "id": "ops/deploy-server",
              "title": "Deploy Server",
              "description": "The server can deploy by multiple metho - Directly, Docker, Docker-Compose, Kubernetes, Helm.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/ops/deploy-server.md",
              "sourceDirName": "ops",
              "slug": "/ops/deploy-server",
              "permalink": "/docs/ops/deploy-server",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Deploy Server",
                "keywords": [
                  "Seata"
                ],
                "description": "The server can deploy by multiple metho - Directly, Docker, Docker-Compose, Kubernetes, Helm."
              },
              "sidebar": "docs",
              "previous": {
                "title": "deploy-guide-beginner",
                "permalink": "/docs/ops/deploy-guide-beginner"
              },
              "next": {
                "title": "Deploy Seata Server By Docker",
                "permalink": "/docs/ops/deploy-by-docker"
              }
            },
            {
              "unversionedId": "ops/upgrade",
              "id": "ops/upgrade",
              "title": "upgrade",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/ops/upgrade.md",
              "sourceDirName": "ops",
              "slug": "/ops/upgrade",
              "permalink": "/docs/ops/upgrade",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "Metrics design",
                "permalink": "/docs/dev/seata-mertics"
              },
              "next": {
                "title": "deploy-guide-beginner",
                "permalink": "/docs/ops/deploy-guide-beginner"
              }
            },
            {
              "unversionedId": "overview/faq",
              "id": "overview/faq",
              "title": "FAQ",
              "description": "Seata FAQ.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/overview/faq.md",
              "sourceDirName": "overview",
              "slug": "/overview/faq",
              "permalink": "/docs/overview/faq",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "FAQ",
                "keywords": [
                  "Seata"
                ],
                "description": "Seata FAQ."
              },
              "sidebar": "docs",
              "previous": {
                "title": "Terminology",
                "permalink": "/docs/overview/terminology"
              },
              "next": {
                "title": "Quick Start",
                "permalink": "/docs/user/quickstart"
              }
            },
            {
              "unversionedId": "overview/terminology",
              "id": "overview/terminology",
              "title": "Terminology",
              "description": "Seata Terminology.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/overview/terminology.md",
              "sourceDirName": "overview",
              "slug": "/overview/terminology",
              "permalink": "/docs/overview/terminology",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Terminology",
                "keywords": [
                  "Seata"
                ],
                "description": "Seata Terminology."
              },
              "sidebar": "docs",
              "previous": {
                "title": "What Is Seata?",
                "permalink": "/docs/overview/what-is-seata"
              },
              "next": {
                "title": "FAQ",
                "permalink": "/docs/overview/faq"
              }
            },
            {
              "unversionedId": "overview/what-is-seata",
              "id": "overview/what-is-seata",
              "title": "What Is Seata?",
              "description": "Seata is an open source distributed transaction solution dedicated to providing high performance and easy to use distributed transaction services. Seata will provide users with AT, TCC, SAGA, and XA transaction models to create a one-stop distributed solution for users.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/overview/what-is-seata.md",
              "sourceDirName": "overview",
              "slug": "/overview/what-is-seata",
              "permalink": "/docs/overview/what-is-seata",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "What Is Seata?",
                "keywords": [
                  "Seata"
                ],
                "description": "Seata is an open source distributed transaction solution dedicated to providing high performance and easy to use distributed transaction services. Seata will provide users with AT, TCC, SAGA, and XA transaction models to create a one-stop distributed solution for users."
              },
              "sidebar": "docs",
              "next": {
                "title": "Terminology",
                "permalink": "/docs/overview/terminology"
              }
            },
            {
              "unversionedId": "tutorial-basics/congratulations",
              "id": "tutorial-basics/congratulations",
              "title": "Congratulations!",
              "description": "You have just learned the basics of Docusaurus and made some changes to the initial template.",
              "source": "@site/docs/tutorial-basics/congratulations.md",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/congratulations",
              "permalink": "/docs/tutorial-basics/congratulations",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 6,
              "frontMatter": {
                "sidebar_position": 6
              }
            },
            {
              "unversionedId": "tutorial-basics/create-a-blog-post",
              "id": "tutorial-basics/create-a-blog-post",
              "title": "Create a Blog Post",
              "description": "Docusaurus creates a page for each blog post, but also a blog index page, a tag system, an RSS feed...",
              "source": "@site/docs/tutorial-basics/create-a-blog-post.md",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/create-a-blog-post",
              "permalink": "/docs/tutorial-basics/create-a-blog-post",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 3,
              "frontMatter": {
                "sidebar_position": 3
              }
            },
            {
              "unversionedId": "tutorial-basics/create-a-document",
              "id": "tutorial-basics/create-a-document",
              "title": "Create a Document",
              "description": "Documents are groups of pages connected through:",
              "source": "@site/docs/tutorial-basics/create-a-document.md",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/create-a-document",
              "permalink": "/docs/tutorial-basics/create-a-document",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 2,
              "frontMatter": {
                "sidebar_position": 2
              }
            },
            {
              "unversionedId": "tutorial-basics/create-a-page",
              "id": "tutorial-basics/create-a-page",
              "title": "Create a Page",
              "description": "Add Markdown or React files to src/pages to create a standalone page:",
              "source": "@site/docs/tutorial-basics/create-a-page.md",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/create-a-page",
              "permalink": "/docs/tutorial-basics/create-a-page",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 1,
              "frontMatter": {
                "sidebar_position": 1
              }
            },
            {
              "unversionedId": "tutorial-basics/deploy-your-site",
              "id": "tutorial-basics/deploy-your-site",
              "title": "Deploy your site",
              "description": "Docusaurus is a static-site-generator (also called Jamstack).",
              "source": "@site/docs/tutorial-basics/deploy-your-site.md",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/deploy-your-site",
              "permalink": "/docs/tutorial-basics/deploy-your-site",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 5,
              "frontMatter": {
                "sidebar_position": 5
              }
            },
            {
              "unversionedId": "tutorial-basics/markdown-features",
              "id": "tutorial-basics/markdown-features",
              "title": "Markdown Features",
              "description": "Docusaurus supports Markdown and a few additional features.",
              "source": "@site/docs/tutorial-basics/markdown-features.mdx",
              "sourceDirName": "tutorial-basics",
              "slug": "/tutorial-basics/markdown-features",
              "permalink": "/docs/tutorial-basics/markdown-features",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 4,
              "frontMatter": {
                "sidebar_position": 4
              }
            },
            {
              "unversionedId": "tutorial-extras/manage-docs-versions",
              "id": "tutorial-extras/manage-docs-versions",
              "title": "Manage Docs Versions",
              "description": "Docusaurus can manage multiple versions of your docs.",
              "source": "@site/docs/tutorial-extras/manage-docs-versions.md",
              "sourceDirName": "tutorial-extras",
              "slug": "/tutorial-extras/manage-docs-versions",
              "permalink": "/docs/tutorial-extras/manage-docs-versions",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 1,
              "frontMatter": {
                "sidebar_position": 1
              }
            },
            {
              "unversionedId": "tutorial-extras/translate-your-site",
              "id": "tutorial-extras/translate-your-site",
              "title": "Translate your site",
              "description": "Let's translate docs/intro.md to French.",
              "source": "@site/docs/tutorial-extras/translate-your-site.md",
              "sourceDirName": "tutorial-extras",
              "slug": "/tutorial-extras/translate-your-site",
              "permalink": "/docs/tutorial-extras/translate-your-site",
              "draft": false,
              "tags": [],
              "version": "current",
              "sidebarPosition": 2,
              "frontMatter": {
                "sidebar_position": 2
              }
            },
            {
              "unversionedId": "user/api",
              "id": "user/api",
              "title": "Api Guide",
              "description": "Api Guide.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/api.md",
              "sourceDirName": "user",
              "slug": "/user/api",
              "permalink": "/docs/user/api",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Api Guide",
                "keywords": [
                  "Seata"
                ],
                "description": "Api Guide."
              },
              "sidebar": "docs",
              "previous": {
                "title": "zookeeper",
                "permalink": "/docs/user/registry/zookeeper"
              },
              "next": {
                "title": "Microservice Framework Guide",
                "permalink": "/docs/user/microservice"
              }
            },
            {
              "unversionedId": "user/apm/prometheus",
              "id": "user/apm/prometheus",
              "title": "prometheus",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/apm/prometheus.md",
              "sourceDirName": "user/apm",
              "slug": "/user/apm/prometheus",
              "permalink": "/docs/user/apm/prometheus",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "skywalking",
                "permalink": "/docs/user/apm/skywalking"
              },
              "next": {
                "title": "performance",
                "permalink": "/docs/user/performance"
              }
            },
            {
              "unversionedId": "user/apm/skywalking",
              "id": "user/apm/skywalking",
              "title": "skywalking",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/apm/skywalking.md",
              "sourceDirName": "user/apm",
              "slug": "/user/apm/skywalking",
              "permalink": "/docs/user/apm/skywalking",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "function",
                "permalink": "/docs/user/sqlreference/function"
              },
              "next": {
                "title": "prometheus",
                "permalink": "/docs/user/apm/prometheus"
              }
            },
            {
              "unversionedId": "user/appendix/global-transaction-status",
              "id": "user/appendix/global-transaction-status",
              "title": "global-transaction-status",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/appendix/global-transaction-status.md",
              "sourceDirName": "user/appendix",
              "slug": "/user/appendix/global-transaction-status",
              "permalink": "/docs/user/appendix/global-transaction-status",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "performance",
                "permalink": "/docs/user/performance"
              },
              "next": {
                "title": "isolation",
                "permalink": "/docs/user/appendix/isolation"
              }
            },
            {
              "unversionedId": "user/appendix/isolation",
              "id": "user/appendix/isolation",
              "title": "isolation",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/appendix/isolation.md",
              "sourceDirName": "user/appendix",
              "slug": "/user/appendix/isolation",
              "permalink": "/docs/user/appendix/isolation",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "global-transaction-status",
                "permalink": "/docs/user/appendix/global-transaction-status"
              },
              "next": {
                "title": "Seata AT Mode",
                "permalink": "/docs/dev/mode/at-mode"
              }
            },
            {
              "unversionedId": "user/configuration/apollo",
              "id": "user/configuration/apollo",
              "title": "apollo",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/apollo.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/apollo",
              "permalink": "/docs/user/configuration/apollo",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "nacos",
                "permalink": "/docs/user/configuration/nacos"
              },
              "next": {
                "title": "etcd3",
                "permalink": "/docs/user/configuration/etcd3"
              }
            },
            {
              "unversionedId": "user/configuration/consul",
              "id": "user/configuration/consul",
              "title": "consul",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/consul.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/consul",
              "permalink": "/docs/user/configuration/consul",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "etcd3",
                "permalink": "/docs/user/configuration/etcd3"
              },
              "next": {
                "title": "zookeeper",
                "permalink": "/docs/user/configuration/zookeeper"
              }
            },
            {
              "unversionedId": "user/configuration/etcd3",
              "id": "user/configuration/etcd3",
              "title": "etcd3",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/etcd3.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/etcd3",
              "permalink": "/docs/user/configuration/etcd3",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "apollo",
                "permalink": "/docs/user/configuration/apollo"
              },
              "next": {
                "title": "consul",
                "permalink": "/docs/user/configuration/consul"
              }
            },
            {
              "unversionedId": "user/configuration/index",
              "id": "user/configuration/index",
              "title": "index",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/index.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/",
              "permalink": "/docs/user/configuration/",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "transaction-group-and-ha",
                "permalink": "/docs/user/txgroup/transaction-group-and-ha"
              },
              "next": {
                "title": "nacos",
                "permalink": "/docs/user/configuration/nacos"
              }
            },
            {
              "unversionedId": "user/configuration/nacos",
              "id": "user/configuration/nacos",
              "title": "nacos",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/nacos.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/nacos",
              "permalink": "/docs/user/configuration/nacos",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "index",
                "permalink": "/docs/user/configuration/"
              },
              "next": {
                "title": "apollo",
                "permalink": "/docs/user/configuration/apollo"
              }
            },
            {
              "unversionedId": "user/configuration/zookeeper",
              "id": "user/configuration/zookeeper",
              "title": "zookeeper",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/configuration/zookeeper.md",
              "sourceDirName": "user/configuration",
              "slug": "/user/configuration/zookeeper",
              "permalink": "/docs/user/configuration/zookeeper",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "consul",
                "permalink": "/docs/user/configuration/consul"
              },
              "next": {
                "title": "index",
                "permalink": "/docs/user/registry/"
              }
            },
            {
              "unversionedId": "user/configurations",
              "id": "user/configurations",
              "title": "The seata parameter configuration version 1.6.0",
              "description": "View version 1.0.0",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/configurations.md",
              "sourceDirName": "user",
              "slug": "/user/configurations",
              "permalink": "/docs/user/configurations",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "Title": "Seata parameter configuration",
                "keywords": [
                  "Seata"
                ],
                "Description": "Seata parameter configuration."
              },
              "sidebar": "docs",
              "previous": {
                "title": "Quick Start",
                "permalink": "/docs/user/quickstart"
              },
              "next": {
                "title": "transaction-group",
                "permalink": "/docs/user/txgroup/transaction-group"
              }
            },
            {
              "unversionedId": "user/configurations090",
              "id": "user/configurations090",
              "title": "configurations090",
              "description": "Public sector",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/configurations090.md",
              "sourceDirName": "user",
              "slug": "/user/configurations090",
              "permalink": "/docs/user/configurations090",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "Title": "Seata parameter configuration version 0.9.0",
                "keywords": [
                  "Seata"
                ],
                "Description": "The seata parameter configuration version is 0.9.0."
              }
            },
            {
              "unversionedId": "user/configurations100",
              "id": "user/configurations100",
              "title": "configurations100",
              "description": "View versions before 0.9.0.1",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/configurations100.md",
              "sourceDirName": "user",
              "slug": "/user/configurations100",
              "permalink": "/docs/user/configurations100",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "Title": "Seata parameter configuration",
                "keywords": [
                  "Seata"
                ],
                "Description": "Seata parameter configuration."
              }
            },
            {
              "unversionedId": "user/datasource",
              "id": "user/datasource",
              "title": "datasource",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/datasource.md",
              "sourceDirName": "user",
              "slug": "/user/datasource",
              "permalink": "/docs/user/datasource",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "ormframework",
                "permalink": "/docs/user/ormframework"
              },
              "next": {
                "title": "SQL restrictions",
                "permalink": "/docs/user/sqlreference/sql-restrictions"
              }
            },
            {
              "unversionedId": "user/microservice",
              "id": "user/microservice",
              "title": "Microservice Framework Guide",
              "description": "Microservice Framework Guide.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/microservice.md",
              "sourceDirName": "user",
              "slug": "/user/microservice",
              "permalink": "/docs/user/microservice",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Microservice Framework Guide",
                "keywords": [
                  "Seata"
                ],
                "description": "Microservice Framework Guide."
              },
              "sidebar": "docs",
              "previous": {
                "title": "Api Guide",
                "permalink": "/docs/user/api"
              },
              "next": {
                "title": "ormframework",
                "permalink": "/docs/user/ormframework"
              }
            },
            {
              "unversionedId": "user/ormframework",
              "id": "user/ormframework",
              "title": "ormframework",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/ormframework.md",
              "sourceDirName": "user",
              "slug": "/user/ormframework",
              "permalink": "/docs/user/ormframework",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "Microservice Framework Guide",
                "permalink": "/docs/user/microservice"
              },
              "next": {
                "title": "datasource",
                "permalink": "/docs/user/datasource"
              }
            },
            {
              "unversionedId": "user/performance",
              "id": "user/performance",
              "title": "performance",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/performance.md",
              "sourceDirName": "user",
              "slug": "/user/performance",
              "permalink": "/docs/user/performance",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "prometheus",
                "permalink": "/docs/user/apm/prometheus"
              },
              "next": {
                "title": "global-transaction-status",
                "permalink": "/docs/user/appendix/global-transaction-status"
              }
            },
            {
              "unversionedId": "user/quickstart",
              "id": "user/quickstart",
              "title": "Quick Start",
              "description": "Let's begin with a Microservices example.",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/quickstart.md",
              "sourceDirName": "user",
              "slug": "/user/quickstart",
              "permalink": "/docs/user/quickstart",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "Quick Start",
                "keywords": [
                  "Seata"
                ],
                "description": "Let's begin with a Microservices example."
              },
              "sidebar": "docs",
              "previous": {
                "title": "FAQ",
                "permalink": "/docs/overview/faq"
              },
              "next": {
                "title": "The seata parameter configuration version 1.6.0",
                "permalink": "/docs/user/configurations"
              }
            },
            {
              "unversionedId": "user/registry/consul",
              "id": "user/registry/consul",
              "title": "consul",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/consul.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/consul",
              "permalink": "/docs/user/registry/consul",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "etcd3",
                "permalink": "/docs/user/registry/etcd3"
              },
              "next": {
                "title": "zookeeper",
                "permalink": "/docs/user/registry/zookeeper"
              }
            },
            {
              "unversionedId": "user/registry/etcd3",
              "id": "user/registry/etcd3",
              "title": "etcd3",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/etcd3.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/etcd3",
              "permalink": "/docs/user/registry/etcd3",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "eureka",
                "permalink": "/docs/user/registry/eureka"
              },
              "next": {
                "title": "consul",
                "permalink": "/docs/user/registry/consul"
              }
            },
            {
              "unversionedId": "user/registry/eureka",
              "id": "user/registry/eureka",
              "title": "eureka",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/eureka.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/eureka",
              "permalink": "/docs/user/registry/eureka",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "nacos",
                "permalink": "/docs/user/registry/nacos"
              },
              "next": {
                "title": "etcd3",
                "permalink": "/docs/user/registry/etcd3"
              }
            },
            {
              "unversionedId": "user/registry/index",
              "id": "user/registry/index",
              "title": "index",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/index.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/",
              "permalink": "/docs/user/registry/",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "zookeeper",
                "permalink": "/docs/user/configuration/zookeeper"
              },
              "next": {
                "title": "nacos",
                "permalink": "/docs/user/registry/nacos"
              }
            },
            {
              "unversionedId": "user/registry/nacos",
              "id": "user/registry/nacos",
              "title": "nacos",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/nacos.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/nacos",
              "permalink": "/docs/user/registry/nacos",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "index",
                "permalink": "/docs/user/registry/"
              },
              "next": {
                "title": "eureka",
                "permalink": "/docs/user/registry/eureka"
              }
            },
            {
              "unversionedId": "user/registry/zookeeper",
              "id": "user/registry/zookeeper",
              "title": "zookeeper",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/registry/zookeeper.md",
              "sourceDirName": "user/registry",
              "slug": "/user/registry/zookeeper",
              "permalink": "/docs/user/registry/zookeeper",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "consul",
                "permalink": "/docs/user/registry/consul"
              },
              "next": {
                "title": "Api Guide",
                "permalink": "/docs/user/api"
              }
            },
            {
              "unversionedId": "user/saga",
              "id": "user/saga",
              "title": "saga",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/saga.md",
              "sourceDirName": "user",
              "slug": "/user/saga",
              "permalink": "/docs/user/saga",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "user/spring",
              "id": "user/spring",
              "title": "spring",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/spring.md",
              "sourceDirName": "user",
              "slug": "/user/spring",
              "permalink": "/docs/user/spring",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {}
            },
            {
              "unversionedId": "user/sqlreference/dml",
              "id": "user/sqlreference/dml",
              "title": "DML",
              "description": "Seata DML",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/sqlreference/dml.md",
              "sourceDirName": "user/sqlreference",
              "slug": "/user/sqlreference/dml",
              "permalink": "/docs/user/sqlreference/dml",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "DML",
                "keywords": [
                  "Seata"
                ],
                "description": "Seata DML"
              },
              "sidebar": "docs",
              "previous": {
                "title": "SQL restrictions",
                "permalink": "/docs/user/sqlreference/sql-restrictions"
              },
              "next": {
                "title": "sql-decoration",
                "permalink": "/docs/user/sqlreference/sql-decoration"
              }
            },
            {
              "unversionedId": "user/sqlreference/function",
              "id": "user/sqlreference/function",
              "title": "function",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/sqlreference/function.md",
              "sourceDirName": "user/sqlreference",
              "slug": "/user/sqlreference/function",
              "permalink": "/docs/user/sqlreference/function",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "sql-decoration",
                "permalink": "/docs/user/sqlreference/sql-decoration"
              },
              "next": {
                "title": "skywalking",
                "permalink": "/docs/user/apm/skywalking"
              }
            },
            {
              "unversionedId": "user/sqlreference/sql-decoration",
              "id": "user/sqlreference/sql-decoration",
              "title": "sql-decoration",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/sqlreference/sql-decoration.md",
              "sourceDirName": "user/sqlreference",
              "slug": "/user/sqlreference/sql-decoration",
              "permalink": "/docs/user/sqlreference/sql-decoration",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "DML",
                "permalink": "/docs/user/sqlreference/dml"
              },
              "next": {
                "title": "function",
                "permalink": "/docs/user/sqlreference/function"
              }
            },
            {
              "unversionedId": "user/sqlreference/sql-restrictions",
              "id": "user/sqlreference/sql-restrictions",
              "title": "SQL restrictions",
              "description": "Seata SQL restrictions",
              "source": "@site/i18n/en/docusaurus-plugin-content-docs/current/user/sqlreference/sql-restrictions.md",
              "sourceDirName": "user/sqlreference",
              "slug": "/user/sqlreference/sql-restrictions",
              "permalink": "/docs/user/sqlreference/sql-restrictions",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {
                "title": "SQL restrictions",
                "keywords": [
                  "Seata"
                ],
                "description": "Seata SQL restrictions"
              },
              "sidebar": "docs",
              "previous": {
                "title": "datasource",
                "permalink": "/docs/user/datasource"
              },
              "next": {
                "title": "DML",
                "permalink": "/docs/user/sqlreference/dml"
              }
            },
            {
              "unversionedId": "user/txgroup/transaction-group",
              "id": "user/txgroup/transaction-group",
              "title": "transaction-group",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/txgroup/transaction-group.md",
              "sourceDirName": "user/txgroup",
              "slug": "/user/txgroup/transaction-group",
              "permalink": "/docs/user/txgroup/transaction-group",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "The seata parameter configuration version 1.6.0",
                "permalink": "/docs/user/configurations"
              },
              "next": {
                "title": "transaction-group-and-ha",
                "permalink": "/docs/user/txgroup/transaction-group-and-ha"
              }
            },
            {
              "unversionedId": "user/txgroup/transaction-group-and-ha",
              "id": "user/txgroup/transaction-group-and-ha",
              "title": "transaction-group-and-ha",
              "description": "Placeholder. DO NOT DELETE.",
              "source": "@site/docs/user/txgroup/transaction-group-and-ha.md",
              "sourceDirName": "user/txgroup",
              "slug": "/user/txgroup/transaction-group-and-ha",
              "permalink": "/docs/user/txgroup/transaction-group-and-ha",
              "draft": false,
              "tags": [],
              "version": "current",
              "frontMatter": {},
              "sidebar": "docs",
              "previous": {
                "title": "transaction-group",
                "permalink": "/docs/user/txgroup/transaction-group"
              },
              "next": {
                "title": "index",
                "permalink": "/docs/user/configuration/"
              }
            }
          ],
          "drafts": [],
          "sidebars": {
            "docs": [
              {
                "type": "category",
                "label": "Overview",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "overview/what-is-seata"
                  },
                  {
                    "type": "doc",
                    "id": "overview/terminology"
                  },
                  {
                    "type": "doc",
                    "id": "overview/faq"
                  }
                ],
                "collapsed": false
              },
              {
                "type": "category",
                "label": "User Doc",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "user/quickstart"
                  },
                  {
                    "type": "doc",
                    "id": "user/configurations"
                  },
                  {
                    "type": "category",
                    "label": "Transactions Grouping",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/txgroup/transaction-group"
                      },
                      {
                        "type": "doc",
                        "id": "user/txgroup/transaction-group-and-ha"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "Configuration Center",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/configuration/index"
                      },
                      {
                        "type": "doc",
                        "id": "user/configuration/nacos"
                      },
                      {
                        "type": "doc",
                        "id": "user/configuration/apollo"
                      },
                      {
                        "type": "doc",
                        "id": "user/configuration/etcd3"
                      },
                      {
                        "type": "doc",
                        "id": "user/configuration/consul"
                      },
                      {
                        "type": "doc",
                        "id": "user/configuration/zookeeper"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "Registration Authority",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/registry/index"
                      },
                      {
                        "type": "doc",
                        "id": "user/registry/nacos"
                      },
                      {
                        "type": "doc",
                        "id": "user/registry/eureka"
                      },
                      {
                        "type": "doc",
                        "id": "user/registry/etcd3"
                      },
                      {
                        "type": "doc",
                        "id": "user/registry/consul"
                      },
                      {
                        "type": "doc",
                        "id": "user/registry/zookeeper"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "doc",
                    "id": "user/api"
                  },
                  {
                    "type": "doc",
                    "id": "user/microservice"
                  },
                  {
                    "type": "doc",
                    "id": "user/ormframework"
                  },
                  {
                    "type": "doc",
                    "id": "user/datasource"
                  },
                  {
                    "type": "category",
                    "label": "SQL Reference",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/sqlreference/sql-restrictions"
                      },
                      {
                        "type": "doc",
                        "id": "user/sqlreference/dml"
                      },
                      {
                        "type": "doc",
                        "id": "user/sqlreference/sql-decoration"
                      },
                      {
                        "type": "doc",
                        "id": "user/sqlreference/function"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "APM",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/apm/skywalking"
                      },
                      {
                        "type": "doc",
                        "id": "user/apm/prometheus"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "Testing Report",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/performance"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "Appendix",
                    "items": [
                      {
                        "type": "doc",
                        "id": "user/appendix/global-transaction-status"
                      },
                      {
                        "type": "doc",
                        "id": "user/appendix/isolation"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  }
                ],
                "collapsed": false
              },
              {
                "type": "category",
                "label": "Developer Guide",
                "collapsible": false,
                "items": [
                  {
                    "type": "category",
                    "label": "Transaction Mode",
                    "items": [
                      {
                        "type": "doc",
                        "id": "dev/mode/at-mode"
                      },
                      {
                        "type": "doc",
                        "id": "dev/mode/tcc-mode"
                      },
                      {
                        "type": "doc",
                        "id": "dev/mode/saga-mode"
                      },
                      {
                        "type": "doc",
                        "id": "dev/mode/xa-mode"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "category",
                    "label": "Domain Model",
                    "items": [
                      {
                        "type": "doc",
                        "id": "dev/domain/overviewDomainModel"
                      },
                      {
                        "type": "doc",
                        "id": "dev/domain/tm"
                      },
                      {
                        "type": "doc",
                        "id": "dev/domain/rm"
                      },
                      {
                        "type": "doc",
                        "id": "dev/domain/tc"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  },
                  {
                    "type": "doc",
                    "id": "dev/seata-mertics"
                  }
                ],
                "collapsed": false
              },
              {
                "type": "category",
                "label": "Ops Guide",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "ops/upgrade"
                  },
                  {
                    "type": "category",
                    "label": "Deploy",
                    "items": [
                      {
                        "type": "doc",
                        "id": "ops/deploy-guide-beginner"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-server"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-by-docker"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-by-docker-compose"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-by-kubernetes"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-by-helm"
                      },
                      {
                        "type": "doc",
                        "id": "ops/deploy-ha"
                      }
                    ],
                    "collapsed": true,
                    "collapsible": true
                  }
                ],
                "collapsed": false
              }
            ],
            "developers": [
              {
                "type": "category",
                "label": "Developers List",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "developers/developers_dev"
                  }
                ],
                "collapsed": false
              },
              {
                "type": "category",
                "label": "Contribute Guide",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "developers/contributor-guide/new-contributor-guide_dev"
                  },
                  {
                    "type": "doc",
                    "id": "developers/contributor-guide/test-coverage-guide_dev"
                  },
                  {
                    "type": "doc",
                    "id": "developers/contributor-guide/reporting-security-issues_dev"
                  },
                  {
                    "type": "doc",
                    "id": "developers/guide_dev"
                  }
                ],
                "collapsed": false
              },
              {
                "type": "category",
                "label": "Committer Guide",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "developers/committer-guide/label-an-issue-guide_dev"
                  },
                  {
                    "type": "doc",
                    "id": "developers/committer-guide/website-guide_dev"
                  },
                  {
                    "type": "doc",
                    "id": "developers/committer-guide/release-guide_dev"
                  }
                ],
                "collapsed": false
              }
            ],
            "download": [
              {
                "type": "category",
                "label": "Download",
                "collapsible": false,
                "items": [
                  {
                    "type": "doc",
                    "id": "download"
                  }
                ],
                "collapsed": false
              }
            ]
          }
        }
      ]
    }
  },
  "docusaurus-plugin-content-blog": {
    "default": {
      "blogSidebarTitle": "All Posts",
      "blogPosts": [
        {
          "id": "/seata-observable-practice",
          "metadata": {
            "permalink": "/blog/seata-observable-practice",
            "source": "@site/blog/seata-observable-practice.md",
            "title": "Seata",
            "description": "Seata",
            "date": "2023-06-25T00:00:00.000Z",
            "formattedDate": "June 25, 2023",
            "tags": [],
            "readingTime": 11.375,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "-Seata"
              }
            ],
            "frontMatter": {
              "title": "Seata",
              "keywords": [
                "Seata"
              ],
              "description": "Seata",
              "author": "-Seata",
              "date": "2023/06/25"
            },
            "nextItem": {
              "title": "Seata",
              "permalink": "/blog/seata-connect-data-and-application"
            }
          },
          "content": "## Seata\nSeataSeataSeata\n### \nSeata\n#### \n![image.png](/img/blog/metrics-.png)\n****\n#### \n![image.png](/img/blog/metrics-.png)\n****\n### Seata\n![image.png](/img/blog/metrics-Seata.png)\n\n\n- **Transaction CoordinatorTC**\n\n\n\n- **Transaction ManagerTM**\n\nTM\n\n- **Resource ManagerRM**\n\nRM\n## Seata\n### \n\n- ****\n\nSeataTCTMRMSeata\n\n- ****\n\nSeata\n\n- ****\n\n\n### \n| **** | **seata** | **** |\n| --- | --- | --- |\n| Metrics | \n\n\nPrometheus | Prometheus\nOpenTelemetry |\n| Tracing | \nseata | SkyWalkingJavaAgent |\n| Logging | \nXID | Alibaba Cloud Service\nELK |\n\n### Metrics\n#### \n\n1. SeataMetrics\n2. Metrics\n3. Metricsprometheusexporter\n4. SpringSPI(Service Provider Interface)\n#### \n![ 1.png](/img/blog/metrics-.png)\n\n- seata-metrics-coreMetrics1RegistryNExporter\n- seata-metrics-apiMeterRegistry\n- seata-metrics-exporter-prometheusprometheus-exporter\n- seata-metrics-registry-compactRegistryGaugeCounterSummayTimer\n#### metrics\n![ 1.png](/img/blog/metrics-.png)\nmetrics\n\n1. SPIExporterRegistry\n2. publishEventBus\n3. metricsRegistry\n4. prometheusExporter\n#### TC\n![image.png](/img/blog/metrics-TC.png)\n#### TM\n![image.png](/img/blog/metrics-TM.png)\n#### RM\n![image.png](/img/blog/metrics-RM.png)\n#### \n![lQLPJxZhZlqESU3NBpjNBp6w8zYK6VbMgzYCoKVrWEDWAA_1694_1688.png](/img/blog/metrics-.png)\n### Tracing\n#### Seatatracing\n\n1. Seata\n2. SeataSeataTracing\n3. Tracingseataseata\n#### Seatatracing\n\n- SeataRPCHeader\n- SkyWalkingRPCtracingspan\n- RPC&span\n\nSeatatracing[[Seata | Seata-server]Skywalking](https://seata.io/zh-cn/docs/user/apm/skywalking.html)\n#### tracing\n\n- demo\n1. \n2. \n3. \n4. \n\n![image.png](/img/blog/metrics-tracing-.png)\n\n- GlobalCommit\n\n![image.png](/img/blog/metrics-tracing-tracing1.png)\n![image.png](/img/blog/metrics-tracing-tracing2.png)\n![image.png](/img/blog/metrics-tracing-tracing3.png)\n### Logging\n#### \n![image.png](/img/blog/metrics-logging.png)\nLoggingSLSELK\n#### \nSeata-Server\n![image.png](/img/blog/metrics-logging.png)\n\n- \n- \n- \n- \n## &\n#### Metrics\n\n\n#### Tracing\n\nxid\n#### Logging\n\n"
        },
        {
          "id": "/seata-connect-data-and-application",
          "metadata": {
            "permalink": "/blog/seata-connect-data-and-application",
            "source": "@site/blog/seata-connect-data-and-application.md",
            "title": "Seata",
            "description": "Seata",
            "date": "2023-06-10T00:00:00.000Z",
            "formattedDate": "June 10, 2023",
            "tags": [],
            "readingTime": 22.88,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "-Seata "
              }
            ],
            "frontMatter": {
              "title": "Seata",
              "keywords": [
                "Seata"
              ],
              "description": "Seata",
              "author": "-Seata ",
              "date": "2023/06/10"
            },
            "prevItem": {
              "title": "Seata",
              "permalink": "/blog/seata-observable-practice"
            },
            "nextItem": {
              "title": " seata-go 1.2.0 ",
              "permalink": "/blog/seata-go-1.2.0"
            }
          },
          "content": "Seata\n\nSeataSeataATTCCSagaXASeataAPISeata\n\n**Seata** Seata\n\nSeata\n\nSeata\n- **TXC/GTS  Seata**\n- **Seata **\n- **Seata **\n<br/>\n### TXC/GTS Seata\n#### \n![](/img/blog/.jpg) \nSeata TXCtaobao transaction constructorTXC \n- **HSF **  \n\n- **TDDL **   \n\n- **MetaQ **   \n\n\nTXCTXC \n- **** \n- **** SQL\n- **** \n\nTXCTXC\n<br/>\n\n![GTS](/img/blog/GTS.jpg) \n\nTXC11TXC**10W TPS49SLA**\n<br/>\n\n#### \nTXCMVP\n\n![](/img/blog/.jpg)  \n\nRAFTGoogle SpannerDriverTXCAT\n\n****  API \n\n![](/img/blog/.jpg) \nB\n\n****BB **TCtransaction coordinator****TMTransaction Manager** **RMresource manager** TXC \n\n![](/img/blog/.jpg) \n**TXC0.20.4TPS3/TPS10/**\n<br/>\n#### Seata \n2017 GTSGlobal Transaction Service ****  **** \n\nGitHub 80%Lock InLinux\n\n![](/img/blog/.jpg) \n**Dubbo** Dubbo10DubboSeata 0-11-100\n\n**** \n\n- \n- YY \n- \n\n**** HigressNacosSentinel SeataOpenSergoOpenSergo\n<br/>\n\n### Seata \n#### Seata \n![](/img/blog/.jpg) \n**Seata4ATTCCSagaXA** Seata10RPC20 JavaGolangPHPPythonJS\n\nSeataSeataSeata\n<br/>\n#### Seata \n![](/img/blog/.jpg) \n**SeataAPISQL** \n<br/>\n\n#### Seata \n![](/img/blog/.jpg) \n**1**  \nSeata 0.2Seata\n\n**2**   \nSeata 0.6.1Seata\n\n**3**   \nSeataSwan\n\n**4**   \nSeata205\n<br/>\n\n#### Seata \n![](/img/blog/.jpg)\n<br/>\n\n#### Seata \n-  Oracle Postgresql \n-  Dubbo3\n-  Spring Boot3\n-  JDK 17\n-  ARM64 \n- \n- SQL\n-  GraalVM Native Image\n-  Redis lua \n<br/>\n\n### Seata 2.x \n![](/img/blog/.jpg) \n\n\n- **//**   \nRaft4APIGTSSaga\n- ****   \nMQAPM\n- ****   \n\n- ****   \nJavaTransaction Mesh\n- **/**    \n\n  \n2.x ****\n<br/>\n\n### Seata \n![](/img/blog/.jpg)"
        },
        {
          "id": "/seata-go-1.2.0",
          "metadata": {
            "permalink": "/blog/seata-go-1.2.0",
            "source": "@site/blog/seata-go-1.2.0.md",
            "title": " seata-go 1.2.0 ",
            "description": " seata-go 1.2.0 ",
            "date": "2023-06-08T00:00:00.000Z",
            "formattedDate": "June 8, 2023",
            "tags": [],
            "readingTime": 2.22,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "Seata"
              }
            ],
            "frontMatter": {
              "title": " seata-go 1.2.0 ",
              "author": "Seata",
              "keywords": [
                "seatagolang1.2.0"
              ],
              "description": " seata-go 1.2.0 ",
              "date": "2023/06/08"
            },
            "prevItem": {
              "title": "Seata",
              "permalink": "/blog/seata-connect-data-and-application"
            },
            "nextItem": {
              "title": "6 |  Seata ",
              "permalink": "/blog/iscas2023"
            }
          },
          "content": "##  seata-go 1.2.0 \n\nSeata \n\n### \nSeata-go 1.2.0  XA XA  X/Open  Seata-go  XA  MySQL seata-go  ATTCCSaga  XA  Seata Java  XA :\n-  XA  \n-  XA   \nXA  samples https://github.com/seata/seata-go-samples/tree/main/xa\n\n### feature\n\n- [[#467](https://github.com/seata/seata-go/pull/467)]  XA  MySQL\n- [[#534](https://github.com/seata/seata-go/pull/534)]  session \n\n### bugfix\n\n- [[#540](https://github.com/seata/seata-go/pull/540)]  xa  bug\n- [[#545](https://github.com/seata/seata-go/pull/545)]  xa  db  bug\n- [[#548](https://github.com/seata/seata-go/pull/548)]  xa  bug\n- [[#556](https://github.com/seata/seata-go/pull/556)]  xa  bug\n- [[#562](https://github.com/seata/seata-go/pull/562)]  xa  bug\n- [[#564](https://github.com/seata/seata-go/pull/564)]  xa  bug\n- [[#566](https://github.com/seata/seata-go/pull/566)]  xa  bug\n\n### optimize:\n\n- [[#523](https://github.com/seata/seata-go/pull/523)]  CI \n- [[#525](https://github.com/seata/seata-go/pull/456)]  jackson  json\n- [[#532](https://github.com/seata/seata-go/pull/532)] \n- [[#536](https://github.com/seata/seata-go/pull/536)]  go import \n- [[#554](https://github.com/seata/seata-go/pull/554)]  xa \n- [[#561](https://github.com/seata/seata-go/pull/561)]  xa \n\n### test:\n\n- [[#535](https://github.com/seata/seata-go/pull/535)] \n\n### doc:\n- [[#550](https://github.com/seata/seata-go/pull/550)]  1.2.0 \n\n\n### contributors:\n\nThanks to these contributors for their code commits. Please report an unintended omission.\n\n- [georgehao](https://github.com/georgehao)\n- [luky116](https://github.com/luky116)\n- [jasondeng1997](https://github.com/jasondeng1997)\n- [106umao](https://github.com/106umao)\n- [wang1309](https://github.com/wang1309)\n- [iSuperCoder](https://github.com/iSuperCoder)\n- [Charlie17Li](https://github.com/Charlie17Li)\n- [Code-Fight](https://github.com/Code-Fight)\n- [Kirhaku](https://github.com/Kirhaku)\n- [Vaderkai](https://github.com/VaderKai)\n\nissue\n\n\n#### Link\n\n- http://github.com/seata/seata\n- https://github.com/seata/seata-php\n- https://github.com/seata/seata-js\n- https://github.com/seata/seata-go   \n  **Samples**\n- https://github.com/seata/seata-samples\n- https://github.com/seata/seata-go-samples   \n  ****   \n- https://seata.io/"
        },
        {
          "id": "/iscas2023",
          "metadata": {
            "permalink": "/blog/iscas2023",
            "source": "@site/blog/iscas2023.md",
            "title": "6 |  Seata ",
            "description": "Seata 2023",
            "date": "2023-05-12T00:00:00.000Z",
            "formattedDate": "May 12, 2023",
            "tags": [],
            "readingTime": 10.575,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "Seata"
              }
            ],
            "frontMatter": {
              "title": "6 |  Seata ",
              "author": "Seata",
              "date": "2023/05/12",
              "keywords": [
                "seata"
              ]
            },
            "prevItem": {
              "title": " seata-go 1.2.0 ",
              "permalink": "/blog/seata-go-1.2.0"
            },
            "nextItem": {
              "title": "Seata 1.6.0 ",
              "permalink": "/blog/seata-1.6.0"
            }
          },
          "content": "###  Seata 2023\n 2023  **4  29 -64**Seata 2023 \n\n![summer2023-1](/img/blog/summer2023-1.jpg)\n\n### 2023 \n\n\n****   8000  12000 \n\n### Seata \n**Seata** GitHub23K+ Starts Seata Seata Seata11\n\n### Seata2023  \nSeata20236   \nhttps://summer-ospp.ac.cn/org/orgdetail/064c15df-705c-483a-8fc8-02831370db14?lang=zh   \n\n![seata2023-2](/img/blog/summer2023-2.png)\n\n#### : NamingServer\n\n**** /Advanced\n\n**** \n\n**** 364176773@qq.com\n\n****   \nseatakafka KRaftrocketmqNameServerclickhouseClickHouse Keeper.,seatanameserver\n\n****\nhttps://summer-ospp.ac.cn/org/prodetail/230640380?list=org&navpage=org\n<br/>\n<br/>\n\n#### : seata-gosaga\n\n**** /Advanced\n\n**** \n\n**** luky116@apache.org\n\n****\nSagaSEATASagaSeata-go sagaJava\n\n****\nhttps://summer-ospp.ac.cn/org/prodetail/230640382?list=org&navpage=org\n<br/>\n<br/>\n\n#### : seata saga\n**** /Advanced\n\n**** \n\n**** leezongjie@163.com\n\n****\nsagaseataseatasaga \n\n****\nhttps://summer-ospp.ac.cn/org/prodetail/230640415?list=org&navpage=org\n<br/>\n<br/>\n\n#### :  \n**** /Advanced\n\n**** \n\n**** 841369634@qq.com\n\n****\nseata seata\n\n****\nhttps://summer-ospp.ac.cn/org/prodetail/230640423?list=org&navpage=org\n<br/>\n<br/>\n\n#### :  \n**** /Basic\n\n**** \n\n**** 349071347@qq.com\n\n****\n, . clientserver, \n\n****\nhttps://summer-ospp.ac.cn/org/prodetail/230640424?list=org&navpage=org\n<br/>\n<br/>\n\n#### : Seatactl\n**** /Advanced\n\n**** \n\n****  jimin.jm@alibaba-inc.com\n\n**** ctlSeataSeataSeatactlSeatactl Seata\n\nctl \n- kubectlhelmSeata\n- \n- \n- \n- WindowsLinuxMacOS\nctl\n\nhttps://summer-ospp.ac.cn/org/prodetail/230640431?list=org&navpage=org\n<br/>\n<br/>\n\n###  2023  \n****\n\nSeata**930** PR Seata\n![seata2023-3](/img/blog/summer2023-3.png)\n\n**,** SeataSeata\n<br/>\n<img src=\"/img/blog/summer2023-4.jpg\" height=\"290\" width=\"250\"/>\n<br/>\n\n####  \n**Seata :**  https://seata.io/\n\n**Seata GitHub :** https://github.com/seata\n\n**** https://summer-ospp.ac.cn/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64?lang=zh\n\n\n\n- ****[Nacos ](https://nacos.io/zh-cn/blog/iscas2023.html)\n- **RPC**[Spring Cloud Alibaba ](https://summer-ospp.ac.cn/org/orgdetail/41d68399-ed48-4d6d-9d4d-3ff4128dc132?lang=zh)  [Dubbo ](https://summer-ospp.ac.cn/org/orgdetail/a7f6e2ad-4acc-47f8-9471-4e54b9a166a6?lang=zh) \n- ****[Higress ](https://higress.io/zh-cn/blog/ospp-2023)\n- **** [Sentinel ](https://summer-ospp.ac. cn/org/orgdetail/5e879522-bd90-4a8b-bf8b-b11aea48626b?lang=zh) \n- ****  [OpenSergo ](https://summer-ospp.ac. cn/org/orgdetail/aaff4eec-11b1-4375-997d-5eea8f51762b?lang=zh)"
        },
        {
          "id": "/seata-1.6.0",
          "metadata": {
            "permalink": "/blog/seata-1.6.0",
            "source": "@site/blog/seata-1.6.0.md",
            "title": "Seata 1.6.0 ",
            "description": "Seata 1.6.0 ",
            "date": "2022-12-17T00:00:00.000Z",
            "formattedDate": "December 17, 2022",
            "tags": [],
            "readingTime": 6.575,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "Seata"
              }
            ],
            "frontMatter": {
              "title": "Seata 1.6.0 ",
              "author": "Seata",
              "keywords": [
                "seata1.6.0"
              ],
              "description": "Seata 1.6.0 ",
              "date": "2022/12/17"
            },
            "prevItem": {
              "title": "6 |  Seata ",
              "permalink": "/blog/iscas2023"
            },
            "nextItem": {
              "title": "Seata 1.5.2 xid",
              "permalink": "/blog/seata-1.5.2"
            }
          },
          "content": "### Seata 1.6.0 \n\nSeata \n\n**seata-server **\n\n[source](https://github.com/seata/seata/archive/v1.6.0.zip) |\n[binary](https://github.com/seata/seata/releases/download/v1.6.0/seata-server-1.6.0.zip)\n\n\n\n### feature\n- [[#4863](https://github.com/seata/seata/pull/4863)]  oracle  postgresql \n- [[#4649](https://github.com/seata/seata/pull/4649)] seata-server\n- [[#4779](https://github.com/seata/seata/pull/4779)]  Apache Dubbo3\n- [[#4479](https://github.com/seata/seata/pull/4479)] TCC\n- [[#4877](https://github.com/seata/seata/pull/4877)] client sdk jdk17\n- [[#4914](https://github.com/seata/seata/pull/4914)]  mysql update join\n- [[#4542](https://github.com/seata/seata/pull/4542)]  oracle timestamp \n- [[#5111](https://github.com/seata/seata/pull/5111)] Nacos contextPath \n- [[#4802](https://github.com/seata/seata/pull/4802)] dockerfile  arm64\n\n\n### bugfix\n- [[#4780](https://github.com/seata/seata/pull/4780)] TimeoutRollbacked\n- [[#4954](https://github.com/seata/seata/pull/4954)] output\n- [[#4817](https://github.com/seata/seata/pull/4817)] springboot\n- [[#4838](https://github.com/seata/seata/pull/4838)]  Statement.executeBatch() undo log \n- [[#4533](https://github.com/seata/seata/pull/4533)] handleRetryRollbackingevent\n- [[#4912](https://github.com/seata/seata/pull/4912)] mysql InsertOnDuplicateUpdate \n- [[#4543](https://github.com/seata/seata/pull/4543)]  Oracle nclob\n- [[#4915](https://github.com/seata/seata/pull/4915)] ServerRecoveryProperties\n- [[#4919](https://github.com/seata/seata/pull/4919)] XIDportaddressnull:0\n- [[#4928](https://github.com/seata/seata/pull/4928)]  rpcContext.getClientRMHolderMap NPE \n- [[#4953](https://github.com/seata/seata/pull/4953)] InsertOnDuplicateUpdate\n- [[#4978](https://github.com/seata/seata/pull/4978)]  kryo \n- [[#4985](https://github.com/seata/seata/pull/4985)]  undo_log id\n- [[#4874](https://github.com/seata/seata/pull/4874)] OpenJDK 11 \n- [[#5018](https://github.com/seata/seata/pull/5018)]  loader path  server \n- [[#5004](https://github.com/seata/seata/pull/5004)] mysql update join\n- [[#5032](https://github.com/seata/seata/pull/5032)] mysql InsertOnDuplicateUpdateSQL\n- [[#5033](https://github.com/seata/seata/pull/5033)] InsertOnDuplicateUpdateSQL\n- [[#5038](https://github.com/seata/seata/pull/5038)] SagaAsyncThreadPoolProperties\n- [[#5050](https://github.com/seata/seata/pull/5050)] SagaCommitted\n- [[#5052](https://github.com/seata/seata/pull/5052)] update join\n- [[#5031](https://github.com/seata/seata/pull/5031)] InsertOnDuplicateUpdatenull\n- [[#5075](https://github.com/seata/seata/pull/5075)] InsertOnDuplicateUpdateSQL\n- [[#5093](https://github.com/seata/seata/pull/5093)] seata serveraccessKey\n- [[#5092](https://github.com/seata/seata/pull/5092)] seata and jpa, AutoConfiguration\n- [[#5109](https://github.com/seata/seata/pull/5109)] RM@GlobalTransactionalNPE\n- [[#5098](https://github.com/seata/seata/pull/5098)] Druid  oracle implicit cache\n- [[#4860](https://github.com/seata/seata/pull/4860)] metrics tag\n- [[#5028](https://github.com/seata/seata/pull/5028)]  insert on duplicate SQL null \n- [[#5078](https://github.com/seata/seata/pull/5078)] SQL\n- [[#5097](https://github.com/seata/seata/pull/5097)] Server accessKey \n- [[#5131](https://github.com/seata/seata/pull/5131)] XAConnactive\n- [[#5134](https://github.com/seata/seata/pull/5134)] hikariDataSource \n- [[#5163](https://github.com/seata/seata/pull/5163)] JDK\n\n### optimize\n- [[#4681](https://github.com/seata/seata/pull/4681)] \n- [[#4774](https://github.com/seata/seata/pull/4774)]  seataio/seata-server  mysql8 \n- [[#4750](https://github.com/seata/seata/pull/4750)] ATxid\n- [[#4790](https://github.com/seata/seata/pull/4790)]  OSSRH github action\n- [[#4765](https://github.com/seata/seata/pull/4765)] mysql8.0.29XAconnection\n- [[#4797](https://github.com/seata/seata/pull/4797)] github actions\n- [[#4800](https://github.com/seata/seata/pull/4800)]  NOTICE \n- [[#4761](https://github.com/seata/seata/pull/4761)]  hget  RedisLocker  hmget\n- [[#4414](https://github.com/seata/seata/pull/4414)] log4j\n- [[#4836](https://github.com/seata/seata/pull/4836)]  BaseTransactionalExecutor#buildLockKey(TableRecords rowsIncludingPK) \n- [[#4865](https://github.com/seata/seata/pull/4865)]  Saga  GGEditor \n- [[#4590](https://github.com/seata/seata/pull/4590)] \n- [[#4490](https://github.com/seata/seata/pull/4490)] tccfence \n- [[#4911](https://github.com/seata/seata/pull/4911)]  header license \n- [[#4917](https://github.com/seata/seata/pull/4917)]  package-lock.json \n- [[#4924](https://github.com/seata/seata/pull/4924)]  pom \n- [[#4932](https://github.com/seata/seata/pull/4932)] \n- [[#4925](https://github.com/seata/seata/pull/4925)]  javadoc \n- [[#4921](https://github.com/seata/seata/pull/4921)]  skywalking-eyes \n- [[#4936](https://github.com/seata/seata/pull/4936)] \n- [[#4946](https://github.com/seata/seata/pull/4946)] sql\n- [[#4962](https://github.com/seata/seata/pull/4962)] docker\n- [[#4974](https://github.com/seata/seata/pull/4974)] redis,globalStatus\n- [[#4981](https://github.com/seata/seata/pull/4981)] tcc fence\n- [[#4995](https://github.com/seata/seata/pull/4995)] mysql InsertOnDuplicateUpdateSQL\n- [[#5047](https://github.com/seata/seata/pull/5047)] \n- [[#5051](https://github.com/seata/seata/pull/5051)] undolog(BranchRollbackFailed_Unretriable)\n- [[#5075](https://github.com/seata/seata/pull/5075)] insert on duplicate update\n- [[#5104](https://github.com/seata/seata/pull/5104)] ConnectionProxydruid\n- [[#5124](https://github.com/seata/seata/pull/5124)] oracleTCC fence\n- [[#4468](https://github.com/seata/seata/pull/4968)] kryo 5.3.0\n- [[#4807](https://github.com/seata/seata/pull/4807)] OSS\n- [[#4445](https://github.com/seata/seata/pull/4445)] \n- [[#4958](https://github.com/seata/seata/pull/4958)]  triggerAfterCommit() \n- [[#4582](https://github.com/seata/seata/pull/4582)] redis\n- [[#4963](https://github.com/seata/seata/pull/4963)]  ARM64  CI \n- [[#4434](https://github.com/seata/seata/pull/4434)]  seata-server CMS GC \n\n\n### test\n- [[#4411](https://github.com/seata/seata/pull/4411)] OracleAT\n- [[#4794](https://github.com/seata/seata/pull/4794)]  `DataSourceProxyTest.getResourceIdTest()`\n- [[#5101](https://github.com/seata/seata/pull/5101)] zkClassNotFoundException `DataSourceProxyTest.getResourceIdTest()`\n\n\n contributors \n\n<!--  GitHub ID  -->\n- [slievrly](https://github.com/slievrly)\n- [renliangyu857](https://github.com/renliangyu857)\n- [wangliang181230](https://github.com/wangliang181230)\n- [a364176773](https://github.com/a364176773)\n- [tuwenlin](https://github.com/tuwenlin)\n- [conghuhu](https://github.com/conghuhu)\n- [a1104321118](https://github.com/a1104321118)\n- [duanqiaoyanyu](https://github.com/duanqiaoyanyu)\n- [robynron](https://github.com/robynron)\n- [lcmvs](https://github.com/lcmvs)\n- [github-ganyu](https://github.com/github-ganyu)\n- [1181954449](https://github.com/1181954449)\n- [zw201913](https://github.com/zw201913)\n- [wingchi-leung](https://github.com/wingchi-leung)\n- [AlexStocks](https://github.com/AlexStocks)\n- [liujunlin5168](https://github.com/liujunlin5168)\n- [pengten](https://github.com/pengten)\n- [liuqiufeng](https://github.com/liuqiufeng)\n- [yujianfei1986](https://github.com/yujianfei1986)\n- [Bughue](https://github.com/Bughue)\n- [AlbumenJ](https://github.com/AlbumenJ)\n- [doubleDimple](https://github.com/doubleDimple)\n- [jsbxyyx](https://github.com/jsbxyyx)\n- [tuwenlin](https://github.com/tuwenlin)\n- [CrazyLionLi](https://github.com/JavaLionLi)\n- [whxxxxx](https://github.com/whxxxxx)\n- [neillee95](https://github.com/neillee95)\n- [crazy-sheep](https://github.com/crazy-sheep)\n- [zhangzq7](https://github.com/zhangzq7)\n- [l81893521](https://github.com/l81893521)\n- [zhuyoufeng](https://github.com/zhuyoufeng)\n- [xingfudeshi](https://github.com/xingfudeshi)\n- [odidev](https://github.com/odidev)\n- [miaoxueyu](https://github.com/miaoxueyu)\n\nissue\n\n\n#### Link\n\n- **Seata:** https://github.com/seata/seata\n- **Seata-Samples:** https://github.com/seata/seata-samples\n- **Release:** https://github.com/seata/seata/releases\n- **WebSite:** https://seata.io"
        },
        {
          "id": "/seata-1.5.2",
          "metadata": {
            "permalink": "/blog/seata-1.5.2",
            "source": "@site/blog/seata-1.5.2.md",
            "title": "Seata 1.5.2 xid",
            "description": "Seata 1.5.2 xid",
            "date": "2022-07-12T00:00:00.000Z",
            "formattedDate": "July 12, 2022",
            "tags": [],
            "readingTime": 2.735,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "Seata"
              }
            ],
            "frontMatter": {
              "title": "Seata 1.5.2 xid",
              "author": "Seata",
              "keywords": [
                "seata1.5.2"
              ],
              "description": "Seata 1.5.2 xid",
              "date": "2022/07/12"
            },
            "prevItem": {
              "title": "Seata 1.6.0 ",
              "permalink": "/blog/seata-1.6.0"
            },
            "nextItem": {
              "title": " Seata  TCC ",
              "permalink": "/blog/seata-tcc-fence"
            }
          },
          "content": "### Seata 1.5.2 xid\n\nSeata \n\n**seata-server **\n\n[source](https://github.com/seata/seata/archive/v1.5.2.zip) |\n[binary](https://github.com/seata/seata/releases/download/v1.5.2/seata-server-1.5.2.zip)\n\n\n\n### feature\n- [[#4661](https://github.com/seata/seata/pull/4713)] xid\n- [[#4676](https://github.com/seata/seata/pull/4676)] NacosserverSLB\n- [[#4642](https://github.com/seata/seata/pull/4642)] client\n- [[#4567](https://github.com/seata/seata/pull/4567)] wherefind_in_set\n\n\n### bugfix\n- [[#4515](https://github.com/seata/seata/pull/4515)] developSeataTCCFenceAutoConfigurationDBClassNotFoundException\n- [[#4661](https://github.com/seata/seata/pull/4661)] PostgreSQLSQL\n- [[#4667](https://github.com/seata/seata/pull/4682)] developRedisTransactionStoreManagermap\n- [[#4678](https://github.com/seata/seata/pull/4678)] transport.enableRmClientBatchSendRequest\n- [[#4701](https://github.com/seata/seata/pull/4701)] \n- [[#4607](https://github.com/seata/seata/pull/4607)] \n- [[#4696](https://github.com/seata/seata/pull/4696)]  oracle \n- [[#4726](https://github.com/seata/seata/pull/4726)] NPE\n- [[#4729](https://github.com/seata/seata/pull/4729)] AspectTransactional.rollbackForClassName\n- [[#4653](https://github.com/seata/seata/pull/4653)]  INSERT_ON_DUPLICATE \n\n### optimize\n- [[#4650](https://github.com/seata/seata/pull/4650)] \n- [[#4670](https://github.com/seata/seata/pull/4670)] branchResultMessageExecutor\n- [[#4662](https://github.com/seata/seata/pull/4662)] \n- [[#4693](https://github.com/seata/seata/pull/4693)] \n- [[#4700](https://github.com/seata/seata/pull/4700)]  maven-compiler-plugin  maven-resources-plugin \n- [[#4711](https://github.com/seata/seata/pull/4711)]  lib \n- [[#4720](https://github.com/seata/seata/pull/4720)] pom\n- [[#4728](https://github.com/seata/seata/pull/4728)] logback1.2.9\n- [[#4745](https://github.com/seata/seata/pull/4745)]  mysql8 driver\n- [[#4626](https://github.com/seata/seata/pull/4626)]  `easyj-maven-plugin`  `flatten-maven-plugin``shade`  `flatten` \n- [[#4629](https://github.com/seata/seata/pull/4629)] globalSession\n- [[#4662](https://github.com/seata/seata/pull/4662)]  EnhancedServiceLoader \n\n\n### test\n- [[#4544](https://github.com/seata/seata/pull/4544)] TransactionContextFilterTestjackson\n- [[#4731](https://github.com/seata/seata/pull/4731)]  AsyncWorkerTest  LockManagerTest \n\n\n contributors \n\n<!--  GitHub ID  -->\n- [slievrly](https://github.com/slievrly)\n- [pengten](https://github.com/pengten)\n- [YSF-A](https://github.com/YSF-A)\n- [tuwenlin](https://github.com/tuwenlin)\n- [2129zxl](https://github.com/2129zxl)\n- [Ifdevil](https://github.com/Ifdevil)\n- [wingchi-leung](https://github.com/wingchi-leung)\n- [liurong](https://github.com/robynron)\n- [opelok-z](https://github.com/opelok-z)\n- [a364176773](https://github.com/a364176773)\n- [Smery-lxm](https://github.com/Smery-lxm)\n- [lvekee](https://github.com/lvekee)\n- [doubleDimple](https://github.com/doubleDimple)\n- [wangliang181230](https://github.com/wangliang181230)\n- [Bughue](https://github.com/Bughue)\n- [AYue-94](https://github.com/AYue-94)\n- [lingxiao-wu](https://github.com/lingxiao-wu)\n- [caohdgege](https://github.com/caohdgege)\n\nissue\n\n#### Link\n\n- **Seata:** https://github.com/seata/seata\n- **Seata-Samples:** https://github.com/seata/seata-samples\n- **Release:** https://github.com/seata/seata/releases\n- **WebSite:** https://seata.io"
        },
        {
          "id": "/seata-tcc-fence",
          "metadata": {
            "permalink": "/blog/seata-tcc-fence",
            "source": "@site/blog/seata-tcc-fence.md",
            "title": " Seata  TCC ",
            "description": "Seata  1.5.1  TCC  Seata ",
            "date": "2022-06-25T00:00:00.000Z",
            "formattedDate": "June 25, 2022",
            "tags": [],
            "readingTime": 13.21,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": " Seata  TCC ",
              "author": "",
              "keywords": [
                "SeataTCC"
              ],
              "description": "Seata  1.5.1  TCC  Seata ",
              "date": "2022/06/25"
            },
            "prevItem": {
              "title": "Seata 1.5.2 xid",
              "permalink": "/blog/seata-1.5.2"
            },
            "nextItem": {
              "title": " Seata TCC ",
              "permalink": "/blog/seata-tcc"
            }
          },
          "content": " Seata 1.5.1 TCC \n\n## 1 TCC \n\nTCC try  commit  cancel \n\n try  commit  try  cancel  try \n\n**try  commit **\n\n### 1.1 try-commit\n\ntry  commit \n\n![fence-try-commit](/img/blog/fence-try-commit.png)\n\n\n### 1.2 try-cancel\n\ntry  cancel \n\n![fence-try-cancel](/img/blog/fence-try-cancel.png)\n\n\n## 2 TCC \n\nTCC TCC  try \n\n TCC \n\n### 2.1 \n\ntry  confirm/cancel  confirm/cancel\n\n### 2.2 \n\nTCC \n\n- TM/\n- RM\n- TC: \n\n Seata \n\n![fence-fiffrent-db](/img/blog/fence-fiffrent-db.png)\n\nTM RM  TC TC TM TC  RM TC  RM  RPC\n\n\n\n![fence-same-db](/img/blog/fence-same-db.png)\n\n\nTC TM RM  TC TM  TC RM  TC \n\nRPC  50%\n\n## 3 RM \n\nRM \n```Java\n@LocalTCC\npublic interface StorageService {\n\n    /**\n     * \n     * @param xid xid\n     * @param productId id\n     * @param count \n     * @return\n     */\n    @TwoPhaseBusinessAction(name = \"storageApi\", commitMethod = \"commit\", rollbackMethod = \"rollback\", useTCCFence = true)\n    boolean decrease(String xid, Long productId, Integer count);\n\n    /**\n     * \n     * @param actionContext\n     * @return\n     */\n    boolean commit(BusinessActionContext actionContext);\n\n    /**\n     * \n     * @param actionContext\n     * @return\n     */\n    boolean rollback(BusinessActionContext actionContext);\n}\n```\n\n @LocalTCC RM  TC  try decrease @TwoPhaseBusinessAction  resourceIdcommit  cancel useTCCFence \n\n## 4 TCC \n\nTCC  Seata1.5.1  tcc_fence_log  @TwoPhaseBusinessAction  useTCCFence  false\n\ntcc_fence_log MySQL \n```SQL\nCREATE TABLE IF NOT EXISTS `tcc_fence_log`\n(\n    `xid`           VARCHAR(128)  NOT NULL COMMENT 'global id',\n    `branch_id`     BIGINT        NOT NULL COMMENT 'branch id',\n    `action_name`   VARCHAR(64)   NOT NULL COMMENT 'action name',\n    `status`        TINYINT       NOT NULL COMMENT 'status(tried:1;committed:2;rollbacked:3;suspended:4)',\n    `gmt_create`    DATETIME(3)   NOT NULL COMMENT 'create time',\n    `gmt_modified`  DATETIME(3)   NOT NULL COMMENT 'update time',\n    PRIMARY KEY (`xid`, `branch_id`),\n    KEY `idx_gmt_modified` (`gmt_modified`),\n    KEY `idx_status` (`status`)\n) ENGINE = InnoDB\nDEFAULT CHARSET = utf8mb4;\n```\n\n### 4.1 \n\n commit/cancel  TC \n\n TCCResourceManager \n```Java\n@Override\npublic BranchStatus branchCommit(BranchType branchType, String xid, long branchId, String resourceId,\n\t\t\t\t\t\t\t\t String applicationData) throws TransactionException {\n\tTCCResource tccResource = (TCCResource)tccResourceCache.get(resourceId);\n\t//\n\tObject targetTCCBean = tccResource.getTargetBean();\n\tMethod commitMethod = tccResource.getCommitMethod();\n\t//\n\ttry {\n\t\t//BusinessActionContext\n\t\tBusinessActionContext businessActionContext = getBusinessActionContext(xid, branchId, resourceId,\n\t\t\tapplicationData);\n\t\tObject[] args = this.getTwoPhaseCommitArgs(tccResource, businessActionContext);\n\t\tObject ret;\n\t\tboolean result;\n\t\t// useTCCFence  true\n\t\tif (Boolean.TRUE.equals(businessActionContext.getActionContext(Constants.USE_TCC_FENCE))) {\n\t\t\ttry {\n\t\t\t\tresult = TCCFenceHandler.commitFence(commitMethod, targetTCCBean, xid, branchId, args);\n\t\t\t} catch (SkipCallbackWrapperException | UndeclaredThrowableException e) {\n\t\t\t\tthrow e.getCause();\n\t\t\t}\n\t\t} else {\n\t\t\t//\n\t\t}\n\t\tLOGGER.info(\"TCC resource commit result : {}, xid: {}, branchId: {}, resourceId: {}\", result, xid, branchId, resourceId);\n\t\treturn result ? BranchStatus.PhaseTwo_Committed : BranchStatus.PhaseTwo_CommitFailed_Retryable;\n\t} catch (Throwable t) {\n\t\t//\n\t\treturn BranchStatus.PhaseTwo_CommitFailed_Retryable;\n\t}\n}\n```\n useTCCFence  true true TCCFenceHandler  commitFence \n\nTCCFenceHandler  commitFence  TCCFenceHandler  commitFence \n```Java\npublic static boolean commitFence(Method commitMethod, Object targetTCCBean,\n\t\t\t\t\t\t\t\t  String xid, Long branchId, Object[] args) {\n\treturn transactionTemplate.execute(status -> {\n\t\ttry {\n\t\t\tConnection conn = DataSourceUtils.getConnection(dataSource);\n\t\t\tTCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);\n\t\t\tif (tccFenceDO == null) {\n\t\t\t\tthrow new TCCFenceException(String.format(\"TCC fence record not exists, commit fence method failed. xid= %s, branchId= %s\", xid, branchId),\n\t\t\t\t\t\tFrameworkErrorCode.RecordAlreadyExists);\n\t\t\t}\n\t\t\tif (TCCFenceConstant.STATUS_COMMITTED == tccFenceDO.getStatus()) {\n\t\t\t\tLOGGER.info(\"Branch transaction has already committed before. idempotency rejected. xid: {}, branchId: {}, status: {}\", xid, branchId, tccFenceDO.getStatus());\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (TCCFenceConstant.STATUS_ROLLBACKED == tccFenceDO.getStatus() || TCCFenceConstant.STATUS_SUSPENDED == tccFenceDO.getStatus()) {\n\t\t\t\tif (LOGGER.isWarnEnabled()) {\n\t\t\t\t\tLOGGER.warn(\"Branch transaction status is unexpected. xid: {}, branchId: {}, status: {}\", xid, branchId, tccFenceDO.getStatus());\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn updateStatusAndInvokeTargetMethod(conn, commitMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_COMMITTED, status, args);\n\t\t} catch (Throwable t) {\n\t\t\tstatus.setRollbackOnly();\n\t\t\tthrow new SkipCallbackWrapperException(t);\n\t\t}\n\t});\n}\n```\n\n tcc_fence_log  STATUS_COMMITTED tcc_fence_log \n\nRollback  commit  TCCFenceHandler  rollbackFence \n\n### 4.2 \n\n try  1 try  cancel \n\n![fence-empty-rollback](/img/blog/fence-empty-rollback.png)\n\n\nSeata  try   tcc_fence_log  status  STATUS_TRIED Rollback \n```Java\n//TCCFenceHandler \npublic static Object prepareFence(String xid, Long branchId, String actionName, Callback<Object> targetCallback) {\n\treturn transactionTemplate.execute(status -> {\n\t\ttry {\n\t\t\tConnection conn = DataSourceUtils.getConnection(dataSource);\n\t\t\tboolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_TRIED);\n\t\t\tLOGGER.info(\"TCC fence prepare result: {}. xid: {}, branchId: {}\", result, xid, branchId);\n\t\t\tif (result) {\n\t\t\t\treturn targetCallback.execute();\n\t\t\t} else {\n\t\t\t\tthrow new TCCFenceException(String.format(\"Insert tcc fence record error, prepare fence failed. xid= %s, branchId= %s\", xid, branchId),\n\t\t\t\t\t\tFrameworkErrorCode.InsertRecordError);\n\t\t\t}\n\t\t} catch (TCCFenceException e) {\n\t\t\t//\n\t\t} catch (Throwable t) {\n\t\t\t//\n\t\t}\n\t});\n}\n```\n Rollback :\n```Java\n//TCCFenceHandler \npublic static boolean rollbackFence(Method rollbackMethod, Object targetTCCBean,\n\t\t\t\t\t\t\t\t\tString xid, Long branchId, Object[] args, String actionName) {\n\treturn transactionTemplate.execute(status -> {\n\t\ttry {\n\t\t\tConnection conn = DataSourceUtils.getConnection(dataSource);\n\t\t\tTCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);\n\t\t\t// non_rollback\n\t\t\tif (tccFenceDO == null) {\n\t\t\t\t//\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tif (TCCFenceConstant.STATUS_ROLLBACKED == tccFenceDO.getStatus() || TCCFenceConstant.STATUS_SUSPENDED == tccFenceDO.getStatus()) {\n\t\t\t\t\tLOGGER.info(\"Branch transaction had already rollbacked before, idempotency rejected. xid: {}, branchId: {}, status: {}\", xid, branchId, tccFenceDO.getStatus());\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (TCCFenceConstant.STATUS_COMMITTED == tccFenceDO.getStatus()) {\n\t\t\t\t\tif (LOGGER.isWarnEnabled()) {\n\t\t\t\t\t\tLOGGER.warn(\"Branch transaction status is unexpected. xid: {}, branchId: {}, status: {}\", xid, branchId, tccFenceDO.getStatus());\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn updateStatusAndInvokeTargetMethod(conn, rollbackMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_ROLLBACKED, status, args);\n\t\t} catch (Throwable t) {\n\t\t\tstatus.setRollbackOnly();\n\t\t\tthrow new SkipCallbackWrapperException(t);\n\t\t}\n\t});\n}\n```\n\nupdateStatusAndInvokeTargetMethod  sql \n```sql\nupdate tcc_fence_log set status = ?, gmt_modified = ?\n    where xid = ? and  branch_id = ? and status = ? ;\n```\n tcc_fence_log   status   STATUS_TRIED  STATUS_ROLLBACKED\n\n### 4.3 \n\nRM  try  Rollback  RM  try \n\n\n![fence-suspend](/img/blog/fence-suspend.png)\n\n\nSeata  Rollback  tcc_fence_log  xid  tcc_fence_log  STATUS_SUSPENDED\n```Java\npublic static boolean rollbackFence(Method rollbackMethod, Object targetTCCBean,\n\t\t\t\t\t\t\t\t\tString xid, Long branchId, Object[] args, String actionName) {\n\treturn transactionTemplate.execute(status -> {\n\t\ttry {\n\t\t\tConnection conn = DataSourceUtils.getConnection(dataSource);\n\t\t\tTCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);\n\t\t\t// non_rollback\n\t\t\tif (tccFenceDO == null) {\n\t\t\t    //\n\t\t\t\tboolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_SUSPENDED);\n\t\t\t\t//\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t//\n\t\t\t}\n\t\t\treturn updateStatusAndInvokeTargetMethod(conn, rollbackMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_ROLLBACKED, status, args);\n\t\t} catch (Throwable t) {\n\t\t\t//\n\t\t}\n\t});\n}\n```\n\n try  tcc_fence_log  xid \n```Java\n//TCCFenceHandler \npublic static Object prepareFence(String xid, Long branchId, String actionName, Callback<Object> targetCallback) {\n\treturn transactionTemplate.execute(status -> {\n\t\ttry {\n\t\t\tConnection conn = DataSourceUtils.getConnection(dataSource);\n\t\t\tboolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_TRIED);\n\t\t\t//\n\t\t} catch (TCCFenceException e) {\n\t\t\tif (e.getErrcode() == FrameworkErrorCode.DuplicateKeyException) {\n\t\t\t\tLOGGER.error(\"Branch transaction has already rollbacked before,prepare fence failed. xid= {},branchId = {}\", xid, branchId);\n\t\t\t\taddToLogCleanQueue(xid, branchId);\n\t\t\t}\n\t\t\tstatus.setRollbackOnly();\n\t\t\tthrow new SkipCallbackWrapperException(e);\n\t\t} catch (Throwable t) {\n\t\t\t//\n\t\t}\n\t});\n}\n```\n\n**queryTCCFenceDO  sql  for update Rollback  tcc_fence_log  try **\n\n## 5 \n\nTCC  TCC Seata  1.5.1 \n\n tcc_fence_log Seata  tcc_fence_log  RM  tcc_fence_log "
        },
        {
          "id": "/seata-tcc",
          "metadata": {
            "permalink": "/blog/seata-tcc",
            "source": "@site/blog/seata-tcc.md",
            "title": " Seata TCC ",
            "description": "Seata  AT XA TCC  SAGA  AT  TCC ",
            "date": "2022-01-18T00:00:00.000Z",
            "formattedDate": "January 18, 2022",
            "tags": [],
            "readingTime": 14.805,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": " Seata TCC ",
              "author": "",
              "keywords": [
                "SeataTCC"
              ],
              "description": "Seata  AT XA TCC  SAGA  AT  TCC ",
              "date": "2022/01/18"
            },
            "prevItem": {
              "title": " Seata  TCC ",
              "permalink": "/blog/seata-tcc-fence"
            },
            "nextItem": {
              "title": " Seata AT ",
              "permalink": "/blog/seata-at-lock"
            }
          },
          "content": "Seata  AT XA TCC  SAGA  AT  TCC \n\n#  TCC\n\nTCC  Try-Confirm-CancelTryConfirmCancel\n\n1. Try\n2. Confirm commit  Try \n3. Cancel Try \n\nTCC  TCC\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116160157.png)\n\n# Seata TCC \n\nSeata TCC  TCC  Seata TCC \n\n A  B  A  TCC \n\n```java\npublic interface TccActionOne {\n    @TwoPhaseBusinessAction(name = \"DubboTccActionOne\", commitMethod = \"commit\", rollbackMethod = \"rollback\")\n    public boolean prepare(BusinessActionContext actionContext, @BusinessActionContextParameter(paramName = \"a\") String a);\n\n    public boolean commit(BusinessActionContext actionContext);\n\n    public boolean rollback(BusinessActionContext actionContext);\n}\n```\n\n B  TCC \n\n```java\npublic interface TccActionTwo {\n    @TwoPhaseBusinessAction(name = \"DubboTccActionTwo\", commitMethod = \"commit\", rollbackMethod = \"rollback\")\n    public void prepare(BusinessActionContext actionContext, @BusinessActionContextParameter(paramName = \"b\") String b);\n\n    public void commit(BusinessActionContext actionContext);\n\n    public void rollback(BusinessActionContext actionContext);\n}\n```\n\n A  B  TCC \n\n```java\n@GlobalTransactional\npublic String doTransactionCommit(){\n    //A\n    tccActionOne.prepare(null,\"one\");\n    //B\n    tccActionTwo.prepare(null,\"two\");\n}\n```\n\n Seata TCC TCC  `@GlobalTransactional`  A  B  TCC Seata  TCC\n Resource TCC Resource\n\nTCC  RPC JVM  TCC TCC  A  B  TCC  Dubbo\nRPC dubbo:reference dubbo:service\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116161933.png)\n\nSeata  TCC  TCC  Seata  TC  TCC Resource TCC Resource  ID TCC\nSeata  AT  TCC  Try  TC  RPC \n\n/TC  ID  TCC Resource  Confirm/Cancel \n\n# Seata  TCC \n\n Seata TCC TCC  Seata  TCTMRM  TCC \n\n## \n\n TCC TCC  RPC JVM  Seata TCC  remoting\n `TwoPhaseBusinessAction`  TCC \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116175059.png)\n\n`RemotingParser`  `isRemoting``isReference``isService``getServiceDesc`  `DefaultRemotingParser`\nRPC  `DefaultRemotingParser` Seata  DubboHSFSofaRpcLocalTCC  RPC  SPI \nSeata  RPC \n\n Seata  `GlobalTransactionScanner ` \n\n`io.seata.spring.util.TCCBeanParserUtils#isTccAutoProxy`\n\n bean  TCC  bean  Remoting bean `getServiceDesc`  remoting bean\n\n\nio.seata.rm.tcc.remoting.parser.DefaultRemotingParser#parserRemotingServiceInfo\n\n```java\npublic RemotingDesc parserRemotingServiceInfo(Object bean,String beanName,RemotingParser remotingParser){\n    RemotingDesc remotingBeanDesc=remotingParser.getServiceDesc(bean,beanName);\n    if(remotingBeanDesc==null){\n    return null;\n    }\n    remotingServiceMap.put(beanName,remotingBeanDesc);\n\n    Class<?> interfaceClass=remotingBeanDesc.getInterfaceClass();\n    Method[]methods=interfaceClass.getMethods();\n    if(remotingParser.isService(bean,beanName)){\n    try{\n    //service bean, registry resource\n    Object targetBean=remotingBeanDesc.getTargetBean();\n    for(Method m:methods){\n    TwoPhaseBusinessAction twoPhaseBusinessAction=m.getAnnotation(TwoPhaseBusinessAction.class);\n    if(twoPhaseBusinessAction!=null){\n    TCCResource tccResource=new TCCResource();\n    tccResource.setActionName(twoPhaseBusinessAction.name());\n    tccResource.setTargetBean(targetBean);\n    tccResource.setPrepareMethod(m);\n    tccResource.setCommitMethodName(twoPhaseBusinessAction.commitMethod());\n    tccResource.setCommitMethod(interfaceClass.getMethod(twoPhaseBusinessAction.commitMethod(),\n    twoPhaseBusinessAction.commitArgsClasses()));\n    tccResource.setRollbackMethodName(twoPhaseBusinessAction.rollbackMethod());\n    tccResource.setRollbackMethod(interfaceClass.getMethod(twoPhaseBusinessAction.rollbackMethod(),\n    twoPhaseBusinessAction.rollbackArgsClasses()));\n    // set argsClasses\n    tccResource.setCommitArgsClasses(twoPhaseBusinessAction.commitArgsClasses());\n    tccResource.setRollbackArgsClasses(twoPhaseBusinessAction.rollbackArgsClasses());\n    // set phase two method's keys\n    tccResource.setPhaseTwoCommitKeys(this.getTwoPhaseArgs(tccResource.getCommitMethod(),\n    twoPhaseBusinessAction.commitArgsClasses()));\n    tccResource.setPhaseTwoRollbackKeys(this.getTwoPhaseArgs(tccResource.getRollbackMethod(),\n    twoPhaseBusinessAction.rollbackArgsClasses()));\n    //registry tcc resource\n    DefaultResourceManager.get().registerResource(tccResource);\n    }\n    }\n    }catch(Throwable t){\n    throw new FrameworkException(t,\"parser remoting service error\");\n    }\n    }\n    if(remotingParser.isReference(bean,beanName)){\n    //reference bean, TCC proxy\n    remotingBeanDesc.setReference(true);\n    }\n    return remotingBeanDesc;\n    }\n```\n\n `getServiceDesc`  remoting bean  `remotingBeanDesc`   `remotingServiceMap`\n `isService`  `TwoPhaseBusinessAction`  `TCCResource`\n\n## \n\n**1**\n\nSeata TCC  `TCCResource` `TCCResourceManager` TCC  RPC \n\nio.seata.rm.tcc.TCCResourceManager#registerResource\n\n```java\npublic void registerResource(Resource resource){\n    TCCResource tccResource=(TCCResource)resource;\n    tccResourceCache.put(tccResource.getResourceId(),tccResource);\n    super.registerResource(tccResource);\n    }\n```\n\n`TCCResource`  TCC  `registerResource`  TC TCC  resourceId \nactionNameactionName  `@TwoParseBusinessAction`  name\n\n**2/**\n\nio.seata.rm.tcc.TCCResourceManager#branchCommit\n\n```java\npublic BranchStatus branchCommit(BranchType branchType,String xid,long branchId,String resourceId,\n    String applicationData)throws TransactionException{\n    TCCResource tccResource=(TCCResource)tccResourceCache.get(resourceId);\n    if(tccResource==null){\n    throw new ShouldNeverHappenException(String.format(\"TCC resource is not exist, resourceId: %s\",resourceId));\n    }\n    Object targetTCCBean=tccResource.getTargetBean();\n    Method commitMethod=tccResource.getCommitMethod();\n    if(targetTCCBean==null||commitMethod==null){\n    throw new ShouldNeverHappenException(String.format(\"TCC resource is not available, resourceId: %s\",resourceId));\n    }\n    try{\n    //BusinessActionContext\n    BusinessActionContext businessActionContext=getBusinessActionContext(xid,branchId,resourceId,\n    applicationData);\n    // ... ... \n    ret=commitMethod.invoke(targetTCCBean,args);\n    // ... ... \n    return result?BranchStatus.PhaseTwo_Committed:BranchStatus.PhaseTwo_CommitFailed_Retryable;\n    }catch(Throwable t){\n    String msg=String.format(\"commit TCC resource error, resourceId: %s, xid: %s.\",resourceId,xid);\n    LOGGER.error(msg,t);\n    return BranchStatus.PhaseTwo_CommitFailed_Retryable;\n    }\n    }\n```\n\n TM TC  ID  TCC  TCC Resource  Confirm/Cancel \n\n resourceId  `TCCResource` xidbranchIdresourceIdapplicationData  `BusinessActionContext`\n `TCCResource`  `commit` \n\n\n\n## \n\n TCC  Seata TCC  RPC \n\n`io.seata.spring.util.TCCBeanParserUtils#isTccAutoProxy` TCC  TCC  true\n\nio.seata.spring.annotation.GlobalTransactionScanner#wrapIfNecessary\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116192544.png)\n\n `GlobalTransactionalScanner`  TCC Reference `TccActionInterceptor` `TccActionInterceptor`\n `MethodInterceptor`\n\n `TccActionInterceptor`  `ActionInterceptorHandler`  `ActionInterceptorHandler#proceed` \n\n```java\npublic Object proceed(Method method,Object[]arguments,String xid,TwoPhaseBusinessAction businessAction,\n    Callback<Object> targetCallback)throws Throwable{\n    //Get action context from arguments, or create a new one and then reset to arguments\n    BusinessActionContext actionContext=getOrCreateActionContextAndResetToArguments(method.getParameterTypes(),arguments);\n    //Creating Branch Record\n    String branchId=doTccActionLogStore(method,arguments,businessAction,actionContext);\n    // ... ... \n    try{\n    // ... ...\n    return targetCallback.execute();\n    }finally{\n    try{\n    //to report business action context finally if the actionContext.getUpdated() is true\n    BusinessActionContextUtil.reportContext(actionContext);\n    }finally{\n    // ... ... \n    }\n    }\n    }\n```\n\n TCC  `doTccActionLogStore`  TCC /\n\n# \n\n TCC  Seata \n\n## \n\n\n\n Try TM  Cancel \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116201900.png)\n\n A  RPC  A  RPC  A Seata\n A  Cancel \n\n Cancel Seata \n\nSeata  TCC  XID  BranchID  Try  Cancel  Try \n\n## \n\n TC  Confirm/Cancel \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116203816.png)\n\n A  TC  A TC \n\nSeata \n\n TCC  status 3 \n\n1. tried1\n2. committed2\n3. rollbacked3\n\n Confirm/Cancel  committed  rollbacked  Confirm/Cancel \n\n## \n\n Cancel   Try  Cancel  Try  Try\n\n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20220116205241.png)\n\n A  Try  Seata  Try TM  RPC  A Try\n\n\nSeata \n\n TCC  status \n\n1. suspended4\n\n Cancel  TCC  Cancel  Try  status=4  Try  status=4  Cancel  false  Try \n\n# \n\n[https://objcoding.com/](https://objcoding.com/)Seata CommitterGitHub\nIDobjcoding"
        },
        {
          "id": "/seata-at-lock",
          "metadata": {
            "permalink": "/blog/seata-at-lock",
            "source": "@site/blog/seata-at-lock.md",
            "title": " Seata AT ",
            "description": "Seata AT Seata ",
            "date": "2022-01-12T00:00:00.000Z",
            "formattedDate": "January 12, 2022",
            "tags": [],
            "readingTime": 9.82,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": " Seata AT ",
              "author": "",
              "keywords": [
                "SeataATTransactionGlobalLock"
              ],
              "description": "Seata AT Seata ",
              "date": "2022/01/12"
            },
            "prevItem": {
              "title": " Seata TCC ",
              "permalink": "/blog/seata-tcc"
            },
            "nextItem": {
              "title": "Welcome",
              "permalink": "/blog/welcome"
            }
          },
          "content": "Seata AT Seata  Seata AT  Seata  DataSourceProxySeata  undo_log \n\n Seata AT Seata \n\n# Seata \n\n Seata  4 \n\n1. Read uncommitted\n2. Read committed\n3. Repeatable read\n4. Serializable\n\n Oracle Mysql\n\n Seata  Seata \n\nSeata \n\n\n\nSeata Seata \n\n# \n\nAT  Seata  DataSourceProxy\n\n## 1\n\n StatementProxy  SQL  `select for update` SelectForUpdateExecutor  `@GlobalTransactional` or `@GlobalLock` while \n\nio.seata.rm.datasource.exec.SelectForUpdateExecutor#doExecute\n\n```java\npublic T doExecute(Object... args) throws Throwable {\n    Connection conn = statementProxy.getConnection();\n    // ... ...\n    try {\n        // ... ...\n        while (true) {\n            try {\n                // ... ...\n                if (RootContext.inGlobalTransaction() || RootContext.requireGlobalLock()) {\n                    // Do the same thing under either @GlobalTransactional or @GlobalLock, \n                    // that only check the global lock  here.\n                    statementProxy.getConnectionProxy().checkLock(lockKeys);\n                } else {\n                    throw new RuntimeException(\"Unknown situation!\");\n                }\n                break;\n            } catch (LockConflictException lce) {\n                if (sp != null) {\n                    conn.rollback(sp);\n                } else {\n                    conn.rollback();\n                }\n                // trigger retry\n                lockRetryController.sleep(lce);\n            }\n        }\n    } finally {\n        // ...\n    }\n```\n\n## 2\n\n ConnectionProxy#doCommit\n\n1`@GlobalTransactional`\n\n-  TC \n\nio.seata.rm.datasource.ConnectionProxy#register\n\n```java\nprivate void register() throws TransactionException {\n    if (!context.hasUndoLog() || !context.hasLockKey()) {\n        return;\n    }\n    Long branchId = DefaultResourceManager.get().branchRegister(BranchType.AT, getDataSourceProxy().getResourceId(),\n                                                                null, context.getXid(), null, context.buildLockKeys());\n    context.setBranchId(branchId);\n}\n```\n\n- TC \n\nio.seata.server.transaction.at.ATCore#branchSessionLock\n\n```java\nprotected void branchSessionLock(GlobalSession globalSession, BranchSession branchSession) throws TransactionException {\n    if (!branchSession.lock()) {\n        throw new BranchTransactionException(LockKeyConflict, String\n                                             .format(\"Global lock acquire failed xid = %s branchId = %s\", globalSession.getXid(),\n                                                     branchSession.getBranchId()));\n    }\n}\n```\n\n2`@GlobalLock`\n\nio.seata.rm.datasource.ConnectionProxy#processLocalCommitWithGlobalLocks\n\n```java\nprivate void processLocalCommitWithGlobalLocks() throws SQLException {\n    checkLock(context.buildLockKeys());\n    try {\n        targetConnection.commit();\n    } catch (Throwable ex) {\n        throw new SQLException(ex);\n    }\n    context.reset();\n}\n```\n\n## GlobalLock \n\n `@GlobalTransactional` Seata  `@GlobalLock`\n\n TC  RPC `@GlobalLock``@GlobalLock`\n\n\n\n# \n\n Seata AT \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20211226164628.png)\n\n**\n\nA A B B A A  A  A  A \n\n\n\n1 `@GlobalTransactional`\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20211226210337.png)\n\n**\n\n A \n\n2  `@GlobalLock`\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20211226210502.png)\n\n**\n\n `@GlobalTransactional`\n\n2  `@GlobalLock`  +  `select for update`\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20211226172358.png)\n\n`select for update` update  updateA \n\n transactional Globallock  select for update \n\n# \n\nSeata AT Seata\n\n\n\n A   `@GlobalLock`  +  `select for update`\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20211226210633.png)\n\n`select for update` SQL  SQL\n\n\n# \n\n[https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "welcome",
          "metadata": {
            "permalink": "/blog/welcome",
            "source": "@site/blog/2021-08-26-welcome/index.md",
            "title": "Welcome",
            "description": "Docusaurus blogging features are powered by the blog plugin.",
            "date": "2021-08-26T00:00:00.000Z",
            "formattedDate": "August 26, 2021",
            "tags": [
              {
                "label": "facebook",
                "permalink": "/blog/tags/facebook"
              },
              {
                "label": "hello",
                "permalink": "/blog/tags/hello"
              },
              {
                "label": "docusaurus",
                "permalink": "/blog/tags/docusaurus"
              }
            ],
            "readingTime": 0.405,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "Sbastien Lorber",
                "title": "Docusaurus maintainer",
                "url": "https://sebastienlorber.com",
                "imageURL": "https://github.com/slorber.png",
                "key": "slorber"
              },
              {
                "name": "Yangshun Tay",
                "title": "Front End Engineer @ Facebook",
                "url": "https://github.com/yangshun",
                "imageURL": "https://github.com/yangshun.png",
                "key": "yangshun"
              }
            ],
            "frontMatter": {
              "slug": "welcome",
              "title": "Welcome",
              "authors": [
                "slorber",
                "yangshun"
              ],
              "tags": [
                "facebook",
                "hello",
                "docusaurus"
              ]
            },
            "prevItem": {
              "title": " Seata AT ",
              "permalink": "/blog/seata-at-lock"
            },
            "nextItem": {
              "title": "",
              "permalink": "/blog/seata-snowflake-explain"
            }
          },
          "content": "[Docusaurus blogging features](https://docusaurus.io/docs/blog) are powered by the [blog plugin](https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-blog).\n\nSimply add Markdown files (or folders) to the `blog` directory.\n\nRegular blog authors can be added to `authors.yml`.\n\nThe blog post date can be extracted from filenames, such as:\n\n- `2019-05-30-welcome.md`\n- `2019-05-30-welcome/index.md`\n\nA blog post folder can be convenient to co-locate blog post images:\n\n![Docusaurus Plushie](./docusaurus-plushie-banner.jpeg)\n\nThe blog supports tags as well!\n\n**And if you don't want a blog**: just delete this directory, and use `blog: false` in your Docusaurus config."
        },
        {
          "id": "/seata-snowflake-explain",
          "metadata": {
            "permalink": "/blog/seata-snowflake-explain",
            "source": "@site/blog/seata-snowflake-explain.md",
            "title": "",
            "description": "2",
            "date": "2021-06-21T00:00:00.000Z",
            "formattedDate": "June 21, 2021",
            "tags": [],
            "readingTime": 10.435,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "selfishlover"
              }
            ],
            "frontMatter": {
              "title": "",
              "author": "selfishlover",
              "keywords": [
                "Seata",
                "snowflake",
                "UUID",
                "page split"
              ],
              "date": "2021/06/21"
            },
            "prevItem": {
              "title": "Welcome",
              "permalink": "/blog/welcome"
            },
            "nextItem": {
              "title": "SeataUUID",
              "permalink": "/blog/seata-analysis-UUID-generator"
            }
          },
          "content": "2\n1. \n2. ID\n![](/img/blog/seata/uuid/before.png)\n\n![](/img/blog/seata/uuid/after.png)\n\nIDIDIDIDIDID2ID2IDID\n\n()\n\nmysql innodbinnodbB+N(N)\n![](/img/blog/seata/uuid/page1.png)  \nB+ID25(4)\n![](/img/blog/seata/uuid/page2.png)  \nIO\n\nID(auto_increment)\n\nID(javaUUID)\n\nIDIDauto_incrementID(UUIDworkerId101024)\n\n  \nIDworkerIdIDworkerId1024  \nIDID\n![](/img/blog/seata/uuid/page3.png)  \nworker1-seq2\n![](/img/blog/seata/uuid/page4.png)  \nworker1seq3seq4()seq5()worker1IDworker2()worker2IDworker1()worker1worker1\"\"\n\nID\n![](/img/blog/seata/uuid/page5.png)  \nIDIDauto_increment1024()\n\n****\n\n***\n## \n\n(innodb250%)\n\n(~)()\n\nseata3PRreviewPR\n\n\n\nseata"
        },
        {
          "id": "/seata-analysis-UUID-generator",
          "metadata": {
            "permalink": "/blog/seata-analysis-UUID-generator",
            "source": "@site/blog/seata-analysis-UUID-generator.md",
            "title": "SeataUUID",
            "description": "SeataUUIDIDID",
            "date": "2021-05-08T00:00:00.000Z",
            "formattedDate": "May 8, 2021",
            "tags": [],
            "readingTime": 8.405,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "selfishlover"
              }
            ],
            "frontMatter": {
              "title": "SeataUUID",
              "author": "selfishlover",
              "keywords": [
                "Seata",
                "snowflake",
                "UUID"
              ],
              "date": "2021/05/08"
            },
            "prevItem": {
              "title": "",
              "permalink": "/blog/seata-snowflake-explain"
            },
            "nextItem": {
              "title": "Seata -- undo_log",
              "permalink": "/blog/seata-feature-undo-log-compress"
            }
          },
          "content": "SeataUUIDIDID\n- \n- \n- \n\n/\nTCIO\n(branch_tableID)\n\nSeata(1.4)\n\n\n1. ID()\n   ID(\"\")\n   Seata()\n    TC\n2. QPS400w/s~\n   124096\n   4096/ms400w/s4096/ms4096\n   (4096)Seata\n\n(1.4)2\n\n4095\n+112+1\n64ID\n\n![](/img/blog/seata/uuid/before.png)\n\n(ID)\n![](/img/blog/seata/uuid/after.png)\n\n`AtomicLong`\n```\n/**\n * timestamp and sequence mix in one Long\n * highest 11 bit: not used\n * middle  41 bit: timestamp\n * lowest  12 bit: sequence\n */\nprivate AtomicLong timestampAndSequence;\n```\n11\n```\n/**\n * business meaning: machine ID (0 ~ 1023)\n * actual layout in memory:\n * highest 1 bit: 0\n * middle 10 bit: workerId\n * lowest 53 bit: all 0\n */\nprivate long workerId;\n```\nID\n```\npublic long nextId() {\n   // \n   long next = timestampAndSequence.incrementAndGet();\n   // 53\n   long timestampWithSequence = next & timestampAndSequenceMask;\n   // 11\n   return workerId | timestampWithSequence;\n}\n```\n\n\n1. 4096/ms\n   \"\"(\"\")\n2. ()\n   \n   ID(~\n   )\n3. \"\" ID\n   QPS400w/s~\n   TC\n\nIDIDIPv410ID\nID(k8s)IP\n- 192.168.4.10\n- 192.168.8.10\n\nIP432\nMAC10[0, 1023]ID\n(IP)\n\nSeataUUID\n`public`\n`io.seata.common.util.IdWorker`\n\nSeata"
        },
        {
          "id": "/seata-feature-undo-log-compress",
          "metadata": {
            "permalink": "/blog/seata-feature-undo-log-compress",
            "source": "@site/blog/seata-feature-undo-log-compress.md",
            "title": "Seata -- undo_log",
            "description": " & ",
            "date": "2021-05-07T00:00:00.000Z",
            "formattedDate": "May 7, 2021",
            "tags": [],
            "readingTime": 5.78,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "chd"
              }
            ],
            "frontMatter": {
              "title": "Seata -- undo_log",
              "author": "chd",
              "keywords": [
                "Seata",
                "undo_log",
                "compress"
              ],
              "date": "2021/05/07"
            },
            "prevItem": {
              "title": "SeataUUID",
              "permalink": "/blog/seata-analysis-UUID-generator"
            },
            "nextItem": {
              "title": "ConcurrentHashMapSeata",
              "permalink": "/blog/seata-dsproxy-deadlock"
            }
          },
          "content": "###  & \n\nSeataDMLblob\n\n1. (MySQLmax_allowed_package)\n2. IOIO\n\n\n\n### \n\n1max_allowed_packagequery is too large2SSD\n\n\n\n\n\n\n\n### \n\nCPUCPU\n\n\n\n1. IOIO+\n2. \n\n\n\n![image](https://user-images.githubusercontent.com/22959373/95567752-f55ddf80-0a55-11eb-8092-1f1d99855bdd.png)\n\n\n\n![image](https://user-images.githubusercontent.com/22959373/95567834-0ad30980-0a56-11eb-9d7e-48b74babbea4.png)\n\ngzipzip\n\n\n\n### \n\n#### \n\n![](https://user-images.githubusercontent.com/22959373/116281711-8f039900-a7bc-11eb-91f8-82afdbb9f932.png)\n\n#### \n\nproperties\n\n```properties\n# undo_logtrue\nseata.client.undo.compress.enable=true\n# zipzip\nseata.client.undo.compress.type=zip\n# 64k\nseata.client.undo.compress.threshold=64k\n```\n\nundo_log\n\n```java\nprotected boolean needCompress(byte[] undoLogContent) {\n    // 1. undo_log(1.4.2)\n    // 2. (64k)\n    // undoLogContent\n    return ROLLBACK_INFO_COMPRESS_ENABLE \n        && undoLogContent.length > ROLLBACK_INFO_COMPRESS_THRESHOLD;\n}\n```\n\nundo_log\n\n```java\n// undo_log\nif (needCompress(undoLogContent)) {\n    // zip\n    compressorType = ROLLBACK_INFO_COMPRESS_TYPE;\n    // \n    undoLogContent = CompressorFactory.getCompressor(compressorType.getCode()).compress(undoLogContent);\n}\n// else \n```\n\n\n\n```java\nprotected String buildContext(String serializer, CompressorType compressorType) {\n    Map<String, String> map = new HashMap<>();\n    map.put(UndoLogConstants.SERIALIZER_KEY, serializer);\n    // \n    map.put(UndoLogConstants.COMPRESSOR_TYPE_KEY, compressorType.name());\n    return CollectionUtils.encodeMap(map);\n}\n```\n\n\n\n```java\nprotected byte[] getRollbackInfo(ResultSet rs) throws SQLException  {\n    // \n    byte[] rollbackInfo = rs.getBytes(ClientTableColumnsName.UNDO_LOG_ROLLBACK_INFO);\n    // \n    // getOrDefaultCompressorType.NONE1.4.21.4.2+\n    String rollbackInfoContext = rs.getString(ClientTableColumnsName.UNDO_LOG_CONTEXT);\n    Map<String, String> context = CollectionUtils.decodeMap(rollbackInfoContext);\n    CompressorType compressorType = CompressorType.getByName(context.getOrDefault(UndoLogConstants.COMPRESSOR_TYPE_KEY,\n    CompressorType.NONE.name()));\n    // \n    return CompressorFactory.getCompressor(compressorType.getCode())\n        .decompress(rollbackInfo);\n}\n```\n\n\n\n### \n\nundo_logSeata"
        },
        {
          "id": "/seata-dsproxy-deadlock",
          "metadata": {
            "permalink": "/blog/seata-dsproxy-deadlock",
            "source": "@site/blog/seata-dsproxy-deadlock.md",
            "title": "ConcurrentHashMapSeata",
            "description": "ConcurrentHashMapBugSeata",
            "date": "2021-03-13T00:00:00.000Z",
            "formattedDate": "March 13, 2021",
            "tags": [],
            "readingTime": 15.61,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "ConcurrentHashMapSeata",
              "keywords": [
                "SeataDataSourceConcurrentHashMapcomputeIfAbsent"
              ],
              "description": "ConcurrentHashMapBugSeata",
              "author": "",
              "date": "2021/03/13"
            },
            "prevItem": {
              "title": "Seata -- undo_log",
              "permalink": "/blog/seata-feature-undo-log-compress"
            },
            "nextItem": {
              "title": "Seata",
              "permalink": "/blog/seata-client-start-analysis-02"
            }
          },
          "content": "1. seata1.4.01.4\n2. (/)RPC\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/03a7f737b56e45b4b74e662033ec74f6~tplv-k3u1fbpfcp-watermark.image)\n\n# \n1.  --> \n2. RPC\n3. SQLSQLSQLSQLDBASQLSQL\n4. \n5. SQLDBASQLSQL\n6. arthaswatch\n7. arthasthread `thread -b` `thread -n`CPU`92%`,20Dubbo`BLOCKED`\n8. seataseataCPU`ConcurrentHashMap#computeIfAbsent``ConcurrentHashMap#computeIfAbsent`bug\n9. seataseata\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/faac0be0982e45a7a43b335e8f8b44bf~tplv-k3u1fbpfcp-watermark.image)\n\n# \n\n### ConcurrentHashMap#computeIfAbsent\nkeyhascodemappingFunctioncomputeIfAbsenthttps://juejin.cn/post/6844904191077384200\n\n### Seata\n\n1. SeataDataSourceBeanPostProcessor\n2. SeataAutoDataSourceProxyAdvice\n3. DataSourceProxyHolder\n\n##### SeataDataSourceBeanPostProcessor\n`SeataDataSourceBeanPostProcessor``BeanPostProcessor``postProcessAfterInitialization`(Bean)`seata`\n\n```java\npublic class SeataDataSourceBeanPostProcessor implements BeanPostProcessor {\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        if (bean instanceof DataSource) {\n            //When not in the excludes, put and init proxy.\n            if (!excludes.contains(bean.getClass().getName())) {\n                //Only put and init proxy, not return proxy.\n                DataSourceProxyHolder.get().putDataSource((DataSource) bean, dataSourceProxyMode);\n            }\n            //If is SeataDataSourceProxy, return the original data source.\n            if (bean instanceof SeataDataSourceProxy) {\n                LOGGER.info(\"Unwrap the bean of the data source,\" +\n                    \" and return the original data source to replace the data source proxy.\");\n                return ((SeataDataSourceProxy) bean).getTargetDataSource();\n            }\n        }\n        return bean;\n    }\n}\n```\n\n##### SeataAutoDataSourceProxyAdvice\n`SeataAutoDataSourceProxyAdvice`MethodInterceptorseata`SeataAutoDataSourceProxyCreator``DataSourceBean``SeataAutoDataSourceProxyAdvice#invoke``AOP``invoke``invoke``seata``seata`\n```java\npublic class SeataAutoDataSourceProxyAdvice implements MethodInterceptor, IntroductionInfo {\n    ......\n    @Override\n    public Object invoke(MethodInvocation invocation) throws Throwable {\n        if (!RootContext.requireGlobalLock() && dataSourceProxyMode != RootContext.getBranchType()) {\n            return invocation.proceed();\n        }\n        Method method = invocation.getMethod();\n        Object[] args = invocation.getArguments();\n        Method m = BeanUtils.findDeclaredMethod(dataSourceProxyClazz, method.getName(), method.getParameterTypes());\n        if (m != null) {\n            SeataDataSourceProxy dataSourceProxy = DataSourceProxyHolder.get().putDataSource((DataSource) invocation.getThis(), dataSourceProxyMode);\n            return m.invoke(dataSourceProxy, args);\n        } else {\n            return invocation.proceed();\n        }\n    }\n}\n```\n\n##### DataSourceProxyHolder\n```seata``DataSourceProxyHolder`ConcurrentHashMap``key --> `seata` value\n\n```java\npublic class DataSourceProxyHolder {\n      public SeataDataSourceProxy putDataSource(DataSource dataSource, BranchType dataSourceProxyMode) {\n        DataSource originalDataSource = dataSource;\n        ......\n        return CollectionUtils.computeIfAbsent(this.dataSourceProxyMap, originalDataSource,\n                BranchType.XA == dataSourceProxyMode ? DataSourceProxyXA::new : DataSourceProxy::new);\n    }\n}\n\n\n// CollectionUtils.java\npublic static <K, V> V computeIfAbsent(Map<K, V> map, K key, Function<? super K, ? extends V> mappingFunction) {\n    V value = map.get(key);\n    if (value != null) {\n        return value;\n    }\n    return map.computeIfAbsent(key, mappingFunction);\n}\n```\n\n### \n1. `DynamicDataSource``P6DataSource`\n2. `P6DataSource``DynamicDataSource`\n3. \n\n```java\n@Qualifier(\"dsMaster\")\n@Bean(\"dsMaster\")\nDynamicDataSource dsMaster() {\n    return new DynamicDataSource(masterDsRoute);\n}\n\n@Primary\n@Qualifier(\"p6DataSource\")\n@Bean(\"p6DataSource\")\nP6DataSource p6DataSource(@Qualifier(\"dsMaster\") DataSource dataSource) {\n    P6DataSource p6DataSource =  new P6DataSource(dsMaster());\n    return p6DataSource;\n}\n```\n\n### \n\n` ConcurrentHashMap#computeIfAbsent `\n\n1`ConcurrentHashMap#computeIfAbsent``keyhashcode``mappingFunctionput`seatamappingFunction`DataSourceProxy::new`DataSourceProxyput\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00d8e13f71644c63b3bbb58c93b30e0c~tplv-k3u1fbpfcp-watermark.image)\n```java\nAOP =>\nSeataAutoDataSourceProxyAdvice => \nDataSourceProxyHolder#putDataSource => \nDataSourceProxy::new => \nAOPgetConnection => \ngetConnection  => \nSeataAutoDataSourceProxyAdvice => \nDataSourceProxyHolder#putDataSource => \nDataSourceProxy::new  => \nDuridDataSourcegetConnection\n```\n\n21`AOP```\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3579631f58df4d17bfcd6f28ccc3fd79~tplv-k3u1fbpfcp-watermark.image)\n\n3`keyhashcode``hashcode`hashcodeConcurrentHashMap`keyhashcode``keyhash`hashcode\n```java\npublic class Test {\n    public static void main(String[] args) {\n        ConcurrentHashMap map = new ConcurrentHashMap(8);\n        Num n1 = new Num(3);\n        Num n2 = new Num(19);\n        Num n3 = new Num(20);\n    \n//      map.computeIfAbsent(n1, k1 -> map.computeIfAbsent(n3, k2 -> 200));      //  \n        map.computeIfAbsent(n1, k1 -> map.computeIfAbsent(n2, k2 -> 200));      // \n    }\n\n    static class Num{\n        private int i;\n        public Num(int i){\n            this.i = i;\n        }\n\n        @Override\n        public int hashCode() {\n            return i;\n        }\n    }\n}\n```\n1. `Num#hashCode`hashcode\n2. ConcurrentHashMapinitialCapacity8sizeCtl16map16\n3. `n1`3hashcode33\n4. `n2`19hashcode193`n1n2hash`\n5. `n3`20hashcode204\n6. `map.computeIfAbsent(n1, k1 -> map.computeIfAbsent(n3, k2 -> 200))``n1n3hash`\n7. `map.computeIfAbsent(n1, k1 -> map.computeIfAbsent(n2, k2 -> 200))``n1n2hash`\n\n\n4`SeataDataSourceBeanPostProcessor``SeataAutoDataSourceProxyAdvice`\n1. `SeataDataSourceBeanPostProcessor`AOP`SeataDataSourceBeanPostProcessor``SeataAutoDataSourceProxyAdvice`\n2. `SeataDataSourceBeanPostProcessor`mapkey`AOP``SeataAutoDataSourceProxyAdvice``invocation.getThis()```key\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/747b664a0b6c4f58843947576dd0856e~tplv-k3u1fbpfcp-watermark.image)\n\n5`SeataAutoDataSourceProxyAdvic#invoke``toStringhashCode`cglibmapput`SeataAutoDataSourceProxyAdvic#invoke`\n\n\n\n# \n1. keyhash`ConcurrentHashMap#computeIfAbsent`BUGBUG\n2. BUG(hashcode)BUG(hashcode)map`hashBUG`\n3. mapBLOCK\n4. `ConcurrentHashMap#computeIfAbsentBUG`seataBUG\n5. demo\n\n```java\npublic class Test {\n    public static void main(String[] args) {\n\n        ConcurrentHashMap map = new ConcurrentHashMap(8);\n\n        Num n1 = new Num(3);\n        Num n2 = new Num(19);\n\n        for(int i = 0; i< 20; i++){\n            new Thread(()-> {\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n\n                map.computeIfAbsent(n1, k-> 200);\n            }).start();\n        }\n        map.computeIfAbsent(n1, k1 -> map.computeIfAbsent(n2, k2 -> 200));\n    }\n\n\n    static class Num{\n        private int i;\n\n        public Num(int i){\n            this.i = i;\n        }\n        @Override\n        public int hashCode() {\n            return i;\n        }\n    }\n}\n```\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6134c6498fa49c4a68b2745ba0895e3~tplv-k3u1fbpfcp-watermark.image)\n\n\n### \n\n1. P6DataSource  DynamicDataSource P6DataSourceDynamicDataSourceBeanexcludsP6DataSource\n2. Seata\n\n##### \n1\n```java\n@Primary\n@Qualifier(\"p6DataSource\")\n@Bean(\"p6DataSource\")\nP6DataSource p6DataSource(@Qualifier(\"dsMaster\") DataSource dataSource) {\n    P6DataSource p6DataSource =  new P6DataSource(new TuYaDynamicDataSource(masterDsRoute));\n    logger.warn(\"dsMaster={}, hashcode={}\",p6DataSource, p6DataSource.hashCode());\n    return p6DataSource;\n}\n```\n\n2excluds\n```java\n@EnableAutoDataSourceProxy(excludes={\"P6DataSource\"})\n```\n\n##### Seata\n\n1`ConcurrentHashMap#computeIfAbsent`\n```java\nSeataDataSourceProxy dsProxy = dataSourceProxyMap.get(originalDataSource);\nif (dsProxy == null) {\n    synchronized (dataSourceProxyMap) {\n        dsProxy = dataSourceProxyMap.get(originalDataSource);\n        if (dsProxy == null) {\n            dsProxy = createDsProxyByMode(dataSourceProxyMode, originalDataSource);\n            dataSourceProxyMap.put(originalDataSource, dsProxy);\n        }\n    }\n}\nreturn dsProxy;\n```\n\n`CollectionUtils#computeIfAbsent`\n```java\npublic static <K, V> V computeIfAbsent(Map<K, V> map, K key, Function<? super K, ? extends V> mappingFunction) {\n    V value = map.get(key);\n    if (value != null) {\n        return value;\n    }\n    value = mappingFunction.apply(key);\n    return map.computeIfAbsent(key, value);\n}\n```\n\n2SeataAutoDataSourceProxyAdvice\n```java\nMethod m = BeanUtils.findDeclaredMethod(dataSourceProxyClazz, method.getName(), method.getParameterTypes());\nif (m != null && DataSource.class.isAssignableFrom(method.getDeclaringClass())) {\n    SeataDataSourceProxy dataSourceProxy = DataSourceProxyHolder.get().putDataSource((DataSource) invocation.getThis(), dataSourceProxyMode);\n    return m.invoke(dataSourceProxy, args);\n} else {\n    return invocation.proceed();\n}\n```\n\n### \n`SeataDataSourceBeanPostProcessor``SeataAutoDataSourceProxyAdvice`map`seata`key`SeataDataSourceBeanPostProcessor`key`AOP``SeataAutoDataSourceProxyAdvice`key`seata`\n\n`SeataDataSourceBeanPostProcessor`orderAOP\n\n\n# \n\nhttps://juejin.cn/post/6939041336964153352/"
        },
        {
          "id": "/seata-client-start-analysis-02",
          "metadata": {
            "permalink": "/blog/seata-client-start-analysis-02",
            "source": "@site/blog/seata-client-start-analysis-02.md",
            "title": "Seata",
            "description": "Seata",
            "date": "2021-03-04T01:35:01.000Z",
            "formattedDate": "March 4, 2021",
            "tags": [
              {
                "label": "Seata",
                "permalink": "/blog/tags/seata"
              }
            ],
            "readingTime": 18.175,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "booogu"
              }
            ],
            "frontMatter": {
              "layout": "post",
              "comments": true,
              "title": "Seata",
              "date": "2021-03-04T01:35:01.000Z",
              "author": "booogu",
              "catalog": true,
              "tags": [
                "Seata"
              ]
            },
            "prevItem": {
              "title": "ConcurrentHashMapSeata",
              "permalink": "/blog/seata-dsproxy-deadlock"
            },
            "nextItem": {
              "title": "SeataRM & TMTC",
              "permalink": "/blog/seata-client-start-analysis-01"
            }
          },
          "content": "> Seata<br />\nSeata<br />\nSeata<br />\nSeata<br />\n~\n\n## \nSeataRMTMTCSeataSeataTC**TC******\n\n## \nSeataSeataSPISeataExtensionSeataSPIJavaSpringBootSeata\n\n**Seata********File****SpringBoot**\n\nSeata\n\n## RM/TM\n[ Seata](http://booogu.top/2021/02/28/seata-client-start-analysis-01/)SeataTMRMNetty ChannelTC ServerRMSeataTC Server\n\nClientTC ServerNettyClientChannelManager.Channreconnect()****TC Server\n```js\n    /**\n     * NettyClientChannelManager.reconnect()\n     * Reconnect to remote server of current transaction service group.\n     *\n     * @param transactionServiceGroup transaction service group\n     */\n    void reconnect(String transactionServiceGroup) {\n        List<String> availList = null;\n        try {\n            //TC Server\n            availList = getAvailServerList(transactionServiceGroup);\n        } catch (Exception e) {\n            LOGGER.error(\"Failed to get available servers: {}\", e.getMessage(), e);\n            return;\n        }\n        //\n    }\n```\n\n[](https://seata.io/zh-cn/docs/user/txgroup/transaction-group.html):\n- SeataRMTM****\n- SeataTC********\n\n- TC\n- TC\n\n![Seata](http://booogu.top/img/in-post/TXGroup_Group_Relation.jpg)\n\n### ****TC Server\nRM/TCTCgetAvailServerList\n```js\n    private List<String> getAvailServerList(String transactionServiceGroup) throws Exception {\n        // \n        // lookUp()TCServer\n        List<InetSocketAddress> availInetSocketAddressList = RegistryFactory.getInstance().lookup(transactionServiceGroup);\n        if (CollectionUtils.isEmpty(availInetSocketAddressList)) {\n            return Collections.emptyList();\n        }\n\n        return availInetSocketAddressList.stream()\n                                         .map(NetUtil::toStringAddress)\n                                         .collect(Collectors.toList());\n    }\n```\n#### **Seata**\nSeataSeata\n\nSeata ****\n\n********Seata****\n- registry.typeNacosNacos\n- config.typeConsulConsul\n\nSeataYamlPropertiesSpringBootapplication.yamlseata-spring-boot-starterSpringBoot\n\nSeataregistry.confregistry.conf\n```js\nregistry {\n  # file nacos eurekarediszkconsuletcd3sofa\n  type = \"file\"\n  file {\n    name = \"file.conf\"\n  }\n}\n\nconfig {\n  # filenacos apollozkconsuletcd3\n  type = \"file\"\n  file {\n    name = \"file.conf\"\n  }\n}\n```\nSeataConfigurationFactory.CURRENT_FILE_INSTANCECURRENT_FILE_INSTANCESeata****\n```js\n    //getInstance()buildRegistryService\n    public static RegistryService getInstance() {\n        if (instance == null) {\n            synchronized (RegistryFactory.class) {\n                if (instance == null) {\n                    instance = buildRegistryService();\n                }\n            }\n        }\n        return instance;\n    }\n\n    private static RegistryService buildRegistryService() {\n        RegistryType registryType;\n        //\n        String registryTypeName = ConfigurationFactory.CURRENT_FILE_INSTANCE.getConfig(\n            ConfigurationKeys.FILE_ROOT_REGISTRY + ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR\n                + ConfigurationKeys.FILE_ROOT_TYPE);\n        try {\n            registryType = RegistryType.getType(registryTypeName);\n        } catch (Exception exx) {\n            throw new NotSupportYetException(\"not support registry type: \" + registryTypeName);\n        }\n        if (RegistryType.File == registryType) {\n            return FileRegistryServiceImpl.getInstance();\n        } else {\n            //SPI\n            return EnhancedServiceLoader.load(RegistryProvider.class, Objects.requireNonNull(registryType).name()).provide();\n        }\n    }\n```\nCURRENT_FILE_INSTANCEConfigurationFactory\n```js\n    //ConfigurationFactory\n    static {\n        load();\n    }\n\n     /**\n     * load()Seata\n     */   \n    private static void load() {\n        //\n        String seataConfigName = System.getProperty(SYSTEM_PROPERTY_SEATA_CONFIG_NAME);\n        if (seataConfigName == null) {\n            seataConfigName = System.getenv(ENV_SEATA_CONFIG_NAME);\n        }\n        if (seataConfigName == null) {\n            seataConfigName = REGISTRY_CONF_DEFAULT;\n        }\n        String envValue = System.getProperty(ENV_PROPERTY_KEY);\n        if (envValue == null) {\n            envValue = System.getenv(ENV_SYSTEM_KEY);\n        }\n        //Configuration\n        Configuration configuration = (envValue == null) ? new FileConfiguration(seataConfigName,\n                false) : new FileConfiguration(seataConfigName + \"-\" + envValue, false);\n        Configuration extConfiguration = null;\n        //SPI\n        //seata-spring-boot-starerSpringBootConfigurationProviderfile.confapplication.properties/application.yaml\n        try {\n            //ExtConfigurationProviderprovideConfiguration\n            extConfiguration = EnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n            if (LOGGER.isInfoEnabled()) {\n                LOGGER.info(\"load Configuration:{}\", extConfiguration == null ? configuration.getClass().getSimpleName()\n                        : extConfiguration.getClass().getSimpleName());\n            }\n        } catch (EnhancedServiceNotFoundException ignore) {\n\n        } catch (Exception e) {\n            LOGGER.error(\"failed to load extConfiguration:{}\", e.getMessage(), e);\n        }\n        //\n        CURRENT_FILE_INSTANCE = extConfiguration == null ? configuration : extConfiguration;\n    }\n```\nload()\n![Seata](http://booogu.top/img/in-post/seata_config_initialization.png)\n\n\n- Seata****\n- Seata**3**yaml/properties/conf\n- Seata**Configuration**SeataFileConfiguration\n\n```js\n/**\n * Seata\n * packageio.seata.config\n */\n\npublic interface Configuration {\n    /**\n     * Gets short.\n     *\n     * @param dataId       the data id\n     * @param defaultValue the default value\n     * @param timeoutMills the timeout mills\n     * @return the short\n     */\n    short getShort(String dataId, int defaultValue, long timeoutMills);\n\n    //\n}\n```\n- SeataExtConfigurationProviderprovide()ConfigurationConfigurationConfiguration\n```js\n/**\n * Seata\n * packageio.seata.config\n */\npublic interface ExtConfigurationProvider {\n    /**\n     * provide a AbstractConfiguration implementation instance\n     * @param originalConfiguration\n     * @return configuration\n     */\n    Configuration provide(Configuration originalConfiguration);\n}\n```\n- seata-seata-spring-boot-starter**SpringBootConfigurationProvider**provideCGLIBFileConfiguration\"get\"application.properties/application.yaml\n\nSpringBootConfigurationProviderExtConfigurationProviderConfigurationSeataExtConfigurationProvider\n\n****SeatafileFileRegistryServiceImpl\n#### TC Server\nlookup()RegistryFactory.getInstance().**lookup(transactionServiceGroup)**FileRegistryServiceImpl.lookup()\n```js\n    /**\n     * TC Server\n     * packageio.seata.discovery.registry\n     * classFileRegistryServiceImpl\n     */\n    @Override\n    public List<InetSocketAddress> lookup(String key) throws Exception {\n        //TC Server\n        String clusterName = getServiceGroup(key);\n        if (clusterName == null) {\n            return null;\n        }\n        //TCServer\n        String endpointStr = CONFIG.getConfig(\n            PREFIX_SERVICE_ROOT + CONFIG_SPLIT_CHAR + clusterName + POSTFIX_GROUPLIST);\n        if (StringUtils.isNullOrEmpty(endpointStr)) {\n            throw new IllegalArgumentException(clusterName + POSTFIX_GROUPLIST + \" is required\");\n        }\n        //InetSocketAddress\n        String[] endpoints = endpointStr.split(ENDPOINT_SPLIT_CHAR);\n        List<InetSocketAddress> inetSocketAddresses = new ArrayList<>();\n        for (String endpoint : endpoints) {\n            String[] ipAndPort = endpoint.split(IP_PORT_SPLIT_CHAR);\n            if (ipAndPort.length != 2) {\n                throw new IllegalArgumentException(\"endpoint format should like ip:port\");\n            }\n            inetSocketAddresses.add(new InetSocketAddress(ipAndPort[0], Integer.parseInt(ipAndPort[1])));\n        }\n        return inetSocketAddresses;\n    }\n\n    /**\n     * default\n     * packageio.seata.discovery.registry\n     * classRegistryService\n     */\n    default String  getServiceGroup(String key) {\n        key = PREFIX_SERVICE_ROOT + CONFIG_SPLIT_CHAR + PREFIX_SERVICE_MAPPING + key;\n        //\n        if (!SERVICE_GROUP_NAME.contains(key)) {\n            ConfigurationCache.addConfigListener(key);\n            SERVICE_GROUP_NAME.add(key);\n        }\n        //TC\n        return ConfigurationFactory.getInstance().getConfig(key);\n    }\n```\n**Seata**\n****\n\n### ****TC\n#### \nConfigurationFactory.buildConfiguration()****\n\n#### \n*FileRegistryServiceImpl.lookup()**RegistryService.getServiceGroup()*\n- lookup()TC Server**TC Server**FileRegistryServiceImpl.lookup()TCServer\n- getServiceGroup()RegistryServerdefaultSeataTC\n\n### \nTC ServerTC Server\n\n> AbstractNettyRemotingClient.doSelect()RMClient/TMClientServer\n\nSeata\n\n> [ Seata](http://booogu.top/2021/02/28/seata-client-start-analysis-01/)SeataSeata\n"
        },
        {
          "id": "/seata-client-start-analysis-01",
          "metadata": {
            "permalink": "/blog/seata-client-start-analysis-01",
            "source": "@site/blog/seata-client-start-analysis-01.md",
            "title": "SeataRM & TMTC",
            "description": "Seata",
            "date": "2021-02-28T21:08:00.000Z",
            "formattedDate": "February 28, 2021",
            "tags": [
              {
                "label": "Seata",
                "permalink": "/blog/tags/seata"
              }
            ],
            "readingTime": 11.15,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "booogu"
              }
            ],
            "frontMatter": {
              "layout": "post",
              "comments": true,
              "title": "SeataRM & TMTC",
              "date": "2021-02-28T21:08:00.000Z",
              "author": "booogu",
              "catalog": true,
              "tags": [
                "Seata"
              ]
            },
            "prevItem": {
              "title": "Seata",
              "permalink": "/blog/seata-client-start-analysis-02"
            },
            "nextItem": {
              "title": "Spring CloudSeata-TCC",
              "permalink": "/blog/integrate-seata-tcc-mode-with-spring-cloud"
            }
          },
          "content": "> Seata <br />\nSeata<br />\nSeata<br />\nSeata<br />\n~\n\n## \nREADMESeata****TC****TMRMSeata\n\nNettyNettyRPCTCRMNetty**SeataRPCConfig/Registry Center**\n\n## GlobalTransactionScanner\nSeata@GlobalTransactionalTCC@TwoPhraseBusinessActionSpring AOPBeanGlobalTransactionScannerSpring BeanScannerSpringGlobalTransactionScannerBean\n\nRPCTMClientRMClientTCGlobalTransactionScanner#afterPropertiesSet()\n\n````js\n    /**\n     * packageio.seata.spring.annotation\n     * classGlobalTransactionScanner\n     */\n    @Override\n    public void afterPropertiesSet() {\n        if (disableGlobalTransaction) {\n            if (LOGGER.isInfoEnabled()) {\n                LOGGER.info(\"Global transaction is disabled.\");\n            }\n            return;\n        }\n        //BeanTMRM\n        initClient();\n\n    }\n````\n\n## RM & TM \nRMClient.init()TMClient\n### \nRMClient#init()RMClient****RmNettyRemotingClient****init()RmNettyRemotingClient********\n\n```js\n    /**\n     * RMClient\n     * packageio.seata.rm\n     * classRMClient\n     */\n    public static void init(String applicationId, String transactionServiceGroup) {\n        // RmNettyRemotingClient        \n        RmNettyRemotingClient rmNettyRemotingClient = RmNettyRemotingClient.getInstance(applicationId, transactionServiceGroup);\n        rmNettyRemotingClient.setResourceManager(DefaultResourceManager.get());\n        rmNettyRemotingClient.setTransactionMessageHandler(DefaultRMHandler.get());\n        // RmNettyRemotingClientinit()\n        rmNettyRemotingClient.init();\n    }\n```\nRMClientinit()\n![RMClient.init](http://booogu.top/img/in-post/rmclient_relation.jpg)\n\n\nRMClientSeata RPCPR[Seata-RPC](https://mp.weixin.qq.com/s/PCSZ4a8cgmyZNhbUrO-BZQ)\n\n### \n\n![RMClient](http://booogu.top/img/in-post/rmclient_initialization.png)\n\n### Channel\nNettyChannel**Channel**Seatacommon-poolChannel\n\nSeata\ncommon-pool\n* **GenericKeydObjectPool<K, V>**KV\n* **KeyedPoolableObjectFactory<K, V>**KV\n\nSeata\n* **Channel**common-poolV\n* **NettyPoolKey**ChannelKeycommon-poolKNettyPoolKey\n    - *address*:ChannelTC Server\n    - *message*:ChannelTC ServerRPC\n* **GenericKeydObjectPool<NettyPoolKey,Channel>**Channel\n* **NettyPoolableFactory**Channel\n\n\nSeataChannelRPC\n\n* NettyClientChannelManager\n  - Channel\n  - ChannelChannel\n* RpcClientBootstrapRPCNettyBootstrapChannelChannel\n* AbstractNettyRemotingClient\n  - RpcClientBootstrap\n  - NettyRM/TMChannelNettyPoolKeyNettyClientChannelManager\n  - NettyPoolableFactory\n\nSeataChannel\n![Channel](http://booogu.top/img/in-post/create_channel.jpg)\n\n**RMClient**\n\n### \nRMClientServer\n\nRMClientinit()Seata\n\n```js\n    /**\n     * packageio.seata.core.rpcn.netty\n     * classAbstractNettyRemotingClient\n     */\n    public void init() {\n        //TC Server\n        timerExecutor.scheduleAtFixedRate(new Runnable() {\n            @Override\n            public void run() {\n                clientChannelManager.reconnect(getTransactionServiceGroup());\n            }\n        }, SCHEDULE_DELAY_MILLS, SCHEDULE_INTERVAL_MILLS, TimeUnit.MILLISECONDS);\n        if (NettyClientConfig.isEnableClientBatchSendRequest()) {\n            mergeSendExecutorService = new ThreadPoolExecutor(MAX_MERGE_SEND_THREAD,\n                MAX_MERGE_SEND_THREAD,\n                KEEP_ALIVE_TIME, TimeUnit.MILLISECONDS,\n                new LinkedBlockingQueue<>(),\n                new NamedThreadFactory(getThreadPrefix(), MAX_MERGE_SEND_THREAD));\n            mergeSendExecutorService.submit(new MergedSendRunnable());\n        }\n        super.init();\n        clientBootstrap.start();\n    }\n```\n\n\nreconnectRMClientTCregisterResource\n![RMClientTC Server](http://booogu.top/img/in-post/rmclient_connect_tcserver.png)\n\n\n* NettyClientChannelManagerAbstractNettyRemotingClientNettyPoolKeygetPoolKeyFunction()ClientRMClientTMClientChannelKey**TC Server**Seata\n  - TMClientChannelTCTMRegisterTMRequest\n  - RMClientChannelRMRegesterRMRequestResourceTC Server\n* ChannelNettyPoolableFactorymakeObjectChannelNettyPoolKey\n    - NettyPoolKeyaddressChannel\n    - NettyPoolKeymessageChannelTC ServerClientTC Server\n\nSeataTC Server\n\n\n\n> ****<br />\n********RMClient/TM ClientTC ServerSeata****TC Server****"
        },
        {
          "id": "/integrate-seata-tcc-mode-with-spring-cloud",
          "metadata": {
            "permalink": "/blog/integrate-seata-tcc-mode-with-spring-cloud",
            "source": "@site/blog/integrate-seata-tcc-mode-with-spring-cloud.md",
            "title": "Spring CloudSeata-TCC",
            "description": "Spring CloudSeataTCC",
            "date": "2021-01-23T00:00:00.000Z",
            "formattedDate": "January 23, 2021",
            "tags": [],
            "readingTime": 7.31,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Spring CloudSeata-TCC",
              "keywords": [
                "TCC",
                "Seata",
                "Spring Cloud",
                "",
                ""
              ],
              "description": "Spring CloudSeataTCC",
              "author": "",
              "date": "2021-01-23T00:00:00.000Z"
            },
            "prevItem": {
              "title": "SeataRM & TMTC",
              "permalink": "/blog/seata-client-start-analysis-01"
            },
            "nextItem": {
              "title": "Seata",
              "permalink": "/blog/seata-config-manager"
            }
          },
          "content": "Spring Cloud + feign  Seata(1.4.0)TCCSeataAT80%redisATATMysqlOraclePostgreSQLTCCTCCAT\n\n\n\n# TCC\n\n**Try-[Comfirm/Cancel]** SeataATTCC\n\nAT ** ACID **  ****MysqlOraclePostgreSQL\n\n prepare \n commit ****\n rollback ****\n\nTCC \n\n prepare    prepare \n commit  **** commit \n rollback  **** rollback \n\n TCC  **** \n\nSEATATCC**AT**ATundo_log\n\n# \n\n-  [nacos](https://nacos.io/zh-cn/ \"nacos\") \n- [seata(TC](http://seata.io/zh-cn/docs/ops/deploy-guide-beginner.html \"seata(TC\")\n\n\n# TMTCC-RM\n\nSpring Cloud + FeignTCC(ATTCCDEMO)\n\n[DEMO](https://github.com/tanzzj/springcloud-seata-feign \"\")\n\n## 3.1 seata\n\n[](http://seata.io/zh-cn/docs/ops/deploy-guide-beginner.html \"\")\n\n## 3.2 TM\n\n[service-tm](https://github.com/tanzzj/springcloud-seata-feign/tree/master/service-tm)\n\n## 3.3 RM-TCC\n\n### 3.3.1 TCC\n\n SpringCloud + FeignFeignhttp`@LocalTCC``@LocalTCC`TCCTCC\n\n-  `@LocalTCC` SpringCloud+FeignTCC\n-  `@TwoPhaseBusinessAction` trynametccbeancommitMethodrollbackMethodseata\n-  `@BusinessActionContextParameter` commitMethod/rollbackMethod\n-  `BusinessActionContext` TCC\n\n\n\n```java\n/**\n * tcc\n * \n * springCloud\n * LocalTCC\n *\n * @author tanzj\n */\n@LocalTCC\npublic interface TccService {\n \n    /**\n     * \n     * name = tccbean,\n     * commitMethod = commit \n     * rollbackMethod = rollback \n     * BusinessActionContextParameter \n     *\n     * @param params  -\n     * @return String\n     */\n    @TwoPhaseBusinessAction(name = \"insert\", commitMethod = \"commitTcc\", rollbackMethod = \"cancel\")\n    String insert(\n            @BusinessActionContextParameter(paramName = \"params\") Map<String, String> params\n    );\n \n    /**\n     * commitMethod\n     * contexttry\n     *\n     * @param context \n     * @return boolean\n     */\n    boolean commitTcc(BusinessActionContext context);\n \n    /**\n     * \n     *\n     * @param context \n     * @return boolean\n     */\n    boolean cancel(BusinessActionContext context);\n}\n```\n\n### 3.3.2 TCC\n\n\n\n- try`@Transational`springrollbackMethod\n- context.getActionContext(\"params\")try\n- **1**TCCcommitMethod\n- **2**TCC****\n\n```java\n@Slf4j\n@RestController\npublic class TccServiceImpl implements  TccService {\n \n    @Autowired\n    TccDAO tccDAO;\n \n    /**\n     * tccttry\n     * \n     *\n     * @param params - name\n     * @return String\n     */\n    @Override\n    @PostMapping(\"/tcc-insert\")\n    @Transactional(rollbackFor = Exception.class, propagation = Propagation.REQUIRED)\n    public String insert(@RequestBody Map<String, String> params) {\n        log.info(\"xid = \" + RootContext.getXID());\n        //todo MQredis\n        tccDAO.insert(params);\n        //\n        //throw new RuntimeException(\"tcc\");\n        return \"success\";\n    }\n \n    /**\n     * tcc confirm\n     * \n     *\n     * @param context \n     * @return boolean\n     */\n    @Override\n    public boolean commitTcc(BusinessActionContext context) {\n        log.info(\"xid = \" + context.getXid() + \"\");\n        //todo \n        return true;\n    }\n \n    /**\n     * tcc  cancel\n     *\n     * @param context \n     * @return boolean\n     */\n    @Override\n    public boolean cancel(BusinessActionContext context) {\n        //todo \n        System.out.println(\"please manually rollback this data:\" + context.getActionContext(\"params\"));\n        return true;\n    }\n}\n```\n\n### 3.3.3 TMRM-TCC\n\n3.2\n\n---\nSpring CloudTCC"
        },
        {
          "id": "/seata-config-manager",
          "metadata": {
            "permalink": "/blog/seata-config-manager",
            "source": "@site/blog/seata-config-manager.md",
            "title": "Seata",
            "description": "SeataSpring",
            "date": "2021-01-10T00:00:00.000Z",
            "formattedDate": "January 10, 2021",
            "tags": [],
            "readingTime": 12.41,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata",
              "keywords": [
                "SeataSpring"
              ],
              "description": "SeataSpring",
              "author": "",
              "date": "2021/01/10"
            },
            "prevItem": {
              "title": "Spring CloudSeata-TCC",
              "permalink": "/blog/integrate-seata-tcc-mode-with-spring-cloud"
            },
            "nextItem": {
              "title": "seata-golang ",
              "permalink": "/blog/seata-golang-communication-mode"
            }
          },
          "content": "SeataSeataSeataSeata\n\n# Server\nServer\n1. `Server#main`\n2. port\n3. hostportstoreMode\n4. Metric\n5. NettyServer\n6. Server\n7. NettyServer\n\n\n\n```java\npublic static void main(String[] args) throws IOException {\n    // port, use to logback.xml\n    int port = PortHelper.getPort(args);\n    System.setProperty(ConfigurationKeys.SERVER_PORT, Integer.toString(port));\n\n    // \n    ParameterParser parameterParser = new ParameterParser(args);\n\n    // Metric\n    MetricsManager.get().init();\n\n    // NettyServer\n    NettyRemotingServer nettyRemotingServer = new NettyRemotingServer(workingThreads);\n\n    // \n    DefaultCoordinator coordinator = new DefaultCoordinator(nettyRemotingServer);\n    coordinator.init();\n    \n    // NettyServer\n    nettyRemotingServer.init();\n}\n```\n\n`3`\n```java\nif (StringUtils.isBlank(storeMode)) {\n    storeMode = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.STORE_MODE,\n        SERVER_DEFAULT_STORE_MODE);\n}\n```\n`storeMode``ConfigurationFactory`API`ConfigurationFactory.getInstance()``ConfigurationFactory``Configuration`\n\n# \n\n## ConfigurationFactory\nSeata`registry.conf``file.conf``File``ConfigurationFactory``registry.conf`\n\n1`registry.conf``FileConfiguration`\n```java\nConfiguration configuration = new FileConfiguration(seataConfigName,false);\nFileConfigFactory.load(\"registry.conf\", \"registry\");\nFileConfig fileConfig = EnhancedServiceLoader.load(FileConfig.class, \"CONF\", argsType, args);\n```\n\n2\n```java\nConfiguration extConfiguration = EnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n```\n\n32`CURRENT_FILE_INSTANCE``CURRENT_FILE_INSTANCE`\n```java\nCURRENT_FILE_INSTANCE = extConfiguration == null ? configuration : extConfiguration;\n```\n\n`CURRENT_FILE_INSTANCE``registry.conf``registry.conf``bootstrap.conf`\n\n\n## Configuration\n`Configuration`SeataapolloconsuletcdnacoszkspringCloud`file.conf``registry.conf``file.conf`\n\n`Configuration``ConfigurationFactory``Configuration``ConfigurationFactory`\n1`registry.conf``config.type``file`\n```java\nconfigTypeName = CURRENT_FILE_INSTANCE.getConfig(ConfigurationKeys.FILE_ROOT_CONFIG + ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR+ ConfigurationKeys.FILE_ROOT_TYPE);\n```\n2`config.type`:`file``registry.conf``config.file.name``FileConfiguration``file.conf`SPISPI\n```java\nif (ConfigType.File == configType) {\n    String pathDataId = String.join(\"config.file.name\");\n    String name = CURRENT_FILE_INSTANCE.getConfig(pathDataId);\n    configuration = new FileConfiguration(name);\n    try {\n        //  \n        extConfiguration = EnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n    } catch (Exception e) {\n        LOGGER.error(\"failed to load extConfiguration:{}\", e.getMessage(), e);\n    }\n} else {\n    configuration = EnhancedServiceLoader\n            .load(ConfigurationProvider.class, Objects.requireNonNull(configType).name()).provide();\n}\n```\n\n32`Configuration`\n```java\nif (null != extConfiguration) {\n    configurationCache = ConfigurationCache.getInstance().proxy(extConfiguration);\n} else {\n    configurationCache = ConfigurationCache.getInstance().proxy(configuration);\n}\n```\n\n**Seata`registry.conf``file.conf`**\n\n\n1. Seata\n2. `file.conf`Spring`application.yaml`\n3. 2`Configuration`\n\n3Seata\n\n# \n\n\n1. `ConfigurationFactory.CURRENT_FILE_INSTANCE.getgetConfig(key)`\n2. `registry.conf`FileConfiguration`configuration`\n3. `SpringBootConfigurationProvider``configuration``configurationProxy`\n4. `configurationProxy``file zk nacos `\n5. Configuration`configuration2`\n6. `SpringBootConfigurationProvider``configuration2``configurationProxy2`\n7. `configurationProxy2`\n8. keySpringBean\n9. SpringBeangetXxx\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cb93fec40df40ba9e8ab9db06cc9b93~tplv-k3u1fbpfcp-watermark.image)\n\n## \n\n```java\nEnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n```\n1. SPI`ExtConfigurationProvider`Seata`SpringBootConfigurationProvider`\n2. `ExtConfigurationProvider#provider``Configuration`\n\n:\n```java\npublic Configuration provide(Configuration originalConfiguration) {\n    return (Configuration) Enhancer.create(originalConfiguration.getClass(), new MethodInterceptor() {\n        @Override\n        public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy)\n            throws Throwable {\n            if (method.getName().startsWith(\"get\") && args.length > 0) {\n                Object result = null;\n                String rawDataId = (String) args[0];\n                if (args.length == 1) {\n                    result = get(convertDataId(rawDataId));\n                } else if (args.length == 2) {\n                    result = get(convertDataId(rawDataId), args[1]);\n                } else if (args.length == 3) {\n                    result = get(convertDataId(rawDataId), args[1], (Long) args[2]);\n                }\n                if (result != null) {\n                    //If the return type is String,need to convert the object to string\n                    if (method.getReturnType().equals(String.class)) {\n                        return String.valueOf(result);\n                    }\n                    return result;\n                }\n            }\n\n            return method.invoke(originalConfiguration, args);\n        }\n    });\n}\n\nprivate Object get(String dataId) throws IllegalAccessException, InstantiationException {\n    String propertyPrefix = getPropertyPrefix(dataId);\n    String propertySuffix = getPropertySuffix(dataId);\n    ApplicationContext applicationContext = (ApplicationContext) ObjectHolder.INSTANCE.getObject(OBJECT_KEY_SPRING_APPLICATION_CONTEXT);\n    Class<?> propertyClass = PROPERTY_BEAN_MAP.get(propertyPrefix);\n    Object valueObject = null;\n    if (propertyClass != null) {\n        try {\n            Object propertyBean = applicationContext.getBean(propertyClass);\n            valueObject = getFieldValue(propertyBean, propertySuffix, dataId);\n        } catch (NoSuchBeanDefinitionException ignore) {\n\n        }\n    } else {\n        throw new ShouldNeverHappenException(\"PropertyClass for prefix: [\" + propertyPrefix + \"] should not be null.\");\n    }\n    if (valueObject == null) {\n        valueObject = getFieldValue(propertyClass.newInstance(), propertySuffix, dataId);\n    }\n\n    return valueObject;\n}\n```\n1`get`1/2/3`Configuration`\n2Seata\n3``Spring\n\n`ExtConfigurationProvider``SpringBootConfigurationProvider`Spring\n\n\n## Spring\nSeata\n1. Starter `seata-all`, Bean\n2. Starter `seata-spring-boot-starter`Bean\n\n`SpringBootConfigurationProvider``seata-spring-boot-starter``seata-all`Seata`ExtConfigurationProvider`\n\n`seata-spring-boot-starter`\n\n1`seata-spring-boot-starter``resources/META-INF/services``spring.factories`\n```\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\nio.seata.spring.boot.autoconfigure.SeataAutoConfiguration,\\\n\n# \nio.seata.spring.boot.autoconfigure.HttpAutoConfiguration\n```\n\n2`SeataAutoConfiguration`Bean GlobalTransactionScanner SeataDataSourceBeanPostProcessorSeataAutoDataSourceProxyCreatorSpringApplicationContextProvider3`SpringApplicationContextProvider``ApplicationContext`\n```java\npublic class SpringApplicationContextProvider implements ApplicationContextAware {\n    @Override\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        ObjectHolder.INSTANCE.setObject(OBJECT_KEY_SPRING_APPLICATION_CONTEXT, applicationContext);\n    }\n}\n```\n3`SeataAutoConfiguration``xxxProperties.Class`Key`PROPERTY_BEAN_MAP```xxxProperties``application.yaml`\n```java\nstatic {\n    PROPERTY_BEAN_MAP.put(SEATA_PREFIX, SeataProperties.class);\n    PROPERTY_BEAN_MAP.put(CLIENT_RM_PREFIX, RmProperties.class);\n    PROPERTY_BEAN_MAP.put(SHUTDOWN_PREFIX, ShutdownProperties.class);\n    ......\n}\n```\n\n`SpringBootConfigurationProvider`\n1. `pKey``xxxProperties`\n2. `ObjectHolder``ApplicationContext``xxxProperties`SpringBean\n3. `xxxProperties`SpringBean\n4. `application.yaml`"
        },
        {
          "id": "/seata-golang-communication-mode",
          "metadata": {
            "permalink": "/blog/seata-golang-communication-mode",
            "source": "@site/blog/seata-golang-communication-mode.md",
            "title": "seata-golang ",
            "description": " seata-golang  rpc ",
            "date": "2021-01-04T00:00:00.000Z",
            "formattedDate": "January 4, 2021",
            "tags": [],
            "readingTime": 18.72,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "seata-golang ",
              "keywords": [
                "seata",
                "seata-golang",
                "seata-go",
                "getty",
                ""
              ],
              "description": " seata-golang  rpc ",
              "author": "",
              "date": "2021/01/04"
            },
            "prevItem": {
              "title": "Seata",
              "permalink": "/blog/seata-config-manager"
            },
            "nextItem": {
              "title": "Seata",
              "permalink": "/blog/seata-datasource-proxy"
            }
          },
          "content": " |  \n\n## \n\n\nJava  netty RPC  netty  golang [getty](https://github.com/AlexStocks/getty)  netty getty  dubbogo  [dubbo-go](https://github.com/apache/dubbo-go)  dubbo-go  apache getty  apache  [dubbo-getty](https://github.com/apache/dubbo-getty) \n\n\n18  fescar seata dubbo-go  seata  go \n\n\n golang  RPC dubbo-go  dubbo-go  getty\n\n\n##  getty  RPC \n\n\ngetty \n\n\n![image.png]( https://img.alicdn.com/imgextra/i1/O1CN011TIcL01jY4JaweOfV_!!6000000004559-2-tps-954-853.png)\n\n\n seata-golang  RPC \n\n\n### 1. \n\n\n RPC  [client.go](https://github.com/apache/dubbo-getty/blob/master/client.go) \n\n\n```go\nfunc (c *client) connect() {\n\tvar (\n\t\terr error\n\t\tss  Session\n\t)\n\n\tfor {\n        //  session \n\t\tss = c.dial()\n\t\tif ss == nil {\n\t\t\t// client has been closed\n\t\t\tbreak\n\t\t}\n\t\terr = c.newSession(ss)\n\t\tif err == nil {\n            // \n\t\t\tss.(*session).run()\n\t\t\t// \n      \n\t\t\tbreak\n\t\t}\n\t\t// don't distinguish between tcp connection and websocket connection. Because\n\t\t// gorilla/websocket/conn.go:(Conn)Close also invoke net.Conn.Close()\n\t\tss.Conn().Close()\n\t}\n}\n```\n\n\n`connect()`  `dial()`  session  dial() \n\n\n```\nfunc (c *client) dial() Session {\n\tswitch c.endPointType {\n\tcase TCP_CLIENT:\n\t\treturn c.dialTCP()\n\tcase UDP_CLIENT:\n\t\treturn c.dialUDP()\n\tcase WS_CLIENT:\n\t\treturn c.dialWS()\n\tcase WSS_CLIENT:\n\t\treturn c.dialWSS()\n\t}\n\n\treturn nil\n}\n```\n\n\n TCP  `c.dialTCP()` \n\n\n```go\nfunc (c *client) dialTCP() Session {\n\tvar (\n\t\terr  error\n\t\tconn net.Conn\n\t)\n\n\tfor {\n\t\tif c.IsClosed() {\n\t\t\treturn nil\n\t\t}\n\t\tif c.sslEnabled {\n\t\t\tif sslConfig, err := c.tlsConfigBuilder.BuildTlsConfig(); err == nil && sslConfig != nil {\n\t\t\t\td := &net.Dialer{Timeout: connectTimeout}\n\t\t\t\t// \n\t\t\t\tconn, err = tls.DialWithDialer(d, \"tcp\", c.addr, sslConfig)\n\t\t\t}\n\t\t} else {\n            //  tcp \n\t\t\tconn, err = net.DialTimeout(\"tcp\", c.addr, connectTimeout)\n\t\t}\n\t\tif err == nil && gxnet.IsSameAddr(conn.RemoteAddr(), conn.LocalAddr()) {\n\t\t\tconn.Close()\n\t\t\terr = errSelfConnect\n\t\t}\n\t\tif err == nil {\n            //  TCPSession\n\t\t\treturn newTCPSession(conn, c)\n\t\t}\n\n\t\tlog.Infof(\"net.DialTimeout(addr:%s, timeout:%v) = error:%+v\", c.addr, connectTimeout, perrors.WithStack(err))\n\t\t<-wheel.After(connectInterval)\n\t}\n}\n```\n\n\n getty  TCP  TCPSession\n\n\n### 2. \n\n\n connection  `ss.(*session).run()` `run()` \n\n\n```go\nfunc (s *session) run() {\n\t// \n  \n\tgo s.handleLoop()\n\tgo s.handlePackage()\n}\n```\n\n\n goroutine`handleLoop`  `handlePackage` `handleLoop()` \n\n\n```go\nfunc (s *session) handleLoop() {\n    // \n  \n\tfor {\n\t\t// A select blocks until one of its cases is ready to run.\n\t\t// It choose one at random if multiple are ready. Otherwise it choose default branch if none is ready.\n\t\tselect {\n\t\t// \n      \n\t\tcase outPkg, ok = <-s.wQ:\n\t\t\t// \n\n\t\t\tiovec = iovec[:0]\n\t\t\tfor idx := 0; idx < maxIovecNum; idx++ {\n        //  s.writer  interface{}  outPkg \n\t\t\t\tpkgBytes, err = s.writer.Write(s, outPkg)\n\t\t\t\t// \n        \n\t\t\t\tiovec = append(iovec, pkgBytes)\n\n                //\n\t\t\t}\n            // \n\t\t\terr = s.WriteBytesArray(iovec[:]...)\n\t\t\tif err != nil {\n\t\t\t\tlog.Errorf(\"%s, [session.handleLoop]s.WriteBytesArray(iovec len:%d) = error:%+v\",\n\t\t\t\t\ts.sessionToken(), len(iovec), perrors.WithStack(err))\n\t\t\t\ts.stop()\n\t\t\t\t// break LOOP\n\t\t\t\tflag = false\n\t\t\t}\n\n\t\tcase <-wheel.After(s.period):\n\t\t\tif flag {\n\t\t\t\tif wsFlag {\n\t\t\t\t\terr := wsConn.writePing()\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\tlog.Warnf(\"wsConn.writePing() = error:%+v\", perrors.WithStack(err))\n\t\t\t\t\t}\n\t\t\t\t}\n                // \n\t\t\t\ts.listener.OnCron(s)\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n`handleLoop()` RPC  `s.writer`  TCP  `s.writer`  Writer  RPC \n\n\n `handlePackage()` \n\n\n```go\nfunc (s *session) handlePackage() {\n    // \n\n\tif _, ok := s.Connection.(*gettyTCPConn); ok {\n\t\tif s.reader == nil {\n\t\t\terrStr := fmt.Sprintf(\"session{name:%s, conn:%#v, reader:%#v}\", s.name, s.Connection, s.reader)\n\t\t\tlog.Error(errStr)\n\t\t\tpanic(errStr)\n\t\t}\n\n\t\terr = s.handleTCPPackage()\n\t} else if _, ok := s.Connection.(*gettyWSConn); ok {\n\t\terr = s.handleWSPackage()\n\t} else if _, ok := s.Connection.(*gettyUDPConn); ok {\n\t\terr = s.handleUDPPackage()\n\t} else {\n\t\tpanic(fmt.Sprintf(\"unknown type session{%#v}\", s))\n\t}\n}\n```\n\n\n `handleTCPPackage()` \n\n\n```go\nfunc (s *session) handleTCPPackage() error {\n    // \n\n\tconn = s.Connection.(*gettyTCPConn)\n\tfor {\n\t\t// \n\n\t\tbufLen = 0\n\t\tfor {\n\t\t\t// for clause for the network timeout condition check\n\t\t\t// s.conn.SetReadTimeout(time.Now().Add(s.rTimeout))\n            //  TCP \n\t\t\tbufLen, err = conn.recv(buf)\n\t\t\t// \n      \n\t\t\tbreak\n\t\t}\n\t\t// \n    \n        //  pkgBuf\n\t\tpktBuf.Write(buf[:bufLen])\n\t\tfor {\n\t\t\tif pktBuf.Len() <= 0 {\n\t\t\t\tbreak\n\t\t\t}\n            //  s.reader  RPC \n\t\t\tpkg, pkgLen, err = s.reader.Read(s, pktBuf.Bytes())\n\t\t\t// \n\n      s.UpdateActive()\n            //  TaskQueue  RPC \n\t\t\ts.addTask(pkg)\n\t\t\tpktBuf.Next(pkgLen)\n\t\t\t// continue to handle case 5\n\t\t}\n\t\tif exit {\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn perrors.WithStack(err)\n}\n```\n\n\nRPC  TCP  RPC  s.reader  RPC  s.reader  Reader \n\n\n### 3. \n\n\nnetty  boss  worker getty \n\n\n `handlePackage()`  `s.addTask(pkg)` \n\n\n```go\nfunc (s *session) addTask(pkg interface{}) {\n\tf := func() {\n\t\ts.listener.OnMessage(s, pkg)\n\t\ts.incReadPkgNum()\n\t}\n\tif taskPool := s.EndPoint().GetTaskPool(); taskPool != nil {\n\t\ttaskPool.AddTaskAlways(f)\n\t\treturn\n\t}\n\tf()\n}\n```\n\n\n`pkg`  `taskPool` seata-golang \n\n\n [taskPool](https://github.com/dubbogo/gost/blob/master/sync/task_pool.go) \n\n\n```go\n// NewTaskPoolSimple build a simple task pool\nfunc NewTaskPoolSimple(size int) GenericTaskPool {\n\tif size < 1 {\n\t\tsize = runtime.NumCPU() * 100\n\t}\n\treturn &taskPoolSimple{\n\t\twork: make(chan task),\n\t\tsem:  make(chan struct{}, size),\n\t\tdone: make(chan struct{}),\n\t}\n}\n```\n\n\n size  `runtime.NumCPU() * 100`  channel `sem` `AddTaskAlways(t task)`\n\n\n```go\nfunc (p *taskPoolSimple) AddTaskAlways(t task) {\n\tselect {\n\tcase <-p.done:\n\t\treturn\n\tdefault:\n\t}\n\n\tselect {\n\tcase p.work <- t:\n\t\treturn\n\tdefault:\n\t}\n\tselect {\n\tcase p.work <- t:\n\tcase p.sem <- struct{}{}:\n\t\tp.wg.Add(1)\n\t\tgo p.worker(t)\n\tdefault:\n\t\tgoSafely(t)\n\t}\n}\n```\n\n\n len(p.sem)  goroutine  goroutine  goroutine  t() len(p.sem)  goroutine  goroutine poolpool  goroutine  goroutine  seata-golang  taskPool  goroutine  goroutine\n\n\n### 4. \n\n\n [getty.go](https://github.com/apache/dubbo-getty/blob/master/getty.go)\n\n\n```go\n// Reader is used to unmarshal a complete pkg from buffer\ntype Reader interface {\n\tRead(Session, []byte) (interface{}, int, error)\n}\n\n// Writer is used to marshal pkg and write to session\ntype Writer interface {\n\t// if @Session is udpGettySession, the second parameter is UDPContext.\n\tWrite(Session, interface{}) ([]byte, error)\n}\n\n// ReadWriter interface use for handle application packages\ntype ReadWriter interface {\n\tReader\n\tWriter\n}\n```\n\n\n```go\n// EventListener is used to process pkg that received from remote session\ntype EventListener interface {\n\t// invoked when session opened\n\t// If the return error is not nil, @Session will be closed.\n\tOnOpen(Session) error\n\n\t// invoked when session closed.\n\tOnClose(Session)\n\n\t// invoked when got error.\n\tOnError(Session, error)\n\n\t// invoked periodically, its period can be set by (Session)SetCronPeriod\n\tOnCron(Session)\n\n\t// invoked when getty received a package. Pls attention that do not handle long time\n\t// logic processing in this func. You'd better set the package's maximum length.\n\t// If the message's length is greater than it, u should should return err in\n\t// Reader{Read} and getty will close this connection soon.\n\t//\n\t// If ur logic processing in this func will take a long time, u should start a goroutine\n\t// pool(like working thread pool in cpp) to handle the processing asynchronously. Or u\n\t// can do the logic processing in other asynchronous way.\n\t// !!!In short, ur OnMessage callback func should return asap.\n\t//\n\t// If this is a udp event listener, the second parameter type is UDPContext.\n\tOnMessage(Session, interface{})\n}\n```\n\n\n getty  `ReadWriter`  RPC  `EventListener`  RPC  `ReadWriter`  `EventLister`  RPC  Client  Server  RPC \n\n\n#### 4.1 \n\n\n seata \n![image-20201205214556457.png](https://cdn.nlark.com/yuque/0/2020/png/737378/1607180799872-5f96afb6-680d-4e69-8c95-b8fd1ac4c3a7.png#align=left&display=inline&height=209&margin=%5Bobject%20Object%5D&name=image-20201205214556457.png&originHeight=209&originWidth=690&size=18407&status=done&style=none&width=690)\n\n\n ReadWriter  [`RpcPackageHandler`](https://github.com/opentrx/seata-golang)  Codec \n\n\n```go\n// \nfunc MessageEncoder(codecType byte, in interface{}) []byte {\n\tswitch codecType {\n\tcase SEATA:\n\t\treturn SeataEncoder(in)\n\tdefault:\n\t\tlog.Errorf(\"not support codecType, %s\", codecType)\n\t\treturn nil\n\t}\n}\n\n// \nfunc MessageDecoder(codecType byte, in []byte) (interface{}, int) {\n\tswitch codecType {\n\tcase SEATA:\n\t\treturn SeataDecoder(in)\n\tdefault:\n\t\tlog.Errorf(\"not support codecType, %s\", codecType)\n\t\treturn nil, 0\n\t}\n}\n```\n\n\n#### 4.2 Client \n\n\n client  `EventListener`  [`RpcRemotingClient`](https://github.com/opentrx/seata-golang/blob/dev/pkg/client/rpc_remoting_client.go)\n\n\n```go\nfunc (client *RpcRemoteClient) OnOpen(session getty.Session) error {\n\tgo func() \n\t\trequest := protocal.RegisterTMRequest{AbstractIdentifyRequest: protocal.AbstractIdentifyRequest{\n\t\t\tApplicationId:           client.conf.ApplicationId,\n\t\t\tTransactionServiceGroup: client.conf.TransactionServiceGroup,\n\t\t}}\n    //  Transaction Coordinator  TransactionManager \n\t\t_, err := client.sendAsyncRequestWithResponse(session, request, RPC_REQUEST_TIMEOUT)\n\t\tif err == nil {\n      //  Transaction Coordinator \n\t\t\tclientSessionManager.RegisterGettySession(session)\n\t\t\tclient.GettySessionOnOpenChannel <- session.RemoteAddr()\n\t\t}\n\t}()\n\n\treturn nil\n}\n\n// OnError ...\nfunc (client *RpcRemoteClient) OnError(session getty.Session, err error) {\n\tclientSessionManager.ReleaseGettySession(session)\n}\n\n// OnClose ...\nfunc (client *RpcRemoteClient) OnClose(session getty.Session) {\n\tclientSessionManager.ReleaseGettySession(session)\n}\n\n// OnMessage ...\nfunc (client *RpcRemoteClient) OnMessage(session getty.Session, pkg interface{}) {\n\tlog.Info(\"received message:{%v}\", pkg)\n\trpcMessage, ok := pkg.(protocal.RpcMessage)\n\tif ok {\n\t\theartBeat, isHeartBeat := rpcMessage.Body.(protocal.HeartBeatMessage)\n\t\tif isHeartBeat && heartBeat == protocal.HeartBeatMessagePong {\n\t\t\tlog.Debugf(\"received PONG from %s\", session.RemoteAddr())\n\t\t}\n\t}\n\n\tif rpcMessage.MessageType == protocal.MSGTYPE_RESQUEST ||\n\t\trpcMessage.MessageType == protocal.MSGTYPE_RESQUEST_ONEWAY {\n\t\tlog.Debugf(\"msgId:%s, body:%v\", rpcMessage.Id, rpcMessage.Body)\n      \n\t\t//  or \n\t\tclient.onMessage(rpcMessage, session.RemoteAddr())\n\t} else {\n\t\tresp, loaded := client.futures.Load(rpcMessage.Id)\n\t\tif loaded {\n\t\t\tresponse := resp.(*getty2.MessageFuture)\n\t\t\tresponse.Response = rpcMessage.Body\n\t\t\tresponse.Done <- true\n\t\t\tclient.futures.Delete(rpcMessage.Id)\n\t\t}\n\t}\n}\n\n// OnCron ...\nfunc (client *RpcRemoteClient) OnCron(session getty.Session) {\n  // \n\tclient.defaultSendRequest(session, protocal.HeartBeatMessagePing)\n}\n```\n\n\n`clientSessionManager.RegisterGettySession(session)`  4.4 \n\n\n#### 4.3 Server  Transaction Coordinator \n\n\n [`DefaultCoordinator`](https://github.com/opentrx/seata-golang/blob/dev/tc/server/default_coordinator_event_listener.go)\n\n\n```go\nfunc (coordinator *DefaultCoordinator) OnOpen(session getty.Session) error {\n\tlog.Infof(\"got getty_session:%s\", session.Stat())\n\treturn nil\n}\n\nfunc (coordinator *DefaultCoordinator) OnError(session getty.Session, err error) {\n\t//  TCP \n  SessionManager.ReleaseGettySession(session)\n\tsession.Close()\n\tlog.Errorf(\"getty_session{%s} got error{%v}, will be closed.\", session.Stat(), err)\n}\n\nfunc (coordinator *DefaultCoordinator) OnClose(session getty.Session) {\n\tlog.Info(\"getty_session{%s} is closing......\", session.Stat())\n}\n\nfunc (coordinator *DefaultCoordinator) OnMessage(session getty.Session, pkg interface{}) {\n\tlog.Debugf(\"received message:{%v}\", pkg)\n\trpcMessage, ok := pkg.(protocal.RpcMessage)\n\tif ok {\n\t\t_, isRegTM := rpcMessage.Body.(protocal.RegisterTMRequest)\n\t\tif isRegTM {\n      //  TransactionManager  TCP \n\t\t\tcoordinator.OnRegTmMessage(rpcMessage, session)\n\t\t\treturn\n\t\t}\n\n\t\theartBeat, isHeartBeat := rpcMessage.Body.(protocal.HeartBeatMessage)\n\t\tif isHeartBeat && heartBeat == protocal.HeartBeatMessagePing {\n\t\t\tcoordinator.OnCheckMessage(rpcMessage, session)\n\t\t\treturn\n\t\t}\n\n\t\tif rpcMessage.MessageType == protocal.MSGTYPE_RESQUEST ||\n\t\t\trpcMessage.MessageType == protocal.MSGTYPE_RESQUEST_ONEWAY {\n\t\t\tlog.Debugf(\"msgId:%s, body:%v\", rpcMessage.Id, rpcMessage.Body)\n\t\t\t_, isRegRM := rpcMessage.Body.(protocal.RegisterRMRequest)\n\t\t\tif isRegRM {\n        //  ResourceManager  TCP \n\t\t\t\tcoordinator.OnRegRmMessage(rpcMessage, session)\n\t\t\t} else {\n\t\t\t\tif SessionManager.IsRegistered(session) {\n\t\t\t\t\tdefer func() {\n\t\t\t\t\t\tif err := recover(); err != nil {\n\t\t\t\t\t\t\tlog.Errorf(\"Catch Exception while do RPC, request: %v,err: %w\", rpcMessage, err)\n\t\t\t\t\t\t}\n\t\t\t\t\t}()\n          // \n\t\t\t\t\tcoordinator.OnTrxMessage(rpcMessage, session)\n\t\t\t\t} else {\n\t\t\t\t\tsession.Close()\n\t\t\t\t\tlog.Infof(\"close a unhandled connection! [%v]\", session)\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tresp, loaded := coordinator.futures.Load(rpcMessage.Id)\n\t\t\tif loaded {\n\t\t\t\tresponse := resp.(*getty2.MessageFuture)\n\t\t\t\tresponse.Response = rpcMessage.Body\n\t\t\t\tresponse.Done <- true\n\t\t\t\tcoordinator.futures.Delete(rpcMessage.Id)\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (coordinator *DefaultCoordinator) OnCron(session getty.Session) {\n\n}\n```\n\n\n`coordinator.OnRegTmMessage(rpcMessage, session)`  Transaction Manager`coordinator.OnRegRmMessage(rpcMessage, session)`  Resource Manager 4.4 \n `coordinator.OnTrxMessage(rpcMessage, session)` \n\n\n```go\n\tswitch msg.GetTypeCode() {\n\tcase protocal.TypeGlobalBegin:\n\t\treq := msg.(protocal.GlobalBeginRequest)\n\t\tresp := coordinator.doGlobalBegin(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeGlobalStatus:\n\t\treq := msg.(protocal.GlobalStatusRequest)\n\t\tresp := coordinator.doGlobalStatus(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeGlobalReport:\n\t\treq := msg.(protocal.GlobalReportRequest)\n\t\tresp := coordinator.doGlobalReport(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeGlobalCommit:\n\t\treq := msg.(protocal.GlobalCommitRequest)\n\t\tresp := coordinator.doGlobalCommit(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeGlobalRollback:\n\t\treq := msg.(protocal.GlobalRollbackRequest)\n\t\tresp := coordinator.doGlobalRollback(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeBranchRegister:\n\t\treq := msg.(protocal.BranchRegisterRequest)\n\t\tresp := coordinator.doBranchRegister(req, ctx)\n\t\treturn resp\n\tcase protocal.TypeBranchStatusReport:\n\t\treq := msg.(protocal.BranchReportRequest)\n\t\tresp := coordinator.doBranchReport(req, ctx)\n\t\treturn resp\n\tdefault:\n\t\treturn nil\n\t}\n```\n\n\n#### 4.4 session manager \nClient  Transaction Coordinator  `clientSessionManager.RegisterGettySession(session)`  `serverSessions = sync.Map{}`  map map  key  session  RemoteAddress  Transaction Coordinator value  sessionClient  map  session  Transaction Coordinator  Transaction Manager  Resource Manager  [`getty_client_session_manager.go`](https://github.com/opentrx/seata-golang/blob/dev/pkg/client/getty_client_session_manager.go)\nTransaction Manager  Resource Manager  Transaction Coordinator  TM  RM  RpcContext \n```go\ntype RpcContext struct {\n\tVersion                 string\n\tTransactionServiceGroup string\n\tClientRole              meta.TransactionRole\n\tApplicationId           string\n\tClientId                string\n\tResourceSets            *model.Set\n\tSession                 getty.Session\n}\n```\n RpcContext  map \n```go\nvar (\n\t// session -> transactionRole\n\t// TM will register before RM, if a session is not the TM registered,\n\t// it will be the RM registered\n\tsession_transactionroles = sync.Map{}\n\n\t// session -> applicationId\n\tidentified_sessions = sync.Map{}\n\n\t// applicationId -> ip -> port -> session\n\tclient_sessions = sync.Map{}\n\n\t// applicationId -> resourceIds\n\tclient_resources = sync.Map{}\n)\n```\nTransaction Manager  Resource Manager  `coordinator.OnRegTmMessage(rpcMessage, session)`  `coordinator.OnRegRmMessage(rpcMessage, session)`  Transaction Coordinator  client_sessions map  applicationIdipport  session  client_resources map  applicationId  resourceIds Resource Manager  RpcContext java  seata  [`getty_session_manager.go`](https://github.com/opentrx/seata-golang/blob/dev/tc/server/getty_session_manager.go)\n [seata-golang](https://github.com/opentrx/seata-golang)  RPC \n\n## seata-golang \n\n[seata-golang](https://github.com/opentrx/seata-golang)  4  8  java  [seata 1.2](https://github.com/seata/seata)  mysql  AT  TCC TC  mysql  TC  AT ![image20201205-232516.png]( https://img.alicdn.com/imgextra/i3/O1CN01alqsQS1G2oQecFYIs_!!6000000000565-2-tps-1025-573.png)\n\n\n java  seata 1.4 raft transaction coordinator  golang \n\n 33069364\n<img src=\"https://img.alicdn.com/imgextra/i2/O1CN01IjOVG425erjuzqcOi_!!6000000007552-2-tps-600-621.png\" width=\"200px\" />\n\n### ****\n\n (GitHubID dk-lockdown) h3c  Java/Go \n(github @AlexStocks)dubbo-go  Muduo/Pika/Dubbo/Sentinel-go  service mesh \n\n#### \n\n\nseata [https://seata.io](https://seata.io)\n\n\njava  seata[https://github.com/seata/seata](https://github.com/seata/seata)\n\n\nseata-golang [https://github.com/opentrx/seata-golang](https://github.com/transaction-wg/seata-golang)\n\n\nseata-golang go  b[https://www.bilibili.com/video/BV1oz411e72T](https://www.bilibili.com/video/BV1oz411e72T)"
        },
        {
          "id": "/seata-datasource-proxy",
          "metadata": {
            "permalink": "/blog/seata-datasource-proxy",
            "source": "@site/blog/seata-datasource-proxy.md",
            "title": "Seata",
            "description": "Seata",
            "date": "2020-10-16T00:00:00.000Z",
            "formattedDate": "October 16, 2020",
            "tags": [],
            "readingTime": 36.27,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata",
              "keywords": [
                "Seata"
              ],
              "description": "Seata",
              "author": "",
              "date": "2020/10/16"
            },
            "prevItem": {
              "title": "seata-golang ",
              "permalink": "/blog/seata-golang-communication-mode"
            },
            "nextItem": {
              "title": "Seata-Client",
              "permalink": "/blog/seata-sourcecode-client-bootstrap"
            }
          },
          "content": "Seata1.3.0\n1. undo_log` undo_log  undo_log undo_log2`undo_log`undo_log2``undo_log``undo_log```undo_log1undo_log\n2. ``undo_log`select for update`  `delete` `select for update``delete`\n\n\n## \nDataSource`getConnection``Connection``ConnectionProxy`\n```java\n// DataSourceProxy\n\npublic DataSourceProxy(DataSource targetDataSource) {\n    this(targetDataSource, DEFAULT_RESOURCE_GROUP_ID);\n}\n\nprivate void init(DataSource dataSource, String resourceGroupId) {\n    DefaultResourceManager.get().registerResource(this);\n}\n\npublic Connection getPlainConnection() throws SQLException {\n    return targetDataSource.getConnection();\n}\n\n@Override\npublic ConnectionProxy getConnection() throws SQLException {\n    Connection targetConnection = targetDataSource.getConnection();\n    return new ConnectionProxy(this, targetConnection);\n}\n```\n\n## \n`DataSourceProxy`\n```\n@Bean\npublic DataSource druidDataSource() {\n    return new DruidDataSource()\n}\n\n@Primary\n@Bean(\"dataSource\")\npublic DataSourceProxy dataSource(DataSource druidDataSource) {\n    return new DataSourceProxy(druidDataSource);\n}\n```\n\n## \n`DataSource``DataSource``DataSourceProxy()``DataSourceProxy``SeataAutoDataSourceProxyCreator`\n```java\npublic class SeataAutoDataSourceProxyCreator extends AbstractAutoProxyCreator {\n    private static final Logger LOGGER = LoggerFactory.getLogger(SeataAutoDataSourceProxyCreator.class);\n    private final String[] excludes;\n    private final Advisor advisor = new DefaultIntroductionAdvisor(new SeataAutoDataSourceProxyAdvice());\n\n    public SeataAutoDataSourceProxyCreator(boolean useJdkProxy, String[] excludes) {\n        this.excludes = excludes;\n        setProxyTargetClass(!useJdkProxy);\n    }\n\n    @Override\n    protected Object[] getAdvicesAndAdvisorsForBean(Class<?> beanClass, String beanName, TargetSource customTargetSource) throws BeansException {\n        if (LOGGER.isInfoEnabled()) {\n            LOGGER.info(\"Auto proxy of [{}]\", beanName);\n        }\n        return new Object[]{advisor};\n    }\n\n    @Override\n    protected boolean shouldSkip(Class<?> beanClass, String beanName) {\n        return SeataProxy.class.isAssignableFrom(beanClass) ||\n                DataSourceProxy.class.isAssignableFrom(beanClass) ||\n                !DataSource.class.isAssignableFrom(beanClass) ||\n                Arrays.asList(excludes).contains(beanClass.getName());\n    }\n}\n\npublic class SeataAutoDataSourceProxyAdvice implements MethodInterceptor, IntroductionInfo {\n    @Override\n    public Object invoke(MethodInvocation invocation) throws Throwable {\n        DataSourceProxy dataSourceProxy = DataSourceProxyHolder.get().putDataSource((DataSource) invocation.getThis());\n        Method method = invocation.getMethod();\n        Object[] args = invocation.getArguments();\n        Method m = BeanUtils.findDeclaredMethod(DataSourceProxy.class, method.getName(), method.getParameterTypes());\n        if (m != null) {\n            return m.invoke(dataSourceProxy, args);\n        } else {\n            return invocation.proceed();\n        }\n    }\n\n    @Override\n    public Class<?>[] getInterfaces() {\n        return new Class[]{SeataProxy.class};\n    }\n}\n```\n\n\n## \n```\n@Bean\n@DependsOn(\"strangeAdapter\")\npublic DataSource druidDataSource(StrangeAdapter strangeAdapter) {\n    doxx\n    return new DruidDataSource()\n}\n\n@Primary\n@Bean(\"dataSource\")\npublic DataSourceProxy dataSource(DataSource druidDataSource) {\n    return new DataSourceProxy(druidDataSource);\n}\n```\n1. `DataSource` `DruidDataSource``DataSourceProxy` `DruidDataSource  DataSourceProxy  targetDataSource ``DataSourceProxy``@Primary`\n2. `DruidDataSource``DruidDataSource``DataSourceProxy2`\n3. Connection\n   1. `DataSource``DataSourceProxy``Primary``DataSourceProxy`\n   2. `DataSource``Connection``DataSourceProxy``Connection``targetDataSource  DruidDataSource  getConnection ``DruidDataSource`2`DataSourceProxy2``DataSourceProxy2#getConnection``DruidDataSource#getConnection` `Connection``ConnectionProxy`\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ac0b91bd8fc4c48aa68afd5c58a42d5~tplv-k3u1fbpfcp-watermark.image)\n\nSeata`DataSourceProxy`\n\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/837aa0462d994e9a8614707c6a50b5ae~tplv-k3u1fbpfcp-watermark.image)\n\n\n\n\n\n# \n`ConnectionProxy`update\n1. `ConnectionProxy#prepareStatement` `PreparedStatementProxy`\n2. `PreparedStatementProxy#executeUpdate``PreparedStatementProxy#executeUpdate`: SQLundo_log\n\n## SQL\n```java\n// ExecuteTemplate#execute\nif (sqlRecognizers.size() == 1) {\n    SQLRecognizer sqlRecognizer = sqlRecognizers.get(0);\n    switch (sqlRecognizer.getSQLType()) {\n        case INSERT:\n            executor = EnhancedServiceLoader.load(InsertExecutor.class, dbType,\n                    new Class[]{StatementProxy.class, StatementCallback.class, SQLRecognizer.class},\n                    new Object[]{statementProxy, statementCallback, sqlRecognizer});\n            break;\n        case UPDATE:\n            executor = new UpdateExecutor<>(statementProxy, statementCallback, sqlRecognizer);\n            break;\n        case DELETE:\n            executor = new DeleteExecutor<>(statementProxy, statementCallback, sqlRecognizer);\n            break;\n        case SELECT_FOR_UPDATE:\n            executor = new SelectForUpdateExecutor<>(statementProxy, statementCallback, sqlRecognizer);\n            break;\n        default:\n            executor = new PlainExecutor<>(statementProxy, statementCallback);\n            break;\n    }\n} else {\n    executor = new MultiExecutor<>(statementProxy, statementCallback, sqlRecognizers);\n}\n```\n\n SQLConnectionProxycommit undo_log SQL\n```\nPreparedStatementProxy#executeUpdate => \nExecuteTemplate#execute => \nBaseTransactionalExecutor#execute =>\nAbstractDMLBaseExecutor#doExecute =>\nAbstractDMLBaseExecutor#executeAutoCommitTrue => \nAbstractDMLBaseExecutor#executeAutoCommitFalse => statementCallback#executePreparedStatement#executeUpdate\nConnectionProxy#commit\nConnectionProxy#processGlobalTransactionCommit\n```\n\n## UNDO_LOG\n```java\n// ConnectionProxy#processGlobalTransactionCommit\nprivate void processGlobalTransactionCommit() throws SQLException {\n    try {\n        // serverserverbranch_table\n        register();\n    } catch (TransactionException e) {\n        // for update sql,commit,branch,,,update @FUNKYE\n        recognizeLockKeyConflictException(e, context.buildLockKeys());\n    }\n    try {\n        // undo_log targetConnection            @1\n        UndoLogManagerFactory.getUndoLogManager(this.getDbType()).flushUndoLogs(this);\n\n        //  targetConnection              @2\n        targetConnection.commit();\n    } catch (Throwable ex) {\n        LOGGER.error(\"process connectionProxy commit error: {}\", ex.getMessage(), ex);\n        report(false);\n        throw new SQLException(ex);\n    }\n    if (IS_REPORT_SUCCESS_ENABLE) {\n        report(true);\n    }\n    context.reset();\n}\n```\n1. undo_log@1`undo_log``TargetConnection` \n```java\npublic void flushUndoLogs(ConnectionProxy cp) throws SQLException {\n    ConnectionContext connectionContext = cp.getContext();\n    if (!connectionContext.hasUndoLog()) {\n        return;\n    }\n\n    String xid = connectionContext.getXid();\n    long branchId = connectionContext.getBranchId();\n\n    BranchUndoLog branchUndoLog = new BranchUndoLog();\n    branchUndoLog.setXid(xid);\n    branchUndoLog.setBranchId(branchId);\n    branchUndoLog.setSqlUndoLogs(connectionContext.getUndoItems());\n\n    UndoLogParser parser = UndoLogParserFactory.getInstance();\n    byte[] undoLogContent = parser.encode(branchUndoLog);\n\n    if (LOGGER.isDebugEnabled()) {\n        LOGGER.debug(\"Flushing UNDO LOG: {}\", new String(undoLogContent, Constants.DEFAULT_CHARSET));\n    }\n\n    insertUndoLogWithNormal(xid, branchId, buildContext(parser.getName()), undoLogContent,cp.getTargetConnection());\n}\n```\n2. @2`TargetConnection` `SQL``undo_log``` `TargetConnection`\n\n>lcn,lcnundologh2(),2,h2undolog,,h2,,lcn,,undolog.\nlcn,undolog @FUNKYElcn\n\n\n# \n1. ServerClient\n2. ClientServer`DataSourceManager#branchRollback`\n3. resourceId`DataSourceManager.dataSourceCache``DataSourceProxy``masterSlaveProxy`(`TragetConnection`)\n4. ServerxidbranchIdundo_log`rollback_info`undo_log`SQLUndoLog`,`SQLUndoLog`ABundo_log`SQLUndoLog``SQLUndoLog`A`SQLUndoLog`B\n5. `SQLUndoLog``SQLUndoLog``INSERT``DELETE`\n6. xidbranchIdundo_log\n\n\n```java\n// AbstractUndoLogManager#undo   \n\npublic void undo(DataSourceProxy dataSourceProxy, String xid, long branchId) throws TransactionException {\n    Connection conn = null;\n    ResultSet rs = null;\n    PreparedStatement selectPST = null;\n    boolean originalAutoCommit = true;\n\n    for (; ; ) {\n        try {\n            // Connection,  TargetConnection\n            conn = dataSourceProxy.getPlainConnection();\n\n            // SQLundo_log\n            if (originalAutoCommit = conn.getAutoCommit()) {\n                conn.setAutoCommit(false);\n            }\n\n            // xid  branchId  undo_logSQL  SELECT * FROM undo_log WHERE branch_id = ? AND xid = ? FOR UPDATE\n            selectPST = conn.prepareStatement(SELECT_UNDO_LOG_SQL);\n            selectPST.setLong(1, branchId);\n            selectPST.setString(2, xid);\n            rs = selectPST.executeQuery();\n\n            boolean exists = false;\n            while (rs.next()) {\n                exists = true;\n                // status == 1 undo_log\n                if (!canUndo(state)) {\n                    return;\n                }\n\n                // undo_log\n                byte[] rollbackInfo = getRollbackInfo(rs);\n                BranchUndoLog branchUndoLog = UndoLogParserFactory.getInstance(serializer).decode(rollbackInfo);\n                try {\n                    setCurrentSerializer(parser.getName());\n                    List<SQLUndoLog> sqlUndoLogs = branchUndoLog.getSqlUndoLogs();\n                    if (sqlUndoLogs.size() > 1) {\n                        Collections.reverse(sqlUndoLogs);\n                    }\n                    for (SQLUndoLog sqlUndoLog : sqlUndoLogs) {\n                        AbstractUndoExecutor undoExecutor = UndoExecutorFactory.getUndoExecutor(dataSourceProxy.getDbType(), sqlUndoLog);\n                        // \n                        undoExecutor.executeOn(conn);\n                    }\n                } \n            }\n\n            // \n            if (exists) {\n                LOGGER.error(\"\\n delete from undo_log where xid={} AND branchId={} \\n\", xid, branchId);\n                deleteUndoLog(xid, branchId, conn);\n                conn.commit();\n            //   xidbranchId undo_logundo_log\n            } else {\n                LOGGER.error(\"\\n insert into undo_log xid={},branchId={} \\n\", xid, branchId);\n                insertUndoLogWithGlobalFinished(xid, branchId, UndoLogParserFactory.getInstance(), conn);\n                conn.commit();\n            }\n            return;\n        } catch (Throwable e) {\n            throw new BranchTransactionException(BranchRollbackFailed_Retriable, String\n                .format(\"Branch session rollback failed and try again later xid = %s branchId = %s %s\", xid,branchId, e.getMessage()), e);\n        }\n    }\n}\n```\n\n1. `TargetConnection`\n2. atuoCommitfalse\n3. xidbranchIdundo_log`for update`undo_log\n\n\n# \n\n\n\n## \n`SQL``undo_log`\n1. SQL\n```\nPreparedStatementProxy1.executeUpdate => \nstatementCallback#executeUpdate(PreparedStatementProxy2#executeUpdate) => \nPreparedStatement#executeUpdate\n```\n`PreparedStatement`\n\n\n2. undo_log\n```\nConnectionProxy1#getTargetConnection -> \nConnectionProxy2#prepareStatement -> \nPreparedStatementProxy2#executeUpdate -> \nPreparedStatement#executeUpdate(undo_log undo_log  undo_log2( undo_log  undo_log)) ->\nConnectionProxy2#commit -> \nConnectionProxy2#processGlobalTransactionCommit(undo_log2) ->\nConnectionProxy2#getTargetConnection ->\nTargetConnection#prepareStatement ->\nPreparedStatement#executeUpdate\n```\n\n\n## \n>undo_log\n\n`undo_log` `undo_log`undo_log(`undo_log2`),`undo_log2`()`undo_log```undo_log1undo_log\n\n****\n```\n// undo_log\n84\t59734070967644161\t172.16.120.59:23004:59734061438185472 serializer=jackson 1.1KB  0\n85\t59734075254222849\t172.16.120.59:23004:59734061438185472 serializer=jackson 4.0KB  0\n\n// branch_table\n59734070967644161\t172.16.120.59:23004:59734061438185472\t\tjdbc:mysql://172.16.248.10:3306/tuya_middleware\n59734075254222849\t172.16.120.59:23004:59734061438185472\t\tjdbc:mysql://172.16.248.10:3306/tuya_middleware\n\n// lock_table\njdbc:mysql://xx^^^seata_storage^^^1 59734070967644161\tjdbc:mysql://172.16.248.10:3306/tuya_middleware\tseata_storage\t  1\njdbc:mysql://xx^^^undo_log^^^84\t    59734075254222849\tjdbc:mysql://172.16.248.10:3306/tuya_middleware\tundo_log\t      84\n```\n\n****\n```\n// 1undo_log: undo_log added with GlobalFinished\n86\t59734070967644161\t172.16.120.59:23004:59734061438185472 serializer=jackson 1.0Byte  1\n```\n\n\n### \n1. xidbranchIdundo_log\n2. undo_log`rollback_info``rollback_info``SQLUndoLog``SQLUndoLog`\n3. xidbranchIdundo_log\n\nundo_logundo_log\n1xidbranchId`undo_log``rollback_info`rollback_info`SQLUndoLog`\n>`seata_storage``undo_log``seata_storageUPDATE`  `undo_logINSERT``undo_log`undo_log(4KB)`rollback_info`\n\n`SQLUndoLog`afterbranchId=`59734070967644161` pk=`84`  `seata_storagebranchId`   `seata_storageundo_log PK`undo_log `seata_storageundo_log`\nundo_logundo_log xidbranchId\n\n2`SQLUndoLog``undo_logINSERT``DELETE``undo_log``59734075254222849`undo_log**`undo_log`**\n\n3`SQLUndoLog``seata_storageUPDATE``seata_storage`\n\n4xidbranchIdundo_log`undo_log  undo_log ,  undo_log2`undo_log\n\n5`seata_storage`undo_log2undo_log`status == 1  undo_log`\n\n\n# \n\n## \n1: \n```\n@Bean(\"dsMaster\")\nDynamicDataSource dsMaster() {\n    return new DynamicDataSource(masterDsRoute);\n}\n\n@Bean(\"dsSlave\")\nDynamicDataSource dsSlave() {\n    return new DynamicDataSource(slaveDsRoute);\n}\n\n@Primary\n@Bean(\"masterSlave\")\nDataSource masterSlave(@Qualifier(\"dsMaster\") DataSource dataSourceMaster,\n                        @Qualifier(\"dsSlave\") DataSource dataSourceSlave) throws SQLException {\n    Map<String, DataSource> dataSourceMap = new HashMap<>(2);\n    //\n    dataSourceMap.put(\"dsMaster\", dataSourceMaster);\n    //\n    dataSourceMap.put(\"dsSlave\", dataSourceSlave);\n    // \n    MasterSlaveRuleConfiguration masterSlaveRuleConfig = new MasterSlaveRuleConfiguration(\n            \"masterSlave\", \"dsMaster\", Lists.newArrayList(\"dsSlave\")\n    );\n    Properties shardingProperties = new Properties();\n    shardingProperties.setProperty(\"sql.show\", \"true\");\n    shardingProperties.setProperty(\"sql.simple\", \"true\");\n    // \n    DataSource dataSource = MasterSlaveDataSourceFactory.createDataSource(dataSourceMap, masterSlaveRuleConfig, shardingProperties);\n    log.info(\"datasource initialized!\");\n    return dataSource;\n}\n```\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3e05c8fc0294a8caf4d0883a4676750~tplv-k3u1fbpfcp-watermark.image)\n\n2seataseata`DataSourceProxyHolder.dataSourceProxyMap`\n```\ndsMaster(DynamicDataSource)           =>       dsMasterProxy(DataSourceProxy)\ndsSlave(DynamicDataSource)           =>       dsSlaveProxy(DataSourceProxy)\nmasterSlave(MasterSlaveDataSource)       =>       masterSlaveProxy(DataSourceProxy)\n```\nIOC dsMasterProxy  dsSlaveProxy  masterSlaveProxy @PrimaryDataSource masterSlaveProxy\n\n\n>shardingjdbcdebug\n\n`masterSlaveProxy`` DataSourceProxy  MasterSlaveDataSource``MasterSlaveDataSource`\ndebug\n  1. select  dsSlave\n  2. update  dsMaster\n\n3DataSourceProxyDataSource`DataSourceProxy``DataSourceManager.dataSourceCache``DataSourceManager.dataSourceCache``DataSourceProxy`,`DataSourceProxy`\nkey`DataSourceManager.dataSourceCache` `DataSourceManager.dataSourceCache``masterSlaveProxy`,`masterSlaveProxy`\n\n4`seata_account`seataundo_log\n  1. seata_account\n  2. undo_log\n\nSeata\n\n\n## \nupdate`seata_account`count\nSQL:\n```\nupdate seata_account set count = count - 1 where id = 100;\n```\n\n## \n\nClient\n1. 20s`innodb_lock_wait_timeout`20(20)\n2. 20sServer\n\n```\n// \nBranch rollback start: 172.16.120.59:23004:59991911632711680 59991915571163137 jdbc:mysql://172.16.248.10:3306/tuya_middleware\n\n// undo_log  insert,  delete\nundoSQL undoSQL=DELETE FROM undo_log WHERE id = ?   PK=[[id,139]] \n// undo_log  undo_log\nundoSQL undoSQL=UPDATE seata_account SET money = ? WHERE id = ?   PK=[[id,1]] \n\n//  undo_log\ndelete from undo_log where xid=172.16.120.59:23004:59991911632711680 AND branchId=59991915571163137 \n\n// `Lock wait timeout exceeded` xidbranchIdundo_log\nbranchRollback failed. branchType:[AT], xid:[172.16.120.59:23004:59991911632711680], branchId:[59991915571163137], resourceId:[jdbc:mysql://172.16.248.10:3306/tuya_middleware], applicationData:[null]. reason:[Branch session rollback failed and try again later xid = 172.16.120.59:23004:59991911632711680 branchId = 59991915571163137 Lock wait timeout exceeded; try restarting transaction]\n```\n\nServer20sserver\n```\nRollback branch transaction fail and will retry, xid = 172.16.120.59:23004:59991911632711680 branchId = 59991915571163137\n```\n\nSQL\n```sql\n1. SELECT * FROM undo_log WHERE branch_id = ? AND xid = ? FOR UPDATE\t\t\t\t\t\t\tslaveDS\n2. SELECT * FROM undo_log WHERE  (id ) in (  (?)  )\t\t\t\t\t\t\t\t\t\t\t\t        slaveDS\n3. DELETE FROM undo_log WHERE id = ?  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t              masterDS\n4. SELECT * FROM seata_account WHERE  (id ) in (  (?)  )\t\t\t\t\t\t\t\t\t\t      masterDS\n5. UPDATE seata_account SET money = ? WHERE id = ?  \t\t\t\t\t\t\t\t\t\t\t        masterDS\n6. DELETE FROM undo_log WHERE branch_id = ? AND xid = ?\t\t\t\t\t\t\t\t\t\t\t      masterDS\n```\n\n\n   \n1\n```sql\nSELECT * FROM information_schema.INNODB_TRX;\n```\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d9852b91a9949f781e1f90bffe95fbf~tplv-k3u1fbpfcp-watermark.image)\n\n2\n```sql\nSELECT * FROM information_schema.INNODB_LOCKs;\n```\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a29748a3af34e7c90e3aa7cb78564bc~tplv-k3u1fbpfcp-watermark.image)\n\n3\n```sql\nSELECT * FROM information_schema.INNODB_LOCK_waits;\n\nSELECT\n\tblock_trx.trx_mysql_thread_id AS sessionID,\n\trequest_trx.trx_mysql_thread_id AS sessionID,\n\tblock_trx.trx_query AS SQL,\n\trequest_trx.trx_query AS SQL,\n\twaits.blocking_trx_id AS ID,\n\twaits.requesting_trx_id AS ID,\n\twaits.requested_lock_id AS ID,\n\tlocks.lock_table AS lock_table, \t\t\t\t\t-- \n\tlocks.lock_type AS lock_type, \t\t\t\t\t\t-- \n\tlocks.lock_mode AS lock_mode \t\t\t\t\t\t\t-- \nFROM\n\tinformation_schema.innodb_lock_waits AS waits\n\tINNER JOIN information_schema.innodb_trx AS block_trx ON waits.blocking_trx_id = block_trx.trx_id\n\tINNER JOIN information_schema.innodb_trx AS request_trx ON waits.requesting_trx_id = request_trx.trx_id\n\tINNER JOIN information_schema.innodb_locks AS locks ON waits.requested_lock_id = locks.lock_id;\n```\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ca5b50cab534a69a49c3e470518e3b6~tplv-k3u1fbpfcp-watermark.image)\n\n\n\n1.  `branch_id = 59991915571163137 AND xid = 172.16.120.59:23004:59991911632711680`\n2. ID`1539483284`SQLcommit\n3. ID`1539483286`\n\n `select for update`  `delete from undo ...` \n\n\n## \n\n1. dataSourceProxy.getPlainConnection()`MasterSlaveDataSource`\n2. `select for update``MasterSlaveDataSource``Connection``MasterSlaveDataSource``dsSlave``Connection`\n3. `delete from undo ...``dsMaster``Connection`\n4. `dsSlave``dsMaster`\n5. `select for update`undo_log\n6. `delete from undo ...``select for update`\n7. \n\n## \n\n1. Seata`select for update``select`undo_log\n\n\n2. `select for update``masterSlave``masterSlave`undo_log\n\n\n## \n`masterSlave``DataSource``dsMaster`  `dsSlave` `masterSlave``SeataAutoDataSourceProxyCreator#shouldSkip`EnableAutoDataSourceProxy`excludes`\n```\n@Override\nprotected boolean shouldSkip(Class<?> beanClass, String beanName) {\n    return SeataProxy.class.isAssignableFrom(beanClass) ||\n            DataSourceProxy.class.isAssignableFrom(beanClass) ||\n            !DataSource.class.isAssignableFrom(beanClass) ||\n            Arrays.asList(excludes).contains(beanClass.getName());\n}\n```\n: \n````\n@EnableAutoDataSourceProxy(excludes = {\"org.apache.shardingsphere.shardingjdbc.jdbc.core.datasource.MasterSlaveDataSource\"})\n````\n\n\n# \n`Seata 1.4.0``1.4.0-SNAPSHOT``ddevelop`\n\n## \n\n1. `DataSourceProxyHolder`\n2. `DataSourceProxy`\n3. `SeataDataSourceBeanPostProcessor`\n\n### DataSourceProxyHolder\n`putDataSource`\n```java\npublic SeataDataSourceProxy putDataSource(DataSource dataSource, BranchType dataSourceProxyMode) {\n    DataSource originalDataSource;\n    if (dataSource instanceof SeataDataSourceProxy) {\n        SeataDataSourceProxy dataSourceProxy = (SeataDataSourceProxy) dataSource;\n        // (AT/XA), \n        if (dataSourceProxyMode == dataSourceProxy.getBranchType()) {\n            return (SeataDataSourceProxy)dataSource;\n        }\n\n        // (AT/XA)TargetDataSource,\n        originalDataSource = dataSourceProxy.getTargetDataSource();\n    } else {\n        originalDataSource = dataSource;\n    }\n\n    //  TargetDataSource  \n    return this.dataSourceProxyMap.computeIfAbsent(originalDataSource,\n            BranchType.XA == dataSourceProxyMode ? DataSourceProxyXA::new : DataSourceProxy::new);\n}\n```\n`DataSourceProxyHolder#putDataSource``SeataAutoDataSourceProxyAdvice``SeataDataSourceBeanPostProcessor`\n\n1. `DataSourceProxy``DataSourceProxyHolder#putDataSource``DataSourceProxy``DataSourceProxy`\n2. `DruidSource``DataSourceProxyHolder#putDataSource``DataSourceProxy`\n\n\n```java\n@Bean\npublic DataSourceProxy dsA(){\n    return new DataSourceProxy(druidA)\n}\n\n@Bean\npublic DataSourceProxy dsB(DataSourceProxy dsA){\n    return new DataSourceProxy(dsA)\n}\n```\n1. \n2. `dsA``dsB``dsB  TargetDataSource``dsA`\n3. `DataSourceProxy`\n\n### DataSourceProxy\n```java\npublic DataSourceProxy(DataSource targetDataSource, String resourceGroupId) {\n    // DataSourceProxy\n    if (targetDataSource instanceof SeataDataSourceProxy) {\n        LOGGER.info(\"Unwrap the target data source, because the type is: {}\", targetDataSource.getClass().getName());\n        targetDataSource = ((SeataDataSourceProxy) targetDataSource).getTargetDataSource();\n    }\n    this.targetDataSource = targetDataSource;\n    init(targetDataSource, resourceGroupId);\n}\n```\n\n### SeataDataSourceBeanPostProcessor\n```java\npublic class SeataDataSourceBeanPostProcessor implements BeanPostProcessor {\n    private static final Logger LOGGER = LoggerFactory.getLogger(SeataDataSourceBeanPostProcessor.class);\n\n    ......\n\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        if (bean instanceof DataSource) {\n            //When not in the excludes, put and init proxy.\n            if (!excludes.contains(bean.getClass().getName())) {\n                //Only put and init proxy, not return proxy.\n                DataSourceProxyHolder.get().putDataSource((DataSource) bean, dataSourceProxyMode);\n            }\n\n            //If is SeataDataSourceProxy, return the original data source.\n            if (bean instanceof SeataDataSourceProxy) {\n                LOGGER.info(\"Unwrap the bean of the data source,\" +\n                    \" and return the original data source to replace the data source proxy.\");\n                return ((SeataDataSourceProxy) bean).getTargetDataSource();\n            }\n        }\n        return bean;\n    }\n}\n```\n1. `SeataDataSourceBeanPostProcessor``BeanPostProcessor`bean`BeanPostProcessor#postProcessAfterInitialization``postProcessAfterInitialization`bean\n2. bean`DataSourceProxy`\n>()`SeataDataSourceBeanPostProcessor``SeataAutoDataSourceProxyAdvice``DataSourceProxyHolder#putDataSource`Server`rsourceId`()`DatasourceProxy``SeataAutoDataSourceProxyAdvice``DataSourceProxy`\n\n## \nseata****\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6910095aadab436eaffe03a752e44240~tplv-k3u1fbpfcp-watermark.image)\n\n `masterSlaveProxy ->masterSlave ->  masterproxy/slaveProxy ->  master/slave`\n\n`excludes`\n\n\n\n1. ```DataSourceProxy``DataSourceProxy``DataSourceProxy`\n2. ```DataSourceProxy``TragetDatasourceDataSourceProxy targetDataSourceProxytragetDatasource`\n3. ****`excludes``DataSourceProxy`\n\n\n# \nDB3updatespring`@Transactional``@Transactional`  `@Transactional`\n\n\n## `@Transactional`\n1. 3updateupdateTCundo_log3update3\n2. 3\n3. seata\n\n## `@Transactional`\n1. 3update\n2. 1\n3. 3updateseata3update\n\n## \n3DBDB\n\n\n\n@FUNKYE"
        },
        {
          "id": "/seata-sourcecode-client-bootstrap",
          "metadata": {
            "permalink": "/blog/seata-sourcecode-client-bootstrap",
            "source": "@site/blog/seata-sourcecode-client-bootstrap.md",
            "title": "Seata-Client",
            "description": "SeataClient",
            "date": "2020-08-25T00:00:00.000Z",
            "formattedDate": "August 25, 2020",
            "tags": [],
            "readingTime": 11.405,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "|"
              }
            ],
            "frontMatter": {
              "title": "Seata-Client",
              "author": "|",
              "date": "2020/08/25",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "Seata",
              "permalink": "/blog/seata-datasource-proxy"
            },
            "nextItem": {
              "title": "MacSeata DemoAT",
              "permalink": "/blog/seata-at-demo-in-mac"
            }
          },
          "content": "## SeataClient\n\nATClientClientTCTMRMTCseata-serverTMRMSDKclient\n\nSeataDemo\n* **BusinessService** \n* **StorageService** \n* **OrderService** \n* **AccountService** \n\n![](https://img-blog.csdnimg.cn/20200820184156758.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTE0NTg0OA==,size_16,color_FFFFFF,t_70#pic_center)\n\nATSeata Client\n* **GlobalTransactionScanner**  GlobalTransactionScannerTMRM\n* **DatasourceProxy** DatasourceProxyDataSourceSQLRM\n*  **Rpc Interceptor** [Seata](https://blog.csdn.net/weixin_45145848/article/details/106930538)Rpc Interceptor\n\n## seata-spring-boot-starter\nseataSDKseata-allseata-spring-boot-starterseata-spring-boot-starterstarterseata-spring-boot-starter\n\nseata-spring-boot-starter\n![](https://img-blog.csdnimg.cn/20200810204518853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTE0NTg0OA==,size_16,color_FFFFFF,t_70)\n\n* **properties** propertiesSpringboot seataSpringBootSeata\n* **provider** providerSpringbootSpringCloudSeata\n* **resources** resourcesspring.factoriesSpringbootExtConfigurationProviderSpringbootConfigurationProviderProviderSpringBootSeata\n\nspringboot-starterresources/META-INF/spring.factories\n```properties\n# Auto Configure\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=\nio.seata.spring.boot.autoconfigure.SeataAutoConfiguration\n```\nspring.factoriesSeataAutoConfigurationGlobalTransactionScannerseataAutoDataSourceProxyCreator\n```java\n@ComponentScan(basePackages = \"io.seata.spring.boot.autoconfigure.properties\")\n@ConditionalOnProperty(prefix = StarterConstants.SEATA_PREFIX, name = \"enabled\",\n        havingValue = \"true\",\n        matchIfMissing = true)\n@Configuration\n@EnableConfigurationProperties({SeataProperties.class})\npublic class SeataAutoConfiguration {\n\n  ...\n  \n  // GlobalTransactionScannerGlobalTransaction\n  // RMTM\n  @Bean\n  @DependsOn({BEAN_NAME_SPRING_APPLICATION_CONTEXT_PROVIDER, BEAN_NAME_FAILURE_HANDLER})\n  @ConditionalOnMissingBean(GlobalTransactionScanner.class)\n  public GlobalTransactionScanner globalTransactionScanner(SeataProperties seataProperties,\n                                                           FailureHandler failureHandler) {\n    if (LOGGER.isInfoEnabled()) {\n      LOGGER.info(\"Automatically configure Seata\");\n    }\n    return new GlobalTransactionScanner(seataProperties.getApplicationId(),\n            seataProperties.getTxServiceGroup(),\n            failureHandler);\n  }\n  \n  // SeataAutoDataSourceProxyCreatorSpringDataSource\n  // SQL\n  @Bean(BEAN_NAME_SEATA_AUTO_DATA_SOURCE_PROXY_CREATOR)\n  @ConditionalOnProperty(prefix = StarterConstants.SEATA_PREFIX, name = {\n          \"enableAutoDataSourceProxy\", \"enable-auto\" +\n          \"-data-source-proxy\"}, havingValue = \"true\", matchIfMissing = true)\n  @ConditionalOnMissingBean(SeataAutoDataSourceProxyCreator.class)\n  public SeataAutoDataSourceProxyCreator seataAutoDataSourceProxyCreator(SeataProperties seataProperties) {\n    return new SeataAutoDataSourceProxyCreator(seataProperties.isUseJdkProxy(),\n            seataProperties.getExcludesForAutoProxying());\n  }\n}\n```\n\n### GlobalTransactionScanner\nGlobalTransactionScannerAutoProxyCreatorAutoProxyCreatorSpringAOPSpringGlobalTransactionScanner\n```java\npublic class GlobalTransactionScanner extends AbstractAutoProxyCreator\n        implements InitializingBean, ApplicationContextAware,\n        DisposableBean {\n  ...\n  // interceptor\n  // \n  private MethodInterceptor interceptor;\n  \n  // globalTransactionalInterceptorInterceptor\n  // TCCInterceptor\n  private MethodInterceptor globalTransactionalInterceptor;\n  \n  // PROXYED_SET\n  private static final Set<String> PROXYED_SET = new HashSet<>();\n  \n  // applicationId\n  // springcloudspring.application.name\n  private final String applicationId;\n  // wikihttp://seata.io/zh-cn/docs/user/txgroup/transaction-group.html\n  private final String txServiceGroup;\n  \n  ...\n\n  // interceptor\n  @Override\n  protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {\n  \t// \n    if (disableGlobalTransaction) {\n      return bean;\n    }\n    try {\n      synchronized (PROXYED_SET) {\n        if (PROXYED_SET.contains(beanName)) {\n          return bean;\n        }\n        \n        // interceptornullinterceptor\n        // getAdvicesAndAdvisorsForBean\n        // interceptorinterceptor\n        interceptor = null;\n        \n        // TCCTwoPhaseBusinessAction\n        if (TCCBeanParserUtils.isTccAutoProxy(bean, beanName,\n                applicationContext)) {\n          // TCC\n          interceptor =\n                  new TccActionInterceptor(TCCBeanParserUtils.getRemotingDesc(beanName));\n        } else {\n          // class\n          Class<?> serviceInterface = SpringProxyUtils.findTargetClass(bean);\n          // \n          Class<?>[] interfacesIfJdk = SpringProxyUtils.findInterfaces(bean);\n          \n          // classGlobalTransactional\n          // classGlobalTransactional\n          // GlobalLocktrue\n          if (!existsAnnotation(new Class[]{serviceInterface})\n                  && !existsAnnotation(interfacesIfJdk)) {\n            return bean;\n          }\n          \n          // interceptornullTCC\n          // globalTransactionalInterceptor\n          if (interceptor == null) {\n            // globalTransactionalInterceptor\n            if (globalTransactionalInterceptor == null) {\n              globalTransactionalInterceptor =\n                      new GlobalTransactionalInterceptor(failureHandlerHook);\n              ConfigurationCache.addConfigListener(\n                      ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,\n                      (ConfigurationChangeListener) globalTransactionalInterceptor);\n            }\n            interceptor = globalTransactionalInterceptor;\n          }\n        }\n\n        if (!AopUtils.isAopProxy(bean)) {\n          // beanProxywrapIfNecessary\n          // getAdvicesAndAdvisorsForBeaninterceptor\n          bean = super.wrapIfNecessary(bean, beanName, cacheKey);\n        } else {\n          // beanAdvisedSupport\n          // interceptor\n          AdvisedSupport advised = SpringProxyUtils.getAdvisedSupport(bean);\n          Advisor[] advisor = buildAdvisors(beanName,\n                  getAdvicesAndAdvisorsForBean(null, null, null));\n          for (Advisor avr : advisor) {\n            advised.addAdvisor(0, avr);\n          }\n        }         \n        // beanName\n        PROXYED_SET.add(beanName);\n        return bean;\n      }\n    } catch (Exception exx) {\n      throw new RuntimeException(exx);\n    }\n  }\n  \n  // wrapIfNecessaryinterceptor\n  @Override\n  protected Object[] getAdvicesAndAdvisorsForBean(Class beanClass, String beanName,\n                                                  TargetSource customTargetSource)\n          throws BeansException {\n    return new Object[]{interceptor};\n  }\n}\n```\n\nGlobalTransactionScannerTccActionInterceptorGlobalTransactionalInterceptorATGlobalTransactionalInterceptorGlobalTransactionalInterceptor\n\nGloabalTransactionScannerTMRMinitClient\n```java\nprivate void initClient() {\n    ...\n    \n    //TM\n    TMClient.init(applicationId, txServiceGroup);\n    ...\n    \n    //RM\n    RMClient.init(applicationId, txServiceGroup);\n\t...\n\t\n    // Spring shutdown\n    registerSpringShutdownHook();\n\n }\n```\n\nTMClientRMClientSeataNettyRpcTMClientRMClient\n```java\npublic class RMClient {\n  // RMClientinitstaticRmNettyRemotingClientinit\n  public static void init(String applicationId, String transactionServiceGroup) {\n    RmNettyRemotingClient rmNettyRemotingClient =\n            RmNettyRemotingClient.getInstance(applicationId, transactionServiceGroup);\n    rmNettyRemotingClient.setResourceManager(DefaultResourceManager.get());\n    rmNettyRemotingClient.setTransactionMessageHandler(DefaultRMHandler.get());\n    rmNettyRemotingClient.init();\n  }\n}\n```\n\nRmNettyRemotingClient\n```java\n@Sharable\npublic final class RmNettyRemotingClient extends AbstractNettyRemotingClient {\n  // ResourceManagerATTCCSaga\n  private ResourceManager resourceManager;\n  // RmNettyRemotingClient\n  private static volatile RmNettyRemotingClient instance;\n  private final AtomicBoolean initialized = new AtomicBoolean(false);\n  // \n  private String applicationId;\n  // \n  private String transactionServiceGroup;\n  \n  // RMClientinitinit\n  public void init() {\n    // SeataRpcProcessor\n    registerProcessor();\n    if (initialized.compareAndSet(false, true)) {\n      // initNettySeata-Server\n      super.init();\n    }\n  }\n  \n  // SeataRpcProcessor\n  private void registerProcessor() {\n    // 1.Seata-ServerbranchCommitProcessor\n    RmBranchCommitProcessor rmBranchCommitProcessor =\n            new RmBranchCommitProcessor(getTransactionMessageHandler(), this);\n    super.registerProcessor(MessageType.TYPE_BRANCH_COMMIT, rmBranchCommitProcessor,\n            messageExecutor);\n            \n    // 2.Seata-ServerbranchRollbackProcessor\n    RmBranchRollbackProcessor rmBranchRollbackProcessor =\n            new RmBranchRollbackProcessor(getTransactionMessageHandler(), this);\n    super.registerProcessor(MessageType.TYPE_BRANCH_ROLLBACK, rmBranchRollbackProcessor\n            , messageExecutor);\n            \n    // 3.Seata-ServerundoLogProcessor\n    RmUndoLogProcessor rmUndoLogProcessor =\n            new RmUndoLogProcessor(getTransactionMessageHandler());\n    super.registerProcessor(MessageType.TYPE_RM_DELETE_UNDOLOG, rmUndoLogProcessor,\n            messageExecutor);\n            \n    // 4.Seata-ServerResponseProcessorClientOnResponseProcessor\n    // ClientRequestSeata-ServerResponse\n    // ClientOnResponseProcessorClientRequestSeata-Server\n    // ResponseRpc\n    ClientOnResponseProcessor onResponseProcessor =\n            new ClientOnResponseProcessor(mergeMsgMap, super.getFutures(),\n                    getTransactionMessageHandler());\n    super.registerProcessor(MessageType.TYPE_SEATA_MERGE_RESULT, onResponseProcessor,\n            null);\n    super.registerProcessor(MessageType.TYPE_BRANCH_REGISTER_RESULT,\n            onResponseProcessor, null);\n    super.registerProcessor(MessageType.TYPE_BRANCH_STATUS_REPORT_RESULT,\n            onResponseProcessor, null);\n    super.registerProcessor(MessageType.TYPE_GLOBAL_LOCK_QUERY_RESULT,\n            onResponseProcessor, null);\n    super.registerProcessor(MessageType.TYPE_REG_RM_RESULT, onResponseProcessor, null);\n    \n    // 5. Seata-ServerPong\n    ClientHeartbeatProcessor clientHeartbeatProcessor = new ClientHeartbeatProcessor();\n    super.registerProcessor(MessageType.TYPE_HEARTBEAT_MSG, clientHeartbeatProcessor,\n            null);\n  }\n}\n```\n\nProcessorMessageTypeTransactionMessageHandlerResourceManagerRpcRmSeata\n* **Rm** RmClientOnResponseProcessorSeata-ServerResponse\n* **Seata-Server** undologSeata-ServerClientProcessorSeata-ServerResponseTransactionMessageHandlerResourceManager\n\nTransactionMessageHandlerResourceManager\n\nSeataAutoDataSourceProxyCreatorRpc Interceptor"
        },
        {
          "id": "/seata-at-demo-in-mac",
          "metadata": {
            "permalink": "/blog/seata-at-demo-in-mac",
            "source": "@site/blog/seata-at-demo-in-mac.md",
            "title": "MacSeata DemoAT",
            "description": "",
            "date": "2020-07-20T00:00:00.000Z",
            "formattedDate": "July 20, 2020",
            "tags": [],
            "readingTime": 8.785,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "portman xu"
              }
            ],
            "frontMatter": {
              "title": "MacSeata DemoAT",
              "author": "portman xu",
              "date": "2020/07/20",
              "keywords": [
                "seata",
                "",
                "demo",
                "mac",
                "at"
              ]
            },
            "prevItem": {
              "title": "Seata-Client",
              "permalink": "/blog/seata-sourcecode-client-bootstrap"
            },
            "nextItem": {
              "title": "Seata RPC ",
              "permalink": "/blog/seata-rpc-refactor"
            }
          },
          "content": "## \n\nSeata\n\n## Seata\n\n### cloc\n\nseatacloc2020-07-20\n\n![cloc-seata](https://github.com/iportman/p/blob/master/blog/seata-at-demo-in-mac/cloc-seata.png?raw=true)\n\nJava 97K\n\n### \n\n50%\n\n![cloc-seata](https://github.com/iportman/p/blob/master/blog/seata-at-demo-in-mac/coverage.png?raw=true)\n\n### Demo\n\nDemoseata-samplesseata-samples-dubbo\n\nhttps://github.com/seata/seata-samples/tree/master/dubbo\n\n## \n\nATDemo\n\n- \n  \n1. \n2. \n3. \n\n- 3\n- 3\n- \n\n\n\n![](http://seata.io/img/architecture.png)\n\n## \n\nAT\n\nundo_log\n\n\n\n## Demo\n\ngithubclone\n\n```sh\ngit clone git@github.com:seata/seata-samples.git\n```\n\nDemo\n\n```sh\n$ cd seata-samples/dubbo/\n$ tree -C  -I 'target' .\n.\n README.md\n pom.xml\n seata-samples-dubbo.iml\n src\n     main\n         java\n            io\n                seata\n                    samples\n                        dubbo\n                            ApplicationKeeper.java\n                            Order.java\n                            service\n                               AccountService.java\n                               BusinessService.java\n                               OrderService.java\n                               StorageService.java\n                               impl\n                                   AccountServiceImpl.java\n                                   BusinessServiceImpl.java\n                                   OrderServiceImpl.java\n                                   StorageServiceImpl.java\n                            starter\n                                DubboAccountServiceStarter.java\n                                DubboBusinessTester.java\n                                DubboOrderServiceStarter.java\n                                DubboStorageServiceStarter.java\n         resources\n             file.conf\n             jdbc.properties\n             log4j.properties\n             registry.conf\n             spring\n                dubbo-account-service.xml\n                dubbo-business.xml\n                dubbo-order-service.xml\n                dubbo-storage-service.xml\n             sql\n                 dubbo_biz.sql\n                 undo_log.sql\n\n13 directories, 27 files\n```\n\n- io.seata.samples.dubbo.starter4\\*Starter4\n  - Account\n  - Business\n  - Order\n  - Storage\n\n- 4dubboseata-samples/dubbo/src/main/resources/spring\n- demo4Business\n- io.seata.samples.dubbo.service44\n- src/main/resources/jdbc.properties\n\n### \n\n![cloc-seata](https://github.com/iportman/p/blob/master/blog/seata-at-demo-in-mac/timing-diagram.png?raw=true)\n\nOk, , Make It Happen!\n\n## Demo\n\n### MySQL\n\n### \n\nseata-samples/dubbo/src/main/resources/sqldubbo_biz.sqlundo_log.sql\n\n```sh\nmysql> show tables;\n+-----------------+\n| Tables_in_seata |\n+-----------------+\n| account_tbl     |\n| order_tbl       |\n| storage_tbl     |\n| undo_log        |\n+-----------------+\n4 rows in set (0.01 sec)\n```\n\n4\n\nseata-samples/dubbo/src/main/resources/jdbc.properties\n\nMySQL\n\n```properties\njdbc.account.url=jdbc:mysql://localhost:3306/seata\njdbc.account.username=your_username\njdbc.account.password=your_password\njdbc.account.driver=com.mysql.jdbc.Driver\n# storage db config\njdbc.storage.url=jdbc:mysql://localhost:3306/seata\njdbc.storage.username=your_username\njdbc.storage.password=your_password\njdbc.storage.driver=com.mysql.jdbc.Driver\n# order db config\njdbc.order.url=jdbc:mysql://localhost:3306/seata\njdbc.order.username=your_username\njdbc.order.password=your_password\njdbc.order.driver=com.mysql.jdbc.Driver\n```\n\n### ZooKeeper\n\nZooKeeperMacHomebrew\n\n```sh\n$ brew services start zookeeper \n==> Successfully started `zookeeper` (label: homebrew.m\n\n$ brew services list           \nName              Status  User    Plist\ndocker-machine    stopped         \nelasticsearch     stopped         \nkafka             stopped         \nkibana            stopped         \nmysql             started portman /Users/portman/Librar\ny/LaunchAgents/homebrew.mxcl.mysql.plist\nnginx             stopped         \npostgresql        stopped         \nredis             stopped         \nzookeeper         started portman /Users/portman/Librar\ny/LaunchAgents/homebrew.mxcl.zookeeper.plist\n```\n\n### TC\n\n[](https://github.com/seata/seata/releases)seata-server1.2.0\n\n1. \n2. seata\n3. \n\n```sh\n$ tar -zxvf seata-server-1.2.0.tar.gz\n$ cd seata\n$ bin/seata-server.sh\n```\n\nServer started\n\n```sh\n2020-07-23 13:45:13.810 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started ...\n```\n\n### IDE\n\n1. seata-samplesIDEIntelliJ IDEA\n2. Maven\n3. AccountOrderStorage3Business\n\n```java\nio.seata.samples.dubbo.starter.DubboStorageServiceStarter\nio.seata.samples.dubbo.starter.DubboOrderServiceStarter\nio.seata.samples.dubbo.starter.DubboStorageServiceStarter\n```\n\n\n\n```sh\nApplication is keep running ...\n```\n\n![cloc-seata](https://github.com/iportman/p/blob/master/blog/seata-at-demo-in-mac/service-boot.png?raw=true)\n\naccount_tblstorage_tbl\n\n```sh\nmysql> SELECT * FROM account_tbl; SELECT * FROM storage_tbl;\n+----+---------+-------+\n| id | user_id | money |\n+----+---------+-------+\n|  1 | U100001 |   999 |\n+----+---------+-------+\n1 row in set (0.00 sec)\n\n+----+----------------+-------+\n| id | commodity_code | count |\n+----+----------------+-------+\n|  1 | C00321         |   100 |\n+----+----------------+-------+\n1 row in set (0.00 sec)\n```\n\n### Business\n\n#### \n\nIDEDubboBusinessTester\n\n\n\nMySQL\n\n```sh\nmysql> SELECT * FROM account_tbl; SELECT * FROM order_tbl; SELECT * FROM storage_tbl;\n+----+---------+-------+\n| id | user_id | money |\n+----+---------+-------+\n|  1 | U100001 |   599 |\n+----+---------+-------+\n1 row in set (0.00 sec)\n\n+----+---------+----------------+-------+-------+\n| id | user_id | commodity_code | count | money |\n+----+---------+----------------+-------+-------+\n|  1 | U100001 | C00321         |     2 |   400 |\n+----+---------+----------------+-------+-------+\n1 row in set (0.00 sec)\n\n+----+----------------+-------+\n| id | commodity_code | count |\n+----+----------------+-------+\n|  1 | C00321         |    98 |\n+----+----------------+-------+\n1 row in set (0.00 sec)\n```\n\n340012\n\n\n\n#### \n\n\n\n\n\nBusinessServiceImplDubboBusinessTester\n\n```java\n\t\t@Override\n    @GlobalTransactional(timeoutMills = 300000, name = \"dubbo-demo-tx\")\n    public void purchase(String userId, String commodityCode, int orderCount) {\n        LOGGER.info(\"purchase begin ... xid: \" + RootContext.getXID());\n        storageService.deduct(commodityCode, orderCount);\n        orderService.create(userId, commodityCode, orderCount);\n      \n        //\n        throw new RuntimeException(\"portman's foooooobar error.\");\n\n    }\n```\n\nDubboBusinessTester\n\n```java\nException in thread \"main\" java.lang.RuntimeException: portman's foooooobar error.\n```\n\nMySQL\n\n## \n\nseatademo\n\n\n\n- \n- undo_log\n\n## \n\n- [Seata ?](http://seata.io/zh-cn/docs/overview/what-is-seata.html)\n- [](http://seata.io/zh-cn/docs/user/quickstart.html)\n\n## \n\n\n\n[Github](https://github.com/iportman)"
        },
        {
          "id": "/seata-rpc-refactor",
          "metadata": {
            "permalink": "/blog/seata-rpc-refactor",
            "source": "@site/blog/seata-rpc-refactor.md",
            "title": "Seata RPC ",
            "description": "RPC  Seata  Seata  RPC  RPC  ",
            "date": "2020-07-13T00:00:00.000Z",
            "formattedDate": "July 13, 2020",
            "tags": [],
            "readingTime": 11.35,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata RPC ",
              "author": "",
              "keywords": [
                "SeataRPC"
              ],
              "date": "2020/07/13"
            },
            "prevItem": {
              "title": "MacSeata DemoAT",
              "permalink": "/blog/seata-at-demo-in-mac"
            },
            "nextItem": {
              "title": "Seata-Server",
              "permalink": "/blog/seata-sourcecode-server-bootstrap"
            }
          },
          "content": "RPC  Seata  Seata  RPC  RPC  **\nRPC **  RPC \n\n Seata  RPC RPC  Seata Seata  RPC \n\n RPC  Seata \n\n# \n\n Seata RPC \n\n1.  Remoting  Netty Handler Remoting  Netty Handler \n2.  Reomting \n3. RemotingClient  RpcClientBootstrap  RemotingServer  RpcServer  ServerBootstrap\n4.  ClientMessageSenderClientMessageListenerServerMessageSender \n\n\n\n1.  Netty Handler  Remoting \n2.  RemotingClient  AbstractNettyRemotingClient\n   RmNettyRemotingClientTmNettyRemotingClient RemotingServer  NettyRemotingServer\n3.  ClientMessageSenderClientMessageListenerServerMessageSender  RemotingClientRemotingServer  Reomting\n    RemotingClientRemotingServer Remoting \n4.  RemotingBootstrap  NettyClientBootstrapNettyServerBootstrap Reomting \n\n RPC \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200711111637.png)\n\n1. AbstractNettyRemotingRemoting Processor \n2. RemotingClient\n3. RemotingServer\n4. AbstractNettyRemotingClient AbstractNettyRemoting  RemotingClient \n5. NettyRemotingServer AbstractNettyRemoting  RemotingServer \n6. RmNettyRemotingClientRm  AbstractNettyRemotingClient \n7. TmNettyRemotingClientTm  AbstractNettyRemotingClient \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200510225359.png)\n\n1. RemotingBootstrap start  stop \n2. NettyClientBootstrap\n3. NettyServerBootstrap\n\n# \n\n RPC  Netty Handler  Processor\n\n1. Netty Handler  \n2.  Seata \n3. \n4.  Seata \n\n Netty Handler  Seata \n\n- RM \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/Xnip2020-05-12_21-41-45.png)\n\n- TM \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/Xnip2020-05-12_21-44-04.png)\n\n-  RM \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200513000620.png)\n\n Seata \n\n\n\n1\n\n1. BranchCommitRequestBranchRollbackRequestUndoLogDeleteRequest\n\n2\n\n1. RegisterRMResponseBranchRegisterResponseBranchReportResponseGlobalLockQueryResponse\n2.\nRegisterTMResponseGlobalBeginResponseGlobalCommitResponseGlobalRollbackResponseGlobalStatusResponseGlobalReportResponse\n3. HeartbeatMessage(PONG)\n\n\n\n1\n\n1. RegisterRMRequestBranchRegisterRequestBranchReportRequestGlobalLockQueryRequest\n2.\nRegisterTMRequestGlobalBeginRequestGlobalCommitRequestGlobalRollbackRequestGlobalStatusRequestGlobalReportRequest\n3. HeartbeatMessage(PING)\n\n2\n\n1. BranchCommitResponseBranchRollbackResponse\n\n Processor Processor  Seata  ProcessorTable\n Processor \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/Xnip2020-05-12_22-09-17.png)\n\n Remoting  processMessage  ProcessorTable  Processor\n\n Netty Handler Handler#channelRead  processMessage  Processor \nProcessorTable \n\n Processor \n\n1\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200510234047.png)\n\n1. RmBranchCommitProcessor\n2. RmBranchRollbackProcessor\n3. RmUndoLogProcessor undo log \n4. ClientOnResponseProcessorBranchRegisterResponseGlobalBeginResponseGlobalCommitResponse \n5. ClientHeartbeatProcessor\n\n2\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200510234016.png)\n\n1. RegRmProcessor RM \n2. RegTmProcessor TM \n3. ServerOnRequestProcessorBranchRegisterRequestGlobalBeginRequestGlobalLockQueryRequest \n4. ServerOnResponseProcessorBranchCommitResponseBranchRollbackResponse \n5. ServerHeartbeatProcessor\n\n TM  Processor \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200514191842.png)\n\n# \n\n Seata RPC \n\n1. \n2. sendAsyncRequest  address  null  timeout  0\n    MessageFuture  futures \n3.  sendMsgWithResponse sendSyncRequest\n\n RPC \n\n1.  RemotingClientRemotingServer \n2.  address  null \n3.  Seata\n   ////\n   timeout  0 \n4. \n\nSeata RPC \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200513103838.png)\n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200513103904.png)\n\n# \n\n1. RPC  netty  Seata  RPC  netty netty  netty RPC\n   \n2.  netty  netty\n\n RPC \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20200711213204.png)\n\n# \n\n[https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub\nIDobjcoding"
        },
        {
          "id": "/seata-sourcecode-server-bootstrap",
          "metadata": {
            "permalink": "/blog/seata-sourcecode-server-bootstrap",
            "source": "@site/blog/seata-sourcecode-server-bootstrap.md",
            "title": "Seata-Server",
            "description": "SeataServer",
            "date": "2020-07-02T00:00:00.000Z",
            "formattedDate": "July 2, 2020",
            "tags": [],
            "readingTime": 18.62,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "|"
              }
            ],
            "frontMatter": {
              "title": "Seata-Server",
              "author": "|",
              "date": "2020/07/02",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "Seata RPC ",
              "permalink": "/blog/seata-rpc-refactor"
            },
            "nextItem": {
              "title": " Seata  XA ",
              "permalink": "/blog/seata-xa-introduce"
            }
          },
          "content": "## SeataServer\n\n### \n1. \n2. \n3. rpc\n4. \n5. XAseataATTCCSaga\n\nseata-serverseata-server\n\n![](https://img-blog.csdnimg.cn/20200726213919467.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTE0NTg0OA==,size_16,color_FFFFFF,t_70)\n\n\n#### 1. Server\nseata-serverServer\n```java\npublic static void main(String[] args) throws IOException {\n    // 8091\n    int port = PortHelper.getPort(args);\n    \n    // SystemPropertyLogbackLoggerContextListener\n    // SystemPropertyLoggerContextListenerPortLogbackContext\n    // logback.xmlPort\n    System.setProperty(ConfigurationKeys.SERVER_PORT, Integer.toString(port));\n\n    // Logger\n    final Logger logger = LoggerFactory.getLogger(Server.class);\n    if (ContainerHelper.isRunningInContainer()) {\n        logger.info(\"The server is running in container.\");\n    }\n\n    // \n    ParameterParser parameterParser = new ParameterParser(args);\n\n    // metricsSPIRegistry\n    MetricsManager.get().init();\n    \n\t// storeModeSystemProperty\n    System.setProperty(ConfigurationKeys.STORE_MODE, parameterParser.getStoreMode());\n    \n\t// NettyRemotingServerNettyRemotingServerNettyRpc\n\t// NettyRemotingServerSDKTMRM\n     nettyRemotingServer = new NettyRemotingServer(WORKING_THREADS);\n    \n    // \n    nettyRemotingServer.setListenPort(parameterParser.getPort());\n    \n\t// UUIDGeneratorUUIDGenerator\n\t// id\n\t// ServerServerNodeid\n    UUIDGenerator.init(parameterParser.getServerNode());\n    \n\t// SessionHodler\n\t// filedbredisdbredis\n    SessionHolder.init(parameterParser.getStoreMode());\n    \n  \t// DefaultCoordinatorDefaultCoordinatorTC\n  \t// ATTCCSAGA\n    DefaultCoordinator coordinator = new DefaultCoordinator(nettyRemotingServer);\n    coordinator.init();\n    nettyRemotingServer.setHandler(coordinator);\n    // register ShutdownHook\n    ShutdownHook.getInstance().addDisposable(coordinator);\n    ShutdownHook.getInstance().addDisposable(nettyRemotingServer);\n\n    // 127.0.0.1 and 0.0.0.0 are not valid here.\n    if (NetUtil.isValidIp(parameterParser.getHost(), false)) {\n        XID.setIpAddress(parameterParser.getHost());\n    } else {\n        XID.setIpAddress(NetUtil.getLocalIp());\n    }\n    XID.setPort(nettyRemotingServer.getListenPort());\n\n    try {\n        // Netty\n        nettyRemotingServer.init();\n    } catch (Throwable e) {\n        logger.error(\"nettyServer init error:{}\", e.getMessage(), e);\n        System.exit(-1);\n    }\n\n    System.exit(0);\n}\n```\n\n#### 2. \nParameterParserinit\n```java \nprivate void init(String[] args) {\n   try {\n   \t   // \n       if (ContainerHelper.isRunningInContainer()) {\n           this.seataEnv = ContainerHelper.getEnv();\n           this.host = ContainerHelper.getHost();\n           this.port = ContainerHelper.getPort();\n           this.serverNode = ContainerHelper.getServerNode();\n           this.storeMode = ContainerHelper.getStoreMode();\n       } else {\n           // JCommander\n           // JCommander\n           JCommander jCommander = JCommander.newBuilder().addObject(this).build();\n           jCommander.parse(args);\n           if (help) {\n               jCommander.setProgramName(PROGRAM_NAME);\n               jCommander.usage();\n               System.exit(0);\n           }\n       }\n       // serverNode\n       // I\n       if (this.serverNode == null) {\n           this.serverNode = IdWorker.initWorkerId();\n       }\n       if (StringUtils.isNotBlank(seataEnv)) {\n           System.setProperty(ENV_PROPERTY_KEY, seataEnv);\n       }\n       if (StringUtils.isBlank(storeMode)) {\n           // ConfigurationParameterParseripportstoreMode\n           // ConfigurationstoreMode\n           // Configuration\n           storeMode = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.STORE_MODE,\n               SERVER_DEFAULT_STORE_MODE);\n       }\n   } catch (ParameterException e) {\n       printError(e);\n   }\n\n}\n```\n\nParameterParserinitConfigurationFactory.getInstance()ConfigurationConfigurationSeata Serverfile.confregistry.conf\n\nConfigurationFactory.getInstancebuildConfigurationbuidlConfigurationConfigurationFactorystatic\n```java\n// Configuration\npublic static Configuration getInstance() {\n    if (instance == null) {\n        synchronized (Configuration.class) {\n            if (instance == null) {\n                instance = buildConfiguration();\n            }\n        }\n    }\n    return instance;\n}\n\n// ConfigurationFactorystatic\nstatic {\n    // registry.conf\n    String seataConfigName = System.getProperty(SYSTEM_PROPERTY_SEATA_CONFIG_NAME);\n    if (seataConfigName == null) {\n        seataConfigName = System.getenv(ENV_SEATA_CONFIG_NAME);\n    }\n    if (seataConfigName == null) {\n        seataConfigName = REGISTRY_CONF_PREFIX;\n    }\n    String envValue = System.getProperty(ENV_PROPERTY_KEY);\n    if (envValue == null) {\n        envValue = System.getenv(ENV_SYSTEM_KEY);\n    }\n    \n    // registry.confConfiguration\n    Configuration configuration = (envValue == null) ? new FileConfiguration(seataConfigName + REGISTRY_CONF_SUFFIX,\n        false) : new FileConfiguration(seataConfigName + \"-\" + envValue + REGISTRY_CONF_SUFFIX, false);\n    Configuration extConfiguration = null;\n    try {\n        // ExtConfigurationProviderSpringBootConfigurationProvider\n        // SDK SpringBootServer\n        extConfiguration = EnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n        if (LOGGER.isInfoEnabled()) {\n            LOGGER.info(\"load Configuration:{}\", extConfiguration == null ? configuration.getClass().getSimpleName()\n                : extConfiguration.getClass().getSimpleName());\n        }\n    } catch (EnhancedServiceNotFoundException ignore) {\n\n    } catch (Exception e) {\n        LOGGER.error(\"failed to load extConfiguration:{}\", e.getMessage(), e);\n    }\n    CURRENT_FILE_INSTANCE = extConfiguration == null ? configuration : extConfiguration;\n}\n```\n\nConfigurationFactorystaticregistry.confregistry.conf************file.confapolloregistry.confregistry.conffilezkapollonacosetcd3file.conffilefile.conf\n\nConfigurationFactorybuildConfigurationregistry.conf\n\n```java\nprivate static Configuration buildConfiguration() {\n    ConfigType configType;\n    String configTypeName;\n    try {\n    \t// registry.confconfig.typeConfigType\n        configTypeName = CURRENT_FILE_INSTANCE.getConfig(\n            ConfigurationKeys.FILE_ROOT_CONFIG + ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR\n                + ConfigurationKeys.FILE_ROOT_TYPE);\n\n        if (StringUtils.isBlank(configTypeName)) {\n            throw new NotSupportYetException(\"config type can not be null\");\n        }\n\n        configType = ConfigType.getType(configTypeName);\n    } catch (Exception e) {\n        throw e;\n    }\n    Configuration extConfiguration = null;\n    Configuration configuration;\n    if (ConfigType.File == configType) {\n    \t// fileregistry.confconfig.file.name\n    \t// filefile.conf\n        String pathDataId = String.join(ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR,\n            ConfigurationKeys.FILE_ROOT_CONFIG, FILE_TYPE, NAME_KEY);\n        String name = CURRENT_FILE_INSTANCE.getConfig(pathDataId);\n        \n        // fileFileConfuguration\n        configuration = new FileConfiguration(name);\n        try {\n        \t// configurationSpringBootSDK\n            extConfiguration = EnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n            if (LOGGER.isInfoEnabled()) {\n                LOGGER.info(\"load Configuration:{}\", extConfiguration == null\n                    ? configuration.getClass().getSimpleName() : extConfiguration.getClass().getSimpleName());\n            }\n        } catch (EnhancedServiceNotFoundException ignore) {\n\n        } catch (Exception e) {\n            LOGGER.error(\"failed to load extConfiguration:{}\", e.getMessage(), e);\n        }\n    } else {\n    \t// filenacoszk\n    \t// SPIConfigurationProvider\n        configuration = EnhancedServiceLoader\n            .load(ConfigurationProvider.class, Objects.requireNonNull(configType).name()).provide();\n    }\n    try {\n    \t// ConfigurationCacheConfiguration\n        Configuration configurationCache;\n        if (null != extConfiguration) {\n            configurationCache = ConfigurationCache.getInstance().proxy(extConfiguration);\n        } else {\n            configurationCache = ConfigurationCache.getInstance().proxy(configuration);\n        }\n        if (null != configurationCache) {\n            extConfiguration = configurationCache;\n        }\n    } catch (EnhancedServiceNotFoundException ignore) {\n\n    } catch (Exception e) {\n        LOGGER.error(\"failed to load configurationCacheProvider:{}\", e.getMessage(), e);\n    }\n    return null == extConfiguration ? configuration : extConfiguration;\n}\n```\n\n#### 3. UUIDGenerator\nUUIDGenertorserverNodeUUIDGenertorIdserverNodeseata-serverid\n```java\npublic class UUIDGenerator {\n\n    /**\n     * Generate uuid long.\n     *\n     * @return the long\n     */\n    public static long generateUUID() {\n        return IdWorker.getInstance().nextId();\n    }\n\n    /**\n     * Init.\n     *\n     * @param serverNode the server node id\n     */\n    public static void init(Long serverNode) {\n        IdWorker.init(serverNode);\n    }\n}\n```\n\nUUIDGeneratorIdWorkeridIdWokerIdWorkerIdWorker\n```java\npublic class IdWorker\n/**\n     * Constructor\n     *\n     * @param workerIdServerNode, 0102364UUID10\n     */\n    public IdWorker(long workerId) {\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(\n                String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId));\n        }\n        this.workerId = workerId;\n    }\n\n    /**\n     * Get the next ID (the method is thread-safe)\n     *\n     * @return SnowflakeId\n     */\n    public long nextId() {\n        long timestamp = timeGen();\n\n        if (timestamp < lastTimestamp) {\n            throw new RuntimeException(String.format(\n                \"clock moved backwards.  Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp));\n        }\n\n        synchronized (this) {\n            if (lastTimestamp == timestamp) {\n                sequence = (sequence + 1) & sequenceMask;\n                if (sequence == 0) {\n                    timestamp = tilNextMillis(lastTimestamp);\n                }\n            } else {\n                sequence = 0L;\n            }\n            lastTimestamp = timestamp;\n        }\n        //64id0 + 41 + 10workerId + 12\n        return ((timestamp - twepoch) << timestampLeftShift) | (workerId << workerIdShift) | sequence;\n    }\n```\n\n#### 4. SessionHolder\nSessionHolderSessionSessionGlobalSessionBranchSession\nSessionHolderfiledbdbdbSessionHolder\n```java\n// ROOT_SESSION_MANAGERSetssionSession\nprivate static SessionManager ROOT_SESSION_MANAGER;\n// commitSession\nprivate static SessionManager ASYNC_COMMITTING_SESSION_MANAGER;\n// commitSession\nprivate static SessionManager RETRY_COMMITTING_SESSION_MANAGER;\n// rollbackSession\nprivate static SessionManager RETRY_ROLLBACKING_SESSION_MANAGER;\n```\n\nSessionHolderinit\n```java\npublic static void init(String mode) throws IOException {\n    if (StringUtils.isBlank(mode)) {\n        mode = CONFIG.getConfig(ConfigurationKeys.STORE_MODE);\n    }\n    StoreMode storeMode = StoreMode.get(mode);\n    if (StoreMode.DB.equals(storeMode)) {\n        // SPISessionManager\n        // SessionManagerDataBaseSessionManager\n        // DataBaseSessionManager\n        ROOT_SESSION_MANAGER = EnhancedServiceLoader.load(SessionManager.class, StoreMode.DB.getName());\n        ASYNC_COMMITTING_SESSION_MANAGER = EnhancedServiceLoader.load(SessionManager.class, StoreMode.DB.getName(),\n            new Object[] {ASYNC_COMMITTING_SESSION_MANAGER_NAME});\n        RETRY_COMMITTING_SESSION_MANAGER = EnhancedServiceLoader.load(SessionManager.class, StoreMode.DB.getName(),\n            new Object[] {RETRY_COMMITTING_SESSION_MANAGER_NAME});\n        RETRY_ROLLBACKING_SESSION_MANAGER = EnhancedServiceLoader.load(SessionManager.class, StoreMode.DB.getName(),\n            new Object[] {RETRY_ROLLBACKING_SESSION_MANAGER_NAME});\n    } else if (StoreMode.FILE.equals(storeMode)) {\n        //file\n        ...\n    } else {\n        throw new IllegalArgumentException(\"unknown store mode:\" + mode);\n    }\n    // reloaddb\n    reload();\n}\n```\n\nSessionHolderSessionManagerDataBaseSessionManagerDataBaseSessionManager\n```java\npublic DataBaseSessionManager(String name) {\n\tsuper();\n\tthis.taskName = name;\n}\n\n// taskNameallSessions\n// taskNameASYNC_COMMITTING_SESSION_MANAGER_NAME\n// AsyncCommitting\npublic Collection<GlobalSession> allSessions() {\n\t// get by taskName\n\tif (SessionHolder.ASYNC_COMMITTING_SESSION_MANAGER_NAME.equalsIgnoreCase(taskName)) {\n\t\t\treturn findGlobalSessions(new SessionCondition(GlobalStatus.AsyncCommitting));\n\t} else if (SessionHolder.RETRY_COMMITTING_SESSION_MANAGER_NAME.equalsIgnoreCase(taskName)) {\n\t\t\treturn findGlobalSessions(new SessionCondition(new GlobalStatus[] {GlobalStatus.CommitRetrying}));\n\t} else if (SessionHolder.RETRY_ROLLBACKING_SESSION_MANAGER_NAME.equalsIgnoreCase(taskName)) {\n\t\t\treturn findGlobalSessions(new SessionCondition(new GlobalStatus[] {GlobalStatus.RollbackRetrying,\n\t\t\t\t\tGlobalStatus.Rollbacking, GlobalStatus.TimeoutRollbacking, GlobalStatus.TimeoutRollbackRetrying}));\n\t} else {\n\t\t// taskNamenullROOT_SESSION_MANAGER\n\t\treturn findGlobalSessions(new SessionCondition(new GlobalStatus[] {\n\t\t\t\tGlobalStatus.UnKnown, GlobalStatus.Begin,\n\t\t\t\tGlobalStatus.Committing, GlobalStatus.CommitRetrying, GlobalStatus.Rollbacking,\n\t\t\t\tGlobalStatus.RollbackRetrying,\n\t\t\t\tGlobalStatus.TimeoutRollbacking, \n\t\t\t\tGlobalStatus.TimeoutRollbackRetrying,\n\t\t\t\tGlobalStatus.AsyncCommitting}));\n\t}\n}\n```\n\n#### 5. DefaultCoordinator\nDefaultCoordinatorDefaultCoordinatorDefaultCoordinatoRpcServerTMRM\n```java\npublic DefaultCoordinator(ServerMessageSender messageSender) {\n\t// messageSenderRpcServer\n\tthis.messageSender = messageSender;\n\t\n\t// DefaultCoreATTCCSaga\n\tthis.core = new DefaultCore(messageSender);\n}\n\n// init5\n// \n// \n// undoLogDelete1\npublic void init() {\n    // \n\tretryRollbacking.scheduleAtFixedRate(() -> {\n\t\ttry {\n\t\t\thandleRetryRollbacking();\n\t\t} catch (Exception e) {\n\t\t\tLOGGER.info(\"Exception retry rollbacking ... \", e);\n\t\t}\n\t}, 0, ROLLBACKING_RETRY_PERIOD, TimeUnit.MILLISECONDS);\n\t\t\n    // \n\tretryCommitting.scheduleAtFixedRate(() -> {\n\t\ttry {\n\t\t\thandleRetryCommitting();\n\t\t} catch (Exception e) {\n\t\t\tLOGGER.info(\"Exception retry committing ... \", e);\n\t\t}\n\t}, 0, COMMITTING_RETRY_PERIOD, TimeUnit.MILLISECONDS);\n\n    // \n\tasyncCommitting.scheduleAtFixedRate(() -> {\n\t\ttry {\n\t\t\thandleAsyncCommitting();\n\t\t} catch (Exception e) {\n\t\t\tLOGGER.info(\"Exception async committing ... \", e);\n\t\t}\n\t}, 0, ASYNC_COMMITTING_RETRY_PERIOD, TimeUnit.MILLISECONDS);\n    \n\t// TimeoutRollbacking\n\t// \n\ttimeoutCheck.scheduleAtFixedRate(() -> {\n\t\ttry {\n\t\t\ttimeoutCheck();\n\t\t} catch (Exception e) {\n\t\t\tLOGGER.info(\"Exception timeout checking ... \", e);\n\t\t}\n\t}, 0, TIMEOUT_RETRY_PERIOD, TimeUnit.MILLISECONDS);\n    \n\t// unlogRMunlog\n\tundoLogDelete.scheduleAtFixedRate(() -> {\n\t\ttry {\n\t\t\tundoLogDelete();\n\t\t} catch (Exception e) {\n\t\t\tLOGGER.info(\"Exception undoLog deleting ... \", e);\n\t\t}\n\t}, UNDO_LOG_DELAY_DELETE_PERIOD, UNDO_LOG_DELETE_PERIOD, TimeUnit.MILLISECONDS);\n}\n```\n\n#### 6. NettyRemotingServer\nNettyRemotingServerNettyRpcNettyRemotingServer\n1. **registerProcessor**ClientProcessor\n2. **super.init()**super.init()NettyIP\n\n```java\npublic void init() {\n    // registry processor\n    registerProcessor();\n    if (initialized.compareAndSet(false, true)) {\n        super.init();\n    }\n}\n\nprivate void registerProcessor() {\n\t// 1. ServerOnRequestProcessorProcessor\n\t// \n\t// ServerOnRequestProcessorgetHandler()handler\n\t// DefaultCoordinatorDefaultCoordinator\n\tServerOnRequestProcessor onRequestProcessor =\n\t    new ServerOnRequestProcessor(this, getHandler());\n\tsuper.registerProcessor(MessageType.TYPE_BRANCH_REGISTER, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_BRANCH_STATUS_REPORT, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_BEGIN, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_COMMIT, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_LOCK_QUERY, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_REPORT, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_ROLLBACK, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_GLOBAL_STATUS, onRequestProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_SEATA_MERGE, onRequestProcessor, messageExecutor);\n\t\n\t// 2.ResponseProcessorResponseProcessorServer\n\t// ClientResponseServerClient\n\t// Client/\n\tServerOnResponseProcessor onResponseProcessor =\n\t    new ServerOnResponseProcessor(getHandler(), getFutures());\n\tsuper.registerProcessor(MessageType.TYPE_BRANCH_COMMIT_RESULT, onResponseProcessor, messageExecutor);\n\tsuper.registerProcessor(MessageType.TYPE_BRANCH_ROLLBACK_RESULT, onResponseProcessor, messageExecutor);\n\t\n\t// 3. ClientRMProcessor\n\tRegRmProcessor regRmProcessor = new RegRmProcessor(this);\n\tsuper.registerProcessor(MessageType.TYPE_REG_RM, regRmProcessor, messageExecutor);\n\t\n\t// 4. ClientTMProcessor\n\tRegTmProcessor regTmProcessor = new RegTmProcessor(this);\n\tsuper.registerProcessor(MessageType.TYPE_REG_CLT, regTmProcessor, null);\n\t\n\t// 5. ClientProcessor\n\tServerHeartbeatProcessor heartbeatMessageProcessor = new ServerHeartbeatProcessor(this);\n\tsuper.registerProcessor(MessageType.TYPE_HEARTBEAT_MSG, heartbeatMessageProcessor, null);\n}\n```\n\nNettyRemotingServerAbstractNettyRemotingServerinit\n```java\npublic void init() {\n\t// super.init()Rpc3S\n    super.init();\n\t// Netty Server\n    serverBootstrap.start();\n}\n\n// serverBootstrap.start();\npublic void start() {\n\t// Netty serverChannelHandler\n\t// ProtocolV1DecoderProtocolV1Encoder\n\t// SeataRPC\n    this.serverBootstrap.group(this.eventLoopGroupBoss, this.eventLoopGroupWorker)\n        .channel(NettyServerConfig.SERVER_CHANNEL_CLAZZ)\n        .option(ChannelOption.SO_BACKLOG, nettyServerConfig.getSoBackLogSize())\n        .option(ChannelOption.SO_REUSEADDR, true)\n        .childOption(ChannelOption.SO_KEEPALIVE, true)\n        .childOption(ChannelOption.TCP_NODELAY, true)\n        .childOption(ChannelOption.SO_SNDBUF, nettyServerConfig.getServerSocketSendBufSize())\n        .childOption(ChannelOption.SO_RCVBUF, nettyServerConfig.getServerSocketResvBufSize())\n        .childOption(ChannelOption.WRITE_BUFFER_WATER_MARK,\n            new WriteBufferWaterMark(nettyServerConfig.getWriteBufferLowWaterMark(),\n                nettyServerConfig.getWriteBufferHighWaterMark()))\n        .localAddress(new InetSocketAddress(listenPort))\n        .childHandler(new ChannelInitializer<SocketChannel>() {\n            @Override\n            public void initChannel(SocketChannel ch) {\n                ch.pipeline().addLast(new IdleStateHandler(nettyServerConfig.getChannelMaxReadIdleSeconds(), 0, 0))\n                    .addLast(new ProtocolV1Decoder())\n                    .addLast(new ProtocolV1Encoder());\n                if (channelHandlers != null) {\n                    addChannelPipelineLast(ch, channelHandlers);\n                }\n\n            }\n        });\n\n    try {\n\t\t// \n        ChannelFuture future = this.serverBootstrap.bind(listenPort).sync();\n        LOGGER.info(\"Server started, listen port: {}\", listenPort);\n\t\t// Nettyregistry.conf\n        RegistryFactory.getInstance().register(new InetSocketAddress(XID.getIpAddress(), XID.getPort()));\n        initialized.set(true);\n        future.channel().closeFuture().sync();\n    } catch (Exception exx) {\n        throw new RuntimeException(exx);\n    }\n}\n```"
        },
        {
          "id": "/seata-xa-introduce",
          "metadata": {
            "permalink": "/blog/seata-xa-introduce",
            "source": "@site/blog/seata-xa-introduce.md",
            "title": " Seata  XA ",
            "description": " Seata  XA ",
            "date": "2020-04-28T00:00:00.000Z",
            "formattedDate": "April 28, 2020",
            "tags": [],
            "readingTime": 20.815,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": " Seata  XA ",
              "keywords": [
                "Seata",
                "",
                "XA",
                "AT"
              ],
              "description": " Seata  XA ",
              "author": "",
              "date": "2020/04/28"
            },
            "prevItem": {
              "title": "Seata-Server",
              "permalink": "/blog/seata-sourcecode-server-bootstrap"
            },
            "nextItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-quick-start"
            }
          },
          "content": "GitHub IDsharajava GTS SEATA  Oracle  WebLogic \n\nSeata 1.2.0 XA  XA \n\n\n\n- WhatXA \n- Why XA\n- HowXA \n\n# 1. XA \n\n\n\n1.  XA\n2.  Seata  \n\n XA \n\n## 1.1  XA\n\nXA   X/Open DTPDistributed Transaction Processing\n\nXA   XA  ACID \n\nXA  2PCTwo-Phase Commit\n\nXA   90  XA  \n\n## 1.2  Seata \n\nSeata \n\n   \n\n1. TM  TC BeginCommitRollback\n2. TM  XID \n3. RM  TC  XID \n4. RM  TC\n5. TC Branch CommitBranch Rollback RM\n\n<img src=\"https://img.alicdn.com/tfs/TB19qmhOrY1gK0jSZTEXXXDQVXa-1330-924.png\" alt=\"seata-mod\" style={{ zoom:'50%' }} />\n\nSeata   \n\n-      *Rollbackable*  *Durable*\n-     TM  TCTC  RM    Commit  Rollback\n\nSeata    Seata    \n\n    \n\n-     *Rollbackable*  *Durable*\n-   TC \n\n Seata  AT  TCC \n\nAT \n\n<img src=\"https://img.alicdn.com/tfs/TB1NTuzOBr0gK0jSZFnXXbRRXXa-1330-924.png\" alt=\"at-mod\" style={{ zoom:'50%' }} />\n\n- \n\n- -  SQL \n  -  SQL \n\n- \n\n- - \n  - \n\nTCC \n\n<img src=\"https://img.alicdn.com/tfs/TB1m59pOEY1gK0jSZFCXXcwqXXa-1330-924.png\" alt=\"tcc-mod\" style={{ zoom:'50%' }} />\n\n- \n\n- -  Try  **  **\n\n- \n\n- -  Confirm \n  -  Cancel \n\n## 1.3  Seata  XA \n\nXA \n\n Seata  XA  XA  \n\n<img src=\"https://img.alicdn.com/tfs/TB1hSpccIVl614jSZKPXXaGjpXa-1330-924.png\" alt=\"xa-mod\" style={{ zoom:'50%' }} />\n\n- \n\n- -  SQL  XA  XA  **\n  - XA  XA prepare XA  **\n\n- \n\n- -  XA  commit\n  -  XA  rollback\n\n# 2.  XA\n\n Seata  XA  XA \n\n## 2.1 \n\nSeata  3 ATTCCSaga   \n\n    \n\n<img src=\"https://img.alicdn.com/tfs/TB1z.qyOET1gK0jSZFrXXcNCXXa-602-460.png\" alt=\"img\" style={{ zoom:'50%' }} />\n\n   \n\n   100  50 50 100 50   \n\n   \n\n## 2.2 XA \n\n  XA    \n\n<img src=\"https://img.alicdn.com/tfs/TB1vs9kOvb2gK0jSZK9XXaEgFXa-602-486.png\" alt=\"nct\" style={{ zoom:'50%' }} />\n\n   \n\nXA  50  **   \n\n   XA \n\n1.  AT XA \n2. XA \n3.  SQL XA  Seata  RM  SDK  AT  **\n4.  XA  XA  Seata  XA \n\n## 2.3 XA \n\n\n\nXA  90 \n\n AT TCC  Saga  XA \n\nXA \n\n1. ****\n\n> \n>\n> \n>\n>      \n>\n> AT  **  ** TC \n\n2. ****XA prepare  XA commit  XA rollback \n\n> \n>\n>    \n>\n>   \n>\n>  XA  Seata  XA \n>\n>       XA \n\n3. **** RT\n\n> \n>\n> \n>\n>     \n>\n>    AT \n>\n>  Seata XA \n>\n>  AT \n>\n> XA  AT \n>\n> AT  RM  \n\n# 3. XA \n\n## 3.1 XA \n\n### 3.1.1 \n\nXA \n\n1.     \n2.   AT \n3.   \n\n\n\n1.  AT    XA  \n2.  XA  XA  \n3.  XA  2PC    XA prepare XA  Seata  RPC \n\n### 3.1.2 \n\n#### 1. \n\nXA   Seata \n\n<img src=\"https://img.alicdn.com/tfs/TB1uM2OaSslXu8jSZFuXXXg7FXa-1330-958.png\" alt=\"xa-fw\" style={{ zoom:'50%' }} />\n\n- E xecute\n\n- - XA start/XA end/XA prepare + SQL + \n\n- F inish\n\n- - XA commit/XA rollback\n\n#### 2. \n\nXA  XAConnection\n\n XAConnection \n\n-  XADataSource\n-  DataSource \n\n XA  XA   XA \n\n AT  XA \n\n JDBC  XAConnection\n\n AT \n\n<img src=\"/img/xa/pics/ds1.png\" alt=\"img\" style={{ zoom:'50%' }} />\n\n\n\n\n\n Oracle  Druid issuehttps://github.com/alibaba/druid/issues/3707\n\nXA  XA \n\n AT \n\n<img src=\"/img/xa/pics/ds2.png\" alt=\"img\" style={{ zoom:'50%' }} />\n\n#### 3. \n\nXA start  Xid \n\n Xid  Seata  XID  BranchId  TC  XA \n\n Seata  BranchId  TC  XA  XA start \n\n\n\n AT \n\n BranchId BranchId  BranchId \n\n#### 4. \n\n XA \n\n **** \n\n\n\n### 3.1.3 \n\nXA \n\n1.  1 1.2.0 XA \n2.  2  5  AT \n3.  3  7 \n4.  4  8 \n5.  5  2020  Seata  Transaction Mesh \n\n## 3.2 XA \n\nXA  AT \n\n Seata seata-xa\n\n Seata  3 \n\n AT  XA  AT \n\n```\n    @Bean(\"dataSource\")\n    public DataSource dataSource(DruidDataSource druidDataSource) {\n        // DataSourceProxy for AT mode\n        // return new DataSourceProxy(druidDataSource);\n\n        // DataSourceProxyXA for XA mode\n        return new DataSourceProxyXA(druidDataSource);\n    }\n```\n\n# 4. \n\n\n\n\n\nSeata   \n\n Seata\n\n<img src=\"https://img.alicdn.com/tfs/TB1lTSoOqL7gK0jSZFBXXXZZpXa-1028-528.png\" alt=\"img\" style={{ zoom:'50%' }} />\n\nXA  Seata    ATTCCSagaXA   \n\n XA  Seata "
        },
        {
          "id": "/seata-quick-start",
          "metadata": {
            "permalink": "/blog/seata-quick-start",
            "source": "@site/blog/seata-quick-start.md",
            "title": "Seata ",
            "description": " 0  Seata Seata  Java ",
            "date": "2020-04-19T00:00:00.000Z",
            "formattedDate": "April 19, 2020",
            "tags": [],
            "readingTime": 13.355,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata ",
              "description": " 0  Seata Seata  Java ",
              "keywords": [
                "fescarseata"
              ],
              "author": "",
              "date": "2020/04/19"
            },
            "prevItem": {
              "title": " Seata  XA ",
              "permalink": "/blog/seata-xa-introduce"
            },
            "nextItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-ha-practice"
            }
          },
          "content": "- [1. ](#)\n- [2.  TC Server](#)\n- [3.  TC Server](#)\n- [4.  Java ](#)\n\n# 1. \n\n[Seata](https://github.com/seata/seata) ********\n\n## 1.1 \n\nSeata ****\n* AT [Seata AT ](https://seata.io/zh-cn/docs/dev/mode/at-mode.html)\n* TCC [Seata TCC ](https://seata.io/zh-cn/docs/dev/mode/tcc-mode.html)\n* Saga [SEATA Saga ](https://seata.io/zh-cn/docs/dev/mode/saga-mode.html)\n* XA ...\n\n****AT > TCC > Saga Seata  **AT **\n\n>  [Wanted: who's using Seata](https://github.com/seata/seata/issues/1246) \n\n## 1.2 \n\n Seata \n\n![](http://www.iocoder.cn/images/Seata/2017-01-01/02.png)\n\n* **TC** (Transaction Coordinator) - ****\n* **TM** (Transaction Manager) - ****\n* **RM** ( Resource Manager ) - ****( Resource ) TC ****\n\nTC  **Server** TM  RM  **Client** \n\n Seata ****\n\n![](http://www.iocoder.cn/images/Seata/2017-01-01/01.png)\n\n> \n\n* TM  TC TC  **XID** \n    > **XID**\n\n* RM  TC  **XID** \n* TM  TC  **XID** \n* TC  RM  **XID** \n\n## 1.3 \n\nSeata ****\n* Dubbo\n    >  [`seata-dubbo`](https://github.com/seata/seata/blob/develop/integration/dubbo/) \n\n* SOFA-RPC\n    >  [`seata-sofa-rpc`](https://github.com/seata/seata/blob/develop/integration/sofa-rpc/) \n\n* Motan\n    >  [`seata-motan`](https://github.com/seata/seata/blob/develop/integration/motan/) \n\n* gRPC\n    >  [`seata-grpc`](https://github.com/seata/seata/blob/develop/integration/gprc/) \n\n* Apache HttpClient\n    >  [`seata-http`](https://github.com/seata/seata/blob/develop/integration/http/) \n\n* Spring Cloud OpenFeign\n    >  [`spring-cloud-starter-alibaba-seata`](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/)  [`feign`](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/feign/) \n    \n* Spring RestTemplate   \n    >  [`spring-cloud-starter-alibaba-seata`](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/feign/SeataBeanPostProcessor.java)  [`rest`](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-starters/spring-cloud-starter-alibaba-seata/src/main/java/com/alibaba/cloud/seata/rest/) \n\n Java Seata  Starter \n* [`seata-spring-boot-starter`](https://mvnrepository.com/artifact/io.seata/seata-spring-boot-starter)\n* [`spring-cloud-starter-alibaba-seata`](https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-seata)\n\n Seata  [DataSource](https://docs.oracle.com/javase/7/docs/api/javax/sql/DataSource.html) **** ORM \n* MyBatisMyBatis-Plus\n* JPAHibernate\n\n## 1.4 \n\n [Wanted: who's using Seata](https://github.com/seata/seata/issues/1246) Seata \n                                                                                                               \n![](http://www.iocoder.cn/images/Seata/2017-01-01/03.png)\n\n [awesome-seata](https://github.com/seata/awesome-seata) ![awesome-seata ](http://www.iocoder.cn/images/Seata/2017-01-01/04.png)\n\nSeata \n\n# 2.  TC Server\n\n**** Seata **TC** Server\n\n TC ****TC ( `store.mode` )\n\n* file ******** `root.data`\n* db **** **db** \n\n file  TC Server ![ TC Server](http://www.iocoder.cn/images/Seata/2017-01-01/11.png)\n\n TC Server macOS  LinuxWindows \n\n## 2.1  Seata \n\n [Seata ](https://github.com/seata/seata/releases) Seata  [v1.1.0](https://github.com/seata/seata/releases/tag/v1.1.0) \n\n```Bash\n# \n$ mkdir -p /Users/yunai/Seata\n$ cd /Users/yunai/Seata\n\n# \n$ wget https://github.com/seata/seata/releases/download/v1.1.0/seata-server-1.1.0.tar.gz\n\n# \n$ tar -zxvf seata-server-1.1.0.tar.gz\n\n# \n$ cd seata\n$ ls -ls\n24 -rw-r--r--    1 yunai  staff  11365 May 13  2019 LICENSE\n 0 drwxr-xr-x    4 yunai  staff    128 Apr  2 07:46 bin # \n 0 drwxr-xr-x    9 yunai  staff    288 Feb 19 23:49 conf # \n 0 drwxr-xr-x  138 yunai  staff   4416 Apr  2 07:46 lib #  seata-*.jar +  \n```\n\n## 2.2  TC Server\n\n `nohup sh bin/seata-server.sh &`  TC Server  `nohup.out` \n\n```Java\n#  File \n2020-04-02 08:36:01.302 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load TransactionStoreManager[FILE] extension by class[io.seata.server.store.file.FileTransactionStoreManager]\n2020-04-02 08:36:01.302 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load SessionManager[FILE] extension by class[io.seata.server.session.file.FileBasedSessionManager]\n# \n2020-04-02 08:36:01.597 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started ...\n```\n* Seata TC Server  **8091** \n\n file  `root.data`\n\n```Bash\n$ ls -ls sessionStore/\ntotal 0\n0 -rw-r--r--  1 yunai  staff  0 Apr  2 08:36 root.data\n```\n\n[4.  Java ](#) Seata \n\n# 3.  TC Server\n\n**** Seata **TC** Server Seata TC Server  **db** \n\n Seata TC Server   TC Server ![ TC Server](http://www.iocoder.cn/images/Seata/2017-01-01/21.png)\n\nSeata TC Server  [discovery](https://github.com/seata/seata/tree/develop/discovery)  Nacos \n\n>  Nacos [Nacos ](http://www.iocoder.cn/Nacos/install/?self)\n\n TC Server macOS  LinuxWindows \n\n## 3.1  Seata \n\n [Seata ](https://github.com/seata/seata/releases) Seata  [v1.1.0](https://github.com/seata/seata/releases/tag/v1.1.0) \n\n```Bash\n# \n$ mkdir -p /Users/yunai/Seata\n$ cd /Users/yunai/Seata\n\n# \n$ wget https://github.com/seata/seata/releases/download/v1.1.0/seata-server-1.1.0.tar.gz\n\n# \n$ tar -zxvf seata-server-1.1.0.tar.gz\n\n# \n$ cd seata\n$ ls -ls\n24 -rw-r--r--    1 yunai  staff  11365 May 13  2019 LICENSE\n 0 drwxr-xr-x    4 yunai  staff    128 Apr  2 07:46 bin # \n 0 drwxr-xr-x    9 yunai  staff    288 Feb 19 23:49 conf # \n 0 drwxr-xr-x  138 yunai  staff   4416 Apr  2 07:46 lib #  seata-*.jar +  \n```\n\n## 3.2 \n\n  [`mysql.sql`](https://github.com/seata/seata/blob/develop/script/server/db/mysql.sql)  Seata TC Server  db \n\n```SQL\n-- -------------------------------- The script used when storeMode is 'db' --------------------------------\n-- the table to store GlobalSession data\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n\n-- the table to store BranchSession data\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n\n-- the table to store lock data\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(96),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_branch_id` (`branch_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n MySQL  `seata` ![`seata`  - MySQL 5.X](http://www.iocoder.cn/images/Seata/2017-01-01/22.png)\n\n  `conf/file`  db  Seata TC Server ![`conf/file` ](http://www.iocoder.cn/images/Seata/2017-01-01/23.png)\n\n MySQL8 \n\n>  MySQL  8.X \n\n MySQL 8.X JDBC \n\n```Bash\n$ cd lib\n$ wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.19/mysql-connector-java-8.0.19.jar\n```\n\n `conf/file`  MySQL 8.X JDBC ![`seata`  - MySQL 8.X](http://www.iocoder.cn/images/Seata/2017-01-01/24.png)\n\n## 3.3  Nacos \n\n `conf/registry.conf`  Nacos ![`conf/registry.conf` ](http://www.iocoder.cn/images/Seata/2017-01-01/25.png)\n\n## 3.4  TC Server\n\n  `nohup sh bin/seata-server.sh -p 18091 -n 1 &` **** TC Server \n* `-p`Seata TC Server \n* `-n`Server node TC Server  transactionId \n\n `nohup.out` \n\n```Java\n#  DB \n2020-04-05 16:54:12.793 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load DataSourceGenerator[dbcp] extension by class[io.seata.server.store.db.DbcpDataSourceGenerator]\nLoading class `com.mysql.jdbc.Driver'. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver'. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.\n2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load LogStore[DB] extension by class[io.seata.core.store.db.LogStoreDataBaseDAO]\n2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load TransactionStoreManager[DB] extension by class[io.seata.server.store.db.DatabaseTransactionStoreManager]\n2020-04-05 16:54:13.442 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load SessionManager[DB] extension by class[io.seata.server.session.db.DataBaseSessionManager]\n# \n2020-04-05 16:54:13.779 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started ...\n#  Nacos \n2020-04-05 16:54:13.788 INFO [main]io.seata.common.loader.EnhancedServiceLoader.loadFile:247 -load RegistryProvider[Nacos] extension by class[io.seata.discovery.registry.nacos.NacosRegistryProvider]\n```\n\n  `nohup sh bin/seata-server.sh -p 28091 -n 2 &` **** TC Server \n\n  Nacos **** Seata TC Server ![Nacos ](http://www.iocoder.cn/images/Seata/2017-01-01/26.png)\n\n# 4.  Java \n\n## 4.1 AT \n\n** Spring Boot**\n\n1[ Spring Boot  Seata ](http://www.iocoder.cn/Spring-Boot/Seata/?self)[2. AT  + ](#) Spring Boot \n\n![](http://www.iocoder.cn/images/Spring-Boot/2020-10-01/01.png)\n\n2[ Spring Boot  Seata ](http://www.iocoder.cn/Spring-Boot/Seata/?self)[AT  + HttpClient ](#) Spring Boot \n\n![](http://www.iocoder.cn/images/Spring-Boot/2020-10-01/21.png)\n\n** Dubbo**\n\n[Dubbo  Seata ](http://www.iocoder.cn/Dubbo/Seata/?sef)[2. AT ](#) Dubbo \n\n![](http://www.iocoder.cn/images/Dubbo/2020-04-15/01.png)\n\n** Spring Cloud**\n\n[ Spring Cloud Alibaba  Seata ](http://www.iocoder.cn/Spring-Cloud-Alibaba/Seata/?self)[3. AT  + Feign](#) Spring Cloud \n\n![](http://www.iocoder.cn/images/Spring-Cloud/2020-07-15/01.png)\n\n## 4.2 TCC \n\n* [Seata   TCC ](https://seata.io/zh-cn/docs/dev/mode/tcc-mode.html)\n* <https://github.com/seata/seata-samples/blob/master/tcc>\n\n## 4.3 Saga \n\n* [Seata   Saga ](https://seata.io/zh-cn/docs/dev/mode/saga-mode.html)\n* <https://github.com/seata/seata-samples/tree/master/saga>\n\n## 4.4 XA \n\nSeata ..."
        },
        {
          "id": "/seata-ha-practice",
          "metadata": {
            "permalink": "/blog/seata-ha-practice",
            "source": "@site/blog/seata-ha-practice.md",
            "title": "Seata ",
            "description": "Seata ",
            "date": "2020-04-10T00:00:00.000Z",
            "formattedDate": "April 10, 2020",
            "tags": [],
            "readingTime": 6.655,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "helloworlde"
              }
            ],
            "frontMatter": {
              "hidden": true,
              "title": "Seata ",
              "keywords": [
                "kubernetes",
                "ops"
              ],
              "description": "Seata ",
              "author": "helloworlde",
              "date": "2020-04-10T00:00:00.000Z"
            },
            "prevItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-quick-start"
            },
            "nextItem": {
              "title": "Seata config ",
              "permalink": "/blog/seata-analysis-config-modular"
            }
          },
          "content": " Seata  Nacos  MySQL [cloud-seata-nacos](https://github.com/helloworlde/spring-cloud-alibaba-component/blob/master/cloud-seata-nacos/) Kubernetes \n\n Nacos : order-service, pay-service, storage-service,  order-service \n\n## \n\n Nacos  MySQL\n\n-  Nacos \n\n Nacos 8848  seata-server  `192.168.199.2`\n\n```bash\ndocker run --name nacos -p 8848:8848 -e MODE=standalone nacos/nacos-server\n```\n\n-  MySQL \n\nMySQL  `192.168.199.2`\n\n```bash\ndocker run --name mysql -p 30060:3306-e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7.17\n```\n\n##  seata-server\n\n- seata-server\n\n SQL  [script/server/db](https://github.com/seata/seata/tree/develop/script/server/db) MySQL  `seata`\n\n undo_log   [script/client/at/db/](https://github.com/seata/seata/blob/develop/script/client/at/db/)\n\n- seata-server\n\n Nacos  [script/config-center](https://github.com/seata/seata/tree/develop/script/config-center)\n\n```\nservice.vgroupMapping.my_test_tx_group=default\nstore.mode=db\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://192.168.199.2:30060/seata?useUnicode=true\nstore.db.user=root\nstore.db.password=123456\n```\n\n###  seata-server  Kubernetes\n\n- seata-server.yaml\n\n ConfigMap \n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: seata-ha-server\n  namespace: default\n  labels:\n    app.kubernetes.io/name: seata-ha-server\nspec:\n  type: ClusterIP\n  ports:\n    - port: 8091\n      protocol: TCP\n      name: http\n  selector:\n    app.kubernetes.io/name: seata-ha-server\n\n---\n\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: seata-ha-server\n  namespace: default\n  labels:\n    app.kubernetes.io/name: seata-ha-server\nspec:\n  serviceName: seata-ha-server\n  replicas: 3\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: seata-ha-server\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: seata-ha-server\n    spec:\n      containers:\n        - name: seata-ha-server\n          image: docker.io/seataio/seata-server:latest\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: SEATA_CONFIG_NAME\n              value: file:/root/seata-config/registry\n          ports:\n            - name: http\n              containerPort: 8091\n              protocol: TCP\n          volumeMounts:\n            - name: seata-config\n              mountPath: /root/seata-config\n      volumes:\n        - name: seata-config\n          configMap:\n            name: seata-ha-server-config\n\n\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: seata-ha-server-config\ndata:\n  registry.conf: |\n    registry {\n        type = \"nacos\"\n        nacos {\n          application = \"seata-server\"\n          serverAddr = \"192.168.199.2\"\n        }\n    }\n    config {\n      type = \"nacos\"\n      nacos {\n        serverAddr = \"192.168.199.2\"\n        group = \"SEATA_GROUP\"\n      }\n    }\n```\n\n- \n\n```bash\nkubectl apply -f seata-server.yaml\n```\n\n pod\n\n```bash\nkubectl get pod | grep seata-ha-server\n\nseata-ha-server-645844b8b6-9qh5j    1/1     Running   0          3m14s\nseata-ha-server-645844b8b6-pzczs    1/1     Running   0          3m14s\nseata-ha-server-645844b8b6-wkpw8    1/1     Running   0          3m14s\n```\n\n Nacos  seata-server  seata-server \n\n-  \n\n```bash\nkubelet logs -f seata-ha-server-645844b8b6-9qh5j\n```\n\n```java\n[0.012s][info   ][gc] Using Serial\n2020-04-15 00:55:09.880 INFO [main]io.seata.server.ParameterParser.init:90 -The server is running in container.\n2020-04-15 00:55:10.013 INFO [main]io.seata.config.FileConfiguration.<init>:110 -The configuration file used is file:/root/seata-config/registry.conf\n2020-04-15 00:55:12.426 INFO [main]com.alibaba.druid.pool.DruidDataSource.init:947 -{dataSource-1} inited\n2020-04-15 00:55:13.127 INFO [main]io.seata.core.rpc.netty.RpcServerBootstrap.start:155 -Server started \n```\n\n`{dataSource-1} `\n\n- seata-serve \n\n![seata-ha-nacos-list.png](/img/blog/seata-ha-nacos-list.png)\n\n\n## \n\n- \n\n [cloud-seata-nacos/README.md](https://github.com/helloworlde/spring-cloud-alibaba-component/blob/master/cloud-seata-nacos/README.md)\n\n-  Nacos \n\n public  data-id  `order-service.properties`, `pay-service.properties`, `storage-service.properties` \n\n```\n# MySQL\nspring.datasource.url=jdbc:mysql://192.168.199.2:30060/seata?useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&useSSL=false\nspring.datasource.username=root\nspring.datasource.password=123456\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n# Seata\nspring.cloud.alibaba.seata.tx-service-group=my_test_tx_group\n```\n\n- \n\n application.yaml  ConfigMap  `NACOS_ADDR` Nacos \n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: default\n  name: seata-ha-service\n  labels:\n    app.kubernetes.io/name: seata-ha-service\nspec:\n  type: NodePort\n  ports:\n    - port: 8081\n      nodePort: 30081\n      protocol: TCP\n      name: http\n  selector:\n    app.kubernetes.io/name: seata-ha-service\n\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: seata-ha-service-config\ndata:\n  NACOS_ADDR: 192.168.199.2:8848\n\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: seata-ha-account\n  namespace: default\n  \n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: seata-ha-account\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n  - kind: ServiceAccount\n    name: seata-ha-account\n    namespace: default\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: default\n  name: seata-ha-service\n  labels:\n    app.kubernetes.io/name: seata-ha-service\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: seata-ha-service\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: seata-ha-service\n    spec:\n      serviceAccountName: seata-ha-account\n      containers:\n        - name: seata-ha-order-service\n          image: \"registry.cn-qingdao.aliyuncs.com/hellowoodes/seata-ha-order-service:1.1\"\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: NACOS_ADDR\n              valueFrom:\n                configMapKeyRef:\n                  key: NACOS_ADDR\n                  name: seata-ha-service-config\n          ports:\n            - name: http\n              containerPort: 8081\n              protocol: TCP\n        - name: seata-ha-pay-service\n          image: \"registry.cn-qingdao.aliyuncs.com/hellowoodes/seata-ha-pay-service:1.1\"\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: NACOS_ADDR\n              valueFrom:\n                configMapKeyRef:\n                  key: NACOS_ADDR\n                  name: seata-ha-service-config\n          ports:\n            - name: http\n              containerPort: 8082\n              protocol: TCP\n        - name: seata-ha-storage-service\n          image: \"registry.cn-qingdao.aliyuncs.com/hellowoodes/seata-ha-storage-service:1.1\"\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: NACOS_ADDR\n              valueFrom:\n                configMapKeyRef:\n                  key: NACOS_ADDR\n                  name: seata-ha-service-config\n          ports:\n            - name: http\n              containerPort: 8083\n              protocol: TCP\n```\n\n\n\n```bash\nkubectl apply -f application.yaml\n```\n\n podseata-ha-service  pod\n\n```bash\nkubectl get pod | grep seata-ha-service\n\nseata-ha-service-7dbdc6894b-5r8q4      3/3     Running   0          12m\n```\n\n Nacos \n\n![seata-ha-service-list.png](/img/blog/seata-ha-service-list.png)\n\n TC \n\n```bash\nkubectl logs -f seata-ha-service-7dbdc6894b-5r8q4 seata-ha-order-service\n```\n\n![seata-ha-service-register.png](/img/blog/seata-ha-service-register.png)\n\n TC  TC \n\n```bash\nkubelet logs -f seata-ha-server-645844b8b6-9qh5j\n```\n\n![seata-ha-tc-register.png](/img/blog/seata-ha-tc-register.png)\n\n\n## \n\n\n### \n\n price  1 10\n\n```bash\ncurl -X POST \\\n  http://192.168.199.2:30081/order/placeOrder \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"userId\": 1,\n    \"productId\": 1,\n    \"price\": 1\n}'\n```\n\n\n\n```json\n{\"success\":true,\"message\":null,\"data\":null}\n```\n\nTC \n\n![seata-ha-commit-tc-success.png](/img/blog/seata-ha-commit-tc-success.png)\n\n order-service \n![seata-ha-commit-success.png](/img/blog/seata-ha-commit-service-success.png)\n\n\n### \n\n price  100\n\n```bash\ncurl -X POST \\\n  http://192.168.199.2:30081/order/placeOrder \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"userId\": 1,\n    \"productId\": 1,\n    \"price\": 100\n}'\n```\n\n TC \n![seata-ha-commit-tc-rollback.png](/img/blog/seata-ha-commit-tc-rollback.png)\n\n \n![seata-ha-commit-service-rollback.png](/img/blog/seata-ha-commit-service-rollback.png)\n\nTC TC "
        },
        {
          "id": "/seata-analysis-config-modular",
          "metadata": {
            "permalink": "/blog/seata-analysis-config-modular",
            "source": "@site/blog/seata-analysis-config-modular.md",
            "title": "Seata config ",
            "description": " . ",
            "date": "2020-01-11T00:00:00.000Z",
            "formattedDate": "January 11, 2020",
            "tags": [],
            "readingTime": 7.74,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata config ",
              "author": "",
              "keywords": [
                "Seata"
              ],
              "date": "2020/1/11"
            },
            "prevItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-ha-practice"
            },
            "nextItem": {
              "title": "Seata-XID Dubbo",
              "permalink": "/blog/seata-analysis-dubbo-transmit-xid"
            }
          },
          "content": "##  . \n[](https://www.iteye.com/blog/javatar-949527)\n\n key-value \n\n\n\n jar  META-INF/services \n\n## . \n\nseata server  resources/registry.conf  seata client  1.0  conf  springboot  yml  seata.config.{type}  yml  io.seata.spring.boot.autoconfigure.properties.registry \n\n seata resources conf  yml  yml \n\n```java\nCURRENT_FILE_INSTANCE = null == extConfiguration ? configuration : extConfiguration;\n```\n\n extConfiguration  ExtConfigurationProvider#provide()  configuration  ConfigurationProvider#provide() config  ConfigurationFactory  SPI \n\n```java\nEnhancedServiceLoader.load(ExtConfigurationProvider.class).provide(configuration);\n```\n\nFile \n\nclient  server  ConfigurationFactory#getInstance()  key  core  config \n\n[](https://seata.io/zh-cn/docs/user/configurations.html)\n\n ConfigurationFactory  ConfigurationFactory \n\n config  ConfigurationChangeListener#onChangeEvent \n\n```java\npublic class GlobalTransactionalInterceptor implements ConfigurationChangeListener {\nprivate volatile boolean disable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,false);\n@Override public Object invoke(Param param) {\n   if(disable){//}\n}\n@Override public void onChangeEvent(Param param) {\n   disable = param;\n}}\n```\n\n spring  GlobalTransactionalInterceptor  GlobalTrarnsactionalScanner  interceptor  interceptor \n\n```java\nConfigurationFactory.getInstance().addConfigListener(ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,(ConfigurationChangeListener)interceptor);\n```\n\ninterceptor#invoke()  disable  true  seata \n\n## .  \n xml \n\nseata AT  seata \n\n```java\n@GlobalTransactional(timeoutMills = 300000, name = \"busi-doBiz\")\npublic String doBiz(String msg) {}\n```\n tcc \n\n```java\n@TwoPhaseBusinessAction(name = \"tccActionForSpringTest\" , commitMethod = \"commit\", rollbackMethod = \"rollback\")\npublic boolean prepare(BusinessActionContext actionContext, int i);\npublic boolean commit(BusinessActionContext actionContext);\npublic boolean rollback(BusinessActionContext actionContext);\n```\n\n##  .\n\n\n![](https://img-blog.csdnimg.cn/20200110213751452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3ODA0NzM3,size_16,color_FFFFFF,t_70)\n META-INF/services  spi  registry.conf  config.type=test \n\n seata seata  enum ConfigType \n\n```java\nprivate static Configuration buildConfiguration() {\n   configTypeName = \"test\";//registry.confconfig.type\n   configType = ConfigType.getType(configTypeName);//ConfigType\n}\n```\n\n ConfigType  test  ConfigType \n\n1.0 ConfigType File,ZK,Nacos,Apollo,Consul,Etcd3,SpringCloudConfig,Custom Custom \n\n![](https://img-blog.csdnimg.cn/20200110215249152.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3ODA0NzM3,size_16,color_FFFFFF,t_70)\n ZK  order=3 ZKorder=1 ConfigurationFactory  TestConfigurationProvider \n\n seata seata  codeccompressordiscoveryintegration  spi  + \n\n##   . seata\n[](https://blog.csdn.net/qq_37804737/category_9530078.html)"
        },
        {
          "id": "/seata-analysis-dubbo-transmit-xid",
          "metadata": {
            "permalink": "/blog/seata-analysis-dubbo-transmit-xid",
            "source": "@site/blog/seata-analysis-dubbo-transmit-xid.md",
            "title": "Seata-XID Dubbo",
            "description": "Seata-DubboXID",
            "date": "2020-01-01T00:00:00.000Z",
            "formattedDate": "January 1, 2020",
            "tags": [],
            "readingTime": 3.39,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "Seata-XID Dubbo",
              "keywords": [
                "Seata",
                "Dubbo",
                "",
                "spring"
              ],
              "description": "Seata-DubboXID",
              "author": "FUNKYE",
              "date": "2020/01/01"
            },
            "prevItem": {
              "title": "Seata config ",
              "permalink": "/blog/seata-analysis-config-modular"
            },
            "nextItem": {
              "title": "Seata Community Meetup",
              "permalink": "/blog/seata-meetup-hangzhou"
            }
          },
          "content": "FUNKYE(),\n\n# \n\n\t1.,seata-dubboseata-dubbo-alibabaTransactionPropagationFilter,apache-dubboalibaba-dubbo.\n\n![20200101203229](/img/blog/20200101203229.png)\n\n## \n\n```java\npackage io.seata.integration.dubbo;\n\nimport io.seata.core.context.RootContext;\nimport org.apache.dubbo.common.Constants;\nimport org.apache.dubbo.common.extension.Activate;\nimport org.apache.dubbo.rpc.Filter;\nimport org.apache.dubbo.rpc.Invocation;\nimport org.apache.dubbo.rpc.Invoker;\nimport org.apache.dubbo.rpc.Result;\nimport org.apache.dubbo.rpc.RpcContext;\nimport org.apache.dubbo.rpc.RpcException;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n@Activate(group = {Constants.PROVIDER, Constants.CONSUMER}, order = 100)\npublic class TransactionPropagationFilter implements Filter {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(TransactionPropagationFilter.class);\n\n    @Override\n    public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {\n        //XID\n        String xid = RootContext.getXID();\n        String xidInterceptorType = RootContext.getXIDInterceptorType();\n        //DubboXID\n        String rpcXid = getRpcXid();\n        String rpcXidInterceptorType = RpcContext.getContext().getAttachment(RootContext.KEY_XID_INTERCEPTOR_TYPE);\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"xid in RootContext[{}] xid in RpcContext[{}]\", xid, rpcXid);\n        }\n        boolean bind = false;\n        if (xid != null) {\n            //XID\n            RpcContext.getContext().setAttachment(RootContext.KEY_XID, xid);\n            RpcContext.getContext().setAttachment(RootContext.KEY_XID_INTERCEPTOR_TYPE, xidInterceptorType);\n        } else {\n            if (rpcXid != null) {\n                //XID\n                RootContext.bind(rpcXid);\n                RootContext.bindInterceptorType(rpcXidInterceptorType);\n                bind = true;\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\"bind[{}] interceptorType[{}] to RootContext\", rpcXid, rpcXidInterceptorType);\n                }\n            }\n        }\n        try {\n            return invoker.invoke(invocation);\n        } finally {\n            if (bind) {\n                //XID\n                String unbindInterceptorType = RootContext.unbindInterceptorType();\n                String unbindXid = RootContext.unbind();\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\"unbind[{}] interceptorType[{}] from RootContext\", unbindXid, unbindInterceptorType);\n                }\n                //XIDXID\n                if (!rpcXid.equalsIgnoreCase(unbindXid)) {\n                    LOGGER.warn(\"xid in change during RPC from {} to {}, xidInterceptorType from {} to {} \", rpcXid, unbindXid, rpcXidInterceptorType, unbindInterceptorType);\n                    if (unbindXid != null) {\n                        //XID\n                        RootContext.bind(unbindXid);\n                        RootContext.bindInterceptorType(unbindInterceptorType);\n                        LOGGER.warn(\"bind [{}] interceptorType[{}] back to RootContext\", unbindXid, unbindInterceptorType);\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * get rpc xid\n     * @return\n     */\n    private String getRpcXid() {\n        String rpcXid = RpcContext.getContext().getAttachment(RootContext.KEY_XID);\n        if (rpcXid == null) {\n            rpcXid = RpcContext.getContext().getAttachment(RootContext.KEY_XID.toLowerCase());\n        }\n        return rpcXid;\n    }\n\n}\n```\n\n\t1.,\n\n![20200101213336](/img/blog/20200101213336.png)\n\n## \n\n\t1.Dubbo @Activate:\n\n```java\n@Documented\n@Retention(RetentionPolicy.RUNTIME)\n@Target({ElementType.TYPE, ElementType.METHOD})\npublic @interface Activate {\n    /**\n     * Group\n     * <br />\n     * {@link ExtensionLoader#getActivateExtension}group\n     * <br />\n     * Group\n     */\n    String[] group() default {};\n\n    /**\n     * Key{@link ExtensionLoader#getActivateExtension}URLKey\n     * <p/>\n     * <br/>\n     *  <code>@Activate(\"cache,validatioin\")</code>\n     * {@link ExtensionLoader#getActivateExtension}URL<code>cache</code>Key<code>validatioin</code>\n     * <br/>\n     * \n     */\n    String[] value() default {};\n\n    /**\n     * \n     */\n    String[] before() default {};\n\n    /**\n     * \n     */\n    String[] after() default {};\n\n    /**\n     * \n     */\n    int order() default 0;\n}\n```\n\n,Seatadubbo@Activate(group = {Constants.PROVIDER, Constants.CONSUMER}, order = 100),dubbo,SeataXID,.\n\n\t2.Dubbo `RpcContext`  `setAttachment`  `getAttachment` \n\n:RpcContext.getContext().getAttachment(RootContext.KEY_XID);\n\n:RpcContext.getContext().setAttachment(RootContext.KEY_XID, xid);\n\n# \n\n[Seata](http://seata.io/zh-cn/index.html)"
        },
        {
          "id": "/seata-meetup-hangzhou",
          "metadata": {
            "permalink": "/blog/seata-meetup-hangzhou",
            "source": "@site/blog/seata-meetup-hangzhou.md",
            "title": "Seata Community Meetup",
            "description": "Seata Community Meetup,1221",
            "date": "2019-12-25T14:48:04.000Z",
            "formattedDate": "December 25, 2019",
            "tags": [],
            "readingTime": 1.06,
            "hasTruncateMarker": false,
            "authors": [],
            "frontMatter": {
              "title": "Seata Community Meetup",
              "keywords": [
                "Seata",
                "",
                "meetup"
              ],
              "description": "Seata Community Meetup,1221"
            },
            "prevItem": {
              "title": "Seata-XID Dubbo",
              "permalink": "/blog/seata-analysis-dubbo-transmit-xid"
            },
            "nextItem": {
              "title": "Seata tcc ",
              "permalink": "/blog/seata-analysis-tcc-modular"
            }
          },
          "content": "![](https://img.alicdn.com/tfs/TB1qH2YwVP7gK0jSZFjXXc5aXXa-2002-901.jpg)\n\n### \n\n### \n\n- Seata Seata  Seata 1.0 \n- Seata  Seata AT, TCC, Saga \n- Seata \n\n- [](https://developer.aliyun.com/live/1760)\n- [ Seata ](http://w2wz.com/h2nb)\n\n### \n\n- () Seata  [slides](https://github.com/a364176773/awesome-seata/blob/master/slides/meetup/201912%40hangzhou/%E5%AD%A3%E6%95%8F%EF%BC%88%E6%B8%85%E9%93%AD%EF%BC%89%E3%80%8ASeata%20%E7%9A%84%E8%BF%87%E5%8E%BB%E3%80%81%E7%8E%B0%E5%9C%A8%E5%92%8C%E6%9C%AA%E6%9D%A5%E3%80%8B.pdf)\n\n  ![](https://img.alicdn.com/tfs/TB1BALWw4z1gK0jSZSgXXavwpXa-6720-4480.jpg)\n\n- SEATASEATA [slides](https://github.com/seata/awesome-seata/blob/master/slides/meetup/201912%40hangzhou/%E5%AD%A3%E6%95%8F%EF%BC%88%E6%B8%85%E9%93%AD%EF%BC%89%E3%80%8ASeata%20%E7%9A%84%E8%BF%87%E5%8E%BB%E3%80%81%E7%8E%B0%E5%9C%A8%E5%92%8C%E6%9C%AA%E6%9D%A5%E3%80%8B.pdf)\n\n  ![1577282651](https://img.alicdn.com/tfs/TB1Xzz1w4v1gK0jSZFFXXb0sXXa-6720-4480.jpg)\n\n- ) Seata AT  [slides](https://github.com/seata/awesome-seata/tree/master/slides/meetup/201912%40hangzhou)\n\n  ![1577282652](https://img.alicdn.com/tfs/TB1UK22w7T2gK0jSZPcXXcKkpXa-6720-4480.jpg)\n\n-  SeataTCC\n\n  ![1577282653](https://img.alicdn.com/tfs/TB1fCPZw.T1gK0jSZFhXXaAtVXa-6720-4480.jpg)\n\n- Seata  Saga \n\n  ![1577282654](https://img.alicdn.com/tfs/TB1zLv3wYj1gK0jSZFuXXcrHpXa-6720-4480.jpg)\n\n- Seata%20 [slides](https://github.com/seata/awesome-seata/blob/master/slides/meetup/201912%40hangzhou/%E9%99%88%E9%B9%8F%E5%BF%97%E3%80%8ASeata%20%E5%9C%A8%E6%BB%B4%E6%BB%B4%E4%B8%A4%E8%BD%AE%E8%BD%A6%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%AE%9E%E8%B7%B5%E3%80%8B.pdf)\n\n  ![1577282655](https://img.alicdn.com/tfs/TB1phvYw4n1gK0jSZKPXXXvUXXa-6720-4480.jpg)\n\n### \n\n![](https://img.alicdn.com/tfs/TB1khDVw.z1gK0jSZLeXXb9kVXa-6720-4480.jpg)"
        },
        {
          "id": "/seata-analysis-tcc-modular",
          "metadata": {
            "permalink": "/blog/seata-analysis-tcc-modular",
            "source": "@site/blog/seata-analysis-tcc-modular.md",
            "title": "Seata tcc ",
            "description": "  .",
            "date": "2019-12-25T00:00:00.000Z",
            "formattedDate": "December 25, 2019",
            "tags": [],
            "readingTime": 10.08,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata tcc ",
              "author": "",
              "keywords": [
                "Seata"
              ],
              "date": "2019/12/25"
            },
            "prevItem": {
              "title": "Seata Community Meetup",
              "permalink": "/blog/seata-meetup-hangzhou"
            },
            "nextItem": {
              "title": "Seata core ",
              "permalink": "/blog/seata-analysis-core-modular"
            }
          },
          "content": "##   .\n\nspring Seata  spring  bean  GlobalTransactionalScanner  TCC  reference tcc bean  TCC  MethodInterceptor tcc  @GlobalTransactional  MethodInterceptor \n\nTCC  MethodInterceptor  TccActionInterceptor(spring)  ActionInterceptorHandler(tcc)  TCC \t\n\nTCC TCC\n\n##   .TCC\n\n2PC\n\n```java\npublic interface TccAction {\n\n    @TwoPhaseBusinessAction(name = \"tccActionForTest\" , commitMethod = \"commit\", rollbackMethod = \"rollback\")\n    public boolean prepare(BusinessActionContext actionContext,\n                           @BusinessActionContextParameter(paramName = \"a\") int a,\n                           @BusinessActionContextParameter(paramName = \"b\", index = 0) List b,\n                           @BusinessActionContextParameter(isParamInProperty = true) TccParam tccParam);\n\n    public boolean commit(BusinessActionContext actionContext);\n    \n    public boolean rollback(BusinessActionContext actionContext);\n}\n```\n\n TCC  BusinessActionContext \n\nprepare\n\ncommit\n\ncancel\n\n BusinessActionContext xidbranchIdactionName  @BusinessActionContextParam \n\n\n1.\n2. try \n3.\n\n##    . remoting \n\n![](https://img-blog.csdnimg.cn/20191124211806237.png?)\n\n DefaultRemotingParser DubboLocalTCCSofaRpc RPC\n\nDefaultRemotingParser \n1. bean  remoting bean\n\n```java\n    @Override\n    public boolean isRemoting(Object bean, String beanName) throws FrameworkException {\n        //\n        return isReference(bean, beanName) || isService(bean, beanName);\n    }\n```\n\n2. bean  rpc  RemotingDesc\n\n```java\n@Override\n    public boolean isRemoting(Object bean, String beanName) throws FrameworkException {\n        //\n        return isReference(bean, beanName) || isService(bean, beanName);\n    }\n```\n\n allRemotingParsers  bean allRemotingParsersinitRemotingParser()  EnhancedServiceLoader.loadAll(RemotingParser.class)  RemotingParser  SPI \n\nfeignRemotingParser SPI \n\nRemotingDesc  bean  targetBeaninterfaceClassinterfaceClassNameprotocolisReference\n\n3.TCC\n\n```java\npublic RemotingDesc parserRemotingServiceInfo(Object bean, String beanName) {\n        RemotingDesc remotingBeanDesc = getServiceDesc(bean, beanName);\n        if (remotingBeanDesc == null) {\n            return null;\n        }\n        remotingServiceMap.put(beanName, remotingBeanDesc);\n\n        Class<?> interfaceClass = remotingBeanDesc.getInterfaceClass();\n        Method[] methods = interfaceClass.getMethods();\n        if (isService(bean, beanName)) {\n            try {\n                //service bean, registry resource\n                Object targetBean = remotingBeanDesc.getTargetBean();\n                for (Method m : methods) {\n                    TwoPhaseBusinessAction twoPhaseBusinessAction = m.getAnnotation(TwoPhaseBusinessAction.class);\n                    if (twoPhaseBusinessAction != null) {\n                        TCCResource tccResource = new TCCResource();\n                        tccResource.setActionName(twoPhaseBusinessAction.name());\n                        tccResource.setTargetBean(targetBean);\n                        tccResource.setPrepareMethod(m);\n                        tccResource.setCommitMethodName(twoPhaseBusinessAction.commitMethod());\n                        tccResource.setCommitMethod(ReflectionUtil\n                            .getMethod(interfaceClass, twoPhaseBusinessAction.commitMethod(),\n                                new Class[] {BusinessActionContext.class}));\n                        tccResource.setRollbackMethodName(twoPhaseBusinessAction.rollbackMethod());\n                        tccResource.setRollbackMethod(ReflectionUtil\n                            .getMethod(interfaceClass, twoPhaseBusinessAction.rollbackMethod(),\n                                new Class[] {BusinessActionContext.class}));\n                        //registry tcc resource\n                        DefaultResourceManager.get().registerResource(tccResource);\n                    }\n                }\n            } catch (Throwable t) {\n                throw new FrameworkException(t, \"parser remoting service error\");\n            }\n        }\n        if (isReference(bean, beanName)) {\n            //reference bean, TCC proxy\n            remotingBeanDesc.setReference(true);\n        }\n        return remotingBeanDesc;\n    }\n```\n\n RemotingDesc  interfaceClass@TwoParserBusinessAction  TCCRecource DefaultResourceManager  TCC \n\n DefaultResourceManager  Resource  BranchType TCC  tcc \n\n rpc  spring parserRemotingServiceInfo()  spring  TCCBeanParserUtils spring  GlobalTransactionScanner  TCC bean TCCBeanParserUtils  TCCResourceManager  TccActionInterceptor  spring tcc  spring \n\n##   .tcc \n\nTCCResourceManager  TCC \n\n1. spring  GlobalTransactionScanner  bean  tcc bean  server \n\n```java\n    @Override\n    public void registerResource(Resource resource) {\n        TCCResource tccResource = (TCCResource)resource;\n        tccResourceCache.put(tccResource.getResourceId(), tccResource);\n        super.registerResource(tccResource);\n    }\n```\n\nserver AbstractResourceManage  resourceId  TCCResource  AbstractResourceManage   resourceGroupId + actionNameactionName  @TwoParseBusinessAction  nameresourceGroupId  DEFAULT\n\n2. rm-datasource  AbstractResourceManager  lockKeys  null AT \n\n3.\n\n```java\n    @Override\n    public BranchStatus branchCommit(BranchType branchType, String xid, long branchId, String resourceId,\n                                     String applicationData) throws TransactionException {\n        TCCResource tccResource = (TCCResource)tccResourceCache.get(resourceId);\n        if (tccResource == null) {\n            throw new ShouldNeverHappenException(\"TCC resource is not exist, resourceId:\" + resourceId);\n        }\n        Object targetTCCBean = tccResource.getTargetBean();\n        Method commitMethod = tccResource.getCommitMethod();\n        if (targetTCCBean == null || commitMethod == null) {\n            throw new ShouldNeverHappenException(\"TCC resource is not available, resourceId:\" + resourceId);\n        }\n        try {\n            boolean result = false;\n            //BusinessActionContext\n            BusinessActionContext businessActionContext = getBusinessActionContext(xid, branchId, resourceId,\n                applicationData);\n            Object ret = commitMethod.invoke(targetTCCBean, businessActionContext);\n            if (ret != null) {\n                if (ret instanceof TwoPhaseResult) {\n                    result = ((TwoPhaseResult)ret).isSuccess();\n                } else {\n                    result = (boolean)ret;\n                }\n            }\n            return result ? BranchStatus.PhaseTwo_Committed : BranchStatus.PhaseTwo_CommitFailed_Retryable;\n        } catch (Throwable t) {\n            LOGGER.error(msg, t);\n            throw new FrameworkException(t, msg);\n        }\n    }\n```\n xidbranchIdresourceIdapplicationData  businessActionContext\n\n commit \n\n branchCommit()  branchRollback()  rm  AbstractRMHandler  handler  core  registerResource()  spring \n\n##   . tcc \n\nspring  TccActionInterceptor  invoke()  rpc bean  rpc  xid  TCC  tcc  ActionInterceptorHandler  \n \n ActionInterceptorHandler \n\n```java\n    public Map<String, Object> proceed(Method method, Object[] arguments, String xid, TwoPhaseBusinessAction businessAction,\n                                       Callback<Object> targetCallback) throws Throwable {\n        Map<String, Object> ret = new HashMap<String, Object>(4);\n\n        //TCC name\n        String actionName = businessAction.name();\n        BusinessActionContext actionContext = new BusinessActionContext();\n        actionContext.setXid(xid);\n        //set action anme\n        actionContext.setActionName(actionName);\n\n        //Creating Branch Record\n        String branchId = doTccActionLogStore(method, arguments, businessAction, actionContext);\n        actionContext.setBranchId(branchId);\n\n        //set the parameter whose type is BusinessActionContext\n        Class<?>[] types = method.getParameterTypes();\n        int argIndex = 0;\n        for (Class<?> cls : types) {\n            if (cls.getName().equals(BusinessActionContext.class.getName())) {\n                arguments[argIndex] = actionContext;\n                break;\n            }\n            argIndex++;\n        }\n        //the final parameters of the try method\n        ret.put(Constants.TCC_METHOD_ARGUMENTS, arguments);\n        //the final result\n        ret.put(Constants.TCC_METHOD_RESULT, targetCallback.execute());\n        return ret;\n    }\n```\n\n\n\n1.doTccActionLogStore() \nfetchActionRequestContext(method, arguments) @BusinessActionContextParam  init  BusinessActionComtext \nDefaultResourceManager.get().branchRegister(BranchType.TCC, actionName, null, xid,applicationContextStr, null) TCC \n\n2. targetCallback.execute()  bean  prepare() \n\n\n##   .\ntcc \n\n1.  tcc \n2.  rpc  remoting bean  ParserRemoting  spring \n3.  TCC \n4.  TCC  MethodInterceptor  tcc \n\n##   .\n[](https://blog.csdn.net/qq_37804737/category_9530078.html)"
        },
        {
          "id": "/seata-analysis-core-modular",
          "metadata": {
            "permalink": "/blog/seata-analysis-core-modular",
            "source": "@site/blog/seata-analysis-core-modular.md",
            "title": "Seata core ",
            "description": "  . ",
            "date": "2019-12-23T00:00:00.000Z",
            "formattedDate": "December 23, 2019",
            "tags": [],
            "readingTime": 8.63,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata core ",
              "author": "",
              "keywords": [
                "Seata"
              ],
              "date": "2019/12/23"
            },
            "prevItem": {
              "title": "Seata tcc ",
              "permalink": "/blog/seata-analysis-tcc-modular"
            },
            "nextItem": {
              "title": "AOP/Seata",
              "permalink": "/blog/seata-spring-boot-aop-aspectj"
            }
          },
          "content": "##   . \ncore client  server context netty  rpc \n\n core \n\n![](https://img-blog.csdnimg.cn/20191223162313317.png)\n\ncodec codec  Codec \n\n```java\n<T> byte[] encode(T t);\n```\n\n```java\n<T> T decode(byte[] bytes);\n```\n1.0 codec SEATAPROTOBUFKRYO\n\ncompressorcodec1.0Gzip\n\nconstantsClientTableColumnsNameServerTableColumnsName client  server model\n\ncontext RootContext  ThreadLocalContextCore  TX_XID TX_LOCK   update/delete/insert/selectForUpdate SQL \n\nevent guava  EventBus  server  metrics MetricsManager  GlobalStatus  server  server \n\nlock\tserver  registerBranch 1.0DataBaseLocker  MemoryLocker rowKey = resourceId + tableName + pk  primary key\n\nmodelBranchStatusGlobalStatusBranchType TransactionManagerResourceManager rm  tm  rm  tm \n\nprotocol rpc  request  response model\n\nstore\n\n##   . exception  handler \n AbstractExceptionHandler  UML Callback AbstractCallback  AbstractExceptionHandler AbstractCallback  Callback  execute() AbstractExceptionHandler  AbstractCallback  execute() \n![](https://img-blog.csdnimg.cn/20191211165628768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3ODA0NzM3,size_16,color_FFFFFF,t_70)\n AbstractExceptionHandler \n\n1. exceptionHandlerTemplate() \n\n```java\n    public void exceptionHandleTemplate(Callback callback, AbstractTransactionRequest request,\n        AbstractTransactionResponse response) {\n        try {\n            callback.execute(request, response); //\n            callback.onSuccess(request, response); //response\n        } catch (TransactionException tex) {\n            LOGGER.error(\"Catch TransactionException while do RPC, request: {}\", request, tex);\n            callback.onTransactionException(request, response, tex); //responsemsg\n        } catch (RuntimeException rex) {\n            LOGGER.error(\"Catch RuntimeException while do RPC, request: {}\", request, rex);\n            callback.onException(request, response, rex);  //responsemsg\n        }\n    }\n```\nonSuccessonTransactionExceptiononException  AbstarctCallback execute AbstractExceptionHandler  handler \nAbstractExceptionHandler AbstractTCInboundHandler AbstractRMHandler \n\n2. AbstractExceptionHandler  Callback handler  callback  callback ()\n\n\n\n exceptionHandlerTemplate()  commit rollback \n\n##   . rpc \nseata  rpc \n\nclient  rpc  AbstractRpcRemotingClient\n![](https://img-blog.csdnimg.cn/20191211180129741.png)\n\n\n\nclientBootstrap netty  Bootstrap  Bootstrap \n\nclientChannelManager ConcurrentHashMap<serverAddress,channel>  channel \n\nclientMessageListener \n\n```java\npublic void onMessage(RpcMessage request, String serverAddress, ClientMessageSender sender) {\n        Object msg = request.getBody();\n        if (LOGGER.isInfoEnabled()) {\n            LOGGER.info(\"onMessage:\" + msg);\n        }\n        if (msg instanceof BranchCommitRequest) {\n            handleBranchCommit(request, serverAddress, (BranchCommitRequest)msg, sender);\n        } else if (msg instanceof BranchRollbackRequest) {\n            handleBranchRollback(request, serverAddress, (BranchRollbackRequest)msg, sender);\n        } else if (msg instanceof UndoLogDeleteRequest) {\n            handleUndoLogDelete((UndoLogDeleteRequest)msg);\n        }\n    }\n```\n\n TransactionMessageHandler ATTCCSAGE exceptionHandleTemplate() \n\nmergeSendExecutorService sendAsyncRequest() LinkedBlockingQueue&lt;&gt;  offer  poll \n\nchannelRead() HeartbeatMessage.PONG  MergeResultMessage  msgId  MessageFuture  result \n\ndispatch() clientMessageListener  server  request \n\n nettyhandlerseata  rpc  Codec handler  TransactionMessageHandler \n\n##   . \ncore core \n\n##   . seata\n[](https://blog.csdn.net/qq_37804737/category_9530078.html)"
        },
        {
          "id": "/seata-spring-boot-aop-aspectj",
          "metadata": {
            "permalink": "/blog/seata-spring-boot-aop-aspectj",
            "source": "@site/blog/seata-spring-boot-aop-aspectj.md",
            "title": "AOP/Seata",
            "description": "AOP/Seata",
            "date": "2019-12-23T00:00:00.000Z",
            "formattedDate": "December 23, 2019",
            "tags": [],
            "readingTime": 4.11,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "AOP/Seata",
              "keywords": [
                "Seata",
                "Nacos",
                "",
                "spring"
              ],
              "description": "AOP/Seata",
              "author": "FUNKYE",
              "date": "2019/12/23"
            },
            "prevItem": {
              "title": "Seata core ",
              "permalink": "/blog/seata-analysis-core-modular"
            },
            "nextItem": {
              "title": "Seata Community Meetup",
              "permalink": "/blog/seata-community-meetup-hangzhou-ready"
            }
          },
          "content": "FUNKYE(),\n\n# \n\nGA,,spring boot aop,!\n\ndemo[](https://gitee.com/itCjb/springboot-dubbo-mybatisplus-seata )\n\n.\n\n## \n\n\t1.TestAspect:\n\n```java\npackage org.test.config;\n\nimport java.lang.reflect.Method; \n\nimport org.apache.commons.lang3.StringUtils;\nimport org.aspectj.lang.JoinPoint;\nimport org.aspectj.lang.annotation.AfterReturning;\nimport org.aspectj.lang.annotation.AfterThrowing;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Before;\nimport org.aspectj.lang.reflect.MethodSignature;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.stereotype.Component;\n\nimport io.seata.core.context.RootContext;\nimport io.seata.core.exception.TransactionException;\nimport io.seata.tm.api.GlobalTransaction;\nimport io.seata.tm.api.GlobalTransactionContext;\n\n@Aspect\n@Component\npublic class TestAspect {\n    private final static Logger logger = LoggerFactory.getLogger(TestAspect.class);\n    \n    @Before(\"execution(* org.test.service.*.*(..))\")\n    public void before(JoinPoint joinPoint) throws TransactionException {\n        MethodSignature signature = (MethodSignature)joinPoint.getSignature();\n        Method method = signature.getMethod();\n        logger.info(\",\" + method.getName());\n        // rediskey\n        // \n        if ((int)(Math.random() * 100) % 2 == 0) {\n            GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n            tx.begin(300000, \"test-client\");\n        } else {\n            logger.info(\"\");\n        }\n    }\n\n    @AfterThrowing(throwing = \"e\", pointcut = \"execution(* org.test.service.*.*(..))\")\n    public void doRecoveryActions(Throwable e) throws TransactionException {\n        logger.info(\":{}\", e.getMessage());\n        if (!StringUtils.isBlank(RootContext.getXID()))\n            GlobalTransactionContext.reload(RootContext.getXID()).rollback();\n    }\n\n    @AfterReturning(value = \"execution(* org.test.service.*.*(..))\", returning = \"result\")\n    public void afterReturning(JoinPoint point, Object result) throws TransactionException {\n        logger.info(\":{}\", result);\n        if ((Boolean)result) {\n            if (!StringUtils.isBlank(RootContext.getXID())) {\n                logger.info(\"Id:{}\", RootContext.getXID());\n                GlobalTransactionContext.reload(RootContext.getXID()).commit();\n            }\n        }\n    }\n\n}\n```\n\nservice:\n\n\t2.service:\n\n```java\n    public Object seataCommit() {\n        testService.Commit();\n        return true;\n    }\n```\n\n,trycatch,,code=200,commit,rollback;\n\n# \n\n\t1.\n\n```java\n    public Object seataCommit() {\n        try {\n            testService.Commit();\n            int i = 1 / 0;\n            return true;\n        } catch (Exception e) {\n            // TODO: handle exception\n            throw new RuntimeException();\n        }\n    }\n```\n\n\t:\n\n```java\n2019-12-23 11:57:55.386  INFO 23952 --- [.0-28888-exec-7] org.test.controller.TestController       : ,seataCommit\n2019-12-23 11:57:55.489  INFO 23952 --- [.0-28888-exec-7] i.seata.tm.api.DefaultGlobalTransaction  : Begin new global transaction [192.168.14.67:8092:2030765910]\n2019-12-23 11:57:55.489  INFO 23952 --- [.0-28888-exec-7] org.test.controller.TestController       : 192.168.14.67:8092:2030765910\n2019-12-23 11:57:55.709  INFO 23952 --- [.0-28888-exec-7] org.test.controller.TestController       : :null\n2019-12-23 11:57:55.885  INFO 23952 --- [.0-28888-exec-7] i.seata.tm.api.DefaultGlobalTransaction  : [192.168.14.67:8092:2030765910] rollback status: Rollbacked\n2019-12-23 11:57:55.888 ERROR 23952 --- [.0-28888-exec-7] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException] with root cause\n\n```\n\n\trollback.\n\n\t2.:\n\n```java\n    public Object seataCommit() {\n        testService.Commit();\n        return true;\n    }\n```\n\n\t:\n\n```\n2019-12-23 12:00:20.876  INFO 23952 --- [.0-28888-exec-2] org.test.controller.TestController       : ,seataCommit\n2019-12-23 12:00:20.919  INFO 23952 --- [.0-28888-exec-2] i.seata.tm.api.DefaultGlobalTransaction  : Begin new global transaction [192.168.14.67:8092:2030765926]\n2019-12-23 12:00:20.920  INFO 23952 --- [.0-28888-exec-2] org.test.controller.TestController       : 192.168.14.67:8092:2030765926\n2019-12-23 12:00:21.078  INFO 23952 --- [.0-28888-exec-2] org.test.controller.TestController       : :true\n2019-12-23 12:00:21.078  INFO 23952 --- [.0-28888-exec-2] org.test.controller.TestController       : Id:192.168.14.67:8092:2030765926\n2019-12-23 12:00:21.213  INFO 23952 --- [.0-28888-exec-2] i.seata.tm.api.DefaultGlobalTransaction  : [192.168.14.67:8092:2030765926] commit status: Committed\n```\n\n\t.\n\n# \n\n\n\n[nacos](https://nacos.io/zh-cn/index.html)\n\n[dubbo](http://dubbo.apache.org/en-us/)\n\n[seata](http://seata.io/zh-cn/)\n\n[docker](https://www.docker.com/)"
        },
        {
          "id": "/seata-community-meetup-hangzhou-ready",
          "metadata": {
            "permalink": "/blog/seata-community-meetup-hangzhou-ready",
            "source": "@site/blog/seata-community-meetup-hangzhou-ready.md",
            "title": "Seata Community Meetup",
            "description": "Seata Community Meetup,1221",
            "date": "2019-12-18T13:39:47.000Z",
            "formattedDate": "December 18, 2019",
            "tags": [],
            "readingTime": 0.64,
            "hasTruncateMarker": false,
            "authors": [],
            "frontMatter": {
              "title": "Seata Community Meetup",
              "keywords": [
                "Seata",
                "",
                "meetup"
              ],
              "description": "Seata Community Meetup,1221"
            },
            "prevItem": {
              "title": "AOP/Seata",
              "permalink": "/blog/seata-spring-boot-aop-aspectj"
            },
            "nextItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-dynamic-config-and-dynamic-disable"
            }
          },
          "content": "### \n\n### \n\n- Seata Seata  Seata 1.0 \n- Seata  Seata AT, TCC, Saga \n- Seata \n\n### \n\n- [](https://developer.aliyun.com/live/1760)\n- [ Seata ](http://w2wz.com/h2nb)\n\n### \n\n-  PPT \n- ,,\n\n### \n\n![](https://img.alicdn.com/tfs/TB1K5nYwVP7gK0jSZFjXXc5aXXa-3175-14507.png)"
        },
        {
          "id": "/seata-dynamic-config-and-dynamic-disable",
          "metadata": {
            "permalink": "/blog/seata-dynamic-config-and-dynamic-disable",
            "source": "@site/blog/seata-dynamic-config-and-dynamic-disable.md",
            "title": "Seata ",
            "description": " Seata ",
            "date": "2019-12-17T00:00:00.000Z",
            "formattedDate": "December 17, 2019",
            "tags": [],
            "readingTime": 7.97,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata ",
              "author": "",
              "keywords": [
                "SeataDynamicConfig"
              ],
              "description": " Seata ",
              "date": "2019/12/17"
            },
            "prevItem": {
              "title": "Seata Community Meetup",
              "permalink": "/blog/seata-community-meetup-hangzhou-ready"
            },
            "nextItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-config-center"
            }
          },
          "content": "Seata ZKApolloNacos  Seata  AT \n\n Seata \n\n\n\n# \n\nSeata  default \n\nio.seata.config.ConfigurationChangeListener\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191216212442.png)\n\n\n\n1.  GlobalTransactionalInterceptor  ConfigurationChangeListener\n2.  file  key key \n\n## Nacos \n\nNacos  AbstractSharedListener\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191223212237.png)\n\n\n\n- dataId\n- listener listener  wrapper\n\nnacos  ConfigurationChangeListener  Nacos  nacos  ConfigurationChangeListener \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191223213347.png)\n\nNacos  dataId  dataId  listener  NacosListener  configService#addListener  NacosListener  dataId dataId \n\n## file \n\n FileListener \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215151642.png)\n\n\n\n- dataId\n\n- listener listener  wrapper** FileListener  ConfigurationChangeListener  FileListener  file  listener **\n\n- executor ConfigurationChangeListener#onProcessEvent \n\n**FileListener#onChangeEvent  file **\n\n listener \n\nConfigurationChangeEvent \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215175232.png)\n\n\n\n getConfig  file \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215162713.png)\n\n future  Runnable  get \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215170908.png)\n\nallowDynamicRefresh\n\ntargetFileLastModifiedfile \n\n\n\n file  tempLastModified targetFileLastModified tempLastModified > targetFileLastModified file  fileConfig\n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215161103.png)\n\nconfigListenersMap  FileConfiguration \n\n```java\nConcurrentMap<String/*dataId*/, Set<ConfigurationChangeListener>> configListenersMap\n```\n\n\n\n onProcessEvent  default  onChangeEvent  FileListener \n\n\n\n# \n\n ConfigurationChangeListener  Seata \n\n[Seata AT ](https://mp.weixin.qq.com/s/n9MHk47zSsFQmV-gBq_P1A)Spring  Seata  AT  GlobalTransactionalInterceptor  GlobalTransactional  GlobalLock GlobalTransactionalInterceptor  MethodInterceptor invoker \n\n-  GlobalTransactionalInterceptor \n\n```java\nprivate volatile boolean disable; \n```\n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215173221.png)\n\nConfigurationKeys.DISABLE_GLOBAL_TRANSACTIONservice.disableGlobalTransaction\n\n1. \n2. \n\n-  ConfigurationChangeListener\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215173358.png)\n\n ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION  disable \n\n-  GlobalTransactionalInterceptor#invoke \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215174155.png)\n\ndisable = true \n\n- \n\nio.seata.spring.annotation.GlobalTransactionScanner#wrapIfNecessary\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191215174409.png)\n\n Spring AOP  wrap \n\n# \n\n Java [https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "/seata-config-center",
          "metadata": {
            "permalink": "/blog/seata-config-center",
            "source": "@site/blog/seata-config-center.md",
            "title": "Seata ",
            "description": "Seata  Seata ",
            "date": "2019-12-12T00:00:00.000Z",
            "formattedDate": "December 12, 2019",
            "tags": [],
            "readingTime": 7.2,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata ",
              "author": "",
              "keywords": [
                "SeataConfig"
              ],
              "description": "Seata  Seata ",
              "date": "2019/12/12"
            },
            "prevItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-dynamic-config-and-dynamic-disable"
            },
            "nextItem": {
              "title": "DockerSeataNacos",
              "permalink": "/blog/seata-nacos-docker"
            }
          },
          "content": "Seata  Seata  Seata \n\n\n# \n\n Seata \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211193041.png)\n\nfile.conf registry.conf \n\n```json\nregistry {\n  # file nacos eurekarediszkconsuletcd3sofa\n  # ...\n}\n\nconfig {\n  # filenacos apollozkconsuletcd3\n  type = \"file\"\n  nacos {\n    serverAddr = \"localhost\"\n    namespace = \"\"\n  }\n  file {\n    name = \"file.conf\"\n  }\n  # ...\n}\n```\n\n registry config  file  file.conf  type \n\n config  core  ConfigurationFactory\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191210211022.png)\n\n\n\nREGISTRY_CONF_PREFIXREGISTRY_CONF_SUFFIX\n\nSYSTEM_PROPERTY_SEATA_CONFIG_NAMEENV_SEATA_CONFIG_NAMEENV_SYSTEM_KEYENV_PROPERTY_KEY\n\nConfigurationFactory \n\nio.seata.config.ConfigurationFactory\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211102702.png)\n\n registry.confFileConfiguration  Seata   registry.conf  FileConfiguration  SPI  ExtConfigurationProvider `META-INF/services/`\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211194643.png)\n\n\n\n# \n\nSeata \n\n FileConfiguration  Seata  AbstractConfiguration Configuration\n\n```java\nshort getShort(String dataId, int defaultValue, long timeoutMills);\nint getInt(String dataId, int defaultValue, long timeoutMills);\nlong getLong(String dataId, long defaultValue, long timeoutMills);\n// ....\n```\n\n Seata  zk \n\n Provider \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211200155.png)\n\n provider  Configuration \n\n\n\n Seata \n\n```java\nConfiguration CONFIG = ConfigurationFactory.getInstance();\n```\n\n getInstance() \n\nio.seata.config.ConfigurationFactory#buildConfiguration\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211102905.png)\n\n ConfigurationFactory  registry.conf  CURRENT_FILE_INSTANCE  File  registry.conf  SPI \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211205127.png)\n\n ZookeeperConfigurationProvider \n\n```java\nEnhancedServiceLoader.load(ConfigurationProvider.class,Objects.requireNonNull(configType).name()).provide();\n```\n\nEnhancedServiceLoader  Seata SPI  `META-INF/services/` `META-INF/seata/`\n\n ZookeeperConfigurationProvider \n\n```java\n@LoadLevel(name = \"ZK\", order = 1)\n```\n\n order \n\nio.seata.common.loader.EnhancedServiceLoader#findAllExtensionClass\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211210438.png)\n\nio.seata.common.loader.EnhancedServiceLoader#loadFile\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211210347.png)\n\n\n\n Seata Seata  load \n\n```java\nObjects.requireNonNull(configType).name()\n```\n\nConfigType \n\n```java\npublic enum ConfigType {\n  File, ZK, Nacos, Apollo, Consul, Etcd3, SpringCloudConfig, Custom;\n}\n```\n\nLoadLevel  name Seata \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211211210.png)\n\n configType  LoadLevel  name \n\n\n\n# \n\nZookeeperConfiguration  AbstractConfiguration\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211202510.png)\n\n zkClient  FILE_CONFIG \n\n```java\nprivate static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n```\n\n registry.conf  Configuration \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211203735.png)\n\n\n\n\n\n# \n\n PR  review  Seata 1.0 \n\n Seata  script \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191211212141.png)\n\nconfig.txt  config.txt \n\n\n# \n\n Java [https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "/seata-nacos-docker",
          "metadata": {
            "permalink": "/blog/seata-nacos-docker",
            "source": "@site/blog/seata-nacos-docker.md",
            "title": "DockerSeataNacos",
            "description": "SeataNacosDocker",
            "date": "2019-12-03T00:00:00.000Z",
            "formattedDate": "December 3, 2019",
            "tags": [],
            "readingTime": 11.645,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "DockerSeataNacos",
              "keywords": [
                "Seata",
                "Nacos",
                ""
              ],
              "description": "SeataNacosDocker",
              "author": "FUNKYE",
              "date": "2019/12/03"
            },
            "prevItem": {
              "title": "Seata ",
              "permalink": "/blog/seata-config-center"
            },
            "nextItem": {
              "title": "SeataNacos",
              "permalink": "/blog/seata-nacos-analysis"
            }
          },
          "content": "demo[](https://gitee.com/itCjb/springboot-dubbo-mybatisplus-seata )\n\nFUNKYE(),\n\n# \n\nSeata[](http://seata.io/zh-cn/blog/springboot-dubbo-mybatisplus-seata.html)\n\nSeataNacos[](http://seata.io/zh-cn/blog/seata-nacos-analysis.html)\n\nnacosdubbo.\n\n## \n\n\t1.docker\n\n```shell\nyum -y install docker\n```\n\n\t2.nacosseata\n\n```mysql\n/******************************************/\n/*    = nacos   */\n/*    = config_info   */\n/******************************************/\nCREATE TABLE `config_info` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\n  `group_id` varchar(255) DEFAULT NULL,\n  `content` longtext NOT NULL COMMENT 'content',\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `src_user` text COMMENT 'source user',\n  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',\n  `app_name` varchar(128) DEFAULT NULL,\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '',\n  `c_desc` varchar(256) DEFAULT NULL,\n  `c_use` varchar(64) DEFAULT NULL,\n  `effect` varchar(64) DEFAULT NULL,\n  `type` varchar(64) DEFAULT NULL,\n  `c_schema` text,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';\n\n/******************************************/\n/*    = nacos_config   */\n/*    = config_info_aggr   */\n/******************************************/\nCREATE TABLE `config_info_aggr` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\n  `group_id` varchar(255) NOT NULL COMMENT 'group_id',\n  `datum_id` varchar(255) NOT NULL COMMENT 'datum_id',\n  `content` longtext NOT NULL COMMENT '',\n  `gmt_modified` datetime NOT NULL COMMENT '',\n  `app_name` varchar(128) DEFAULT NULL,\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='';\n\n\n/******************************************/\n/*    = nacos_config   */\n/*    = config_info_beta   */\n/******************************************/\nCREATE TABLE `config_info_beta` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\n  `content` longtext NOT NULL COMMENT 'content',\n  `beta_ips` varchar(1024) DEFAULT NULL COMMENT 'betaIps',\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `src_user` text COMMENT 'source user',\n  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';\n\n/******************************************/\n/*    = nacos_config   */\n/*    = config_info_tag   */\n/******************************************/\nCREATE TABLE `config_info_tag` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\n  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',\n  `tag_id` varchar(128) NOT NULL COMMENT 'tag_id',\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\n  `content` longtext NOT NULL COMMENT 'content',\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `src_user` text COMMENT 'source user',\n  `src_ip` varchar(20) DEFAULT NULL COMMENT 'source ip',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';\n\n/******************************************/\n/*    = nacos_config   */\n/*    = config_tags_relation   */\n/******************************************/\nCREATE TABLE `config_tags_relation` (\n  `id` bigint(20) NOT NULL COMMENT 'id',\n  `tag_name` varchar(128) NOT NULL COMMENT 'tag_name',\n  `tag_type` varchar(64) DEFAULT NULL COMMENT 'tag_type',\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\n  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',\n  `nid` bigint(20) NOT NULL AUTO_INCREMENT,\n  PRIMARY KEY (`nid`),\n  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),\n  KEY `idx_tenant_id` (`tenant_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';\n\n/******************************************/\n/*    = nacos_config   */\n/*    = group_capacity   */\n/******************************************/\nCREATE TABLE `group_capacity` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',\n  `group_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Group ID',\n  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '',\n  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '',\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_group_id` (`group_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='Group';\n\n/******************************************/\n/*    = nacos_config   */\n/*    = his_config_info   */\n/******************************************/\nCREATE TABLE `his_config_info` (\n  `id` bigint(64) unsigned NOT NULL,\n  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n  `data_id` varchar(255) NOT NULL,\n  `group_id` varchar(128) NOT NULL,\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\n  `content` longtext NOT NULL,\n  `md5` varchar(32) DEFAULT NULL,\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00',\n  `src_user` text,\n  `src_ip` varchar(20) DEFAULT NULL,\n  `op_type` char(10) DEFAULT NULL,\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '',\n  PRIMARY KEY (`nid`),\n  KEY `idx_gmt_create` (`gmt_create`),\n  KEY `idx_gmt_modified` (`gmt_modified`),\n  KEY `idx_did` (`data_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='';\n\n\n/******************************************/\n/*    = nacos_config   */\n/*    = tenant_capacity   */\n/******************************************/\nCREATE TABLE `tenant_capacity` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',\n  `tenant_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID',\n  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '',\n  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '',\n  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '0',\n  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '',\n  `gmt_create` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  `gmt_modified` datetime NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_tenant_id` (`tenant_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='';\n\n\nCREATE TABLE `tenant_info` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\n  `kp` varchar(128) NOT NULL COMMENT 'kp',\n  `tenant_id` varchar(128) default '' COMMENT 'tenant_id',\n  `tenant_name` varchar(128) default '' COMMENT 'tenant_name',\n  `tenant_desc` varchar(256) DEFAULT NULL COMMENT 'tenant_desc',\n  `create_source` varchar(32) DEFAULT NULL COMMENT 'create_source',\n  `gmt_create` bigint(20) NOT NULL COMMENT '',\n  `gmt_modified` bigint(20) NOT NULL COMMENT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),\n  KEY `idx_tenant_id` (`tenant_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';\n\nCREATE TABLE users (\n\tusername varchar(50) NOT NULL PRIMARY KEY,\n\tpassword varchar(500) NOT NULL,\n\tenabled boolean NOT NULL\n);\n\nCREATE TABLE roles (\n\tusername varchar(50) NOT NULL,\n\trole varchar(50) NOT NULL\n);\n\nINSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);\n\nINSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN');\n\n```\n\n```mysql\n-- the table to store GlobalSession data\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n\n-- the table to store BranchSession data\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n\n-- the table to store lock data\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(128),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_branch_id` (`branch_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n\n```\n\n\t3.nacosseata\n\n```shell\ndocker run -d --name nacos -p 8848:8848 -e MODE=standalone -e MYSQL_MASTER_SERVICE_HOST=mysqlip -e MYSQL_MASTER_SERVICE_DB_NAME=nacos -e MYSQL_MASTER_SERVICE_USER=root -e MYSQL_MASTER_SERVICE_PASSWORD=mysql -e MYSQL_SLAVE_SERVICE_HOST=mysqlip -e SPRING_DATASOURCE_PLATFORM=mysql -e MYSQL_DATABASE_NUM=1 nacos/nacos-server:latest\n```\n\n```shell\ndocker run -d --name seata -p 8091:8091 -e SEATA_IP=ip -e SEATA_PORT=8091 seataio/seata-server:1.4.2\n```\n\n## Seata\n\n\t1.seatavim,cp,cp\n\n```\ndocker cp id:seata-server/resources \n```\n\n\t2.ip\n\n```\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' ID/NAMES\n```\n\n\t3.nacos-config.txt\n\n```\ntransport.type=TCP\ntransport.server=NIO\ntransport.heartbeat=true\ntransport.enableClientBatchSendRequest=false\ntransport.threadFactory.bossThreadPrefix=NettyBoss\ntransport.threadFactory.workerThreadPrefix=NettyServerNIOWorker\ntransport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler\ntransport.threadFactory.shareBossWorker=false\ntransport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector\ntransport.threadFactory.clientSelectorThreadSize=1\ntransport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread\ntransport.threadFactory.bossThreadSize=1\ntransport.threadFactory.workerThreadSize=default\ntransport.shutdown.wait=3\nservice.vgroupMapping.=default\nservice.default.grouplist=127.0.0.1:8091\nservice.enableDegrade=false\nservice.disableGlobalTransaction=false\nclient.rm.asyncCommitBufferLimit=10000\nclient.rm.lock.retryInterval=10\nclient.rm.lock.retryTimes=30\nclient.rm.lock.retryPolicyBranchRollbackOnConflict=true\nclient.rm.reportRetryCount=5\nclient.rm.tableMetaCheckEnable=false\nclient.rm.tableMetaCheckerInterval=60000\nclient.rm.sqlParserType=druid\nclient.rm.reportSuccessEnable=false\nclient.rm.sagaBranchRegisterEnable=false\nclient.tm.commitRetryCount=5\nclient.tm.rollbackRetryCount=5\nclient.tm.defaultGlobalTransactionTimeout=60000\nclient.tm.degradeCheck=false\nclient.tm.degradeCheckAllowTimes=10\nclient.tm.degradeCheckPeriod=2000\nstore.mode=file\nstore.publicKey=\nstore.file.dir=file_store/data\nstore.file.maxBranchSessionSize=16384\nstore.file.maxGlobalSessionSize=512\nstore.file.fileWriteBufferCacheSize=16384\nstore.file.flushDiskMode=async\nstore.file.sessionReloadReadSize=100\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://mysqlip:3306/seata?useUnicode=true&rewriteBatchedStatements=true\nstore.db.user=mysql\nstore.db.password=mysql\nstore.db.minConn=5\nstore.db.maxConn=30\nstore.db.globalTable=global_table\nstore.db.branchTable=branch_table\nstore.db.queryLimit=100\nstore.db.lockTable=lock_table\nstore.db.maxWait=5000\nserver.recovery.committingRetryPeriod=1000\nserver.recovery.asynCommittingRetryPeriod=1000\nserver.recovery.rollbackingRetryPeriod=1000\nserver.recovery.timeoutRetryPeriod=1000\nserver.maxCommitRetryTimeout=-1\nserver.maxRollbackRetryTimeout=-1\nserver.rollbackRetryTimeoutUnlockEnable=false\nclient.undo.dataValidation=true\nclient.undo.logSerialization=jackson\nclient.undo.onlyCareUpdateColumns=true\nserver.undo.logSaveDays=7\nserver.undo.logDeletePeriod=86400000\nclient.undo.logTable=undo_log\nclient.undo.compress.enable=true\nclient.undo.compress.type=zip\nclient.undo.compress.threshold=64k\nlog.exceptionRate=100\ntransport.serialization=seata\ntransport.compressor=none\nmetrics.enabled=false\nmetrics.registryType=compact\nmetrics.exporterList=prometheus\nmetrics.exporterPrometheusPort=9898\n```\n\n[](http://seata.io/zh-cn/docs/user/configurations.html)\n\n\t4.registry.conf\n\n```\nregistry {\n  # file nacos eurekarediszkconsuletcd3sofa\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"nacosip:8848\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n}\n\nconfig {\n  # filenacos apollozkconsuletcd3\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"nacosip:8848\"\n    namespace = \"\"\n  }\n}\n```\n\n\t5.,registry.conf,\n\n```shell\ndocker cp /home/seata/resources/registry.conf seata:seata-server/resources/\ndocker restart seata\ndocker logs -f seata\n```\n\n\t6.nacos-config.shNacos\n\neg: sh ${SEATAPATH}/script/config-center/nacos/nacos-config.sh -h localhost -p 8848 -g SEATA_GROUP -t 5a3c7d6c-f497-4d68-a71a-2e5e3340b3ca -u username -w password\n\n[](https://github.com/seata/seata/blob/1.4.2/script/config-center/README.md)\n\n\n\t7.nacos\n\n![20191202205912](/img/blog/20191202205912.png)\n\n\t.\n\n# \n\n\t1.,test-serviceapplication.ymlregistry.conf\n\n```\nregistry {\n  type = \"nacos\"\n  nacos {\n    serverAddr = \"ip:8848\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n}\nconfig {\n  type = \"nacos\"\n  nacos {\n    serverAddr = \"ip:8848\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n}\n\n```\n\n```\nserver:\n  port: 38888\nspring:\n  application: \n      name: test-service\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource\n    url: jdbc:mysql://mysqlip:3306/test?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    username: root\n    password: 123456\ndubbo:\n  protocol:\n    threadpool: cached\n  scan:\n    base-packages: com.example\n  application:\n    qos-enable: false\n    name: testserver\n  registry:\n    id: my-registry\n    address:  nacos://ip:8848\nmybatis-plus:\n  mapper-locations: classpath:/mapper/*Mapper.xml\n  typeAliasesPackage: org.test.entity\n  global-config:\n    db-config:\n      field-strategy: not-empty\n      id-type: auto\n      db-type: mysql\n  configuration:\n    map-underscore-to-camel-case: true\n    cache-enabled: true\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n    auto-mapping-unknown-column-behavior: none\n```\n\n\t2.registry.conftest-client-resources,application\n\n```\nspring:\n  application:\n     name: test\n  datasource:\n     driver-class-name: com.mysql.cj.jdbc.Driver\n     url: jdbc:mysql://mysqlIp:3306/test?userSSL=true&useUnicode=true&characterEncoding=UTF8&serverTimezone=Asia/Shanghai\n     username: root\n     password: 123456\n  mvc:\n    servlet:\n      load-on-startup: 1\n  http:\n    encoding:\n            force: true\n            charset: utf-8\n            enabled: true\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\ndubbo:\n  registry:\n    id: my-registry\n    address:  nacos://ip:8848\n  application:\n    name: dubbo-demo-client\n    qos-enable: false\nserver:\n  port: 28888\n  max-http-header-size: 8192\n  address: 0.0.0.0\n  tomcat:\n    max-http-post-size: 104857600\n```\n\t4.  db  undo_log .\n```sql\nCREATE TABLE IF NOT EXISTS `undo_log`\n(\n    `branch_id`     BIGINT       NOT NULL COMMENT 'branch transaction id',\n    `xid`           VARCHAR(128) NOT NULL COMMENT 'global transaction id',\n    `context`       VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization',\n    `rollback_info` LONGBLOB     NOT NULL COMMENT 'rollback info',\n    `log_status`    INT(11)      NOT NULL COMMENT '0:normal status,1:defense status',\n    `log_created`   DATETIME(6)  NOT NULL COMMENT 'create datetime',\n    `log_modified`  DATETIME(6)  NOT NULL COMMENT 'modify datetime',\n    UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`)\n) ENGINE = InnoDB\n  AUTO_INCREMENT = 1\n  DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table';\n```\n\n\t5.test-service,test-client.\n\n\t6.nacos\n\n![20191203132351](/img/blog/20191203132351.png)\n\n# \n\nnacosseatadocker,\n\n[nacos](https://nacos.io/zh-cn/index.html)\n\n[dubbo](http://dubbo.apache.org/en-us/)\n\n[seata](http://seata.io/zh-cn/)\n\n[docker](https://www.docker.com/)"
        },
        {
          "id": "/seata-nacos-analysis",
          "metadata": {
            "permalink": "/blog/seata-nacos-analysis",
            "source": "@site/blog/seata-nacos-analysis.md",
            "title": "SeataNacos",
            "description": "SeataNacos",
            "date": "2019-12-02T00:00:00.000Z",
            "formattedDate": "December 2, 2019",
            "tags": [],
            "readingTime": 6.475,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "SeataNacos",
              "keywords": [
                "Seata",
                "Nacos",
                ""
              ],
              "description": "SeataNacos",
              "author": "FUNKYE",
              "date": "2019/12/02"
            },
            "prevItem": {
              "title": "DockerSeataNacos",
              "permalink": "/blog/seata-nacos-docker"
            },
            "nextItem": {
              "title": "SeataATMybatis-PlusMP",
              "permalink": "/blog/seata-mybatisplus-analysis"
            }
          },
          "content": "[](https://gitee.com/itCjb/springboot-dubbo-mybatisplus-seata )\n\nFUNKYE(),\n\n# \n\nseata,[](http://seata.io/zh-cn/blog/springboot-dubbo-mybatisplus-seata.html)\n\nnacosdubbo.\n\n## \n\n\t1.nacosgithub[](https://github.com/alibaba/nacos/releases/tag/1.1.4)\n\n\t![](/img/blog/20191202203649.png)\n\n\t2.,,bin,\n\n![](/img/blog/20191202203943.png)\n\n\t3.:http://127.0.0.1:8848/nacos/#/login\n\n![](/img/blog/20191202204101.png)\n\n?nacos(),.\n\n\n\n![20191202204147](/img/blog/20191202204147.png)\n\nseata.\n\n## Seata\n\n\t1.seataconf?\n\n![](/img/blog/20191202204259.png)\n\n,:\n\n![20191202204353](/img/blog/20191202204353.png)\n\n![20191202204437](/img/blog/20191202204437.png)\n\n\t2.!registry.conf\n\n```\nregistry {\n  # file nacos eurekarediszkconsuletcd3sofa\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"localhost\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n  eureka {\n    serviceUrl = \"http://localhost:8761/eureka\"\n    application = \"default\"\n    weight = \"1\"\n  }\n  redis {\n    serverAddr = \"localhost:6379\"\n    db = \"0\"\n  }\n  zk {\n    cluster = \"default\"\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  consul {\n    cluster = \"default\"\n    serverAddr = \"127.0.0.1:8500\"\n  }\n  etcd3 {\n    cluster = \"default\"\n    serverAddr = \"http://localhost:2379\"\n  }\n  sofa {\n    serverAddr = \"127.0.0.1:9603\"\n    application = \"default\"\n    region = \"DEFAULT_ZONE\"\n    datacenter = \"DefaultDataCenter\"\n    cluster = \"default\"\n    group = \"SEATA_GROUP\"\n    addressWaitTime = \"3000\"\n  }\n  file {\n    name = \"file.conf\"\n  }\n}\n\nconfig {\n  # filenacos apollozkconsuletcd3\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"localhost\"\n    namespace = \"\"\n  }\n  consul {\n    serverAddr = \"127.0.0.1:8500\"\n  }\n  apollo {\n    app.id = \"seata-server\"\n    apollo.meta = \"http://192.168.1.204:8801\"\n  }\n  zk {\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  etcd3 {\n    serverAddr = \"http://localhost:2379\"\n  }\n  file {\n    name = \"file.conf\"\n  }\n}\n\n```\n\nnacos-config.sh,nacos-config.txtnacos\n\n![20191202205743](/img/blog/20191202205743.png)\n\nnacos\n\n![20191202205912](/img/blog/20191202205912.png)\n\n,,gitsh,sh, \n\n```shell\nfor line in $(cat nacos-config.txt)\n\ndo\n\nkey=${line%%=*}\nvalue=${line#*=}\necho \"\\r\\n set \"${key}\" = \"${value}\n\nresult=`curl -X POST \"http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=$key&group=SEATA_GROUP&content=$value\"`\n\nif [ \"$result\"x == \"true\"x ]; then\n\n  echo \"\\033[42;37m $result \\033[0m\"\n\nelse\n\n  echo \"\\033[41;37 $result \\033[0m\"\n  let error++\n\nfi\n\ndone\n\n\nif [ $error -eq 0 ]; then\n\necho  \"\\r\\n\\033[42;37m init nacos config finished, please start seata-server. \\033[0m\"\n\nelse\n\necho  \"\\r\\n\\033[41;33m init nacos config fail. \\033[0m\"\n\nfi\n```\n\n\t3.,seata-service/binseata,!\n\n![20191202210112](/img/blog/20191202210112.png)\n\n# \n\n\t1.springboot-dubbo-mybatsiplus-seatapom,zk,nacos.\n\n```java\n\t<properties>\n\t\t<webVersion>3.1</webVersion>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n\t\t<maven.compiler.source>1.8</maven.compiler.source>\n\t\t<maven.compiler.target>1.8</maven.compiler.target>\n\t\t<HikariCP.version>3.2.0</HikariCP.version>\n\t\t<mybatis-plus-boot-starter.version>3.2.0</mybatis-plus-boot-starter.version>\n\t</properties>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>2.1.8.RELEASE</version>\n\t</parent>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>com.alibaba.nacos</groupId>\n\t\t\t<artifactId>nacos-client</artifactId>\n\t\t\t<version>1.1.4</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.dubbo</groupId>\n\t\t\t<artifactId>dubbo-registry-nacos</artifactId>\n\t\t\t<version>2.7.4.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.dubbo</groupId>\n\t\t\t<artifactId>dubbo-spring-boot-starter</artifactId>\n\t\t\t<version>2.7.4.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.commons</groupId>\n\t\t\t<artifactId>commons-lang3</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.alibaba</groupId>\n\t\t\t<artifactId>fastjson</artifactId>\n\t\t\t<version>1.2.60</version>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>javax</groupId> <artifactId>javaee-api</artifactId> \n\t\t\t<version>7.0</version> <scope>provided</scope> </dependency> -->\n\t\t<dependency>\n\t\t\t<groupId>io.springfox</groupId>\n\t\t\t<artifactId>springfox-swagger2</artifactId>\n\t\t\t<version>2.9.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>io.springfox</groupId>\n\t\t\t<artifactId>springfox-swagger-ui</artifactId>\n\t\t\t<version>2.9.2</version>\n\t\t</dependency>\n \n\t\t<!-- mybatis-plus begin -->\n\t\t<dependency>\n\t\t\t<groupId>com.baomidou</groupId>\n\t\t\t<artifactId>mybatis-plus-boot-starter</artifactId>\n\t\t\t<version>${mybatis-plus-boot-starter.version}</version>\n\t\t</dependency>\n\t\t<!-- mybatis-plus end -->\n\t\t<!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->\n\t\t<dependency>\n\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t<artifactId>lombok</artifactId>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>io.seata</groupId>\n\t\t\t<artifactId>seata-all</artifactId>\n\t\t\t<version>0.9.0.1</version>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>com.baomidou</groupId> <artifactId>dynamic-datasource-spring-boot-starter</artifactId> \n\t\t\t<version>2.5.4</version> </dependency> -->\n \n\t\t<!-- <dependency> <groupId>com.baomidou</groupId> <artifactId>mybatis-plus-generator</artifactId> \n\t\t\t<version>3.1.0</version> </dependency> -->\n\t\t<!-- https://mvnrepository.com/artifact/org.freemarker/freemarker -->\n\t\t<dependency>\n\t\t\t<groupId>org.freemarker</groupId>\n\t\t\t<artifactId>freemarker</artifactId>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter -->\n\t\t<dependency>\n\t\t\t<groupId>com.alibaba</groupId>\n\t\t\t<artifactId>druid-spring-boot-starter</artifactId>\n\t\t\t<version>1.1.20</version>\n\t\t</dependency>\n\t\t<!-- log4j2.yml -->\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.dataformat</groupId>\n\t\t\t<artifactId>jackson-dataformat-yaml</artifactId>\n\t\t</dependency>\n\t\t<dependency> <!-- log4j2 -->\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-log4j2</artifactId>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-web</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-aop</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>org.scala-lang</groupId> <artifactId>scala-library</artifactId> \n\t\t\t<version>2.11.0</version> </dependency> -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-configuration-processor</artifactId>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t</dependencies>\n\n```\n\n\t2.test-service,zkapplication.yml,:\n\n```yaml\nserver:\n  port: 38888\nspring:\n  application: \n      name: test-service\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource\n    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    username: root\n    password: 123456\ndubbo:\n  protocol:\n    loadbalance: leastactive\n    threadpool: cached\n  scan:\n    base-packages: orgtest.service\n  application:\n    qos-enable: false\n    name: testserver\n  registry:\n    id: my-registry\n    address:  nacos://127.0.0.1:8848\nmybatis-plus:\n  mapper-locations: classpath:/mapper/*Mapper.xml\n  typeAliasesPackage: org.test.entity\n  global-config:\n    db-config:\n      field-strategy: not-empty\n      id-type: auto\n      db-type: mysql\n  configuration:\n    map-underscore-to-camel-case: true\n    cache-enabled: true      \n    auto-mapping-unknown-column-behavior: none\n```\n\n<img src=\"/img/blog/20191202211833.png\" alt=\"20191202211833\"  style={{ zoom:'100%' }} />\n\n\t3.registry.conf,nacos,ip\n\n```java\nregistry {\n  type = \"nacos\"\n  file {\n    name = \"file.conf\"\n  }\n   zk {\n    cluster = \"default\"\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n    nacos {\n    serverAddr = \"localhost\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n}\nconfig {\n  type = \"nacos\"\n  file {\n    name = \"file.conf\"\n  }\n  zk {\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n    nacos {\n    serverAddr = \"localhost\"\n    namespace = \"\"\n    cluster = \"default\"\n  }\n}\n```\n\n\t4.provideApplication\n\n![20191202212000](/img/blog/20191202212000.png)\n\n,seata:\n\n![20191202212028](/img/blog/20191202212028.png)\n\n,,test-client,application.yml,zknacos,,test-serviceregistry.conf,clientresourcesregistry.conf.\n\nclientApplication:\n\n![20191202212114](/img/blog/20191202212114.png)\n\n\t5.\n\n![20191202212203](/img/blog/20191202212203.png)\n\n,.swagger,http://127.0.0.1:28888/swagger-ui.html\n\n![20191202212240](/img/blog/20191202212240.png)\n\n,! \n\n# \n\nnacosseata,\n\n[nacos](https://nacos.io/zh-cn/index.html)\n\n[dubbo](http://dubbo.apache.org/en-us/)\n\n[seata](http://seata.io/zh-cn/)"
        },
        {
          "id": "/seata-mybatisplus-analysis",
          "metadata": {
            "permalink": "/blog/seata-mybatisplus-analysis",
            "source": "@site/blog/seata-mybatisplus-analysis.md",
            "title": "SeataATMybatis-PlusMP",
            "description": "SeataMybatis-PlusMP",
            "date": "2019-11-30T00:00:00.000Z",
            "formattedDate": "November 30, 2019",
            "tags": [],
            "readingTime": 10.225,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "SeataATMybatis-PlusMP",
              "keywords": [
                "Seata",
                "Mybatis-Plus",
                ""
              ],
              "description": "SeataMybatis-PlusMP",
              "author": "FUNKYE",
              "date": "2019/11/30"
            },
            "prevItem": {
              "title": "SeataNacos",
              "permalink": "/blog/seata-nacos-analysis"
            },
            "nextItem": {
              "title": "SpringBoot+Dubbo+MybatisPlusseata",
              "permalink": "/blog/springboot-dubbo-mybatisplus-seata"
            }
          },
          "content": "https://gitee.com/itCjb/springboot-dubbo-mybatisplus-seata \n\nFUNKYE(),\n\n# \n\nMybatis-Plus[MyBatis-Plus](https://github.com/baomidou/mybatis-plus) MP [MyBatis](http://www.mybatis.org/mybatis-3/)  MyBatis \n\nMP\n\n```xml\n<bean id=\"sqlSessionFactory\" class=\"com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean\">\n    <property name=\"dataSource\" ref=\"dataSource\"/>\n</bean>\n```\n\nSeataSeata Seata  ATTCCSAGA  XA \n\nAT\n\n- \n- \n  - \n  - \n\n## \n\n\t1.mpsqlSessionFactorySeata\n\n\t2.seatademoSeataAutoConfig\n\n```java\npackage org.test.config;\n \nimport javax.sql.DataSource; \n \nimport org.apache.ibatis.session.SqlSessionFactory;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n \nimport com.alibaba.druid.pool.DruidDataSource;\nimport com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;\n \nimport io.seata.rm.datasource.DataSourceProxy;\nimport io.seata.spring.annotation.GlobalTransactionScanner;\n \n@Configuration\npublic class SeataAutoConfig {\n\t@Autowired(required = true)\n\tprivate DataSourceProperties dataSourceProperties;\n\tprivate final static Logger logger = LoggerFactory.getLogger(SeataAutoConfig.class);\n \n\t@Bean(name = \"dataSource\") // Bean\n\t@Primary // DataSourceDataSource\n\tpublic DataSource druidDataSource() {\n\t\tDruidDataSource druidDataSource = new DruidDataSource();\n\t\tlogger.info(\"dataSourceProperties.getUrl():{}\",dataSourceProperties.getUrl());\n\t\tdruidDataSource.setUrl(dataSourceProperties.getUrl());\n\t\tdruidDataSource.setUsername(dataSourceProperties.getUsername());\n\t\tdruidDataSource.setPassword(dataSourceProperties.getPassword());\n\t\tdruidDataSource.setDriverClassName(dataSourceProperties.getDriverClassName());\n\t\tdruidDataSource.setInitialSize(0);\n\t\tdruidDataSource.setMaxActive(180);\n\t\tdruidDataSource.setMaxWait(60000);\n\t\tdruidDataSource.setMinIdle(0);\n\t\tdruidDataSource.setValidationQuery(\"Select 1 from DUAL\");\n\t\tdruidDataSource.setTestOnBorrow(false);\n\t\tdruidDataSource.setTestOnReturn(false);\n\t\tdruidDataSource.setTestWhileIdle(true);\n\t\tdruidDataSource.setTimeBetweenEvictionRunsMillis(60000);\n\t\tdruidDataSource.setMinEvictableIdleTimeMillis(25200000);\n\t\tdruidDataSource.setRemoveAbandoned(true);\n\t\tdruidDataSource.setRemoveAbandonedTimeout(1800);\n\t\tdruidDataSource.setLogAbandoned(true);\n\t\tlogger.info(\"dataSource........\");\n\t\treturn druidDataSource;\n\t}\n \n\t/**\n\t * init datasource proxy\n\t * \n\t * @Param: druidDataSource datasource bean instance\n\t * @Return: DataSourceProxy datasource proxy\n\t */\n\t@Bean\n\tpublic DataSourceProxy dataSourceProxy(DataSource dataSource) {\n\t\tlogger.info(\"dataSource........\");\n\t\treturn new DataSourceProxy(dataSource);\n\t}\n \n\t@Bean\n\tpublic SqlSessionFactory sqlSessionFactory(DataSourceProxy dataSourceProxy) throws Exception {\n\t\tMybatisSqlSessionFactoryBean factory = new MybatisSqlSessionFactoryBean();\n\t\tfactory.setDataSource(dataSourceProxy);\n        factory.setMapperLocations(new PathMatchingResourcePatternResolver()\n            .getResources(\"classpath*:/mapper/*.xml\"));\n\t\treturn factory.getObject();\n\t}\n \n\t/**\n\t * init global transaction scanner\n\t *\n\t * @Return: GlobalTransactionScanner\n\t */\n\t@Bean\n\tpublic GlobalTransactionScanner globalTransactionScanner() {\n\t\tlogger.info(\"seata........\");\n\t\treturn new GlobalTransactionScanner(\"test-service\", \"test-group\");\n\t}\n}\n\n```\n\nseata,,seatadatasourcebean,.\n\nmpseata,,mapper,?\n\n,sqlSessionFactory,mpsqlSessionFactory,sqlSessionFactorylmpseata.?\n\nmp,,\n\n```java\n/*\n * Copyright (c) 2011-2020, baomidou (jobob@qq.com).\n * <p>\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy of\n * the License at\n * <p>\n * https://www.apache.org/licenses/LICENSE-2.0\n * <p>\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations under\n * the License.\n */\npackage com.baomidou.mybatisplus.autoconfigure;\n \n \nimport com.baomidou.mybatisplus.core.MybatisConfiguration;\nimport com.baomidou.mybatisplus.core.config.GlobalConfig;\nimport com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;\nimport com.baomidou.mybatisplus.core.incrementer.IKeyGenerator;\nimport com.baomidou.mybatisplus.core.injector.ISqlInjector;\nimport com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.mapping.DatabaseIdProvider;\nimport org.apache.ibatis.plugin.Interceptor;\nimport org.apache.ibatis.scripting.LanguageDriver;\nimport org.apache.ibatis.session.ExecutorType;\nimport org.apache.ibatis.session.SqlSessionFactory;\nimport org.apache.ibatis.type.TypeHandler;\nimport org.mybatis.spring.SqlSessionFactoryBean;\nimport org.mybatis.spring.SqlSessionTemplate;\nimport org.mybatis.spring.mapper.MapperFactoryBean;\nimport org.mybatis.spring.mapper.MapperScannerConfigurer;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.BeanWrapper;\nimport org.springframework.beans.BeanWrapperImpl;\nimport org.springframework.beans.factory.BeanFactory;\nimport org.springframework.beans.factory.BeanFactoryAware;\nimport org.springframework.beans.factory.InitializingBean;\nimport org.springframework.beans.factory.ObjectProvider;\nimport org.springframework.beans.factory.support.BeanDefinitionBuilder;\nimport org.springframework.beans.factory.support.BeanDefinitionRegistry;\nimport org.springframework.boot.autoconfigure.AutoConfigurationPackages;\nimport org.springframework.boot.autoconfigure.AutoConfigureAfter;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnSingleCandidate;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.context.annotation.ImportBeanDefinitionRegistrar;\nimport org.springframework.core.io.Resource;\nimport org.springframework.core.io.ResourceLoader;\nimport org.springframework.core.type.AnnotationMetadata;\nimport org.springframework.util.Assert;\nimport org.springframework.util.CollectionUtils;\nimport org.springframework.util.ObjectUtils;\nimport org.springframework.util.StringUtils;\n \nimport javax.sql.DataSource;\nimport java.util.List;\nimport java.util.Optional;\nimport java.util.stream.Stream;\n \n/**\n * {@link EnableAutoConfiguration Auto-Configuration} for Mybatis. Contributes a\n * {@link SqlSessionFactory} and a {@link SqlSessionTemplate}.\n * <p>\n * If {@link org.mybatis.spring.annotation.MapperScan} is used, or a\n * configuration file is specified as a property, those will be considered,\n * otherwise this auto-configuration will attempt to register mappers based on\n * the interface definitions in or under the root auto-configuration package.\n * </p>\n * <p> copy from {@link org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration}</p>\n *\n * @author Edd Melndez\n * @author Josh Long\n * @author Kazuki Shimizu\n * @author Eduardo Macarrn\n */\n@Configuration\n@ConditionalOnClass({SqlSessionFactory.class, SqlSessionFactoryBean.class})\n@ConditionalOnSingleCandidate(DataSource.class)\n@EnableConfigurationProperties(MybatisPlusProperties.class)\n@AutoConfigureAfter(DataSourceAutoConfiguration.class)\npublic class MybatisPlusAutoConfiguration implements InitializingBean {\n \n    private static final Logger logger = LoggerFactory.getLogger(MybatisPlusAutoConfiguration.class);\n \n    private final MybatisPlusProperties properties;\n \n    private final Interceptor[] interceptors;\n \n    private final TypeHandler[] typeHandlers;\n \n    private final LanguageDriver[] languageDrivers;\n \n    private final ResourceLoader resourceLoader;\n \n    private final DatabaseIdProvider databaseIdProvider;\n \n    private final List<ConfigurationCustomizer> configurationCustomizers;\n \n    private final List<MybatisPlusPropertiesCustomizer> mybatisPlusPropertiesCustomizers;\n \n    private final ApplicationContext applicationContext;\n \n \n    public MybatisPlusAutoConfiguration(MybatisPlusProperties properties,\n                                        ObjectProvider<Interceptor[]> interceptorsProvider,\n                                        ObjectProvider<TypeHandler[]> typeHandlersProvider,\n                                        ObjectProvider<LanguageDriver[]> languageDriversProvider,\n                                        ResourceLoader resourceLoader,\n                                        ObjectProvider<DatabaseIdProvider> databaseIdProvider,\n                                        ObjectProvider<List<ConfigurationCustomizer>> configurationCustomizersProvider,\n                                        ObjectProvider<List<MybatisPlusPropertiesCustomizer>> mybatisPlusPropertiesCustomizerProvider,\n                                        ApplicationContext applicationContext) {\n        this.properties = properties;\n        this.interceptors = interceptorsProvider.getIfAvailable();\n        this.typeHandlers = typeHandlersProvider.getIfAvailable();\n        this.languageDrivers = languageDriversProvider.getIfAvailable();\n        this.resourceLoader = resourceLoader;\n        this.databaseIdProvider = databaseIdProvider.getIfAvailable();\n        this.configurationCustomizers = configurationCustomizersProvider.getIfAvailable();\n        this.mybatisPlusPropertiesCustomizers = mybatisPlusPropertiesCustomizerProvider.getIfAvailable();\n        this.applicationContext = applicationContext;\n    }\n \n    @Override\n    public void afterPropertiesSet() {\n        if (!CollectionUtils.isEmpty(mybatisPlusPropertiesCustomizers)) {\n            mybatisPlusPropertiesCustomizers.forEach(i -> i.customize(properties));\n        }\n        checkConfigFileExists();\n    }\n \n    private void checkConfigFileExists() {\n        if (this.properties.isCheckConfigLocation() && StringUtils.hasText(this.properties.getConfigLocation())) {\n            Resource resource = this.resourceLoader.getResource(this.properties.getConfigLocation());\n            Assert.state(resource.exists(),\n                \"Cannot find config location: \" + resource + \" (please add config file or check your Mybatis configuration)\");\n        }\n    }\n \n    @SuppressWarnings(\"SpringJavaInjectionPointsAutowiringInspection\")\n    @Bean\n    @ConditionalOnMissingBean\n    public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {\n        // TODO  MybatisSqlSessionFactoryBean  SqlSessionFactoryBean\n        MybatisSqlSessionFactoryBean factory = new MybatisSqlSessionFactoryBean();\n        factory.setDataSource(dataSource);\n        factory.setVfs(SpringBootVFS.class);\n        if (StringUtils.hasText(this.properties.getConfigLocation())) {\n            factory.setConfigLocation(this.resourceLoader.getResource(this.properties.getConfigLocation()));\n        }\n        applyConfiguration(factory);\n        if (this.properties.getConfigurationProperties() != null) {\n            factory.setConfigurationProperties(this.properties.getConfigurationProperties());\n        }\n        if (!ObjectUtils.isEmpty(this.interceptors)) {\n            factory.setPlugins(this.interceptors);\n        }\n        if (this.databaseIdProvider != null) {\n            factory.setDatabaseIdProvider(this.databaseIdProvider);\n        }\n        if (StringUtils.hasLength(this.properties.getTypeAliasesPackage())) {\n            factory.setTypeAliasesPackage(this.properties.getTypeAliasesPackage());\n        }\n        if (this.properties.getTypeAliasesSuperType() != null) {\n            factory.setTypeAliasesSuperType(this.properties.getTypeAliasesSuperType());\n        }\n        if (StringUtils.hasLength(this.properties.getTypeHandlersPackage())) {\n            factory.setTypeHandlersPackage(this.properties.getTypeHandlersPackage());\n        }\n        if (!ObjectUtils.isEmpty(this.typeHandlers)) {\n            factory.setTypeHandlers(this.typeHandlers);\n        }\n        if (!ObjectUtils.isEmpty(this.properties.resolveMapperLocations())) {\n            factory.setMapperLocations(this.properties.resolveMapperLocations());\n        }\n \n        // TODO (mybatis,)\n        Class<? extends LanguageDriver> defaultLanguageDriver = this.properties.getDefaultScriptingLanguageDriver();\n        if (!ObjectUtils.isEmpty(this.languageDrivers)) {\n            factory.setScriptingLanguageDrivers(this.languageDrivers);\n        }\n        Optional.ofNullable(defaultLanguageDriver).ifPresent(factory::setDefaultScriptingLanguageDriver);\n \n        // TODO \n        if (StringUtils.hasLength(this.properties.getTypeEnumsPackage())) {\n            factory.setTypeEnumsPackage(this.properties.getTypeEnumsPackage());\n        }\n        // TODO  NULL\n        GlobalConfig globalConfig = this.properties.getGlobalConfig();\n        // TODO \n        if (this.applicationContext.getBeanNamesForType(MetaObjectHandler.class,\n            false, false).length > 0) {\n            MetaObjectHandler metaObjectHandler = this.applicationContext.getBean(MetaObjectHandler.class);\n            globalConfig.setMetaObjectHandler(metaObjectHandler);\n        }\n        // TODO \n        if (this.applicationContext.getBeanNamesForType(IKeyGenerator.class, false,\n            false).length > 0) {\n            IKeyGenerator keyGenerator = this.applicationContext.getBean(IKeyGenerator.class);\n            globalConfig.getDbConfig().setKeyGenerator(keyGenerator);\n        }\n        // TODO sql\n        if (this.applicationContext.getBeanNamesForType(ISqlInjector.class, false,\n            false).length > 0) {\n            ISqlInjector iSqlInjector = this.applicationContext.getBean(ISqlInjector.class);\n            globalConfig.setSqlInjector(iSqlInjector);\n        }\n        // TODO  GlobalConfig  MybatisSqlSessionFactoryBean\n        factory.setGlobalConfig(globalConfig);\n        return factory.getObject();\n    }\n \n    // TODO  MybatisSqlSessionFactoryBean\n    private void applyConfiguration(MybatisSqlSessionFactoryBean factory) {\n        // TODO  MybatisConfiguration\n        MybatisConfiguration configuration = this.properties.getConfiguration();\n        if (configuration == null && !StringUtils.hasText(this.properties.getConfigLocation())) {\n            configuration = new MybatisConfiguration();\n        }\n        if (configuration != null && !CollectionUtils.isEmpty(this.configurationCustomizers)) {\n            for (ConfigurationCustomizer customizer : this.configurationCustomizers) {\n                customizer.customize(configuration);\n            }\n        }\n        factory.setConfiguration(configuration);\n    }\n \n    @Bean\n    @ConditionalOnMissingBean\n    public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory) {\n        ExecutorType executorType = this.properties.getExecutorType();\n        if (executorType != null) {\n            return new SqlSessionTemplate(sqlSessionFactory, executorType);\n        } else {\n            return new SqlSessionTemplate(sqlSessionFactory);\n        }\n    }\n \n    /**\n     * This will just scan the same base package as Spring Boot does. If you want more power, you can explicitly use\n     * {@link org.mybatis.spring.annotation.MapperScan} but this will get typed mappers working correctly, out-of-the-box,\n     * similar to using Spring Data JPA repositories.\n     */\n    public static class AutoConfiguredMapperScannerRegistrar implements BeanFactoryAware, ImportBeanDefinitionRegistrar {\n \n        private BeanFactory beanFactory;\n \n        @Override\n        public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n \n            if (!AutoConfigurationPackages.has(this.beanFactory)) {\n                logger.debug(\"Could not determine auto-configuration package, automatic mapper scanning disabled.\");\n                return;\n            }\n \n            logger.debug(\"Searching for mappers annotated with @Mapper\");\n \n            List<String> packages = AutoConfigurationPackages.get(this.beanFactory);\n            if (logger.isDebugEnabled()) {\n                packages.forEach(pkg -> logger.debug(\"Using auto-configuration base package '{}'\", pkg));\n            }\n \n            BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);\n            builder.addPropertyValue(\"processPropertyPlaceHolders\", true);\n            builder.addPropertyValue(\"annotationClass\", Mapper.class);\n            builder.addPropertyValue(\"basePackage\", StringUtils.collectionToCommaDelimitedString(packages));\n            BeanWrapper beanWrapper = new BeanWrapperImpl(MapperScannerConfigurer.class);\n            Stream.of(beanWrapper.getPropertyDescriptors())\n                // Need to mybatis-spring 2.0.2+\n                .filter(x -> x.getName().equals(\"lazyInitialization\")).findAny()\n                .ifPresent(x -> builder.addPropertyValue(\"lazyInitialization\", \"${mybatis.lazy-initialization:false}\"));\n            registry.registerBeanDefinition(MapperScannerConfigurer.class.getName(), builder.getBeanDefinition());\n        }\n \n        @Override\n        public void setBeanFactory(BeanFactory beanFactory) {\n            this.beanFactory = beanFactory;\n        }\n    }\n \n    /**\n     * If mapper registering configuration or mapper scanning configuration not present, this configuration allow to scan\n     * mappers based on the same component-scanning path as Spring Boot itself.\n     */\n    @Configuration\n    @Import(AutoConfiguredMapperScannerRegistrar.class)\n    @ConditionalOnMissingBean({MapperFactoryBean.class, MapperScannerConfigurer.class})\n    public static class MapperScannerRegistrarNotFoundConfiguration implements InitializingBean {\n \n        @Override\n        public void afterPropertiesSet() {\n            logger.debug(\n                \"Not found configuration for registering mapper bean using @MapperScan, MapperFactoryBean and MapperScannerConfigurer.\");\n        }\n    }\n}\n\n```\n\nmpsqlSessionFactory,,?\n\n,mpsqlSessionFactory.\n\n,seata\n\n```java\npackage org.test.config;\n\nimport javax.sql.DataSource;\n\nimport org.mybatis.spring.annotation.MapperScan;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n\nimport com.alibaba.druid.pool.DruidDataSource;\n\nimport io.seata.rm.datasource.DataSourceProxy;\nimport io.seata.spring.annotation.GlobalTransactionScanner;\n\n@Configuration\n@MapperScan(\"com.baomidou.springboot.mapper*\")\npublic class SeataAutoConfig {\n    @Autowired(required = true)\n    private DataSourceProperties dataSourceProperties;\n    private final static Logger logger = LoggerFactory.getLogger(SeataAutoConfig.class);\n    private DataSourceProxy dataSourceProxy;\n\n    @Bean(name = \"dataSource\") // Bean\n    @Primary // DataSourceDataSource\n    public DataSource druidDataSource() {\n        DruidDataSource druidDataSource = new DruidDataSource();\n        logger.info(\"dataSourceProperties.getUrl():{}\", dataSourceProperties.getUrl());\n        druidDataSource.setUrl(dataSourceProperties.getUrl());\n        druidDataSource.setUsername(dataSourceProperties.getUsername());\n        druidDataSource.setPassword(dataSourceProperties.getPassword());\n        druidDataSource.setDriverClassName(dataSourceProperties.getDriverClassName());\n        druidDataSource.setInitialSize(0);\n        druidDataSource.setMaxActive(180);\n        druidDataSource.setMaxWait(60000);\n        druidDataSource.setMinIdle(0);\n        druidDataSource.setValidationQuery(\"Select 1 from DUAL\");\n        druidDataSource.setTestOnBorrow(false);\n        druidDataSource.setTestOnReturn(false);\n        druidDataSource.setTestWhileIdle(true);\n        druidDataSource.setTimeBetweenEvictionRunsMillis(60000);\n        druidDataSource.setMinEvictableIdleTimeMillis(25200000);\n        druidDataSource.setRemoveAbandoned(true);\n        druidDataSource.setRemoveAbandonedTimeout(1800);\n        druidDataSource.setLogAbandoned(true);\n        logger.info(\"dataSource........\");\n        dataSourceProxy = new DataSourceProxy(druidDataSource);\n        return dataSourceProxy;\n    }\n\n    /**\n     * init datasource proxy\n     * \n     * @Param: druidDataSource datasource bean instance\n     * @Return: DataSourceProxy datasource proxy\n     */\n    @Bean\n    public DataSourceProxy dataSourceProxy() {\n        logger.info(\"dataSource........\");\n        return dataSourceProxy;\n    }\n\n    /**\n     * init global transaction scanner\n     *\n     * @Return: GlobalTransactionScanner\n     */\n    @Bean\n    public GlobalTransactionScanner globalTransactionScanner() {\n        logger.info(\"seata........\");\n        return new GlobalTransactionScanner(\"test-service\", \"test-group\");\n    }\n}\n\n```\n\n,sqlSessionFactory,DataSource beanbean,@Primary,mp,mpseatasqlSessionFactory,mp,bug!\n\n# \n\n"
        },
        {
          "id": "/springboot-dubbo-mybatisplus-seata",
          "metadata": {
            "permalink": "/blog/springboot-dubbo-mybatisplus-seata",
            "source": "@site/blog/springboot-dubbo-mybatisplus-seata.md",
            "title": "SpringBoot+Dubbo+MybatisPlusseata",
            "description": "springboot+dubbo+mybatisplusseata",
            "date": "2019-11-29T00:00:00.000Z",
            "formattedDate": "November 29, 2019",
            "tags": [],
            "readingTime": 22.755,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "FUNKYE"
              }
            ],
            "frontMatter": {
              "title": "SpringBoot+Dubbo+MybatisPlusseata",
              "keywords": [
                "Seata",
                "dubbo",
                "mybatis",
                ""
              ],
              "description": "springboot+dubbo+mybatisplusseata",
              "author": "FUNKYE",
              "date": "2019/11/29"
            },
            "prevItem": {
              "title": "SeataATMybatis-PlusMP",
              "permalink": "/blog/seata-mybatisplus-analysis"
            },
            "nextItem": {
              "title": "Seata  RM  TM ",
              "permalink": "/blog/seata-at-mode-start-rm-tm"
            }
          },
          "content": "[](https://gitee.com/itCjb/springboot-dubbo-mybatisplus-seata )\n\nFUNKYE(),\n\n# \n\n    ****ACID\n    ****:,(,),Transaction,\n    **Seata** \n    ****MQTX-LCNLCNDubbo2.7MQTX-LCNSeataSeataDemo\n\n# \n\n1.mysql,eclipse,. \n\n2.seata[](http://seata.io/zh-cn/blog/download.html)0.9.0\n\n3.seata-server\n\n## \n\n1.mysqlseata,sql,seata-serverconfdb_store.sqlsql.\n\n```mysql\n/*\nNavicat MySQL Data Transfer\nSource Server         : mysql\nSource Server Version : 50721\nSource Host           : localhost:3306\nSource Database       : seata\nTarget Server Type    : MYSQL\nTarget Server Version : 50721\nFile Encoding         : 65001\nDate: 2019-11-23 22:03:18\n*/\n\nSET FOREIGN_KEY_CHECKS=0;\n\n-- ----------------------------\n\n-- Table structure for branch_table\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `branch_table`;\nCREATE TABLE `branch_table` (\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(128) NOT NULL,\n  `transaction_id` bigint(20) DEFAULT NULL,\n  `resource_group_id` varchar(32) DEFAULT NULL,\n  `resource_id` varchar(256) DEFAULT NULL,\n  `lock_key` varchar(128) DEFAULT NULL,\n  `branch_type` varchar(8) DEFAULT NULL,\n  `status` tinyint(4) DEFAULT NULL,\n  `client_id` varchar(64) DEFAULT NULL,\n  `application_data` varchar(2000) DEFAULT NULL,\n  `gmt_create` datetime DEFAULT NULL,\n  `gmt_modified` datetime DEFAULT NULL,\n  PRIMARY KEY (`branch_id`),\n  KEY `idx_xid` (`xid`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ----------------------------\n\n-- Records of branch_table\n\n-- ----------------------------\n\n-- ----------------------------\n\n-- Table structure for global_table\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `global_table`;\nCREATE TABLE `global_table` (\n  `xid` varchar(128) NOT NULL,\n  `transaction_id` bigint(20) DEFAULT NULL,\n  `status` tinyint(4) NOT NULL,\n  `application_id` varchar(32) DEFAULT NULL,\n  `transaction_service_group` varchar(32) DEFAULT NULL,\n  `transaction_name` varchar(128) DEFAULT NULL,\n  `timeout` int(11) DEFAULT NULL,\n  `begin_time` bigint(20) DEFAULT NULL,\n  `application_data` varchar(2000) DEFAULT NULL,\n  `gmt_create` datetime DEFAULT NULL,\n  `gmt_modified` datetime DEFAULT NULL,\n  PRIMARY KEY (`xid`),\n  KEY `idx_gmt_modified_status` (`gmt_modified`,`status`),\n  KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ----------------------------\n\n-- Records of global_table\n\n-- ----------------------------\n\n-- ----------------------------\n\n-- Table structure for lock_table\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `lock_table`;\nCREATE TABLE `lock_table` (\n  `row_key` varchar(128) NOT NULL,\n  `xid` varchar(96) DEFAULT NULL,\n  `transaction_id` mediumtext,\n  `branch_id` mediumtext,\n  `resource_id` varchar(256) DEFAULT NULL,\n  `table_name` varchar(32) DEFAULT NULL,\n  `pk` varchar(36) DEFAULT NULL,\n  `gmt_create` datetime DEFAULT NULL,\n  `gmt_modified` datetime DEFAULT NULL,\n  PRIMARY KEY (`row_key`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ----------------------------\n\n-- Records of lock_table\n\n-- ----------------------------\n\n-- ----------------------------\n\n-- Table structure for undo_log\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `undo_log`;\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `context` varchar(128) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n-- ----------------------------\n\n-- Records of undo_log\n```\n\n2.seata,demo,test,sql:\n\n```mysql\n/*\nNavicat MySQL Data Transfer\nSource Server         : mysql\nSource Server Version : 50721\nSource Host           : localhost:3306\nSource Database       : test\nTarget Server Type    : MYSQL\nTarget Server Version : 50721\nFile Encoding         : 65001\nDate: 2019-11-23 22:03:24\n*/\n\nSET FOREIGN_KEY_CHECKS=0;\n\n-- ----------------------------\n\n-- Table structure for test\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `test`;\nCREATE TABLE `test` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `one` varchar(255) DEFAULT NULL,\n  `two` varchar(255) DEFAULT NULL,\n  `createTime` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4;\n\n-- ----------------------------\n\n-- Records of test\n\n-- ----------------------------\n\nINSERT INTO `test` VALUES ('1', '1', '2', '2019-11-23 16:07:34');\n\n-- ----------------------------\n\n-- Table structure for undo_log\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `undo_log`;\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `context` varchar(128) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;\n\n-- ----------------------------\n\n-- Records of undo_log\n```\n\n 3.seata-server/conf file:![20191129132933](/img/blog/20191129132933.png)\n\n 4.db,:![](/img/blog/20191129133111.png)\n\n,bin./seata-server.bat  \n\n# \n\n\teclipse,idea,\n\n\t1.maven,:![20191129133354](/img/blog/20191129133354.png)<img src=\"/img/blog/20191129133441.png\" alt=\"20191129133441\" style={{ zoom:'150%' }} />\n\n\t2.pom.xml,:\n\n```java\n\t<properties>\n\t\t<webVersion>3.1</webVersion>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n\t\t<maven.compiler.source>1.8</maven.compiler.source>\n\t\t<maven.compiler.target>1.8</maven.compiler.target>\n\t\t<HikariCP.version>3.2.0</HikariCP.version>\n\t\t<mybatis-plus-boot-starter.version>3.2.0</mybatis-plus-boot-starter.version>\n\t</properties>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>2.1.8.RELEASE</version>\n\t</parent>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.curator</groupId>\n\t\t\t<artifactId>curator-framework</artifactId>\n\t\t\t<version>4.2.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.curator</groupId>\n\t\t\t<artifactId>curator-recipes</artifactId>\n\t\t\t<version>4.2.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.dubbo</groupId>\n\t\t\t<artifactId>dubbo-spring-boot-starter</artifactId>\n\t\t\t<version>2.7.4.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.commons</groupId>\n\t\t\t<artifactId>commons-lang3</artifactId>\n\t\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.alibaba</groupId>\n\t\t\t<artifactId>fastjson</artifactId>\n\t\t\t<version>1.2.60</version>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>javax</groupId> <artifactId>javaee-api</artifactId> \n\t\t\t<version>7.0</version> <scope>provided</scope> </dependency> -->\n\t\t<dependency>\n\t\t\t<groupId>io.springfox</groupId>\n\t\t\t<artifactId>springfox-swagger2</artifactId>\n\t\t\t<version>2.9.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>io.springfox</groupId>\n\t\t\t<artifactId>springfox-swagger-ui</artifactId>\n\t\t\t<version>2.9.2</version>\n\t\t</dependency>\n \n\t\t<!-- mybatis-plus begin -->\n\t\t<dependency>\n\t\t\t<groupId>com.baomidou</groupId>\n\t\t\t<artifactId>mybatis-plus-boot-starter</artifactId>\n\t\t\t<version>${mybatis-plus-boot-starter.version}</version>\n\t\t</dependency>\n\t\t<!-- mybatis-plus end -->\n\t\t<!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->\n\t\t<dependency>\n\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t<artifactId>lombok</artifactId>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>io.seata</groupId>\n\t\t\t<artifactId>seata-all</artifactId>\n\t\t\t<version>0.9.0.1</version>\n\t\t</dependency>\n\t\t<!-- Zookeeper -->\n\t\t<dependency>\n\t\t\t<groupId>org.apache.zookeeper</groupId>\n\t\t\t<artifactId>zookeeper</artifactId>\n\t\t\t<version>3.4.9</version>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>com.baomidou</groupId> <artifactId>dynamic-datasource-spring-boot-starter</artifactId> \n\t\t\t<version>2.5.4</version> </dependency> -->\n \n\t\t<!-- <dependency> <groupId>com.baomidou</groupId> <artifactId>mybatis-plus-generator</artifactId> \n\t\t\t<version>3.1.0</version> </dependency> -->\n\t\t<!-- https://mvnrepository.com/artifact/org.freemarker/freemarker -->\n\t\t<dependency>\n\t\t\t<groupId>org.freemarker</groupId>\n\t\t\t<artifactId>freemarker</artifactId>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter -->\n\t\t<dependency>\n\t\t\t<groupId>com.alibaba</groupId>\n\t\t\t<artifactId>druid-spring-boot-starter</artifactId>\n\t\t\t<version>1.1.20</version>\n\t\t</dependency>\n\t\t<!-- log4j2.yml -->\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.dataformat</groupId>\n\t\t\t<artifactId>jackson-dataformat-yaml</artifactId>\n\t\t</dependency>\n\t\t<dependency> <!-- log4j2 -->\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-log4j2</artifactId>\n\t\t</dependency>\n\t\t<!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-web</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-aop</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- <dependency> <groupId>org.scala-lang</groupId> <artifactId>scala-library</artifactId> \n\t\t\t<version>2.11.0</version> </dependency> -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-configuration-processor</artifactId>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t</dependencies>\n\n```\n\n\t3.pom,pom, overview ,:![20191129134127](/img/blog/20191129134127.png)\n\n4.demo,test-service:![20191129135935](/img/blog/20191129135935.png)\n\n\t:\n\n<img src=\"/img/blog/20191129140048.png\" alt=\"20191129140048\"  style={{ zoom:'200%' }} />\n\n \tEmbeddedZooKeeper.java, ProviderApplication.java,:\n\n```java\npackage org.test;\n \nimport java.io.File;\nimport java.lang.reflect.Method;\nimport java.util.Properties;\nimport java.util.UUID;\n \nimport org.apache.zookeeper.server.ServerConfig;\nimport org.apache.zookeeper.server.ZooKeeperServerMain;\nimport org.apache.zookeeper.server.quorum.QuorumPeerConfig;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.context.SmartLifecycle;\nimport org.springframework.util.ErrorHandler;\nimport org.springframework.util.SocketUtils;\n \n/**\n * from:\n * https://github.com/spring-projects/spring-xd/blob/v1.3.1.RELEASE/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/zookeeper/ZooKeeperUtils.java\n * \n * Helper class to start an embedded instance of standalone (non clustered) ZooKeeper.\n * \n * NOTE: at least an external standalone server (if not an ensemble) are recommended, even for\n * {@link org.springframework.xd.dirt.server.singlenode.SingleNodeApplication}\n * \n * @author Patrick Peralta\n * @author Mark Fisher\n * @author David Turanski\n */\npublic class EmbeddedZooKeeper implements SmartLifecycle {\n \n    /**\n     * Logger.\n     */\n    private static final Logger logger = LoggerFactory.getLogger(EmbeddedZooKeeper.class);\n \n    /**\n     * ZooKeeper client port. This will be determined dynamically upon startup.\n     */\n    private final int clientPort;\n \n    /**\n     * Whether to auto-start. Default is true.\n     */\n    private boolean autoStartup = true;\n \n    /**\n     * Lifecycle phase. Default is 0.\n     */\n    private int phase = 0;\n \n    /**\n     * Thread for running the ZooKeeper server.\n     */\n    private volatile Thread zkServerThread;\n \n    /**\n     * ZooKeeper server.\n     */\n    private volatile ZooKeeperServerMain zkServer;\n \n    /**\n     * {@link ErrorHandler} to be invoked if an Exception is thrown from the ZooKeeper server thread.\n     */\n    private ErrorHandler errorHandler;\n \n    private boolean daemon = true;\n \n    /**\n     * Construct an EmbeddedZooKeeper with a random port.\n     */\n    public EmbeddedZooKeeper() {\n        clientPort = SocketUtils.findAvailableTcpPort();\n    }\n \n    /**\n     * Construct an EmbeddedZooKeeper with the provided port.\n     *\n     * @param clientPort\n     *            port for ZooKeeper server to bind to\n     */\n    public EmbeddedZooKeeper(int clientPort, boolean daemon) {\n        this.clientPort = clientPort;\n        this.daemon = daemon;\n    }\n \n    /**\n     * Returns the port that clients should use to connect to this embedded server.\n     * \n     * @return dynamically determined client port\n     */\n    public int getClientPort() {\n        return this.clientPort;\n    }\n \n    /**\n     * Specify whether to start automatically. Default is true.\n     * \n     * @param autoStartup\n     *            whether to start automatically\n     */\n    public void setAutoStartup(boolean autoStartup) {\n        this.autoStartup = autoStartup;\n    }\n \n    /**\n     * {@inheritDoc}\n     */\n    public boolean isAutoStartup() {\n        return this.autoStartup;\n    }\n \n    /**\n     * Specify the lifecycle phase for the embedded server.\n     * \n     * @param phase\n     *            the lifecycle phase\n     */\n    public void setPhase(int phase) {\n        this.phase = phase;\n    }\n \n    /**\n     * {@inheritDoc}\n     */\n    public int getPhase() {\n        return this.phase;\n    }\n \n    /**\n     * {@inheritDoc}\n     */\n    public boolean isRunning() {\n        return (zkServerThread != null);\n    }\n \n    /**\n     * Start the ZooKeeper server in a background thread.\n     * <p>\n     * Register an error handler via {@link #setErrorHandler} in order to handle any exceptions thrown during startup or\n     * execution.\n     */\n    public synchronized void start() {\n        if (zkServerThread == null) {\n            zkServerThread = new Thread(new ServerRunnable(), \"ZooKeeper Server Starter\");\n            zkServerThread.setDaemon(daemon);\n            zkServerThread.start();\n        }\n    }\n \n    /**\n     * Shutdown the ZooKeeper server.\n     */\n    public synchronized void stop() {\n        if (zkServerThread != null) {\n            // The shutdown method is protected...thus this hack to invoke it.\n            // This will log an exception on shutdown; see\n            // https://issues.apache.org/jira/browse/ZOOKEEPER-1873 for details.\n            try {\n                Method shutdown = ZooKeeperServerMain.class.getDeclaredMethod(\"shutdown\");\n                shutdown.setAccessible(true);\n                shutdown.invoke(zkServer);\n            }\n \n            catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n \n            // It is expected that the thread will exit after\n            // the server is shutdown; this will block until\n            // the shutdown is complete.\n            try {\n                zkServerThread.join(5000);\n                zkServerThread = null;\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                logger.warn(\"Interrupted while waiting for embedded ZooKeeper to exit\");\n                // abandoning zk thread\n                zkServerThread = null;\n            }\n        }\n    }\n \n    /**\n     * Stop the server if running and invoke the callback when complete.\n     */\n    public void stop(Runnable callback) {\n        stop();\n        callback.run();\n    }\n \n    /**\n     * Provide an {@link ErrorHandler} to be invoked if an Exception is thrown from the ZooKeeper server thread. If none\n     * is provided, only error-level logging will occur.\n     * \n     * @param errorHandler\n     *            the {@link ErrorHandler} to be invoked\n     */\n    public void setErrorHandler(ErrorHandler errorHandler) {\n        this.errorHandler = errorHandler;\n    }\n \n    /**\n     * Runnable implementation that starts the ZooKeeper server.\n     */\n    private class ServerRunnable implements Runnable {\n \n        public void run() {\n            try {\n                Properties properties = new Properties();\n                File file = new File(System.getProperty(\"java.io.tmpdir\") + File.separator + UUID.randomUUID());\n                file.deleteOnExit();\n                properties.setProperty(\"dataDir\", file.getAbsolutePath());\n                properties.setProperty(\"clientPort\", String.valueOf(clientPort));\n \n                QuorumPeerConfig quorumPeerConfig = new QuorumPeerConfig();\n                quorumPeerConfig.parseProperties(properties);\n \n                zkServer = new ZooKeeperServerMain();\n                ServerConfig configuration = new ServerConfig();\n                configuration.readFrom(quorumPeerConfig);\n \n                zkServer.runFromConfig(configuration);\n            } catch (Exception e) {\n                if (errorHandler != null) {\n                    errorHandler.handleError(e);\n                } else {\n                    logger.error(\"Exception running embedded ZooKeeper\", e);\n                }\n            }\n        }\n    }\n \n}\n\n```\n\n```java\npackage org.test;\n \nimport org.apache.dubbo.config.spring.context.annotation.DubboComponentScan;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\n \n/**\n * \n * @author cjb\n * @date 2019/10/24\n */\n@EnableTransactionManagement\n@ComponentScan(basePackages = {\"org.test.config\", \"org.test.service.impl\"})\n@DubboComponentScan(basePackages = \"org.test.service.impl\")\n@SpringBootApplication\npublic class ProviderApplication {\n \n    public static void main(String[] args) {\n        new EmbeddedZooKeeper(2181, false).start();\n        SpringApplication app = new SpringApplication(ProviderApplication.class);\n        app.run(args);\n    }\n \n}\n\n```\n\n \t org.test.entityTest lombok,,eclipselombok\n\n```java\npackage org.test.entity;\n \nimport java.io.Serializable;\nimport java.time.LocalDateTime;\n \nimport com.baomidou.mybatisplus.annotation.IdType;\nimport com.baomidou.mybatisplus.annotation.TableField;\nimport com.baomidou.mybatisplus.annotation.TableId;\n \nimport io.swagger.annotations.ApiModel;\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.Data;\nimport lombok.EqualsAndHashCode;\nimport lombok.experimental.Accessors;\n \n/**\n * <p>\n * \n * </p>\n *\n * @author Funkye\n * @since 2019-04-23\n */\n@Data\n@EqualsAndHashCode(callSuper = false)\n@Accessors(chain = true)\n@ApiModel(value = \"test\", description = \"\")\npublic class Test implements Serializable {\n \n    private static final long serialVersionUID = 1L;\n \n    @ApiModelProperty(value = \"\")\n    @TableId(value = \"id\", type = IdType.AUTO)\n    private Integer id;\n \n    @ApiModelProperty(value = \"one\")\n    @TableField(\"one\")\n    private String one;\n \n    @ApiModelProperty(value = \"two\")\n    @TableField(\"two\")\n    private String two;\n \n    @ApiModelProperty(value = \"createTime\")\n    @TableField(\"createTime\")\n    private LocalDateTime createTime;\n \n}\n\n```\n\n\tservice,service.impl,mapper,ITestservice,,mapper\n\n```java\npackage org.test.service;\n \nimport org.test.entity.Test;\n \nimport com.baomidou.mybatisplus.extension.service.IService; \n \n/**\n * <p>\n *  \n * </p>\n *\n * @author Funkye\n * @since 2019-04-10\n */\npublic interface ITestService extends IService<Test> {\n \n}\n\n```\n\n```java\npackage org.test.service.impl;\n \n \n \n \nimport org.apache.dubbo.config.annotation.Service;\nimport org.test.entity.Test;\nimport org.test.mapper.TestMapper;\nimport org.test.service.ITestService;\n \nimport com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\n \n@Service(version = \"1.0.0\",interfaceClass =ITestService.class )\npublic class TestServiceImpl extends ServiceImpl<TestMapper, Test> implements ITestService {\n \n}\n\n```\n\n```java\npackage org.test.mapper;\n \nimport org.test.entity.Test; \n \nimport com.baomidou.mybatisplus.core.mapper.BaseMapper;\n \n/**\n * <p>\n *  Mapper \n * </p>\n *\n * @author Funkye\n * @since 2019-04-10\n */\npublic interface TestMapper extends BaseMapper<Test> {\n \n}\n\n```\n\n \torg.test.config,SeataAutoConfig.java,,, \n\n```java\npackage org.test.config;\n\nimport javax.sql.DataSource;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n\nimport com.alibaba.druid.pool.DruidDataSource;\n\nimport io.seata.rm.datasource.DataSourceProxy;\nimport io.seata.spring.annotation.GlobalTransactionScanner;\n\n@Configuration\npublic class SeataAutoConfig {\n\t@Autowired(required = true)\n\tprivate DataSourceProperties dataSourceProperties;\n\tprivate final static Logger logger = LoggerFactory.getLogger(SeataAutoConfig.class);\n\n\t@Bean(name = \"druidDataSource\") // Bean\n\tpublic DataSource druidDataSource() {\n\t\tDruidDataSource druidDataSource = new DruidDataSource();\n\t\tlogger.info(\"dataSourceProperties.getUrl():{}\", dataSourceProperties.getUrl());\n\t\tdruidDataSource.setUrl(dataSourceProperties.getUrl());\n\t\tdruidDataSource.setUsername(dataSourceProperties.getUsername());\n\t\tdruidDataSource.setPassword(dataSourceProperties.getPassword());\n\t\tdruidDataSource.setDriverClassName(dataSourceProperties.getDriverClassName());\n\t\tdruidDataSource.setInitialSize(0);\n\t\tdruidDataSource.setMaxActive(180);\n\t\tdruidDataSource.setMaxWait(60000);\n\t\tdruidDataSource.setMinIdle(0);\n\t\tdruidDataSource.setValidationQuery(\"Select 1 from DUAL\");\n\t\tdruidDataSource.setTestOnBorrow(false);\n\t\tdruidDataSource.setTestOnReturn(false);\n\t\tdruidDataSource.setTestWhileIdle(true);\n\t\tdruidDataSource.setTimeBetweenEvictionRunsMillis(60000);\n\t\tdruidDataSource.setMinEvictableIdleTimeMillis(25200000);\n\t\tdruidDataSource.setRemoveAbandoned(true);\n\t\tdruidDataSource.setRemoveAbandonedTimeout(1800);\n\t\tdruidDataSource.setLogAbandoned(true);\n\t\tlogger.info(\"dataSource........\");\n\t\treturn druidDataSource;\n\t}\n\n\t/**\n\t * init datasource proxy\n\t * \n\t * @Param: druidDataSource datasource bean instance\n\t * @Return: DataSourceProxy datasource proxy\n\t */\n\t@Bean(name = \"dataSource\")\n\t@Primary // DataSourceDataSource\n\tpublic DataSourceProxy dataSourceProxy(@Qualifier(value = \"druidDataSource\") DruidDataSource druidDataSource) {\n\t\tlogger.info(\"dataSource........\");\n\t\treturn new DataSourceProxy(druidDataSource);\n\t}\n\n\t/**\n\t * init global transaction scanner\n\t *\n\t * @Return: GlobalTransactionScanner\n\t */\n\t@Bean\n\tpublic GlobalTransactionScanner globalTransactionScanner() {\n\t\tlogger.info(\"seata........\");\n\t\treturn new GlobalTransactionScanner(\"test-service\", \"test-group\");\n\t}\n}\n```\n\n \tmybatisplusMybatisPlusConfig  \n\n```java\npackage org.test.config;\n \nimport java.util.ArrayList;\nimport java.util.List;\n \nimport org.mybatis.spring.mapper.MapperScannerConfigurer;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n \nimport com.baomidou.mybatisplus.core.parser.ISqlParser;\nimport com.baomidou.mybatisplus.extension.parsers.BlockAttackSqlParser;\nimport com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;\n \n@Configuration\n// @MapperScan(\"com.baomidou.springboot.mapper*\")//@Bean\n// MapperScannerConfigurer21\npublic class MybatisPlusConfig {\n \n    /**\n     * mybatis-plus<br>\n     * http://mp.baomidou.com<br>\n     */\n    @Bean\n    public PaginationInterceptor paginationInterceptor() {\n        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();\n        List<ISqlParser> sqlParserList = new ArrayList<ISqlParser>();\n        //  SQL \n        sqlParserList.add(new BlockAttackSqlParser());\n        paginationInterceptor.setSqlParserList(sqlParserList);\n        return paginationInterceptor;\n    }\n \n    /**\n     *  {@code @MapperScan(\"com.baomidou.springboot.mapper*\")} Mapper\n     */\n \n    @Bean\n    public MapperScannerConfigurer mapperScannerConfigurer() {\n        MapperScannerConfigurer scannerConfigurer = new MapperScannerConfigurer();\n        scannerConfigurer.setBasePackage(\"org.test.mapper\");\n        return scannerConfigurer;\n    }\n \n}\n\n```\n\n\t **resources,mapper,application.yml** \n\n```yaml\nserver:\n  port: 38888\nspring:\n  application: \n      name: test-service\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource\n    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    username: root\n    password: 123456\ndubbo:\n  protocol:\n    loadbalance: leastactive\n    threadpool: cached\n  scan:\n    base-packages: orgtest.service\n  application:\n    qos-enable: false\n    name: testserver\n  registry:\n    id: my-registry\n    address:  zookeeper://127.0.0.1:2181?client=curator\nmybatis-plus:\n  mapper-locations: classpath:/mapper/*Mapper.xml\n  typeAliasesPackage: org.test.entity\n  global-config:\n    db-config:\n      field-strategy: not-empty\n      id-type: auto\n      db-type: mysql\n  configuration:\n    map-underscore-to-camel-case: true\n    cache-enabled: true      \n    auto-mapping-unknown-column-behavior: none\n\n```\n\n\t file.conf,service vgroup_mapping.,**SeataAutoConfigtest-group,test-group**,ipseataip \n\n```java\ntransport {\n  type = \"TCP\"\n  server = \"NIO\"\n  heartbeat = true\n  thread-factory {\n    boss-thread-prefix = \"NettyBoss\"\n    worker-thread-prefix = \"NettyServerNIOWorker\"\n    server-executor-thread-prefix = \"NettyServerBizHandler\"\n    share-boss-worker = false\n    client-selector-thread-prefix = \"NettyClientSelector\"\n    client-selector-thread-size = 1\n    client-worker-thread-prefix = \"NettyClientWorkerThread\"\n    boss-thread-size = 1\n    worker-thread-size = 8\n  }\n  shutdown {\n    wait = 3\n  }\n  serialization = \"seata\"\n  compressor = \"none\"\n}\nservice {\n  vgroup_mapping.test-group = \"default\"\n  default.grouplist = \"127.0.0.1:8091\"\n  enableDegrade = false\n  disable = false\n  max.commit.retry.timeout = \"-1\"\n  max.rollback.retry.timeout = \"-1\"\n}\n \nclient {\n  async.commit.buffer.limit = 10000\n  lock {\n    retry.internal = 10\n    retry.times = 30\n  }\n  report.retry.count = 5\n  tm.commit.retry.count = 1\n  tm.rollback.retry.count = 1\n  undo.log.table = \"undo_log\"\n}\n \nrecovery {\n  committing-retry-period = 1000\n  asyn-committing-retry-period = 1000\n  rollbacking-retry-period = 1000\n  timeout-retry-period = 1000\n}\n \ntransaction {\n  undo.data.validation = true\n  undo.log.serialization = \"jackson\"\n  undo.log.save.days = 7\n  undo.log.delete.period = 86400000\n  undo.log.table = \"undo_log\"\n}\n \nmetrics {\n  enabled = false\n  registry-type = \"compact\"\n  exporter-list = \"prometheus\"\n  exporter-prometheus-port = 9898\n}\n \nsupport {\n  spring {\n    datasource.autoproxy = false\n  }\n}\n\n```\n\n registry.conf,file,zkip \n\n```java\nregistry {\n  type = \"file\"\n  file {\n    name = \"file.conf\"\n  }\n}\nconfig {\n  type = \"file\"\n  file {\n    name = \"file.conf\"\n  }\n  zk {\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n}\n\n```\n\n\t ,,seata-server![20191129142115](/img/blog/20191129142115.png)\n\n\ttest-client,,test-service\n\n\ttest-serviceservice,,service,,demo,.\n\n:![](/img/blog/20191129142349.png)\n\n \tClientApplication:\n\n```java\npackage org.test;\n \nimport java.util.TimeZone;\nimport java.util.concurrent.Executor;\n \nimport org.apache.dubbo.config.spring.context.annotation.EnableDubbo;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.scheduling.annotation.EnableAsync;\nimport org.springframework.scheduling.annotation.EnableScheduling;\nimport org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;\n \nimport com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration;\n \n@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class, MybatisPlusAutoConfiguration.class})\n@EnableScheduling\n@EnableAsync\n@Configuration\n@EnableDubbo(scanBasePackages = {\"org.test.service\"})\n@ComponentScan(basePackages = {\"org.test.service\", \"org.test.controller\", \"org.test.config\"})\npublic class ClientApplication {\n    public static void main(String[] args) {\n        TimeZone.setDefault(TimeZone.getTimeZone(\"Asia/Shanghai\"));\n        SpringApplication app = new SpringApplication(ClientApplication.class);\n        app.run(args);\n    }\n \n    @Bean(name = \"threadPoolTaskExecutor\")\n    public Executor threadPoolTaskExecutor() {\n        return new ThreadPoolTaskExecutor();\n    }\n}\n\n```\n\n configSwaggerConfig :\n\n```java\npackage org.test.config;\n \nimport java.util.ArrayList;\nimport java.util.List;\n \nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n \nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.service.Contact;\nimport springfox.documentation.service.Parameter;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\n \n@Configuration\n@EnableSwagger2\npublic class SwaggerConfig {\n    // swagger2swagger2\n    @Bean\n    public Docket createRestApi() {\n        List<Parameter> pars = new ArrayList<Parameter>();\n        return new Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()).select()\n            // \n            .apis(RequestHandlerSelectors.basePackage(\"org.test.controller\")).paths(PathSelectors.any()).build()\n            .globalOperationParameters(pars);\n    }\n \n    //  api,\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n            // \n            .title(\"\")\n            // \n            .contact(new Contact(\"FUNKYE\", \"\", \"\"))\n            // \n            .version(\"1.0\")\n            // \n            .description(\"API \").build();\n    }\n}\n\n```\n\n\tSpringMvcConfigure,seata,mvc,seata,,,. \n\n```java\npackage org.test.config;\n \nimport java.nio.charset.Charset; \nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n \nimport org.apache.dubbo.config.annotation.Reference;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.Ordered;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.converter.HttpMessageConverter;\nimport org.springframework.http.converter.StringHttpMessageConverter;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\nimport org.springframework.web.servlet.HandlerInterceptor;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\nimport org.springframework.web.servlet.view.InternalResourceViewResolver;\n \nimport com.alibaba.fastjson.serializer.SerializerFeature;\nimport com.alibaba.fastjson.support.config.FastJsonConfig;\nimport com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;\nimport com.google.common.collect.Maps;\n \nimport io.seata.spring.annotation.GlobalTransactionScanner;\n \n@Configuration\npublic class SpringMvcConfigure implements WebMvcConfigurer {\n \n    @Bean\n    public FilterRegistrationBean corsFilter() {\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        CorsConfiguration config = new CorsConfiguration();\n        config.setAllowCredentials(true);\n        config.addAllowedOrigin(\"*\");\n        config.addAllowedHeader(CorsConfiguration.ALL);\n        config.addAllowedMethod(CorsConfiguration.ALL);\n        source.registerCorsConfiguration(\"/**\", config);\n        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(new CorsFilter(source));\n        filterRegistrationBean.setOrder(Ordered.HIGHEST_PRECEDENCE);\n        filterRegistrationBean.setOrder(1);\n        filterRegistrationBean.setEnabled(true);\n        filterRegistrationBean.addUrlPatterns(\"/**\");\n        Map<String, String> initParameters = Maps.newHashMap();\n        initParameters.put(\"excludes\", \"/favicon.ico,/img/*,/js/*,/css/*\");\n        initParameters.put(\"isIncludeRichText\", \"true\");\n        filterRegistrationBean.setInitParameters(initParameters);\n        return filterRegistrationBean;\n    }\n \n    @Bean\n    public InternalResourceViewResolver viewResolver() {\n        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();\n        viewResolver.setPrefix(\"/WEB-INF/jsp/\");\n        viewResolver.setSuffix(\".jsp\");\n        // viewResolver.setViewClass(JstlView.class);\n        // Spring\n        return viewResolver;\n    }\n \n \n \n    /**\n     * jsonfastjson\n     */\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();\n        FastJsonConfig fastJsonConfig = new FastJsonConfig();\n        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat, SerializerFeature.WriteMapNullValue,\n            SerializerFeature.WriteNullStringAsEmpty, SerializerFeature.DisableCircularReferenceDetect);\n        // \n        List<MediaType> fastMediaTypes = new ArrayList<>();\n        fastMediaTypes.add(MediaType.APPLICATION_JSON_UTF8);\n        fastConverter.setSupportedMediaTypes(fastMediaTypes);\n        fastConverter.setFastJsonConfig(fastJsonConfig);\n        // , \n        StringHttpMessageConverter smc = new StringHttpMessageConverter(Charset.forName(\"UTF-8\"));\n        converters.add(smc);\n        converters.add(fastConverter);\n    }\n \n    @Bean\n    public GlobalTransactionScanner globalTransactionScanner() {\n        return new GlobalTransactionScanner(\"test-client\", \"test-group\");\n    }\n \n}\n\n```\n\n c**ontroller,TestController** :\n\n```java\npackage org.test.controller;\n \nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Lazy;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.test.service.DemoService;\n \nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\n \n/**\n * <p>\n *  \n * </p>\n *\n * @author funkye\n * @since 2019-03-20\n */\n@RestController\n@RequestMapping(\"/test\")\n@Api(tags = \"\")\npublic class TestController {\n \n    private final static Logger logger = LoggerFactory.getLogger(TestController.class);\n    @Autowired\n    @Lazy\n    DemoService demoService;\n \n    @GetMapping(value = \"testSeataOne\")\n    @ApiOperation(value = \"\")\n    public Object testSeataOne() {\n        return demoService.One();\n    }\n \n    @GetMapping(value = \"testSeataTwo\")\n    @ApiOperation(value = \"\")\n    public Object testSeataTwo() {\n        return demoService.Two();\n    }\n \n}\n\n```\n\n serviceDemoService \n\n```java\npackage org.test.service;\n \nimport java.time.LocalDateTime;\n \nimport org.apache.dubbo.config.annotation.Reference;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.stereotype.Service;\nimport org.test.controller.TestController;\nimport org.test.entity.Test;\n \nimport io.seata.core.context.RootContext;\nimport io.seata.core.exception.TransactionException;\nimport io.seata.spring.annotation.GlobalTransactional;\nimport io.seata.tm.api.GlobalTransactionContext;\n \n@Service\npublic class DemoService {\n\t@Reference(version = \"1.0.0\", timeout = 60000)\n\tprivate ITestService testService;\n\tprivate final static Logger logger = LoggerFactory.getLogger(DemoService.class);\n \n\t/**\n\t * \n\t * \n\t * @return\n\t */\n\t@GlobalTransactional\n\tpublic Object One() {\n\t\tlogger.info(\"seataId:{}\", RootContext.getXID());\n\t\tTest t = new Test();\n\t\tt.setOne(\"1\");\n\t\tt.setTwo(\"2\");\n\t\tt.setCreateTime(LocalDateTime.now());\n\t\ttestService.save(t);\n\t\ttry {\n\t\t\tint i = 1 / 0;\n\t\t\treturn true;\n\t\t} catch (Exception e) {\n\t\t\t// TODO: handle exception\n\t\t\ttry {\n\t\t\t\tlogger.info(\"id\");\n\t\t\t\tGlobalTransactionContext.reload(RootContext.getXID()).rollback();\n\t\t\t} catch (TransactionException e1) {\n\t\t\t\t// TODO Auto-generated catch block\n\t\t\t\te1.printStackTrace();\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n \n\t/**\n\t * \n\t * \n\t * @return\n\t */\n\t@GlobalTransactional\n\tpublic Object Two() {\n\t\tlogger.info(\"seataId:{}\", RootContext.getXID());\n\t\tTest t = new Test();\n\t\tt.setOne(\"1\");\n\t\tt.setTwo(\"2\");\n\t\tt.setCreateTime(LocalDateTime.now());\n\t\ttestService.save(t);\n\t\ttry {\n\t\t\tint i = 1 / 0;\n\t\t\treturn true;\n\t\t} catch (Exception e) {\n\t\t\t// TODO: handle exception\n\t\t\tthrow new RuntimeException();\n\t\t}\n\t}\n}\n\n```\n\n resources,**application.yml** \n\n```java\nspring:\n  application:\n     name: test\n  datasource:\n     driver-class-name: com.mysql.cj.jdbc.Driver\n     url: jdbc:mysql://127.0.0.1:3306/test?userSSL=true&useUnicode=true&characterEncoding=UTF8&serverTimezone=Asia/Shanghai\n     username: root\n     password: 123456\n  mvc:\n    servlet:\n      load-on-startup: 1\n  http:\n    encoding:\n            force: true\n            charset: utf-8\n            enabled: true\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\ndubbo:\n  registry:\n    id: my-registry\n    address:  zookeeper://127.0.0.1:2181?client=curator\n#    address:  zookeeper://127.0.0.1:2181?client=curator\n  application:\n    name: dubbo-demo-client\n    qos-enable: false\nserver:\n  port: 28888\n  max-http-header-size: 8192\n  address: 0.0.0.0\n  tomcat:\n    max-http-post-size: 104857600\n\n```\n\n servicefileregistry,client,file.\n\n![](/img/blog/20191129142851.png)\n\n ,test-service,test-client,swagger\n\n\t4.127.0.0.1:28888/swagger-ui.html\t\t![](/img/blog/20191129143041.png)\n\n![20191129143124](/img/blog/20191129143124.png)\n\n  ,: \n\n![20191129143252](/img/blog/20191129143252.png)\n\n ,: \n\n![20191129143124](/img/blog/20191129143124.png)\n\n : \n\n![20191129143407](/img/blog/20191129143407.png)\n\n ,seata-server: \n\n<img src=\"/img/blog/20191129143419.png\" style={{ zoom:'200%' }} />\n\n ,id,,,undo_log,,,,. \n\n# \n\nseata,!\n\nseata,dubbo,!"
        },
        {
          "id": "/seata-at-mode-start-rm-tm",
          "metadata": {
            "permalink": "/blog/seata-at-mode-start-rm-tm",
            "source": "@site/blog/seata-at-mode-start-rm-tm.md",
            "title": "Seata  RM  TM ",
            "description": " Seata ",
            "date": "2019-11-28T00:00:00.000Z",
            "formattedDate": "November 28, 2019",
            "tags": [],
            "readingTime": 3.325,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata  RM  TM ",
              "author": "",
              "keywords": [
                "SeataATRMTM"
              ],
              "description": " Seata ",
              "date": "2019/11/28"
            },
            "prevItem": {
              "title": "SpringBoot+Dubbo+MybatisPlusseata",
              "permalink": "/blog/springboot-dubbo-mybatisplus-seata"
            },
            "nextItem": {
              "title": "Seata AT ",
              "permalink": "/blog/seata-at-mode-start"
            }
          },
          "content": " GlobalTransactionScanner  RM  TM client Seata TM  TM client TM client  GlobalTransactional RM client \n\n\n GlobalTransactionScanner  GlobalTransactionScanner   InitializingBean  afterPropertiesSet() afterPropertySet()  bean  Spring \n\n InitializingBean ApplicationListener bean  GlobalTransactional  Spring  RM  TM client  TM client \n\n PR [https://github.com/seata/seata/pull/1936](https://github.com/seata/seata/pull/1936)\n\n pr  Seata  TM  GlobalRollbackRequestRM  BranchReport(false)  TC  GlobalRollbackRequest \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191128094250.png)\n\n TM client \n\n Seata \n\n TM client \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/20191127202606.png)\n\n\n RM client  TM client  TM  TM client  RM client\n\n# \n\n Java [https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "/seata-at-mode-start",
          "metadata": {
            "permalink": "/blog/seata-at-mode-start",
            "source": "@site/blog/seata-at-mode-start.md",
            "title": "Seata AT ",
            "description": "Seata ",
            "date": "2019-11-27T00:00:00.000Z",
            "formattedDate": "November 27, 2019",
            "tags": [],
            "readingTime": 13.8,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Seata AT ",
              "author": "",
              "keywords": [
                "SeataAT"
              ],
              "description": "Seata ",
              "date": "2019/11/27"
            },
            "prevItem": {
              "title": "Seata  RM  TM ",
              "permalink": "/blog/seata-at-mode-start-rm-tm"
            },
            "nextItem": {
              "title": " Seata Saga ",
              "permalink": "/blog/design-more-flexable-application-by-saga"
            }
          },
          "content": "[Seata](https://mp.weixin.qq.com/s/Pypkm5C9aLPJHYwcM6tAtA) Seata AT  AT RMTMTC Seata  Seata AT \n\n\n\n# \n\nTM  TM TM  GlobalTransaction\n\nio.seata.tm.api.GlobalTransaction\n\n```java\npublic interface GlobalTransaction {\n\n  void begin() throws TransactionException;\n\n  void begin(int timeout) throws TransactionException;\n\n  void begin(int timeout, String name) throws TransactionException;\n\n  void commit() throws TransactionException;\n\n  void rollback() throws TransactionException;\n  \n  GlobalStatus getStatus() throws TransactionException;\n  \n  // ...\n}\n```\n\n GlobalTransactionContext  GlobalTransaction GlobalTransaction  API  Seata AT \n\n```java\n//init seata;\nTMClient.init(applicationId, txServiceGroup);\nRMClient.init(applicationId, txServiceGroup);\n//trx\nGlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\ntry {\n  tx.begin(60000, \"testBiz\");\n  // \n  // ...\n  tx.commit();\n} catch (Exception exx) {\n  tx.rollback();\n  throw exx;\n}\n```\n\n Spring  Spring AOP  Mybatis-spring  Spring  Seata \n\n `@GlobalTransactional`Seata  Spring  GlobalTransactionScanner\n\n```java\npublic class GlobalTransactionScanner extends AbstractAutoProxyCreator implements InitializingBean, ApplicationContextAware, DisposableBean {\n  // ...\n}\n```\n\n Spring \n\n![image-20191124155455309](https://gitee.com/objcoding/md-picture/raw/master/img/image-20191124155455309.png)\n\nInitializingBean  afterPropertiesSet()  initClient() \n\nio.seata.spring.annotation.GlobalTransactionScanner#initClient\n\n```java\nTMClient.init(applicationId, txServiceGroup);\nRMClient.init(applicationId, txServiceGroup);\n```\n\n TM  RM \n\n- TM \n\nio.seata.tm.TMClient#init\n\n```java\npublic static void init(String applicationId, String transactionServiceGroup) {\n  //  TmRpcClient \n  TmRpcClient tmRpcClient = TmRpcClient.getInstance(applicationId, transactionServiceGroup);\n  //  TM Client\n  tmRpcClient.init();\n}\n```\n\n TmRpcClient.getInstance()  TM  Netty  messageExecutor  TmRpcClient  ClientBootstrap Netty  ClientChannelManager Netty Seata  Netty \n\nio.seata.core.rpc.netty.AbstractRpcRemotingClient#init\n\n```java\npublic void init() {\n  clientBootstrap.start();\n  // \n  timerExecutor.scheduleAtFixedRate(new Runnable() {\n    @Override\n    public void run() {\n      clientChannelManager.reconnect(getTransactionServiceGroup());\n    }\n  }, SCHEDULE_INTERVAL_MILLS, SCHEDULE_INTERVAL_MILLS, TimeUnit.SECONDS);\n  mergeSendExecutorService = new ThreadPoolExecutor(MAX_MERGE_SEND_THREAD,\n                                                    MAX_MERGE_SEND_THREAD,\n                                                    KEEP_ALIVE_TIME, TimeUnit.MILLISECONDS,\n                                                    new LinkedBlockingQueue<>(),\n                                                    new NamedThreadFactory(getThreadPrefix(), MAX_MERGE_SEND_THREAD));\n  mergeSendExecutorService.submit(new MergedSendRunnable());\n  super.init();\n}\n```\n\n TM  init()  netty  RegisterTMRequestRM  RegisterRMRequest NettyClientChannelManager  channels  channel channels  channel  channels \n\nio.seata.core.rpc.netty.AbstractRpcRemoting#init\n\n```java\npublic void init() {\n  timerExecutor.scheduleAtFixedRate(new Runnable() {\n    @Override\n    public void run() {\n      for (Map.Entry<Integer, MessageFuture> entry : futures.entrySet()) {\n        if (entry.getValue().isTimeout()) {\n          futures.remove(entry.getKey());\n          entry.getValue().setResultMessage(null);\n          if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"timeout clear future: {}\", entry.getValue().getRequestMessage().getBody());\n          }\n        }\n      }\n\n      nowMills = System.currentTimeMillis();\n    }\n  }, TIMEOUT_CHECK_INTERNAL, TIMEOUT_CHECK_INTERNAL, TimeUnit.MILLISECONDS);\n}\n```\n\n AbstractRpcRemoting  init  futures  futruefutures  future  future \n\n- RM \n\nio.seata.rm.RMClient#init\n\n```java\npublic static void init(String applicationId, String transactionServiceGroup) {\n  RmRpcClient rmRpcClient = RmRpcClient.getInstance(applicationId, transactionServiceGroup);\n  rmRpcClient.setResourceManager(DefaultResourceManager.get());\n  rmRpcClient.setClientMessageListener(new RmMessageListener(DefaultRMHandler.get()));\n  rmRpcClient.init();\n}\n```\n\n RmRpcClient.getInstance  TM ResourceManager  RM DefaultResourceManager  RM  get()  SPI Seata  META-INF/services/ \n\nClientMessageListener  RM  TC  undo log  init  TM DefaultRMHandler  RM \n\n wrapIfNecessary \n\nio.seata.spring.annotation.GlobalTransactionScanner#wrapIfNecessary\n\n```java\nprotected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {\n  // \n  if (disableGlobalTransaction) {\n    return bean;\n  }\n  try {\n    synchronized (PROXYED_SET) {\n      if (PROXYED_SET.contains(beanName)) {\n        return bean;\n      }\n      interceptor = null;\n      //check TCC proxy\n      if (TCCBeanParserUtils.isTccAutoProxy(bean, beanName, applicationContext)) {\n        //TCC interceptor, proxy bean of sofa:reference/dubbo:reference, and LocalTCC\n        interceptor = new TccActionInterceptor(TCCBeanParserUtils.getRemotingDesc(beanName));\n      } else {\n        Class<?> serviceInterface = SpringProxyUtils.findTargetClass(bean);\n        Class<?>[] interfacesIfJdk = SpringProxyUtils.findInterfaces(bean);\n\n        //  bean  GlobalTransactional  GlobalLock \n        if (!existsAnnotation(new Class[]{serviceInterface})\n            && !existsAnnotation(interfacesIfJdk)) {\n          return bean;\n        }\n\n        if (interceptor == null) {\n          // \n          interceptor = new GlobalTransactionalInterceptor(failureHandlerHook);\n        }\n      }\n\n      LOGGER.info(\"Bean[{}] with name [{}] would use interceptor [{}]\",\n                  bean.getClass().getName(), beanName, interceptor.getClass().getName());\n      if (!AopUtils.isAopProxy(bean)) {\n        bean = super.wrapIfNecessary(bean, beanName, cacheKey);\n      } else {\n        AdvisedSupport advised = SpringProxyUtils.getAdvisedSupport(bean);\n        //   \n        Advisor[] advisor = super.buildAdvisors(beanName, getAdvicesAndAdvisorsForBean(null, null, null));\n        for (Advisor avr : advisor) {\n          advised.addAdvisor(0, avr);\n        }\n      }\n      PROXYED_SET.add(beanName);\n      return bean;\n    }\n  } catch (Exception exx) {\n    throw new RuntimeException(exx);\n  }\n}\n```\n\n\nGlobalTransactionScanner  AbstractAutoProxyCreator Spring AOP GlobalTransactionalInterceptor  GlobalTransactional  GlobalLock \n\nGlobalTransactionalInterceptor  MethodInterceptor\n\nio.seata.spring.annotation.GlobalTransactionalInterceptor#invoke\n\n```java\npublic Object invoke(final MethodInvocation methodInvocation) throws Throwable {\n  Class<?> targetClass = methodInvocation.getThis() != null ? AopUtils.getTargetClass(methodInvocation.getThis()) : null;\n  Method specificMethod = ClassUtils.getMostSpecificMethod(methodInvocation.getMethod(), targetClass);\n  final Method method = BridgeMethodResolver.findBridgedMethod(specificMethod);\n\n  final GlobalTransactional globalTransactionalAnnotation = getAnnotation(method, GlobalTransactional.class);\n  final GlobalLock globalLockAnnotation = getAnnotation(method, GlobalLock.class);\n  if (globalTransactionalAnnotation != null) {\n    // \n    return handleGlobalTransaction(methodInvocation, globalTransactionalAnnotation);\n  } else if (globalLockAnnotation != null) {\n    // \n    return handleGlobalLock(methodInvocation);\n  } else {\n    return methodInvocation.proceed();\n  }\n}\n```\n\n handleGlobalTransaction()  TransactionalTemplate \n\nio.seata.spring.annotation.GlobalTransactionalInterceptor#handleGlobalTransaction\n\n```java\nprivate Object handleGlobalTransaction(final MethodInvocation methodInvocation,\n                                       final GlobalTransactional globalTrxAnno) throws Throwable {\n  try {\n    return transactionalTemplate.execute(new TransactionalExecutor() {\n      @Override\n      public Object execute() throws Throwable {\n        return methodInvocation.proceed();\n      }\n      @Override\n      public TransactionInfo getTransactionInfo() {\n        // ...\n      }\n    });\n  } catch (TransactionalExecutor.ExecutionException e) {\n    // ...\n  }\n}\n```\n\nhandleGlobalTransaction()  TransactionalTemplate  execute \n\nio.seata.tm.api.TransactionalTemplate#execute\n\n```java\npublic Object execute(TransactionalExecutor business) throws Throwable {\n  // 1. get or create a transaction\n  GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n\n  // 1.1 get transactionInfo\n  TransactionInfo txInfo = business.getTransactionInfo();\n  if (txInfo == null) {\n    throw new ShouldNeverHappenException(\"transactionInfo does not exist\");\n  }\n  try {\n\n    // 2. begin transaction\n    beginTransaction(txInfo, tx);\n\n    Object rs = null;\n    try {\n\n      // Do Your Business\n      rs = business.execute();\n\n    } catch (Throwable ex) {\n\n      // 3.the needed business exception to rollback.\n      completeTransactionAfterThrowing(txInfo,tx,ex);\n      throw ex;\n    }\n\n    // 4. everything is fine, commit.\n    commitTransaction(tx);\n\n    return rs;\n  } finally {\n    //5. clear\n    triggerAfterCompletion();\n    cleanUp();\n  }\n}\n```\n\n API  Spring  Mybatis-spring \n\n\n\n# \n\n channel  RegisterRMRequest/RegisterTMRequest  ServerMessageListener \n\nio.seata.core.rpc.ServerMessageListener\n\n```java\npublic interface ServerMessageListener {\n  // \n  void onTrxMessage(RpcMessage request, ChannelHandlerContext ctx, ServerMessageSender sender);\n\t//  RM \n  void onRegRmMessage(RpcMessage request, ChannelHandlerContext ctx,\n                      ServerMessageSender sender, RegisterCheckAuthHandler checkAuthHandler);\n  //  TM \n  void onRegTmMessage(RpcMessage request, ChannelHandlerContext ctx,\n                      ServerMessageSender sender, RegisterCheckAuthHandler checkAuthHandler);\n  // \n  void onCheckMessage(RpcMessage request, ChannelHandlerContext ctx, ServerMessageSender sender)\n\n}\n```\n\nChannelManager  channel  ChannelManager  channel TM  RM  channel \n\n```java\n/**\n * resourceId -> applicationId -> ip -> port -> RpcContext\n */\nprivate static final ConcurrentMap<String, ConcurrentMap<String, ConcurrentMap<String, ConcurrentMap<Integer,\nRpcContext>>>>\n  RM_CHANNELS = new ConcurrentHashMap<String, ConcurrentMap<String, ConcurrentMap<String, ConcurrentMap<Integer,\nRpcContext>>>>();\n\n/**\n * ip+appname,port\n */\nprivate static final ConcurrentMap<String, ConcurrentMap<Integer, RpcContext>> TM_CHANNELS\n  = new ConcurrentHashMap<String, ConcurrentMap<Integer, RpcContext>>();\n```\n\n Map \n\nRM_CHANNELS\n\n1. resourceId  RM client \n2. applicationId  RM client  Id springboot  spring.application.name=account-service  account-service   applicationId\n3. ip  RM client \n4. port  RM client \n5. RpcContext \n\nTM_CHANNELS\n\n1. ip+appname appname+ip TM_CHANNELS  Map  key  appname+ip\n2. port\n\n RM Client \n\nio.seata.core.rpc.ChannelManager#registerRMChannel\n\n```java\npublic static void registerRMChannel(RegisterRMRequest resourceManagerRequest, Channel channel)\n  throws IncompatibleVersionException {\n  Version.checkVersion(resourceManagerRequest.getVersion());\n  //  ResourceIds set\n  Set<String> dbkeySet = dbKeytoSet(resourceManagerRequest.getResourceIds());\n  RpcContext rpcContext;\n  // channel\n  if (!IDENTIFIED_CHANNELS.containsKey(channel)) {\n    //  rpcContext\n    rpcContext = buildChannelHolder(NettyPoolKey.TransactionRole.RMROLE, resourceManagerRequest.getVersion(),\n                                    resourceManagerRequest.getApplicationId(), resourceManagerRequest.getTransactionServiceGroup(),\n                                    resourceManagerRequest.getResourceIds(), channel);\n    //  rpcContext \n    rpcContext.holdInIdentifiedChannels(IDENTIFIED_CHANNELS);\n  } else {\n    rpcContext = IDENTIFIED_CHANNELS.get(channel);\n    rpcContext.addResources(dbkeySet);\n  }\n  if (null == dbkeySet || dbkeySet.isEmpty()) { return; }\n  for (String resourceId : dbkeySet) {\n    String clientIp;\n    //  RM_CHANNELS  java8  computeIfAbsent \n    ConcurrentMap<Integer, RpcContext> portMap = RM_CHANNELS.computeIfAbsent(resourceId, resourceIdKey -> new ConcurrentHashMap<>())\n      .computeIfAbsent(resourceManagerRequest.getApplicationId(), applicationId -> new ConcurrentHashMap<>())\n      .computeIfAbsent(clientIp = getClientIpFromChannel(channel), clientIpKey -> new ConcurrentHashMap<>());\n\t\t//  rpcContext  portMap \n    rpcContext.holdInResourceManagerChannels(resourceId, portMap);\n    updateChannelsResource(resourceId, clientIp, resourceManagerRequest.getApplicationId());\n  }\n}\n```\n\n RM client  RM_CHANNELS  IDENTIFIED_CHANNELS  channel IDENTIFIED_CHANNELS \n\n```java\nprivate static final ConcurrentMap<Channel, RpcContext> IDENTIFIED_CHANNELS\n  = new ConcurrentHashMap<>();\n```\n\nIDENTIFIED_CHANNELS  TM  RM  channel\n\n TM \n\nio.seata.core.rpc.ChannelManager#registerTMChannel\n\n```java\npublic static void registerTMChannel(RegisterTMRequest request, Channel channel)\n  throws IncompatibleVersionException {\n  Version.checkVersion(request.getVersion());\n  //  RpcContext\n  RpcContext rpcContext = buildChannelHolder(NettyPoolKey.TransactionRole.TMROLE, request.getVersion(),\n                                             request.getApplicationId(),\n                                             request.getTransactionServiceGroup(),\n                                             null, channel);\n  //  RpcContext  IDENTIFIED_CHANNELS \n  rpcContext.holdInIdentifiedChannels(IDENTIFIED_CHANNELS);\n  // account-service:127.0.0.1:63353\n  String clientIdentified = rpcContext.getApplicationId() + Constants.CLIENT_ID_SPLIT_CHAR\n    + getClientIpFromChannel(channel);\n  //  TM_CHANNELS \n  TM_CHANNELS.putIfAbsent(clientIdentified, new ConcurrentHashMap<Integer, RpcContext>());\n  // getrpcContextmapvalue\n  ConcurrentMap<Integer, RpcContext> clientIdentifiedMap = TM_CHANNELS.get(clientIdentified);\n  rpcContext.holdInClientChannels(clientIdentifiedMap);\n}\n```\n\nTM client  RM client  RM client  TM client \n\n 0.9.0 \n\n\n# \n\n Java [https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "/design-more-flexable-application-by-saga",
          "metadata": {
            "permalink": "/blog/design-more-flexable-application-by-saga",
            "source": "@site/blog/design-more-flexable-application-by-saga.md",
            "title": " Seata Saga ",
            "description": "Seata saga",
            "date": "2019-11-04T00:00:00.000Z",
            "formattedDate": "November 4, 2019",
            "tags": [],
            "readingTime": 28.77,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "long187"
              }
            ],
            "frontMatter": {
              "title": " Seata Saga ",
              "keywords": [
                "Saga",
                "Seata",
                "",
                "",
                "",
                "",
                ""
              ],
              "description": "Seata saga",
              "author": "long187",
              "date": "2019-11-04T00:00:00.000Z"
            },
            "prevItem": {
              "title": "Seata AT ",
              "permalink": "/blog/seata-at-mode-start"
            },
            "nextItem": {
              "title": " Seata ",
              "permalink": "/blog/seata-at-tcc-saga"
            }
          },
          "content": "Seata Simple Extensible Autonomous Transaction Architecture ATTCCSaga  XA  Saga <br />[https://github.com/seata/seata](https://github.com/seata/seata)\n\nSeata Committer\n\n<a name=\"uTwja\"></a>\n# \n\n----\n\n\n\n\n\n- ****<br />\n\n catch \n\n- ****<br />\n\n\n\n- ****<br />\n\n\n\n- ****<br />\n\n\n\n<a name=\"hvEU6\"></a>\n\n# \n\n\n\n TCC \n\n TryConfirmCancel  TCC \n\n ACID CAP  ACID  BASEACID CAP  C BASE CAP  A ACID BASE \n\n30Saga  Saga \n> [https://github.com/aphyr/dist-sagas/blob/master/sagas.pdf](https://github.com/aphyr/dist-sagas/blob/master/sagas.pdf)[1]\n> [http://microservices.io/patterns/data/saga.html](http://microservices.io/patterns/data/saga.html)[2]\n\n\n<a name=\"k8kbY\"></a>\n\n# \n\n<a name=\"Oc5Er\"></a>\n## Apache Camel Saga\n\nCamel  EIPEnterprise Integration Patterns2.21 Saga EIP\n\nSaga EIP  camel route  Action Action Saga Saga Camel  Saga EIP [Microprofile  LRA](https://github.com/eclipse/microprofile-sandbox/tree/master/proposals/0009-LRA)[3]Long Running Action\n\nSaga  Camel route  Java  XML DSLDefinition Specific Language\n\n Java DSL \n```java\n// action\nfrom(\"direct:reserveCredit\")\n  .bean(idService, \"generateCustomId\") // generate a custom Id and set it in the body\n  .to(\"direct:creditReservation\")\n\n// delegate action\nfrom(\"direct:creditReservation\")\n  .saga()\n  .propagation(SagaPropagation.SUPPORTS)\n  .option(\"CreditId\", body()) // mark the current body as needed in the compensating action\n  .compensation(\"direct:creditRefund\")\n    .bean(creditService, \"reserveCredit\")\n    .log(\"Credit ${header.amount} reserved. Custom Id used is ${body}\");\n\n// called only if the saga is cancelled\nfrom(\"direct:creditRefund\")\n  .transform(header(\"CreditId\")) // retrieve the CreditId option from headers\n  .bean(creditService, \"refundCredit\")\n  .log(\"Credit for Custom Id ${body} refunded\");\n```\n\nXML DSL \n```xml\n<route>\n  <from uri=\"direct:start\"/>\n  <saga>\n    <compensation uri=\"direct:compensation\" />\n    <completion uri=\"direct:completion\" />\n    <option optionName=\"myOptionKey\">\n      <constant>myOptionValue</constant>\n    </option>\n    <option optionName=\"myOptionKey2\">\n      <constant>myOptionValue2</constant>\n    </option>\n  </saga>\n  <to uri=\"direct:action1\" />\n  <to uri=\"direct:action2\" />\n</route>\n```\n\n<a name=\"pQWuF\"></a>\n\n## Eventuate Tram Saga\n\n[Eventuate Tram Saga](https://github.com/eventuate-tram/eventuate-tram-sagas)[4] JDBC / JPA  Java  Saga  Camel Saga Java DSL \n\n```java\npublic class CreateOrderSaga implements SimpleSaga<CreateOrderSagaData> {\n\n  private SagaDefinition<CreateOrderSagaData> sagaDefinition =\n          step()\n            .withCompensation(this::reject)\n          .step()\n            .invokeParticipant(this::reserveCredit)\n          .step()\n            .invokeParticipant(this::approve)\n          .build();\n\n\n  @Override\n  public SagaDefinition<CreateOrderSagaData> getSagaDefinition() {\n    return this.sagaDefinition;\n  }\n\n\n  private CommandWithDestination reserveCredit(CreateOrderSagaData data) {\n    long orderId = data.getOrderId();\n    Long customerId = data.getOrderDetails().getCustomerId();\n    Money orderTotal = data.getOrderDetails().getOrderTotal();\n    return send(new ReserveCreditCommand(customerId, orderId, orderTotal))\n            .to(\"customerService\")\n            .build();\n\n...\n```\n\n<a name=\"scN9h\"></a>\n\n## Apache ServiceComb Saga\n\n[ServiceComb Saga](https://github.com/apache/incubator-servicecomb-saga)[5][TCC](http://design.inf.usi.ch/sites/default/files/biblio/rest-tcc.pdf) try Saga  rollback  Java +<br />\n\n<a name=\"ouwrmp\"></a>\n\n#### \n\nSaga **alpha****omega**\n\n- alpha <br />\n- omega  agent alpha <br />\n\n alphaomega <br />\n![ServiceComb Saga](/img/saga/service-comb-saga.png?raw=true)\n\n<a name=\"ggflbq\"></a>\n\n#### \n```java\npublic class ServiceA extends AbsService implements IServiceA {\n\n  private static final Logger LOG = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n\n  @Autowired\n  private IServiceB serviceB;\n\n  @Autowired\n  private IServiceC serviceC;\n\n  @Override\n  public String getServiceName() {\n    return \"servicea\";\n  }\n\n  @Override\n  public String getTableName() {\n    return \"testa\";\n  }\n\n  @Override\n  @SagaStart\n  @Compensable(compensationMethod = \"cancelRun\")\n  @Transactional(rollbackFor = Exception.class)\n  public Object run(InvokeContext invokeContext) throws Exception {\n    LOG.info(\"A.run called\");\n    doRunBusi();\n    if (invokeContext.isInvokeB(getServiceName())) {\n      serviceB.run(invokeContext);\n    }\n    if (invokeContext.isInvokeC(getServiceName())) {\n      serviceC.run(invokeContext);\n    }\n    if (invokeContext.isException(getServiceName())) {\n      LOG.info(\"A.run exception\");\n      throw new Exception(\"A.run exception\");\n    }\n    return null;\n  }\n\n  public void cancelRun(InvokeContext invokeContext) {\n    LOG.info(\"A.cancel called\");\n    doCancelBusi();\n  }\n```\n\n<a name=\"CnD8r\"></a>\n\n## \n\n TCC  TCC  Saga  BU \n\n- \n-  DSL\n\n<a name=\"MAZEu\"></a>\n\n## \n\n DSL  Java +\n\n| ****         | ****                                                                                                                                                                                                                                                                                                                                                            | ****                                                                                                                                                                      |\n| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| +DSL       | <br />- <br />- <br />- <br />- <br />-  Actor  SEDA <br /> | <br />-  JAVA  DSL <br />- <br />- <br />                     |\n| +java  | <br />- <br />- <br />- <br />                                                                                                                                                                                                                                          | <br />-  Actor  SEDA <br />- <br />- <br /> |\n\n\n<a name=\"EKm6f\"></a>\n\n# \n\n<a name=\"tw6CG\"></a>\n\n# Seata Saga \n\nSeata Saga [Seata Saga ](http://seata.io/zh-cn/docs/user/saga.html)[6]\n\nSeata Saga +DSL \n\n- +DSL \n-  Actor  SEDA \n- +DSL \n-  Saga ,  A  B AA +DSL, \n\n> , \n\n\n<a name=\"4yL9U\"></a>\n\n### (Seata State Language)\n\n1.  json \n2. \n3.  json \n> : \n\n4. \n\nInventoryServiceBalanceService reduce  compensateReduce InventoryService \n\n```java\npublic interface InventoryService {\n\n    /**\n     * reduce\n     * @param businessKey\n     * @param amount\n     * @param params\n     * @return\n     */\n    boolean reduce(String businessKey, BigDecimal amount, Map<String, Object> params);\n\n    /**\n     * compensateReduce\n     * @param businessKey\n     * @param params\n     * @return\n     */\n    boolean compensateReduce(String businessKey, Map<String, Object> params);\n}\n```\n\n\n\n![](/img/saga/demo_statelang.png?raw=true)\n<br /> JSON\n\n```json\n{\n    \"Name\": \"reduceInventoryAndBalance\",\n    \"Comment\": \"reduce inventory then reduce balance in a transaction\",\n    \"StartState\": \"ReduceInventory\",\n    \"Version\": \"0.0.1\",\n    \"States\": {\n        \"ReduceInventory\": {\n            \"Type\": \"ServiceTask\",\n            \"ServiceName\": \"inventoryAction\",\n            \"ServiceMethod\": \"reduce\",\n            \"CompensateState\": \"CompensateReduceInventory\",\n            \"Next\": \"ChoiceState\",\n            \"Input\": [\n                \"$.[businessKey]\",\n                \"$.[count]\"\n            ],\n            \"Output\": {\n                \"reduceInventoryResult\": \"$.#root\"\n            },\n            \"Status\": {\n                \"#root == true\": \"SU\",\n                \"#root == false\": \"FA\",\n                \"$Exception{java.lang.Throwable}\": \"UN\"\n            }\n        },\n        \"ChoiceState\":{\n            \"Type\": \"Choice\",\n            \"Choices\":[\n                {\n                    \"Expression\":\"[reduceInventoryResult] == true\",\n                    \"Next\":\"ReduceBalance\"\n                }\n            ],\n            \"Default\":\"Fail\"\n        },\n        \"ReduceBalance\": {\n            \"Type\": \"ServiceTask\",\n            \"ServiceName\": \"balanceAction\",\n            \"ServiceMethod\": \"reduce\",\n            \"CompensateState\": \"CompensateReduceBalance\",\n            \"Input\": [\n                \"$.[businessKey]\",\n                \"$.[amount]\",\n                {\n                    \"throwException\" : \"$.[mockReduceBalanceFail]\"\n                }\n            ],\n            \"Output\": {\n                \"compensateReduceBalanceResult\": \"$.#root\"\n            },\n            \"Status\": {\n                \"#root == true\": \"SU\",\n                \"#root == false\": \"FA\",\n                \"$Exception{java.lang.Throwable}\": \"UN\"\n            },\n            \"Catch\": [\n                {\n                    \"Exceptions\": [\n                        \"java.lang.Throwable\"\n                    ],\n                    \"Next\": \"CompensationTrigger\"\n                }\n            ],\n            \"Next\": \"Succeed\"\n        },\n        \"CompensateReduceInventory\": {\n            \"Type\": \"ServiceTask\",\n            \"ServiceName\": \"inventoryAction\",\n            \"ServiceMethod\": \"compensateReduce\",\n            \"Input\": [\n                \"$.[businessKey]\"\n            ]\n        },\n        \"CompensateReduceBalance\": {\n            \"Type\": \"ServiceTask\",\n            \"ServiceName\": \"balanceAction\",\n            \"ServiceMethod\": \"compensateReduce\",\n            \"Input\": [\n                \"$.[businessKey]\"\n            ]\n        },\n        \"CompensationTrigger\": {\n            \"Type\": \"CompensationTrigger\",\n            \"Next\": \"Fail\"\n        },\n        \"Succeed\": {\n            \"Type\":\"Succeed\"\n        },\n        \"Fail\": {\n            \"Type\":\"Fail\",\n            \"ErrorCode\": \"PURCHASE_FAILED\",\n            \"Message\": \"purchase failed\"\n        }\n    }\n}\n```\n\n[AWS Step Functions](https://docs.aws.amazon.com/zh_cn/step-functions/latest/dg/tutorial-creating-lambda-state-machine.html)[7]\n\n<a name=\"2de9b28a\"></a>\n\n#### \"\" :\n\n- Name: \n- Comment: \n- Version: \n- StartState: \"\"\n- States:  map key \"\"\n\n<a name=\"2b956670\"></a>\n\n#### \"\" :\n\n- Type\"\" \n  - ServiceTask: \n  - Choice: \n  - CompensationTrigger: \n  - Succeed: \n  - Fail: \n  - SubStateMachine: \n- ServiceName: beanId\n- ServiceMethod: \n- CompensateState: \"\"\"\"\n- Input:  $.[SpringEL](https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html)[8] \n- Output:  map key  key mapvalue  $.  SpringEL #root \n- Status: SU FA UN  map key  SpringEL  $Exception{value \n- Catch: \n- Next: \"\"\n- Choices: Choice \"\", ,  Expression  SpringEL Next \"\"\n- ErrorCode: Fail \"\"\n- Message: Fail \"\"\n\n[Seata Saga ](http://seata.io/zh-cn/docs/user/saga.html)[6[http://seata.io/zh-cn/docs/user/saga.html](http://seata.io/zh-cn/docs/user/saga.html)]\n\n<a name=\"209f0e37\"></a>\n\n### :\n\n![](/img/saga/saga_engine_mechanism.png?raw=true)\n\n-  stateA,  stataB stateC\n- \"\"stataA  EventQueue EventQueue  stateB\n-  Seata Server  xid, \"\"\n- \"\" Seata Server  branchId, \"\"\n- \"\"\"\",  Seata Server \n- \"\",  Seata Server \n\n<a name=\"808e95dc\"></a>\n\n### :\n\n![](/img/saga/saga_engine.png?raw=true)\n\n, \n\n- Eventing \n  - , , , \n\n- ProcessController \n  -  Eventing \"state\"\n> \"\"\n\n\n- StateMachineEngine \n  -  state \n  -  API\n\n<a name=\"73a9fddd\"></a>\n\n### Saga \n\n Saga  100% \n> Seata Saga  Saga \n\n\n<a name=\"d64c5051\"></a>\n\n#### \n\n- \n- \n  -  \n  - Saga  \n  - \n\n\n\n<a name=\"88a92b17\"></a>\n\n#### \n\n-    \n- \n  -  \n  - Saga  \n  - \n\n\n\n<a name=\"ce766631\"></a>\n\n#### \n\n- , \n\n<a name=\"FO5YS\"></a>\n\n# \n\n BASE  Saga  Seata Saga Saga \n\n- \n- \n- \n- \n\n<a name=\"3X7vO\"></a>\n\n## \n\n[1][https://github.com/aphyr/dist-sagas/blob/master/sagas.pdf](https://github.com/aphyr/dist-sagas/blob/master/sagas.pdf)<br />[2][http://microservices.io/patterns/data/saga.html](http://microservices.io/patterns/data/saga.html)<br />[3][Microprofile  LRA](https://github.com/eclipse/microprofile-sandbox/tree/master/proposals/0009-LRA)[https://github.com/eclipse/microprofile-sandbox/tree/master/proposals/0009-LRA](https://github.com/eclipse/microprofile-sandbox/tree/master/proposals/0009-LRA)<br />[4][Eventuate Tram Saga](https://github.com/eventuate-tram/eventuate-tram-sagas)[https://github.com/eventuate-tram/eventuate-tram-sagas](https://github.com/eventuate-tram/eventuate-tram-sagas)<br />[5][ServiceComb Saga](https://github.com/apache/incubator-servicecomb-saga)[https://github.com/apache/servicecomb-pack](https://github.com/apache/servicecomb-pack)<br />[6][Seata Saga ](http://seata.io/zh-cn/docs/user/saga.html)[http://seata.io/zh-cn/docs/user/saga.html](http://seata.io/zh-cn/docs/user/saga.html)<br />[7][AWS Step Functions](https://docs.aws.amazon.com/zh_cn/step-functions/latest/dg/tutorial-creating-lambda-state-machine.html)[https://docs.aws.amazon.com/zh_cn/step-functions/latest/dg/tutorial-creating-lambda-state-machine.html](https://docs.aws.amazon.com/zh_cn/step-functions/latest/dg/tutorial-creating-lambda-state-machine.html)<br />[8][SpringEL](https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html)[https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html](https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html)<br />"
        },
        {
          "id": "/seata-at-tcc-saga",
          "metadata": {
            "permalink": "/blog/seata-at-tcc-saga",
            "source": "@site/blog/seata-at-tcc-saga.md",
            "title": " Seata ",
            "description": " Seata ATTCCSaga",
            "date": "2019-08-11T00:00:00.000Z",
            "formattedDate": "August 11, 2019",
            "tags": [],
            "readingTime": 25.685,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "long187"
              }
            ],
            "frontMatter": {
              "title": " Seata ",
              "keywords": [
                "Saga",
                "Seata",
                "AT",
                "TCC",
                "",
                "",
                "",
                ""
              ],
              "description": " Seata ATTCCSaga",
              "author": "long187",
              "date": "2019-08-11T00:00:00.000Z"
            },
            "prevItem": {
              "title": " Seata Saga ",
              "permalink": "/blog/design-more-flexable-application-by-saga"
            },
            "nextItem": {
              "title": " Seata ",
              "permalink": "/blog/seata-at-mode-design"
            }
          },
          "content": "Seata Committer\n<br /> 8  11  SOFA Meetup#3   Seata  Seata ATTCCSaga\n\n PPT \n\n![3  Seata -.jpg](/img/saga/sofameetup3_img/1.jpeg)\n\n<a name=\"Ad95d\"></a>\n## \n\n<a name=\"Q2ayF\"></a>\n### 1.1  -\n\n\n\n\n\n![image.png](/img/saga/sofameetup3_img/2.png)\n\n\n<a name=\"WBQbC\"></a>\n### 1.2  -\n\n\n\nSOA\n\n![image.png](/img/saga/sofameetup3_img/3.png)\n\n\n\n\n<a name=\"3oIxE\"></a>\n## \n\n<a name=\"akRiW\"></a>\n### 2.1\n\n![16_16_18__08_13_2019.jpg](/img/saga/sofameetup3_img/4.jpeg)\n\n\n\n<a name=\"8tfKI\"></a>\n### 2.2TCC\n\n![16_16_51__08_13_2019.jpg](/img/saga/sofameetup3_img/5.jpeg)\n\nTCCTry-Confirm-Cancel  Try  Try  Confirm  Cancel \n\n<a name=\"IXxpF\"></a>\n### 2.3 Saga\n\n![3  Seata --9.jpg](/img/saga/sofameetup3_img/6.jpeg)\n\nSaga  Saga \n\n\n\nSaga Hector & Kenneth 1987 Sagas<br />\n<br />Saga \n\n<a name=\"fZPaN\"></a>\n## Seata\n\n<a name=\"IgVM7\"></a>\n### 3.1  Seata \n\nSeataSimple Extensible Autonomous Transaction Architecture 2019  1 Seata  1.1  star Seata  Seata \n\nSeata[https://](https://github.com/seata/seata)[github.com/seata/seata](https://github.com/seata/seata)<br />\n<br />![image.png](/img/saga/sofameetup3_img/7.png)\n\n<a name=\"zyy0l\"></a>\n### 3.2  Seata \n\nSeata  TMRM  TC  TM  RM  Seata TC  Seata \n\n![image.png](/img/saga/sofameetup3_img/8.png)\n\n Seata \n\n- TM TM  TC \n- RM  TC \n- TM TM  TC/\n- TC \n- TC  RM / \n\n<a name=\"1QKqI\"></a>\n### 3.3  Seata \n\nSeata  4  AT TCC Saga  XA \n\n![15_49_23__08_13_2019.jpg](/img/saga/sofameetup3_img/9.jpeg)<br />\n\n<a name=\"784n4\"></a>\n#### 2.3.1 AT \n\n 1 Seata  AT AT  AT  SQL  SQLSeata \n\n![image.png](/img/saga/sofameetup3_img/10.png)<br />\n\n<a name=\"Acfeo\"></a>\n##### AT  \n\n- \n\nSeata  SQL SQL  SQLbefore image SQLafter image\n\n![3.png](/img/saga/sofameetup3_img/11.png)\n\n- \n\n SQL  Seata \n\n![4.png](/img/saga/sofameetup3_img/12.png)\n\n- \n\nSeata  SQLbefore image after image\n\n![5.png](/img/saga/sofameetup3_img/13.png)\n\nAT  Seata  SQLAT \n\n<a name=\"FnD1S\"></a>\n#### 2.3.2 TCC \n\n2019  3 Seata  TCC TCC  TryConfirm  Cancel  Try  Confirm  Cancel \n\n![6.png](/img/saga/sofameetup3_img/14.png)\n\nTCC \n\n- Try\n- Confirm Try  Confirm \n- Cancel\n\n** TCC **<br />**<br />![16_48_02__08_13_2019.jpg](/img/saga/sofameetup3_img/15.jpeg)\n\n**1 TCC  -  2 **\n\n TCC \n\n TCC  A  SQL  TCC  Try   Confirm \n\n![7.png](/img/saga/sofameetup3_img/16.png)\n\n\n\nTry Try  A  Try  A  100 30 \n\n Confirm Confirm  Try Confirm  A  30  A  70  \n\n Cancel  Try  30  A 100 \n\n TCC  2  TCC  3  Try  Confirm  AT TCC  TCC  AT TCC  AT \n\n**2 TCC  - **<br />**<br />![16_51_44__08_13_2019.jpg](/img/saga/sofameetup3_img/17.jpeg)\n\nCancel  Try  Cancel  Cancel  xid  Cancel \n\n**3 TCC  - **<br />**<br />![16_51_56__08_13_2019.jpg](/img/saga/sofameetup3_img/18.jpeg)\n\nCancel  Try  Try  Cancel  Try  Cancel  Try  Try  Cancel  xid Try xid Try \n\n**4 TCC  - **<br />**<br />![16_52_07__08_13_2019.jpg](/img/saga/sofameetup3_img/19.jpeg)\n\n xid \n\n<a name=\"dsMch\"></a>\n#### 2.3.3 Saga \n\nSaga  Seata  Saga \n\n\n\n![8.png](/img/saga/sofameetup3_img/20.png)\n\n\nSaga Saga \n\n**1 Saga **<br />**<br />![16_44_58__08_13_2019.jpg](/img/saga/sofameetup3_img/21.jpeg)\n\nSaga Saga \n\n TCC  Saga \n\nSaga\n\n- \n- \n- \n\nSaga <br />**2  Saga **\n\n![17_13_19__08_13_2019.jpg](/img/saga/sofameetup3_img/22.png)\n\n Saga Seata Seata  json \n\n**3 **<br />\n\n![16_45_32__08_13_2019.jpg](/img/saga/sofameetup3_img/23.png)\n\n<br />\n\n**4 **\n\n![16_45_46__08_13_2019.jpg](/img/saga/sofameetup3_img/24.jpeg)\n\n EventBus  Pub-Sub  process  route  API \n\n**5 Saga **\n\nTCCSaga\n\n**1Saga  - **<br />**<br />![16_52_22__08_13_2019.jpg](/img/saga/sofameetup3_img/25.jpeg)\n\n**2Saga  - **<br />**<br />![16_52_52__08_13_2019.jpg](/img/saga/sofameetup3_img/26.jpeg)\n\n**3Saga  - **<br />**<br />![3  Seata --31.jpg](/img/saga/sofameetup3_img/27.jpeg)\n\n**4Saga  - **<br />**<br />![16_53_07__08_13_2019.jpg](/img/saga/sofameetup3_img/28.jpeg)\n\n Saga Server \n\n Saga \n\n**6  Saga **<br />**<br />![17_13_37__08_13_2019.jpg](/img/saga/sofameetup3_img/29.jpeg)\n\n Saga +Seata one  @SagaCompensable  one  compensateOne  processA  @SagaTransactional  Saga \n\n**7  Saga **\n\n Saga \n\n![17_13_49__08_13_2019.jpg](/img/saga/sofameetup3_img/30.jpeg)\n\n Saga \n\n<a name=\"Gpkrf\"></a>\n## \n\n Seata ATTCCSaga\n\nSeata  XA AT 0TCC Saga Saga  TCC  Saga \n\nPPT [https://tech.antfin.com/community/activities/779/review](https://tech.antfin.com/community/activities/779/review)"
        },
        {
          "id": "/seata-at-mode-design",
          "metadata": {
            "permalink": "/blog/seata-at-mode-design",
            "source": "@site/blog/seata-at-mode-design.md",
            "title": " Seata ",
            "description": "AT ",
            "date": "2019-07-11T00:00:00.000Z",
            "formattedDate": "July 11, 2019",
            "tags": [],
            "readingTime": 14.945,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": " Seata ",
              "author": "",
              "keywords": [
                "SeataAT"
              ],
              "description": "AT ",
              "date": "2019/07/11"
            },
            "prevItem": {
              "title": " Seata ",
              "permalink": "/blog/seata-at-tcc-saga"
            },
            "nextItem": {
              "title": "SeataGo Server-TaaS",
              "permalink": "/blog/seata-analysis-go-server"
            }
          },
          "content": " CAP  BASE \n\n Fescar SeataSeata  Seata \n\n\n\n\n# \n\n XA 2PC XA  XA \n\n TCC  TCC  ByteTCCtcc-transaction  RocketMQ \n\n TCC \n\n\n\n# Seata \n\nSeata \n\n Seata \n\nSeata  ACID \n\nSeata  3\n\n- Transaction Coordinator (TC) \n- Transaction Manager (TM) \n- Resource Manager (RM) \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata.png)\n\n\n\n1. TM  TC TC  XIDXID \n2. RM  TC  XID \n3. TM  TC \n4. TC  XID \n\n\n\n#  XA \n\nSeata  XA \n\n XA  XA  XA  XA  XA \n\n XA Seata  Seata  RM  RM  RM \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata5.png)\n\nSeata  Seata  Seata  DataSourceProxySeata  SQL undo log  undo_log  sql \n\n TC  TM TC  RM  undo log  TM RM  TC RM  XID  undo log \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata6.png)\n\nXA  RM  XA \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/Seata7.png)\n\nSeata  RM \n\n\n\n# \n\n\n\n- \n\n\n RM  JDBC  SQL  undo log  ACID  SQL  undo log  SQL  TC \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata2.png)\n\n- \n\n\nTM\n\n TM TC  RM  undo log \n\n\n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata3.png)\n\n\n\nTM\n\n TM RM  TC RM  XID  undo log  ACID  undo log  TC \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata4.png)\n\n Seata  Seata  Seata  Seata  XA \n\n\n\n# \n\n Seata  AT  XA  ACID  ACID  ACID  Seata Seata  MT  Prepare/Commit/Rollback 3  MT  Seata \n\n![](https://gitee.com/objcoding/md-picture/raw/master/img/seata8.png)\n\n Seata Seata \n\n*Seata*\n\n# \n\n Java [https://objcoding.com/](https://objcoding.com/)Seata ContributorGitHub IDobjcoding"
        },
        {
          "id": "/seata-analysis-go-server",
          "metadata": {
            "permalink": "/blog/seata-analysis-go-server",
            "source": "@site/blog/seata-analysis-go-server.md",
            "title": "SeataGo Server-TaaS",
            "description": "",
            "date": "2019-04-23T00:00:00.000Z",
            "formattedDate": "April 23, 2019",
            "tags": [],
            "readingTime": 6.17,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "fagongzi(zhangxu19830126@gmail.com)"
              }
            ],
            "frontMatter": {
              "title": "SeataGo Server-TaaS",
              "author": "fagongzi(zhangxu19830126@gmail.com)",
              "date": "2019/04/23",
              "keywords": [
                "seata"
              ]
            },
            "prevItem": {
              "title": " Seata ",
              "permalink": "/blog/seata-at-mode-design"
            },
            "nextItem": {
              "title": "Fescar  Spring Cloud ",
              "permalink": "/blog/how-to-support-spring-cloud"
            }
          },
          "content": "### \nTaaS  Seata TC, Transaction Coordinator `Golang` Taas InfiniVision (http://infinivision.cn) Seata Seata \n\nSeataGTSTaaS(Transaction as a Service)\n\nTaaSSeataFescarSeataTaaSSeata\n\nSeataSeataTaaS Seata\n\nSeataJavaTaaS\n\nTaaS github (https://github.com/seata/seata-go-server)\n\n### \n1. \n2. Leader\n3. Auto-Rebalance\n4. \n\n### \n![](/img/blog/taas.png)\n\n#### \nTaaSTaaS`Fragment`FragmentFragmentFragmentFragment\n\n#### \n`Fragment`LeaderLeaderLeaderLeaderLeaderFragment\n\n#### \nTaaSElasticell   (https://github.com/deepfabric/elasticell) ElasticellredisKVRaft\n\n#### Auto-Rebalance\n`Fragment``Fragment`TaaS3`Fragment`FragmentLeaderFragment\n\n##### Fragment\n![](/img/blog/taas_add.png)\n\n1. t0Fragment1Seata-TC1\n2. t1Fragment1Fragment1'Seata-TC2\n3. t2Fragment1Fragment1\"Seata-TC3\n\nt2Fragment1\n\n##### Fragment\n![](/img/blog/taas_move.png)\n1. t04FragmentSeata-TC1Seata-TC2Seata-TC3\n2. t1Seata-TC4\n3. t23FragmentSeata-TC4\n\n### \n\n* Seata 39.97.115.141:8091\n* UI http://39.97.115.141:8084/ui/index.html\n\n### \ndocker-composeTaaS\n```bash\ngit clone https://github.com/seata/taas.git\ndocker-compse up -d\n```\ndocker-compose30\n\n#### Seata\n8091Seata\n\n#### Seata UI \nWEB UI `http://127.0.0.1:8084/ui/index.html`\n\n### InfiniVision\n InsightFace (https://github.com/deepinsight/insightface) () Elasticell (https://github.com/deepfabric/elasticell) \n\n### \nGateway (https://github.com/fagongzi/gateway) InfiniVision"
        },
        {
          "id": "/how-to-support-spring-cloud",
          "metadata": {
            "permalink": "/blog/how-to-support-spring-cloud",
            "source": "@site/blog/how-to-support-spring-cloud.md",
            "title": "Fescar  Spring Cloud ",
            "description": "Fescar ",
            "date": "2019-04-15T00:00:00.000Z",
            "formattedDate": "April 15, 2019",
            "tags": [],
            "readingTime": 20.04,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": " "
              }
            ],
            "frontMatter": {
              "title": "Fescar  Spring Cloud ",
              "author": " ",
              "date": "2019/04/15",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "SeataGo Server-TaaS",
              "permalink": "/blog/seata-analysis-go-server"
            },
            "nextItem": {
              "title": "SeataFescar  Spring Cloud",
              "permalink": "/blog/integrate-seata-with-spring-cloud"
            }
          },
          "content": "### Fescar \n\n 2PC  XA (e.g. atomikos) TCC( e.g. byteTCC) ( e.g. RocketMQ Half Message) XA  TCC \n\n Fescar 6k StarFescar  **Fast & Easy Commit And Rollback**  Fescar  RDBMS XA TCC \n\n XAFescar  TCRMTM\n\n![Fescar](/img/blog/fescar-microservices.png)\n\n```\n1. TM  TC  XID\n2. XID \n3. RM  TC  XID \n4. TM  TC  XID \n5. TC  XID \n```\n\n TC TM RM RM  JDBC  undo log Fescar \n\n### Fescar \n\nFescar Fescar Fescar  API  XID  XID \n\nRPC  XID  XID RPC XID  Filter  Interceptor  Spring Cloud Fescar \n\n### Fescar  Spring Cloud Alibaba  \n\n spring-cloud-alibaba-fescar.  AutoConfiguration RestTemplate  Feign Feign  Hystrix  Sentinel \n\n#### Fescar AutoConfiguration\n AutoConfiguration  Fescar  \n\nFescar  GlobalTransactionScannerGlobalTransactionScanner  Fescar  RM clientTM  client   GlobalTransactional GlobalTransactionScanner bean  GlobalTransactionAutoConfiguration FescarProperties   \nFescarProperties  Fescar  txServiceGroup  application.properties  key: spring.cloud.alibaba.fescar.txServiceGroup  ${spring.application.name}-fescar-service-group txServiceGroup  Fescar Apollo TC  TC nacosrediszkeureka TC  RM clientTM  client  TC  rpc \n\n#### \n\n Spring Cloud  RPC  HTTP  HandlerInterceptor HTTP\n\nHandlerInterceptor  Spring  \n\n```java\n    /**\n\t * Intercept the execution of a handler. Called after HandlerMapping determined\n\t * an appropriate handler object, but before HandlerAdapter invokes the handler.\n\t */\n\tdefault boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)\n\t\t\tthrows Exception {\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Intercept the execution of a handler. Called after HandlerAdapter actually\n\t * invoked the handler, but before the DispatcherServlet renders the view.\n\t * Can expose additional model objects to the view via the given ModelAndView.\n\t */\n\tdefault void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,\n\t\t\t@Nullable ModelAndView modelAndView) throws Exception {\n\t}\n\n\t/**\n\t * Callback after completion of request processing, that is, after rendering\n\t * the view. Will be called on any outcome of handler execution, thus allows\n\t * for proper resource cleanup.\n\t */\n\tdefault void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,\n\t\t\t@Nullable Exception ex) throws Exception {\n\t}\n```\n\n Fescar  preHandleafterCompletion \n\nFescarHandlerInterceptor  XIDFescarHandlerInterceptorConfiguration  url  XID \n\n```java\n/**\n * @author xiaojing\n *\n * Fescar HandlerInterceptor, Convert Fescar information into\n * @see com.alibaba.fescar.core.context.RootContext from http request's header in\n * {@link org.springframework.web.servlet.HandlerInterceptor#preHandle(HttpServletRequest , HttpServletResponse , Object )},\n * And clean up Fescar information after servlet method invocation in\n * {@link org.springframework.web.servlet.HandlerInterceptor#afterCompletion(HttpServletRequest, HttpServletResponse, Object, Exception)}\n */\npublic class FescarHandlerInterceptor implements HandlerInterceptor {\n\n\tprivate static final Logger log = LoggerFactory\n\t\t\t.getLogger(FescarHandlerInterceptor.class);\n\n\t@Override\n\tpublic boolean preHandle(HttpServletRequest request, HttpServletResponse response,\n\t\t\tObject handler) throws Exception {\n\n\t\tString xid = RootContext.getXID();\n\t\tString rpcXid = request.getHeader(RootContext.KEY_XID);\n\t\tif (log.isDebugEnabled()) {\n\t\t\tlog.debug(\"xid in RootContext {} xid in RpcContext {}\", xid, rpcXid);\n\t\t}\n\n\t\tif (xid == null && rpcXid != null) {\n\t\t\tRootContext.bind(rpcXid);\n\t\t\tif (log.isDebugEnabled()) {\n\t\t\t\tlog.debug(\"bind {} to RootContext\", rpcXid);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic void afterCompletion(HttpServletRequest request, HttpServletResponse response,\n\t\t\tObject handler, Exception e) throws Exception {\n\n\t\tString rpcXid = request.getHeader(RootContext.KEY_XID);\n\n\t\tif (StringUtils.isEmpty(rpcXid)) {\n\t\t\treturn;\n\t\t}\n\n\t\tString unbindXid = RootContext.unbind();\n\t\tif (log.isDebugEnabled()) {\n\t\t\tlog.debug(\"unbind {} from RootContext\", unbindXid);\n\t\t}\n\t\tif (!rpcXid.equalsIgnoreCase(unbindXid)) {\n\t\t\tlog.warn(\"xid in change during RPC from {} to {}\", rpcXid, unbindXid);\n\t\t\tif (unbindXid != null) {\n\t\t\t\tRootContext.bind(unbindXid);\n\t\t\t\tlog.warn(\"bind {} back to RootContext\", unbindXid);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n```\n\n\n\npreHandle xid rpcXid  HTTP Header preHandle  XID rpcXid  rpcXid \n\nafterCompletion Fescar  RootContext.unbind()  XID  if  rpcXid unbindXid  unbindXid \n\n Spring Cloud  RPC  HTTP  Header  XID \n\n#### \n\nFescar RestTemplateFeignFeign+Hystrix  Feign+Sentinel  Spring Boot  Auto Configuration  spring.factories \n\n#####  RestTemplate\n\n RestTemplate Fescar  XID \n\n```java\npublic class FescarRestTemplateInterceptor implements ClientHttpRequestInterceptor {\n\t@Override\n\tpublic ClientHttpResponse intercept(HttpRequest httpRequest, byte[] bytes,\n\t\t\tClientHttpRequestExecution clientHttpRequestExecution) throws IOException {\n\t\tHttpRequestWrapper requestWrapper = new HttpRequestWrapper(httpRequest);\n\n\t\tString xid = RootContext.getXID();\n\n\t\tif (!StringUtils.isEmpty(xid)) {\n\t\t\trequestWrapper.getHeaders().add(RootContext.KEY_XID, xid);\n\t\t}\n\t\treturn clientHttpRequestExecution.execute(requestWrapper, bytes);\n\t}\n}\n```\n\nFescarRestTemplateInterceptor  ClientHttpRequestInterceptor  intercept  Fescar  XID  HTTP Header \n\nFescarRestTemplateInterceptor  FescarRestTemplateAutoConfiguration  FescarRestTemplateInterceptor  RestTemplate \n\n```java\n@Configuration\npublic class FescarRestTemplateAutoConfiguration {\n\n\t@Bean\n\tpublic FescarRestTemplateInterceptor fescarRestTemplateInterceptor() {\n\t\treturn new FescarRestTemplateInterceptor();\n\t}\n\n\t@Autowired(required = false)\n\tprivate Collection<RestTemplate> restTemplates;\n\n\t@Autowired\n\tprivate FescarRestTemplateInterceptor fescarRestTemplateInterceptor;\n\n\t@PostConstruct\n\tpublic void init() {\n\t\tif (this.restTemplates != null) {\n\t\t\tfor (RestTemplate restTemplate : restTemplates) {\n\t\t\t\tList<ClientHttpRequestInterceptor> interceptors = new ArrayList<ClientHttpRequestInterceptor>(\n\t\t\t\t\t\trestTemplate.getInterceptors());\n\t\t\t\tinterceptors.add(this.fescarRestTemplateInterceptor);\n\t\t\t\trestTemplate.setInterceptors(interceptors);\n\t\t\t}\n\t\t}\n\t}\n\n}\n```\n\ninit  restTemplate  restTemplate  fescarRestTemplateInterceptor \n\n##### Feign\n\n![Feign ](/img/blog/20190305184812.png)\n\n Feign  AutoConfiguration \n\n```java\n@Configuration\n@ConditionalOnClass(Client.class)\n@AutoConfigureBefore(FeignAutoConfiguration.class)\npublic class FescarFeignClientAutoConfiguration {\n\n\t@Bean\n\t@Scope(\"prototype\")\n\t@ConditionalOnClass(name = \"com.netflix.hystrix.HystrixCommand\")\n\t@ConditionalOnProperty(name = \"feign.hystrix.enabled\", havingValue = \"true\")\n\tFeign.Builder feignHystrixBuilder(BeanFactory beanFactory) {\n\t\treturn FescarHystrixFeignBuilder.builder(beanFactory);\n\t}\n\n\t@Bean\n\t@Scope(\"prototype\")\n\t@ConditionalOnClass(name = \"com.alibaba.csp.sentinel.SphU\")\n\t@ConditionalOnProperty(name = \"feign.sentinel.enabled\", havingValue = \"true\")\n\tFeign.Builder feignSentinelBuilder(BeanFactory beanFactory) {\n\t\treturn FescarSentinelFeignBuilder.builder(beanFactory);\n\t}\n\n\t@Bean\n\t@ConditionalOnMissingBean\n\t@Scope(\"prototype\")\n\tFeign.Builder feignBuilder(BeanFactory beanFactory) {\n\t\treturn FescarFeignBuilder.builder(beanFactory);\n\t}\n\n\t@Configuration\n\tprotected static class FeignBeanPostProcessorConfiguration {\n\n\t\t@Bean\n\t\tFescarBeanPostProcessor fescarBeanPostProcessor(\n\t\t\t\tFescarFeignObjectWrapper fescarFeignObjectWrapper) {\n\t\t\treturn new FescarBeanPostProcessor(fescarFeignObjectWrapper);\n\t\t}\n\n\t\t@Bean\n\t\tFescarContextBeanPostProcessor fescarContextBeanPostProcessor(\n\t\t\t\tBeanFactory beanFactory) {\n\t\t\treturn new FescarContextBeanPostProcessor(beanFactory);\n\t\t}\n\n\t\t@Bean\n\t\tFescarFeignObjectWrapper fescarFeignObjectWrapper(BeanFactory beanFactory) {\n\t\t\treturn new FescarFeignObjectWrapper(beanFactory);\n\t\t}\n\t}\n\n}\n```\n\nFescarFeignClientAutoConfiguration  Client.class  FeignAutoConfiguration FeignClientsConfiguration  FeignAutoConfiguration  FeignContext  FescarFeignClientAutoConfiguration  FeignClientsConfiguration\n\nFescarFeignClientAutoConfiguration  Feign.Builder feign.sentinelfeign.hystrix   feign  feign  Client  FescarFeignClient\n\n```java\nHystrixFeign.builder().retryer(Retryer.NEVER_RETRY)\n      .client(new FescarFeignClient(beanFactory))\n```\n\n```java\nSentinelFeign.builder().retryer(Retryer.NEVER_RETRY)\n\t\t\t\t.client(new FescarFeignClient(beanFactory));\n```\n\n```java\nFeign.builder().client(new FescarFeignClient(beanFactory));\n```\n\nFescarFeignClient  Feign \n\n```java\npublic class FescarFeignClient implements Client {\n\n\tprivate final Client delegate;\n\tprivate final BeanFactory beanFactory;\n\n\tFescarFeignClient(BeanFactory beanFactory) {\n\t\tthis.beanFactory = beanFactory;\n\t\tthis.delegate = new Client.Default(null, null);\n\t}\n\n\tFescarFeignClient(BeanFactory beanFactory, Client delegate) {\n\t\tthis.delegate = delegate;\n\t\tthis.beanFactory = beanFactory;\n\t}\n\n\t@Override\n\tpublic Response execute(Request request, Request.Options options) throws IOException {\n\n\t\tRequest modifiedRequest = getModifyRequest(request);\n\n\t\ttry {\n\t\t\treturn this.delegate.execute(modifiedRequest, options);\n\t\t}\n\t\tfinally {\n\n\t\t}\n\t}\n\n\tprivate Request getModifyRequest(Request request) {\n\n\t\tString xid = RootContext.getXID();\n\n\t\tif (StringUtils.isEmpty(xid)) {\n\t\t\treturn request;\n\t\t}\n\n\t\tMap<String, Collection<String>> headers = new HashMap<>();\n\t\theaders.putAll(request.headers());\n\n\t\tList<String> fescarXid = new ArrayList<>();\n\t\tfescarXid.add(xid);\n\t\theaders.put(RootContext.KEY_XID, fescarXid);\n\n\t\treturn Request.create(request.method(), request.url(), headers, request.body(),\n\t\t\t\trequest.charset());\n\t}\n\n```\n\nFescarFeignClient  Request  XID  XID  XID  Header \n\nFeignBeanPostProcessorConfiguration 3 beanFescarContextBeanPostProcessorFescarBeanPostProcessor  FescarFeignObjectWrapper FescarContextBeanPostProcessor FescarBeanPostProcessor Spring  BeanPostProcessor \n FescarContextBeanPostProcessor \n\n```java\n    @Override\n\tpublic Object postProcessBeforeInitialization(Object bean, String beanName)\n\t\t\tthrows BeansException {\n\t\tif (bean instanceof FeignContext && !(bean instanceof FescarFeignContext)) {\n\t\t\treturn new FescarFeignContext(getFescarFeignObjectWrapper(),\n\t\t\t\t\t(FeignContext) bean);\n\t\t}\n\t\treturn bean;\n\t}\n\n\t@Override\n\tpublic Object postProcessAfterInitialization(Object bean, String beanName)\n\t\t\tthrows BeansException {\n\t\treturn bean;\n\t}\n```\n\nBeanPostProcessor  Spring  Bean postProcessBeforeInitialization postProcessAfterInitialization 2 bean wrapper \n\nFescarContextBeanPostProcessor   FeignContext  FescarFeignContext   \nFescarBeanPostProcessor   FeignClient  LoadBalancerFeignClient  FescarLoadBalancerFeignClient  FescarFeignClient\n\nFeignAutoConfiguration  FeignContext  ConditionalOnXXX  Fescar  FeignContext  FescarFeignContext\n\n```java\n    @Bean\n\tpublic FeignContext feignContext() {\n\t\tFeignContext context = new FeignContext();\n\t\tcontext.setConfigurations(this.configurations);\n\t\treturn context;\n\t}\n```\n\n Feign ClientFeignClientFactoryBean  FeignContext  @Configuration  Feign Client  builder FescarFeignBuilder  FescarFeignCliet FeignClientFactoryBean \n\n```java\n\t/**\n\t * @param <T> the target type of the Feign client\n\t * @return a {@link Feign} client created with the specified data and the context information\n\t */\n\t<T> T getTarget() {\n\t\tFeignContext context = applicationContext.getBean(FeignContext.class);\n\t\tFeign.Builder builder = feign(context);\n\n\t\tif (!StringUtils.hasText(this.url)) {\n\t\t\tif (!this.name.startsWith(\"http\")) {\n\t\t\t\turl = \"http://\" + this.name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\turl = this.name;\n\t\t\t}\n\t\t\turl += cleanPath();\n\t\t\treturn (T) loadBalance(builder, context, new HardCodedTarget<>(this.type,\n\t\t\t\t\tthis.name, url));\n\t\t}\n\t\tif (StringUtils.hasText(this.url) && !this.url.startsWith(\"http\")) {\n\t\t\tthis.url = \"http://\" + this.url;\n\t\t}\n\t\tString url = this.url + cleanPath();\n\t\tClient client = getOptional(context, Client.class);\n\t\tif (client != null) {\n\t\t\tif (client instanceof LoadBalancerFeignClient) {\n\t\t\t\t// not load balancing because we have a url,\n\t\t\t\t// but ribbon is on the classpath, so unwrap\n\t\t\t\tclient = ((LoadBalancerFeignClient)client).getDelegate();\n\t\t\t}\n\t\t\tbuilder.client(client);\n\t\t}\n\t\tTargeter targeter = get(context, Targeter.class);\n\t\treturn (T) targeter.target(this, builder, context, new HardCodedTarget<>(\n\t\t\t\tthis.type, this.name, url));\n\t}\n```\n URL  URL targeter.target feignmap\nInvocationHandler   \nFescarContextBeanPostProcessor  FeignClient  Fescar \n\n FescarFeignObjectWrapperWrapper\n\n```java\n\tObject wrap(Object bean) {\n\t\tif (bean instanceof Client && !(bean instanceof FescarFeignClient)) {\n\t\t\tif (bean instanceof LoadBalancerFeignClient) {\n\t\t\t\tLoadBalancerFeignClient client = ((LoadBalancerFeignClient) bean);\n\t\t\t\treturn new FescarLoadBalancerFeignClient(client.getDelegate(), factory(),\n\t\t\t\t\t\tclientFactory(), this.beanFactory);\n\t\t\t}\n\t\t\treturn new FescarFeignClient(this.beanFactory, (Client) bean);\n\t\t}\n\t\treturn bean;\n\t}\n```\n\nwrap  bean  LoadBalancerFeignClient  client.getDelegate()  LoadBalancerFeignClient  Client  FescarFeignClient LoadBalancerFeignClient  FescarLoadBalancerFeignClient  bean  Client  FescarFeignClient LoadBalancerFeignClient bean  FescarFeignClient\n\n Spring boot  Auto Configuration  Feign Builder Bean Client  FescarFeignClient  BeanPostProcessor Spring  Bean Bean FescarFeignClient  FeignClientFactoryBean getTarget \n\n##### Hystrix \n\n Hystrix  Hystrix  Fescar  RootContext  ThreadLocal  ThreadLocalContextCoreHystrix Hystrix  \n\n```\nThread or Semaphore\nThe default, and the recommended setting, is to run HystrixCommands using thread isolation (THREAD) and HystrixObservableCommands using semaphore isolation (SEMAPHORE).\n\nCommands executed in threads have an extra layer of protection against latencies beyond what network timeouts can offer.\n\nGenerally the only time you should use semaphore isolation for HystrixCommands is when the call is so high volume (hundreds per second, per instance) that the overhead of separate threads is too high; this typically only applies to non-network calls.\n```\n\nservice  ThreadLocal  XID  Hystrix Hystrix  HystrixConcurrencyStrategy  wrapCallable \n\n```java\npublic class FescarHystrixConcurrencyStrategy extends HystrixConcurrencyStrategy {\n\n\tprivate HystrixConcurrencyStrategy delegate;\n\n\tpublic FescarHystrixConcurrencyStrategy() {\n\t\tthis.delegate = HystrixPlugins.getInstance().getConcurrencyStrategy();\n\t\tHystrixPlugins.reset();\n\t\tHystrixPlugins.getInstance().registerConcurrencyStrategy(this);\n\t}\n\n\t@Override\n\tpublic <K> Callable<K> wrapCallable(Callable<K> c) {\n\t\tif (c instanceof FescarContextCallable) {\n\t\t\treturn c;\n\t\t}\n\n\t\tCallable<K> wrappedCallable;\n\t\tif (this.delegate != null) {\n\t\t\twrappedCallable = this.delegate.wrapCallable(c);\n\t\t}\n\t\telse {\n\t\t\twrappedCallable = c;\n\t\t}\n\t\tif (wrappedCallable instanceof FescarContextCallable) {\n\t\t\treturn wrappedCallable;\n\t\t}\n\n\t\treturn new FescarContextCallable<>(wrappedCallable);\n\t}\n\n\tprivate static class FescarContextCallable<K> implements Callable<K> {\n\n\t\tprivate final Callable<K> actual;\n\t\tprivate final String xid;\n\n\t\tFescarContextCallable(Callable<K> actual) {\n\t\t\tthis.actual = actual;\n\t\t\tthis.xid = RootContext.getXID();\n\t\t}\n\n\t\t@Override\n\t\tpublic K call() throws Exception {\n\t\t\ttry {\n\t\t\t\tRootContext.bind(xid);\n\t\t\t\treturn actual.call();\n\t\t\t}\n\t\t\tfinally {\n\t\t\t\tRootContext.unbind();\n\t\t\t}\n\t\t}\n\n\t}\n}\n```\n\nFescar  FescarHystrixAutoConfiguration HystrixCommand FescarHystrixConcurrencyStrategy\n\n```java\n@Configuration\n@ConditionalOnClass(HystrixCommand.class)\npublic class FescarHystrixAutoConfiguration {\n\n\t@Bean\n\tFescarHystrixConcurrencyStrategy fescarHystrixConcurrencyStrategy() {\n\t\treturn new FescarHystrixConcurrencyStrategy();\n\t}\n\n}\n```\n\n### \n\n- Fescar: https://github.com/alibaba/fescar\n\n- Spring Cloud Alibaba: https://github.com/spring-cloud-incubator/spring-cloud-alibaba\n\n- spring-cloud-openfeign: https://github.com/spring-cloud/spring-cloud-openfeign\n\n ### \n\n   ywindJava  \n  () slievrlyFescar  TXC/GTS "
        },
        {
          "id": "/integrate-seata-with-spring-cloud",
          "metadata": {
            "permalink": "/blog/integrate-seata-with-spring-cloud",
            "source": "@site/blog/integrate-seata-with-spring-cloud.md",
            "title": "SeataFescar  Spring Cloud",
            "description": "Fescar Fescar Fescar SeataSeata ",
            "date": "2019-04-15T00:00:00.000Z",
            "formattedDate": "April 15, 2019",
            "tags": [],
            "readingTime": 8.715,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ".Fei"
              }
            ],
            "frontMatter": {
              "title": "SeataFescar  Spring Cloud",
              "author": ".Fei",
              "date": "2019/04/15",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "Fescar  Spring Cloud ",
              "permalink": "/blog/how-to-support-spring-cloud"
            },
            "nextItem": {
              "title": "Seata-Client",
              "permalink": "/blog/seata-analysis-java-client"
            }
          },
          "content": "Fescar Fescar Fescar SeataSeata \n\n \n  SEATA GITHUB:[https://github.com/seata/seata]\n\n\n\nSpring Cloud Seata \n\n# 2.\n\nclient->->->.\n\n```\n                        spring cloud gateway\n\n                                spring cloud fegin\n\n                                nacos1.0.RC2\n\n                                fescar-server0.4.1(Seata)\n```\nnacos[Nacos](https://nacos.io/zh-cn/docs/quick-start.html)       \n\nseata fescar-server-0.4.1\\conf \n\n```\n    file.conf\n    logback.xml\n    nacos-config.sh\n    nacos-config.text\n    registry.conf\n``` \n\n file.conf registry.conf   &  \nfile.conf registry.conf   &  \n     nacos zk file.cnf type=file file  file.cnf\n\nregistry.conf  registry config\n\nseatanacosfile eureka redis zookeeper type=file \n\nnacoseureka\n\neureka\n\n# 3.\n\n```java\nregistry {\n  # file nacos eurekarediszk\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"localhost\"\n    namespace = \"public\"\n    cluster = \"default\"\n  }\n  eureka {\n    serviceUrl = \"http://localhost:1001/eureka\"\n    application = \"default\"\n    weight = \"1\"\n  }\n  redis {\n    serverAddr = \"localhost:6379\"\n    db = \"0\"\n  }\n  zk {\n    cluster = \"default\"\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  file {\n    name = \"file.conf\"\n  }\n}\n\nconfig {\n  # filenacos apollozk\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"localhost\"\n    namespace = \"public\"\n    cluster = \"default\"\n  }\n  apollo {\n    app.id = \"fescar-server\"\n    apollo.meta = \"http://192.168.1.204:8801\"\n  }\n  zk {\n    serverAddr = \"127.0.0.1:2181\"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  file {\n    name = \"file.conf\"\n  }\n}\n``` \nnacos-config.sh nacosnacos\n\nSEATA  IP DNSfescar nacosIPhostIPSEATA\n\n```shell\nsh fescar-server.sh 8091 /home/admin/fescar/data/ IP\n```\n\n\nfile.conf registry.conf file.conf,file.confregistry \nfileZKnacostypefile.conf service.localRgroup.grouplist   service.vgroupMapping   client  SEATA  servereurekaconfigtype=\"file\" SEATA configeureka\n\n```java\ntransport {\n  # tcp udt unix-domain-socket\n  type = \"TCP\"\n  #NIO NATIVE\n  server = \"NIO\"\n  #enable heartbeat\n  heartbeat = true\n  #thread factory for netty\n  thread-factory {\n    boss-thread-prefix = \"NettyBoss\"\n    worker-thread-prefix = \"NettyServerNIOWorker\"\n    server-executor-thread-prefix = \"NettyServerBizHandler\"\n    share-boss-worker = false\n    client-selector-thread-prefix = \"NettyClientSelector\"\n    client-selector-thread-size = 1\n    client-worker-thread-prefix = \"NettyClientWorkerThread\"\n    # netty boss thread size,will not be used for UDT\n    boss-thread-size = 1\n    #auto default pin or 8\n    worker-thread-size = 8\n  }\n}\nservice {\n  #vgroup->rgroup\n  vgroup_mapping.service-provider-fescar-service-group = \"default\"\n  #only support single node\n  localRgroup.grouplist = \"127.0.0.1:8091\"\n  #degrade current not support\n  enableDegrade = false\n  #disable\n  disable = false\n}\n\nclient {\n  async.commit.buffer.limit = 10000\n  lock {\n    retry.internal = 10\n    retry.times = 30\n  }\n}\n```\n\n# 4.\n \n\n```java\n    grouplist IPfescar-severIP\n    vgroup_mapping\n```\n vgroup_mapping.-fescar-service-group, consumer provider application.propertiesspring.application.name=service-provider  fescar-service-group keyvaluefescar  cluster = \"default\"  / application = \"default\"\n\n```java\n     vgroup_mapping.service-provider-fescar-service-group = \"default\"\n      #only support single node\n      localRgroup.grouplist = \"127.0.0.1:8091\"\n```\nprovider consumer \n\nnacosnacos\n# 5.\nconsumerconsumer feginproviderfegindemo controller\n\n```java\n@RestController\npublic class DemoController {\n\t@Autowired\n\tprivate DemoFeignClient demoFeignClient;\n\t\n\t@Autowired\n\tprivate DemoFeignClient2 demoFeignClient2;\n\t@GlobalTransactional(timeoutMills = 300000, name = \"spring-cloud-demo-tx\")\n\t@GetMapping(\"/getdemo\")\n\tpublic String demo() {\n\t\t\n\t\t// A   save\n\t\tResponseData<Integer> result = demoFeignClient.insertService(\"test\",1);\n\t\tif(result.getStatus()==400) {\n\t\t\tSystem.out.println(result+\"+++++++++++++++++++++++++++++++++++++++\");\n\t\t\tthrow new RuntimeException(\"this is error1\");\n\t\t}\n\t\n\t\t// B A \n\t\tResponseData<Integer>  result2 = demoFeignClient2.saveService();\n\t\n\t\tif(result2.getStatus()==400) {\n\t\t\tSystem.out.println(result2+\"+++++++++++++++++++++++++++++++++++++++\");\n\t\t\tthrow new RuntimeException(\"this is error2\");\n\t\t}\n\n\t\treturn \"SUCCESS\";\n\t}\n}\n```\nA,B providerB\n\nSEATAXIDSEATA[spring-cloud-fescar DEMO](https://github.com/spring-cloud-incubator/spring-cloud-alibaba/tree/master/spring-cloud-alibaba-examples/fescar-example)\n# 5.\n\nundo_logXID\n\n\n\nDruid\n\n```java\n@Configuration\npublic class DatabaseConfiguration {\n\n\t\n\t@Bean(destroyMethod = \"close\", initMethod = \"init\")\n\t@ConfigurationProperties(prefix=\"spring.datasource\")\n\tpublic DruidDataSource druidDataSource() {\n\n\t\treturn new DruidDataSource();\n\t}\n\t\n\t\n\t@Bean\n\tpublic DataSourceProxy dataSourceProxy(DruidDataSource druidDataSource) {\n\t\n\t\treturn new DataSourceProxy(druidDataSource);\n\t}\n\t\n\n    @Bean\n    public SqlSessionFactory sqlSessionFactory(DataSourceProxy dataSourceProxy) throws Exception {\n        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();\n        factoryBean.setDataSource(dataSourceProxy);    \n        return factoryBean.getObject();\n    }\n}\n```\nundo_logXID\n\n \n.Fei"
        },
        {
          "id": "/seata-analysis-java-client",
          "metadata": {
            "permalink": "/blog/seata-analysis-java-client",
            "source": "@site/blog/seata-analysis-java-client.md",
            "title": "Seata-Client",
            "description": "",
            "date": "2019-04-15T00:00:00.000Z",
            "formattedDate": "April 15, 2019",
            "tags": [],
            "readingTime": 25.585,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "fangliangsheng"
              }
            ],
            "frontMatter": {
              "title": "Seata-Client",
              "author": "fangliangsheng",
              "date": "2019/04/15",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "SeataFescar  Spring Cloud",
              "permalink": "/blog/integrate-seata-with-spring-cloud"
            },
            "nextItem": {
              "title": "Seata-Server",
              "permalink": "/blog/seata-analysis-java-server"
            }
          },
          "content": "## \nFescarSeata8000Star[Seata](https://github.com/seata/seata)MysqlSeata[WIKI](https://github.com/seata/seata/wiki/%E6%A6%82%E8%A7%88)\n\nspring cloud+spring jpa+spring cloud alibaba fescar+mysql+seatademoseatadebugclientRMTM\n\nfescar-0.4.1seatajarfescarfescar\n\n[https://github.com/fescar-group/fescar-samples/tree/master/springcloud-jpa-seata](https://github.com/fescar-group/fescar-samples/tree/master/springcloud-jpa-seata)\n## \n- XIDip:port:sequence\n- Transaction Coordinator (TC)\n- Transaction Manager (TM )\n- Resource Manager (RM)\n## \nFescarXIDXIDfeacar-serverfeacar-servercommitrollback\nFescardubbospring cloudspring-boot\n\n```xml\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-alibaba-fescar</artifactId>\n    <version>2.1.0.BUILD-SNAPSHOT</version>\n</dependency>\n```\nRestTemplateFeignXID\n## \n\n\n\n - order-server\n - account-server\n - storage-server\n\n\n\n - business-server\n \n\n![](/img/blog/20190410114411366.png)\n \n****\n   1. business\n   2. storage\n   3. order\n   4. account\n   \n****\n   1. business\n   2. storage\n   3. order\n   4. account``\n   \n234commit4\n\n## \nfescar[registry.conf](https://github.com/seata/seata/blob/develop/config/src/main/resources/registry.conf),[ConfigurationFactory](https://github.com/seata/seata/blob/develop/config/src/main/java/com/alibaba/fescar/config/ConfigurationFactory.java)registry.conf\n\n```java\nprivate static final String REGISTRY_CONF = \"registry.conf\";\npublic static final Configuration FILE_INSTANCE = new FileConfiguration(REGISTRY_CONF);\n```\n\n`registry`filefile.conf3\n\n 1. transport\n     transport[NettyServerConfig](https://github.com/seata/seata/blob/develop/core/src/main/java/com/alibaba/fescar/core/rpc/netty/NettyServerConfig.java)NettyTMRMfescar-serverNetty\n 2. service\n\n```js\n\t service {\n\t  #vgroup->rgroup\n\t  vgroup_mapping.my_test_tx_group = \"default\"\n\t  #ClientTC\n\t  default.grouplist = \"127.0.0.1:8091\"\n\t  #degrade current not support\n\t  enableDegrade = false\n\t  #disable\n\t  seata\n\t  disableGlobalTransaction = false\n\t}\n```\n 3. client\n\n```js\n\tclient {\n\t  #RMTCcommit\n\t  async.commit.buffer.limit = 10000\n\t  lock {\n\t    retry.internal = 10\n\t    retry.times = 30\n\t  }\n\t}\n```\n## Proxy\nfescarAT`DruidDataSource`\n0.4.2\n\n```java\n@Bean\n@ConfigurationProperties(prefix = \"spring.datasource\")\npublic DruidDataSource druidDataSource() {\n    DruidDataSource druidDataSource = new DruidDataSource();\n    return druidDataSource;\n}\n\n@Primary\n@Bean(\"dataSource\")\npublic DataSourceProxy dataSource(DruidDataSource druidDataSource) {\n    return new DataSourceProxy(druidDataSource);\n}\n```\n`DataSourceProxy``ConnectionProxy`,fescar`ConnectionProxy``commit``undo_log`\n\n`undo_log`fescar`rollback``commit``undo_log`\n\n```sql\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n```\n## Server\n[https://github.com/seata/seata/releases](https://github.com/seata/seata/releases) Clientfescar-server,\n bin \n\n```shell\n./fescar-server.sh 8091 ../data\n```\n\n\n```shell\n2019-04-09 20:27:24.637 INFO [main]c.a.fescar.core.rpc.netty.AbstractRpcRemotingServer.start:152 -Server started ... \n```\n## Client\nfescar[GlobalTransactionAutoConfiguration](https://github.com/spring-cloud-incubator/spring-cloud-alibaba/blob/finchley/spring-cloud-alibaba-fescar/src/main/java/org/springframework/cloud/alibaba/fescar/GlobalTransactionAutoConfiguration.java)spring boot`GlobalTransactionScanner`\n\n```java\n@Configuration\n@EnableConfigurationProperties({FescarProperties.class})\npublic class GlobalTransactionAutoConfiguration {\n    private final ApplicationContext applicationContext;\n    private final FescarProperties fescarProperties;\n\n    public GlobalTransactionAutoConfiguration(ApplicationContext applicationContext, FescarProperties fescarProperties) {\n        this.applicationContext = applicationContext;\n        this.fescarProperties = fescarProperties;\n    }\n\n\t/**\n\t* GlobalTransactionScanner\n\t* scannerclient\n\t*/\n    @Bean\n    public GlobalTransactionScanner globalTransactionScanner() {\n        String applicationName = this.applicationContext.getEnvironment().getProperty(\"spring.application.name\");\n        String txServiceGroup = this.fescarProperties.getTxServiceGroup();\n        if (StringUtils.isEmpty(txServiceGroup)) {\n            txServiceGroup = applicationName + \"-fescar-service-group\";\n            this.fescarProperties.setTxServiceGroup(txServiceGroup);\n        }\n\t\t\n        return new GlobalTransactionScanner(applicationName, txServiceGroup);\n    }\n}\n```\nFescarProperties\n\n```json\nspring.cloud.alibaba.fescar.tx-service-group=my_test_tx_group\n```\nspring.application.name+ -fescar-service-groupspring.application.name\n\n```java\n@ConfigurationProperties(\"spring.cloud.alibaba.fescar\")\npublic class FescarProperties {\n    private String txServiceGroup;\n\n    public FescarProperties() {\n    }\n\n    public String getTxServiceGroup() {\n        return this.txServiceGroup;\n    }\n\n    public void setTxServiceGroup(String txServiceGroup) {\n        this.txServiceGroup = txServiceGroup;\n    }\n}\n```\napplicationIdtxServiceGroup[GlobalTransactionScanner](https://github.com/seata/seata/blob/develop/spring/src/main/java/com/alibaba/fescar/spring/annotation/GlobalTransactionScanner.java)initClient\n\n```java\nprivate void initClient() {\n    if (StringUtils.isNullOrEmpty(applicationId) || StringUtils.isNullOrEmpty(txServiceGroup)) {\n        throw new IllegalArgumentException(\n            \"applicationId: \" + applicationId + \", txServiceGroup: \" + txServiceGroup);\n    }\n    //init TM\n    TMClient.init(applicationId, txServiceGroup);\n\n    //init RM\n    RMClient.init(applicationId, txServiceGroup);\n  \n}\n```\n`TMClient``RMClient`TMRMTMRM`@GlobalTransactional`\nClientTCNettyNetty ChanneltransactionRole`TMROLE``RMROLE`\n\n```java\n2019-04-09 13:42:57.417  INFO 93715 --- [imeoutChecker_1] c.a.f.c.rpc.netty.NettyPoolableFactory   : NettyPool create channel to {\"address\":\"127.0.0.1:8091\",\"message\":{\"applicationId\":\"business-service\",\"byteBuffer\":{\"char\":\"\\u0000\",\"direct\":false,\"double\":0.0,\"float\":0.0,\"int\":0,\"long\":0,\"readOnly\":false,\"short\":0},\"transactionServiceGroup\":\"my_test_tx_group\",\"typeCode\":101,\"version\":\"0.4.1\"},\"transactionRole\":\"TMROLE\"}\n2019-04-09 13:42:57.505  INFO 93715 --- [imeoutChecker_1] c.a.f.c.rpc.netty.NettyPoolableFactory   : NettyPool create channel to {\"address\":\"127.0.0.1:8091\",\"message\":{\"applicationId\":\"business-service\",\"byteBuffer\":{\"char\":\"\\u0000\",\"direct\":false,\"double\":0.0,\"float\":0.0,\"int\":0,\"long\":0,\"readOnly\":false,\"short\":0},\"transactionServiceGroup\":\"my_test_tx_group\",\"typeCode\":103,\"version\":\"0.4.1\"},\"transactionRole\":\"RMROLE\"}\n2019-04-09 13:42:57.629 DEBUG 93715 --- [lector_TMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:RegisterTMRequest{applicationId='business-service', transactionServiceGroup='my_test_tx_group'}\n2019-04-09 13:42:57.629 DEBUG 93715 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:RegisterRMRequest{resourceIds='null', applicationId='business-service', transactionServiceGroup='my_test_tx_group'}\n2019-04-09 13:42:57.699 DEBUG 93715 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null,messageId:1\n2019-04-09 13:42:57.699 DEBUG 93715 --- [lector_TMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null,messageId:2\n2019-04-09 13:42:57.701 DEBUG 93715 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : com.alibaba.fescar.core.rpc.netty.RmRpcClient@3b06d101 msgId:1, future :com.alibaba.fescar.core.protocol.MessageFuture@28bb1abd, body:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null\n2019-04-09 13:42:57.701 DEBUG 93715 --- [lector_TMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : com.alibaba.fescar.core.rpc.netty.TmRpcClient@65fc3fb7 msgId:2, future :com.alibaba.fescar.core.protocol.MessageFuture@9a1e3df, body:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null\n2019-04-09 13:42:57.710  INFO 93715 --- [imeoutChecker_1] c.a.fescar.core.rpc.netty.RmRpcClient    : register RM success. server version:0.4.1,channel:[id: 0xe6468995, L:/127.0.0.1:57397 - R:/127.0.0.1:8091]\n2019-04-09 13:42:57.710  INFO 93715 --- [imeoutChecker_1] c.a.f.c.rpc.netty.NettyPoolableFactory   : register success, cost 114 ms, version:0.4.1,role:TMROLE,channel:[id: 0xd22fe0c5, L:/127.0.0.1:57398 - R:/127.0.0.1:8091]\n2019-04-09 13:42:57.711  INFO 93715 --- [imeoutChecker_1] c.a.f.c.rpc.netty.NettyPoolableFactory   : register success, cost 125 ms, version:0.4.1,role:RMROLE,channel:[id: 0xe6468995, L:/127.0.0.1:57397 - R:/127.0.0.1:8091]\n\n```\n\n1. Netty\n2. \n3. \n4. `RmRpcClient``TmRpcClient`\n## TM\nTMbusiness-service,BusinessServicepurchase`@GlobalTransactional`\n\n```java\n@Service\npublic class BusinessService {\n\n    @Autowired\n    private StorageFeignClient storageFeignClient;\n    @Autowired\n    private OrderFeignClient orderFeignClient;\n\n    @GlobalTransactional\n    public void purchase(String userId, String commodityCode, int orderCount){\n        storageFeignClient.deduct(commodityCode, orderCount);\n\n        orderFeignClient.create(userId, commodityCode, orderCount);\n    }\n}\n```\n`@GlobalTransactional`[GlobalTransactionalInterceptor](https://github.com/seata/seata/blob/develop/spring/src/main/java/com/alibaba/fescar/spring/annotation/GlobalTransactionalInterceptor.java)\n\n```java\n/**\n * AOP\n */\n@Override\npublic Object invoke(final MethodInvocation methodInvocation) throws Throwable {\n    Class<?> targetClass = (methodInvocation.getThis() != null ? AopUtils.getTargetClass(methodInvocation.getThis()) : null);\n    Method specificMethod = ClassUtils.getMostSpecificMethod(methodInvocation.getMethod(), targetClass);\n    final Method method = BridgeMethodResolver.findBridgedMethod(specificMethod);\n\n\t//GlobalTransactional\n    final GlobalTransactional globalTransactionalAnnotation = getAnnotation(method, GlobalTransactional.class);\n    final GlobalLock globalLockAnnotation = getAnnotation(method, GlobalLock.class);\n    \n    //GlobalTransactional\n    if (globalTransactionalAnnotation != null) {\n        return handleGlobalTransaction(methodInvocation, globalTransactionalAnnotation);\n    } else if (globalLockAnnotation != null) {\n        return handleGlobalLock(methodInvocation);\n    } else {\n        return methodInvocation.proceed();\n    }\n}\n```\n`handleGlobalTransaction`[TransactionalTemplate](https://github.com/seata/seata/blob/develop/tm/src/main/java/com/alibaba/fescar/tm/api/TransactionalTemplate.java)executeTM\n\n```java\npublic Object execute(TransactionalExecutor business) throws TransactionalExecutor.ExecutionException {\n    // 1. get or create a transaction\n    GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n\n    try {\n        // 2. begin transaction\n        try {\n            triggerBeforeBegin();\n            tx.begin(business.timeout(), business.name());\n            triggerAfterBegin();\n        } catch (TransactionException txe) {\n            throw new TransactionalExecutor.ExecutionException(tx, txe,\n                TransactionalExecutor.Code.BeginFailure);\n        }\n        Object rs = null;\n        try {\n            // Do Your Business\n            rs = business.execute();\n        } catch (Throwable ex) {\n            // 3. any business exception, rollback.\n            try {\n                triggerBeforeRollback();\n                tx.rollback();\n                triggerAfterRollback();\n                // 3.1 Successfully rolled back\n                throw new TransactionalExecutor.ExecutionException(tx, TransactionalExecutor.Code.RollbackDone, ex);\n            } catch (TransactionException txe) {\n                // 3.2 Failed to rollback\n                throw new TransactionalExecutor.ExecutionException(tx, txe,\n                    TransactionalExecutor.Code.RollbackFailure, ex);\n            }\n        }\n        // 4. everything is fine, commit.\n        try {\n            triggerBeforeCommit();\n            tx.commit();\n            triggerAfterCommit();\n        } catch (TransactionException txe) {\n            // 4.1 Failed to commit\n            throw new TransactionalExecutor.ExecutionException(tx, txe,\n                TransactionalExecutor.Code.CommitFailure);\n        }\n        return rs;\n    } finally {\n        //5. clear\n        triggerAfterCompletion();\n        cleanUp();\n    }\n}\n```\n[DefaultGlobalTransaction](https://github.com/seata/seata/blob/develop/tm/src/main/java/com/alibaba/fescar/tm/api/DefaultGlobalTransaction.java)begin\n\n```java\npublic void begin(int timeout, String name) throws TransactionException {\n    if (role != GlobalTransactionRole.Launcher) {\n        check();\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Ignore Begin(): just involved in global transaction [\" + xid + \"]\");\n        }\n        return;\n    }\n    if (xid != null) {\n        throw new IllegalStateException();\n    }\n    if (RootContext.getXID() != null) {\n        throw new IllegalStateException();\n    }\n    //TCXID\n    xid = transactionManager.begin(null, null, name, timeout);\n    status = GlobalStatus.Begin;\n    RootContext.bind(xid);\n    if (LOGGER.isDebugEnabled()) {\n        LOGGER.debug(\"Begin a NEW global transaction [\" + xid + \"]\");\n    }\n}\n```\n`if (role != GlobalTransactionRole.Launcher)`roleLauncherParticipant`@GlobalTransactional`ParticipantbeginreturnLauncherParticipantXIDXIDLauncherXIDParticipant.\nLauncherLauncher\n\n[DefaultTransactionManager](https://github.com/seata/seata/blob/develop/tm/src/main/java/com/alibaba/fescar/tm/DefaultTransactionManager.java)TMTCbegincommitrollback\n\n```java\n@Override\npublic String begin(String applicationId, String transactionServiceGroup, String name, int timeout)\n    throws TransactionException {\n    GlobalBeginRequest request = new GlobalBeginRequest();\n    request.setTransactionName(name);\n    request.setTimeout(timeout);\n    GlobalBeginResponse response = (GlobalBeginResponse)syncCall(request);\n    return response.getXid();\n}\n```\nfescar-serverXID\n\n```java\n2019-04-09 13:46:57.417 DEBUG 31326 --- [nio-8084-exec-1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : offer message: timeout=60000,transactionName=purchase(java.lang.String,java.lang.String,int)\n2019-04-09 13:46:57.417 DEBUG 31326 --- [geSend_TMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : write message:FescarMergeMessage timeout=60000,transactionName=purchase(java.lang.String,java.lang.String,int), channel:[id: 0xa148545e, L:/127.0.0.1:56120 - R:/127.0.0.1:8091],active?true,writable?true,isopen?true\n2019-04-09 13:46:57.418 DEBUG 31326 --- [lector_TMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:FescarMergeMessage timeout=60000,transactionName=purchase(java.lang.String,java.lang.String,int)\n2019-04-09 13:46:57.421 DEBUG 31326 --- [lector_TMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:MergeResultMessage com.alibaba.fescar.core.protocol.transaction.GlobalBeginResponse@2dc480dc,messageId:1196\n2019-04-09 13:46:57.421 DEBUG 31326 --- [nio-8084-exec-1] c.a.fescar.core.context.RootContext      : bind 192.168.224.93:8091:2008502699\n2019-04-09 13:46:57.421 DEBUG 31326 --- [nio-8084-exec-1] c.a.f.tm.api.DefaultGlobalTransaction    : Begin a NEW global transaction [192.168.224.93:8091:2008502699]\n```\nbusiness.execute()`storageFeignClient.deduct(commodityCode, orderCount)`RMstorage-service\n## RM\n\n```java\n@GetMapping(path = \"/deduct\")\npublic Boolean deduct(String commodityCode, Integer count){\n    storageService.deduct(commodityCode,count);\n    return true;\n}\n\n@Transactional\npublic void deduct(String commodityCode, int count){\n    Storage storage = storageDAO.findByCommodityCode(commodityCode);\n    storage.setCount(storage.getCount()-count);\n\n    storageDAO.save(storage);\n}\n```\nstorageservicefescarfescar[ConnectionProxy](https://github.com/seata/seata/blob/develop/rm-datasource/src/main/java/com/alibaba/fescar/rm/datasource/ConnectionProxy.java)`DataSourceProxy`DataSourceProxyfescarTCRM\n\n`ConnectionProxy`ConnectionProxycommit\n\n```java\npublic void commit() throws SQLException {\n\t//\n\t//XID\n    if (context.inGlobalTransaction()) {\n        processGlobalTransactionCommit();\n    } else if (context.isGlobalLockRequire()) {\n        processLocalCommitWithGlobalLocks();\n    } else {\n        targetConnection.commit();\n    }\n}\n    \nprivate void processGlobalTransactionCommit() throws SQLException {\n    try {\n    \t//TCRMTCbranchId\n        register();\n    } catch (TransactionException e) {\n        recognizeLockKeyConflictException(e);\n    }\n\n    try {\n        if (context.hasUndoLog()) {\n        \t//undolog\n            UndoLogManager.flushUndoLogs(this);\n        }\n\n\t\t//undo_log\n        targetConnection.commit();\n    } catch (Throwable ex) {\n    \t//TCRM\n        report(false);\n        if (ex instanceof SQLException) {\n            throw new SQLException(ex);\n        }\n    }\n\t//TCRM\n    report(true);\n    context.reset();\n}\n    \nprivate void register() throws TransactionException {\n\t//RMrequestnettyTC\n    Long branchId = DefaultResourceManager.get().branchRegister(BranchType.AT, getDataSourceProxy().getResourceId(),\n            null, context.getXid(), null, context.buildLockKeys());\n    //branchId\n    context.setBranchId(branchId);\n}\n```\n\n\n```java\n2019-04-09 21:57:48.341 DEBUG 38933 --- [nio-8081-exec-1] o.s.c.a.f.web.FescarHandlerInterceptor   : xid in RootContext null xid in RpcContext 192.168.0.2:8091:2008546211\n2019-04-09 21:57:48.341 DEBUG 38933 --- [nio-8081-exec-1] c.a.fescar.core.context.RootContext      : bind 192.168.0.2:8091:2008546211\n2019-04-09 21:57:48.341 DEBUG 38933 --- [nio-8081-exec-1] o.s.c.a.f.web.FescarHandlerInterceptor   : bind 192.168.0.2:8091:2008546211 to RootContext\n2019-04-09 21:57:48.386  INFO 38933 --- [nio-8081-exec-1] o.h.h.i.QueryTranslatorFactoryInitiator  : HHH000397: Using ASTQueryTranslatorFactory\nHibernate: select storage0_.id as id1_0_, storage0_.commodity_code as commodit2_0_, storage0_.count as count3_0_ from storage_tbl storage0_ where storage0_.commodity_code=?\nHibernate: update storage_tbl set count=? where id=?\n2019-04-09 21:57:48.673  INFO 38933 --- [nio-8081-exec-1] c.a.fescar.core.rpc.netty.RmRpcClient    : will connect to 192.168.0.2:8091\n2019-04-09 21:57:48.673  INFO 38933 --- [nio-8081-exec-1] c.a.fescar.core.rpc.netty.RmRpcClient    : RM will register :jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false\n2019-04-09 21:57:48.673  INFO 38933 --- [nio-8081-exec-1] c.a.f.c.rpc.netty.NettyPoolableFactory   : NettyPool create channel to {\"address\":\"192.168.0.2:8091\",\"message\":{\"applicationId\":\"storage-service\",\"byteBuffer\":{\"char\":\"\\u0000\",\"direct\":false,\"double\":0.0,\"float\":0.0,\"int\":0,\"long\":0,\"readOnly\":false,\"short\":0},\"resourceIds\":\"jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false\",\"transactionServiceGroup\":\"hello-service-fescar-service-group\",\"typeCode\":103,\"version\":\"0.4.0\"},\"transactionRole\":\"RMROLE\"}\n2019-04-09 21:57:48.677 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:RegisterRMRequest{resourceIds='jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false', applicationId='storage-service', transactionServiceGroup='hello-service-fescar-service-group'}\n2019-04-09 21:57:48.680 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null,messageId:9\n2019-04-09 21:57:48.680 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : com.alibaba.fescar.core.rpc.netty.RmRpcClient@7d61f5d4 msgId:9, future :com.alibaba.fescar.core.protocol.MessageFuture@186cd3e0, body:version=0.4.1,extraData=null,identified=true,resultCode=null,msg=null\n2019-04-09 21:57:48.680  INFO 38933 --- [nio-8081-exec-1] c.a.fescar.core.rpc.netty.RmRpcClient    : register RM success. server version:0.4.1,channel:[id: 0xd40718e3, L:/192.168.0.2:62607 - R:/192.168.0.2:8091]\n2019-04-09 21:57:48.680  INFO 38933 --- [nio-8081-exec-1] c.a.f.c.rpc.netty.NettyPoolableFactory   : register success, cost 3 ms, version:0.4.1,role:RMROLE,channel:[id: 0xd40718e3, L:/192.168.0.2:62607 - R:/192.168.0.2:8091]\n2019-04-09 21:57:48.680 DEBUG 38933 --- [nio-8081-exec-1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : offer message: transactionId=2008546211,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,lockKey=storage_tbl:1\n2019-04-09 21:57:48.681 DEBUG 38933 --- [geSend_RMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : write message:FescarMergeMessage transactionId=2008546211,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,lockKey=storage_tbl:1, channel:[id: 0xd40718e3, L:/192.168.0.2:62607 - R:/192.168.0.2:8091],active?true,writable?true,isopen?true\n2019-04-09 21:57:48.681 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:FescarMergeMessage transactionId=2008546211,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,lockKey=storage_tbl:1\n2019-04-09 21:57:48.687 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:MergeResultMessage BranchRegisterResponse: transactionId=2008546211,branchId=2008546212,result code =Success,getMsg =null,messageId:11\n2019-04-09 21:57:48.702 DEBUG 38933 --- [nio-8081-exec-1] c.a.f.rm.datasource.undo.UndoLogManager  : Flushing UNDO LOG: {\"branchId\":2008546212,\"sqlUndoLogs\":[{\"afterImage\":{\"rows\":[{\"fields\":[{\"keyType\":\"PrimaryKey\",\"name\":\"id\",\"type\":4,\"value\":1},{\"keyType\":\"NULL\",\"name\":\"count\",\"type\":4,\"value\":993}]}],\"tableName\":\"storage_tbl\"},\"beforeImage\":{\"rows\":[{\"fields\":[{\"keyType\":\"PrimaryKey\",\"name\":\"id\",\"type\":4,\"value\":1},{\"keyType\":\"NULL\",\"name\":\"count\",\"type\":4,\"value\":994}]}],\"tableName\":\"storage_tbl\"},\"sqlType\":\"UPDATE\",\"tableName\":\"storage_tbl\"}],\"xid\":\"192.168.0.2:8091:2008546211\"}\n2019-04-09 21:57:48.755 DEBUG 38933 --- [nio-8081-exec-1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : offer message: transactionId=2008546211,branchId=2008546212,resourceId=null,status=PhaseOne_Done,applicationData=null\n2019-04-09 21:57:48.755 DEBUG 38933 --- [geSend_RMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : write message:FescarMergeMessage transactionId=2008546211,branchId=2008546212,resourceId=null,status=PhaseOne_Done,applicationData=null, channel:[id: 0xd40718e3, L:/192.168.0.2:62607 - R:/192.168.0.2:8091],active?true,writable?true,isopen?true\n2019-04-09 21:57:48.756 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:FescarMergeMessage transactionId=2008546211,branchId=2008546212,resourceId=null,status=PhaseOne_Done,applicationData=null\n2019-04-09 21:57:48.758 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:MergeResultMessage com.alibaba.fescar.core.protocol.transaction.BranchReportResponse@582a08cf,messageId:13\n2019-04-09 21:57:48.799 DEBUG 38933 --- [nio-8081-exec-1] c.a.fescar.core.context.RootContext      : unbind 192.168.0.2:8091:2008546211\n2019-04-09 21:57:48.799 DEBUG 38933 --- [nio-8081-exec-1] o.s.c.a.f.web.FescarHandlerInterceptor   : unbind 192.168.0.2:8091:2008546211 from RootContext\n```\n\n 1. business-serviceXID\n 2. XID\n 3. sql\n 4. TCRMNetty\n 5. TC\n 6. TCbranchId\n 7. Undo Log\n 8. TCPhaseOne\n 9. XID\n\n19[FescarHandlerInterceptor](https://github.com/dongsheep/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-fescar/src/main/java/org/springframework/cloud/alibaba/fescar/web/FescarHandlerInterceptor.java)fescarspring-cloud-alibaba-fescar,feignrestxid bindunbindRMPhaseOnePhaseTwo\n## \nTCRMRMcommitrollback\n\n```java\n2019-04-09 21:57:49.813 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Receive:xid=192.168.0.2:8091:2008546211,branchId=2008546212,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,applicationData=null,messageId:1\n2019-04-09 21:57:49.813 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.AbstractRpcRemoting    : com.alibaba.fescar.core.rpc.netty.RmRpcClient@7d61f5d4 msgId:1, body:xid=192.168.0.2:8091:2008546211,branchId=2008546212,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,applicationData=null\n2019-04-09 21:57:49.814  INFO 38933 --- [atch_RMROLE_1_8] c.a.f.core.rpc.netty.RmMessageListener   : onMessage:xid=192.168.0.2:8091:2008546211,branchId=2008546212,branchType=AT,resourceId=jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false,applicationData=null\n2019-04-09 21:57:49.816  INFO 38933 --- [atch_RMROLE_1_8] com.alibaba.fescar.rm.AbstractRMHandler  : Branch committing: 192.168.0.2:8091:2008546211 2008546212 jdbc:mysql://127.0.0.1:3306/db_storage?useSSL=false null\n2019-04-09 21:57:49.816  INFO 38933 --- [atch_RMROLE_1_8] com.alibaba.fescar.rm.AbstractRMHandler  : Branch commit result: PhaseTwo_Committed\n2019-04-09 21:57:49.817  INFO 38933 --- [atch_RMROLE_1_8] c.a.fescar.core.rpc.netty.RmRpcClient    : RmRpcClient sendResponse branchStatus=PhaseTwo_Committed,result code =Success,getMsg =null\n2019-04-09 21:57:49.817 DEBUG 38933 --- [atch_RMROLE_1_8] c.a.f.c.rpc.netty.AbstractRpcRemoting    : send response:branchStatus=PhaseTwo_Committed,result code =Success,getMsg =null,channel:[id: 0xd40718e3, L:/192.168.0.2:62607 - R:/192.168.0.2:8091]\n2019-04-09 21:57:49.817 DEBUG 38933 --- [lector_RMROLE_1] c.a.f.c.rpc.netty.MessageCodecHandler    : Send:branchStatus=PhaseTwo_Committed,result code =Success,getMsg =null\n```\n\n1. RMXID=192.168.0.2:8091:2008546211,branchId=2008546212commit\n2. commit\n3. commitTCbranchStatusPhaseTwo_Committed\n\ncommit[AbstractRMHandler](https://github.com/seata/seata/blob/develop/rm/src/main/java/com/alibaba/fescar/rm/AbstractRMHandler.java)doBranchCommit\n\n```java\n/**\n * xidbranchId\n * RMbranchCommit\n */\nprotected void doBranchCommit(BranchCommitRequest request, BranchCommitResponse response) throws TransactionException {\n    String xid = request.getXid();\n    long branchId = request.getBranchId();\n    String resourceId = request.getResourceId();\n    String applicationData = request.getApplicationData();\n    LOGGER.info(\"Branch committing: \" + xid + \" \" + branchId + \" \" + resourceId + \" \" + applicationData);\n    BranchStatus status = getResourceManager().branchCommit(request.getBranchType(), xid, branchId, resourceId, applicationData);\n    response.setBranchStatus(status);\n    LOGGER.info(\"Branch commit result: \" + status);\n}\n```\nbranchCommit[AsyncWorker](https://github.com/seata/seata/blob/develop/rm-datasource/src/main/java/com/alibaba/fescar/rm/datasource/AsyncWorker.java)branchCommitAsyncWorkerfescarPhaseOnePhaseTwocommitPhaseTwo\n\n```java\nprivate static final List<Phase2Context> ASYNC_COMMIT_BUFFER = Collections.synchronizedList( new ArrayList<Phase2Context>());\n        \n/**\n * XIDlist\n */\n@Override\npublic BranchStatus branchCommit(BranchType branchType, String xid, long branchId, String resourceId, String applicationData) throws TransactionException {\n    if (ASYNC_COMMIT_BUFFER.size() < ASYNC_COMMIT_BUFFER_LIMIT) {\n        ASYNC_COMMIT_BUFFER.add(new Phase2Context(branchType, xid, branchId, resourceId, applicationData));\n    } else {\n        LOGGER.warn(\"Async commit buffer is FULL. Rejected branch [\" + branchId + \"/\" + xid + \"] will be handled by housekeeping later.\");\n    }\n    return BranchStatus.PhaseTwo_Committed;\n}\n\t\n/**\n * listXID\n */\npublic synchronized void init() {\n    LOGGER.info(\"Async Commit Buffer Limit: \" + ASYNC_COMMIT_BUFFER_LIMIT);\n    timerExecutor = new ScheduledThreadPoolExecutor(1,\n        new NamedThreadFactory(\"AsyncWorker\", 1, true));\n    timerExecutor.scheduleAtFixedRate(new Runnable() {\n        @Override\n        public void run() {\n            try {\n                doBranchCommits();\n            } catch (Throwable e) {\n                LOGGER.info(\"Failed at async committing ... \" + e.getMessage());\n            }\n        }\n    }, 10, 1000 * 1, TimeUnit.MILLISECONDS);\n}\n\t\nprivate void doBranchCommits() {\n    if (ASYNC_COMMIT_BUFFER.size() == 0) {\n        return;\n    }\n    Map<String, List<Phase2Context>> mappedContexts = new HashMap<>();\n    Iterator<Phase2Context> iterator = ASYNC_COMMIT_BUFFER.iterator();\n    \n    //ASYNC_COMMIT_BUFFER\n    //resourceIdkeycommitresourceIdurl\n    //\n    while (iterator.hasNext()) {\n        Phase2Context commitContext = iterator.next();\n        List<Phase2Context> contextsGroupedByResourceId = mappedContexts.get(commitContext.resourceId);\n        if (contextsGroupedByResourceId == null) {\n            contextsGroupedByResourceId = new ArrayList<>();\n            mappedContexts.put(commitContext.resourceId, contextsGroupedByResourceId);\n        }\n        contextsGroupedByResourceId.add(commitContext);\n\n        iterator.remove();\n\n    }\n\n    for (Map.Entry<String, List<Phase2Context>> entry : mappedContexts.entrySet()) {\n        Connection conn = null;\n        try {\n            try {\n            \t//resourceId\n                DataSourceProxy dataSourceProxy = DataSourceManager.get().get(entry.getKey());\n                conn = dataSourceProxy.getPlainConnection();\n            } catch (SQLException sqle) {\n                LOGGER.warn(\"Failed to get connection for async committing on \" + entry.getKey(), sqle);\n                continue;\n            }\n            List<Phase2Context> contextsGroupedByResourceId = entry.getValue();\n            for (Phase2Context commitContext : contextsGroupedByResourceId) {\n                try {\n                \t//undologxidbranchId\n                    UndoLogManager.deleteUndoLog(commitContext.xid, commitContext.branchId, conn);\n                } catch (Exception ex) {\n                    LOGGER.warn(\n                        \"Failed to delete undo log [\" + commitContext.branchId + \"/\" + commitContext.xid + \"]\", ex);\n                }\n            }\n\n        } finally {\n            if (conn != null) {\n                try {\n                    conn.close();\n                } catch (SQLException closeEx) {\n                    LOGGER.warn(\"Failed to close JDBC resource while deleting undo_log \", closeEx);\n                }\n            }\n        }\n    }\n}\n```\ncommitRMxidbranchIdundo_log\n## \nrollback\n 1. [ConnectionProxy](https://github.com/seata/seata/blob/develop/rm-datasource/src/main/java/com/alibaba/fescar/rm/datasource/ConnectionProxy.java)`report(false)`\n 2. TM`@GlobalTransactional`[TransactionalTemplate](https://github.com/seata/seata/blob/develop/tm/src/main/java/com/alibaba/fescar/tm/api/TransactionalTemplate.java)executebusiness.execute()catchcatchrollbackTMTCXID\n\n```java\n public void rollback() throws TransactionException {\n    //Launcherrollback\n    if (role == GlobalTransactionRole.Participant) {\n        // Participant has no responsibility of committing\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Ignore Rollback(): just involved in global transaction [\" + xid + \"]\");\n        }\n        return;\n    }\n    if (xid == null) {\n        throw new IllegalStateException();\n    }\n\n    status = transactionManager.rollback(xid);\n    if (RootContext.getXID() != null) {\n        if (xid.equals(RootContext.getXID())) {\n            RootContext.unbind();\n        }\n    }\n}\n```\nTCrollbackRM[AbstractRMHandler](https://github.com/seata/seata/blob/develop/rm/src/main/java/com/alibaba/fescar/rm/AbstractRMHandler.java)doBranchRollbackrollback\n\n```java\nprotected void doBranchRollback(BranchRollbackRequest request, BranchRollbackResponse response) throws TransactionException {\n    String xid = request.getXid();\n    long branchId = request.getBranchId();\n    String resourceId = request.getResourceId();\n    String applicationData = request.getApplicationData();\n    LOGGER.info(\"Branch rolling back: \" + xid + \" \" + branchId + \" \" + resourceId);\n    BranchStatus status = getResourceManager().branchRollback(request.getBranchType(), xid, branchId, resourceId, applicationData);\n    response.setBranchStatus(status);\n    LOGGER.info(\"Branch rollback result: \" + status);\n}\n```\nrollback`DataSourceManager`branchRollback\n\n```java\npublic BranchStatus branchRollback(BranchType branchType, String xid, long branchId, String resourceId, String applicationData) throws TransactionException {\n    //resourceId\n    DataSourceProxy dataSourceProxy = get(resourceId);\n    if (dataSourceProxy == null) {\n        throw new ShouldNeverHappenException();\n    }\n    try {\n        UndoLogManager.undo(dataSourceProxy, xid, branchId);\n    } catch (TransactionException te) {\n        if (te.getCode() == TransactionExceptionCode.BranchRollbackFailed_Unretriable) {\n            return BranchStatus.PhaseTwo_RollbackFailed_Unretryable;\n        } else {\n            return BranchStatus.PhaseTwo_RollbackFailed_Retryable;\n        }\n    }\n    return BranchStatus.PhaseTwo_Rollbacked;\n}\n```\n[UndoLogManager](https://github.com/seata/seata/blob/develop/rm-datasource/src/main/java/com/alibaba/fescar/rm/datasource/undo/UndoLogManager.java)undojdbcgithubundo\n\n 1. xidbranchIdPhaseOneundo_log\n 2. undo_logsqlPhaseOne\n 3. 2undo_log\n 4. 1undo_log`GlobalFinished`undo_log.\n PhaseOne\n xidbranchId4PhaseOnePhaseOne\n## \nfescar clientTMRMfescar\n\nfescarRoadmapfescar"
        },
        {
          "id": "/seata-analysis-java-server",
          "metadata": {
            "permalink": "/blog/seata-analysis-java-server",
            "source": "@site/blog/seata-analysis-java-server.md",
            "title": "Seata-Server",
            "description": "FescarFescarSeata(Simpe Extensible Autonomous Transcaction Architecture)FescarFast & EaSy Commit And RollbackFescarCommitRollbackSeata",
            "date": "2019-04-08T00:00:00.000Z",
            "formattedDate": "April 8, 2019",
            "tags": [],
            "readingTime": 29.73,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ","
              }
            ],
            "frontMatter": {
              "title": "Seata-Server",
              "author": ",",
              "date": "2019/04/08",
              "keywords": [
                "fescarseata"
              ]
            },
            "prevItem": {
              "title": "Seata-Client",
              "permalink": "/blog/seata-analysis-java-client"
            },
            "nextItem": {
              "title": "TCC",
              "permalink": "/blog/tcc-mode-applicable-scenario-analysis"
            }
          },
          "content": "FescarFescarSeata(Simpe Extensible Autonomous Transcaction Architecture)FescarFast & EaSy Commit And RollbackFescarCommitRollbackSeata\n\nSeata:\n\n![](/img/blog/20190327000119.png)\n\n- TM:TC\n- RM:RMTC\n- TC:Fescar-server\n\nTC\n\n# 2.Transcation Coordinator\n TC TCRMTMTCRMTMSeataTC\n\n:\n- RMTM\n- : \n- RMTM\n- /\n\nSeata\n\n## 2.1 Seata-Server\n\n\n![](/img/seata-server/design.png)\n\nSeata-Server:\n- Coordinator Core: commit,rollback\n- Store:\n- Discovery: /ServerClient\n- Config: \n- Lock: Seata\n- RPC:\n- HA-Cluster:Seata0.6\n\n## 2.2 Discovery\n\nDiscovery/Seata-Sever\n\n![](/img/seata-server/discover.png)\n\nRegistryService:\n- register\n- unregisterJVMShutdownHook\n- subscribe\n- unsubscribe\n- lookupkey\n- closeRegistry\n\n//rediszknacoseruka  consulNacos\n\n#### 2.2.1 register\n![](/img/seata-server/register.png)\n\n\nstep1:\n\nstep2:Nacos Naming  serverAddr registry.conf \n\nunregister\n\n#### 2.2.2 lookup\n![](/img/seata-server/lookup.png)\n\nstep1clusterName\n\nstep2map\n\nstep3mapmap\n\n\n#### 2.2.3 subscribe\n\n![](/img/seata-server/subscribe.png)\n\n:\n\nstep1cluster-> listener mapnacos\n\nstep2Nacos api \n## 2.3 Config\n:NettyselectworksessionSeata\n\nSeataConfiguration:\n\n![](/img/seata-server/config.png)\n\n- getInt/Long/Boolean/getConfig()dataId\n- putConfig\n- removeConfig\n- add/remove/get ConfigListener// \n\nConfigFile()NacosApollo  ZKSeataregistry.confconfig.type conf\n## 2.4 Store\nSeata\nTCRM\n\nSeataSessionTMGloabSessionRMBranchSessionGloabSessionBranchSessionSession\n\nFileTransactionStoreManager#writeSession:\n\n![](/img/seata-server/store.png)\n\n\n- step1TransactionWriteFuture\n- step2futureRequestLinkedBlockingQueueRocketMQFileChannel\n- step3future.get\n\n\n\n![](/img/seata-server/storewrite.png)\n\nWriteDataFileRunnable()Runnablerun():\n\n![](/img/seata-server/storerun.png)\n\n:\n\nstep1 stoppingtruenull\n\nstep2\n\nstep3futurefalseget()\n\nstep4pageCahce\n\nstep5\n\nwriteDataFile:\n\n![](/img/seata-server/writedatafile.png)\n\nstep1ByteBufferBufferSizeBufferGC\n\nstep2ByteBuffer\n\nstep3ByteBufferfileChannel,pageCacheOSflushflush:\n\n![](/img/seata-server/flush.png)\n\nflushpageCache\n\nstoresession\n\n## 2.5 Lock\nSeata:Seata\n\nLockSeataLock:\n![](/img/seata-server/lockManager.png)\n\n:\n- acquireLockBranchSessionSessiontrue\n- isLockableIDIdKey\n- cleanAllLocks\nredismysql\n![](/img/seata-server/defaultLock.png)\n\n:\n- BUCKET_PER_TABLEtablebucket\n- LOCK_MAPmapMap\n\n | key| value\n---|---|---\n1-LOCK_MAP | resourceIdjdbcUrl | dbLockMap\n2- dbLockMap | tableName  | tableLockMap\n3- tableLockMap | PK.hashcode%Bucket hashcode%bucket | bucketLockMap\n4- bucketLockMap | PK | trascationId\n\nbucketLockMapmapbucketLockMap,trascationIdTranscationId\n\n## 2.6 RPC\nSeataNettyRPC\n\n![](/img/seata-server/reactor.png)\n\nAcceptorcpu*2NIO-ThreadTM100500\n\nSeata Netty  \n\n![](/img/seata-server/transport.png)\n\nSeataNettyIdleStateHandler:\n\n![](/img/seata-server/idleStateHandler.png)\n\nSever15s(5sping)15s\n\n\n![](/img/seata-server/userEventTriggered.png)\n\nstep1\n\nstep2   \nSeata Netty   \n\n![](/img/seata-server/send.png)\n\n AbstractRpcRemoting#sendAsyncRequest  RpcMessage  basket  while true \n1msbasket merge  channel  fail-fast merge map AbstractRpcRemotingClient#channelRead dispatch  messageListener  handler timerExecutor    \nSeata  Netty Client TMClientRMClient  AbstractRpcRemotingClientAbstractRpcRemotingClient  RemotingService, RegisterMsgListenernetty  ClientMessageSender AbstractRpcRemoting ClientServer     \nRMClient\n![](/img/seata-server/class.png)\nTMClient  RMClient  poolConfig  NettyPoolableFactory implements KeyedPoolableObjectFactory<NettyPoolKey, Channel>  channel channel  key+ip  key \n channel TMClient  RMClient  ip \n\n## 2.7 HA-Cluster\nHA-Cluster,HA-Cluster:\n![](/img/seata-server/hacluster.png)\n\n:\n\nstep1transcationIdtranscationmasterMaster\n\nstep2servermasterslavemasterslavemasterslave\n\n0.5GoSeata-ServerSeata()raft\n\n## 2.8 Metrics  \nmetricApache SkyWalking Seata\n\n# 3.Coordinator Core\nServerSeataSeata\n\n## 3.1 \nServermain\n\n![](/img/seata-server/main.png)\n\nstep1RpcServerNetty\n\nstep2Server)IP(ipvip)\n\nstep3SessionHoler,dataDirSession\n\nstep4CoorDinator,\n- retryRollbackingrollbackrollback5ms\n- retryCommittingcommitcommit5ms\n- asyncCommittingcommitcommit10ms\n- timeoutCheck2ms\n\nstep5 UUIDGeneratorID(transcationId,branchId)\n\nstep6IPXIDrpcServer\n\nSeata\n## 3.2 Begin-\nSeata\n\n![](/img/seata-server/begin.png)\n\nstep1 IDGloabSessionbranchSession\n\nstep2RootSessionManagerSeataListener(sessionManagerSessionLifecycleListener)\n- ROOT_SESSION_MANAGERSession\n- ASYNC_COMMITTING_SESSION_MANAGERcommitSession\n- RETRY_COMMITTING_SESSION_MANAGERcommitSession\n- RETRY_ROLLBACKING_SESSION_MANAGERSession\nSessionManagerRootSessionManager\n\nstep3Globalsession\n\n![](/img/seata-server/begin2.png)\n\nBegin,,RootSessionManageronBeginSessionmap\n\nstep4XIDXID ip+port+transactionId TMIDRMRMXIDServer\n\n## 3.3 BranchRegister-\nTMRM\n\n![](/img/seata-server/branchRegister.png)\n\nstep1transactionId\n\nstep2BranchSession\n\nstep3\n\nstep4branchSessionglobalSession\n\nstep5branchId,ID\n\nServerTMcatch \n\n## 3.4 GlobalCommit - \n\nTM-:\n\n\n![](/img/seata-server/commit.png)\n\nstep1globalSessionnullcommit\n\nstep2GloabSessionbranch(provider)\n\nstep3statusBeginCommitting\n\nstep4ATundolog\n\nstep5ASYNC_COMMITTING_SESSION_MANAGERstep6step6\n\nstep6BranchSessionbranchSessionmanager\n\n## 3.5 GlobalRollback - \n\nTM\n\n![](/img/seata-server/rollback.png)\n\n\n\n# 4.\n4Seata\n- \n- : HA-Cluster\n- RPCnettySeata\n- \n\nSeata-ServerServer\n\nSeata GitHubhttps://github.com/seata/seata   \n\n\n\nGitHub ID @CoffeeLatte007Seata CommitterJava   \n()GitHub ID @slievrlySeata  TXC/GTS "
        },
        {
          "id": "/tcc-mode-applicable-scenario-analysis",
          "metadata": {
            "permalink": "/blog/tcc-mode-applicable-scenario-analysis",
            "source": "@site/blog/tcc-mode-applicable-scenario-analysis.md",
            "title": "TCC",
            "description": "Fescar 0.4.0  TCC  Roadmap",
            "date": "2019-03-27T00:00:00.000Z",
            "formattedDate": "March 27, 2019",
            "tags": [],
            "readingTime": 16.635,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "zhangthen"
              }
            ],
            "frontMatter": {
              "title": "TCC",
              "author": "zhangthen",
              "date": "2019/03/27",
              "keywords": [
                "seataTCCroadmap"
              ]
            },
            "prevItem": {
              "title": "Seata-Server",
              "permalink": "/blog/seata-analysis-java-server"
            },
            "nextItem": {
              "title": "TCC ",
              "permalink": "/blog/tcc-mode-design-principle"
            }
          },
          "content": "Fescar 0.4.0  TCC  Roadmap\n<a name=\"2143093f\"></a>\n\n##  TCC \n<br /> \n![1.png](/img/blog/TCC1.png)<br />\n\nTCC  RPC  SOA \n\n\n<a name=\"d9b462de\"></a>\n\n## TCC \n\n TCC \n\n<a name=\"95179108\"></a>\n\n### 1.1 \n\n\n\n\n\n1.  SOA \n1. \n\n\n\n![2.png](/img/blog/TCC2.png)\n\nTCC \n\n<a name=\"240e4d15\"></a>\n\n### 1.2 \n\nTCC \n\n****<br />\n![3.png](/img/blog/TCC3.png)\n\n**TCC **<br />\n![4.png](/img/blog/TCC4.png)\n\n TryCommitCancel \n\n1. Try \n1. Commit \n\n Commit   Commit <br />\n![5.png](/img/blog/TCC5.png)\n\n TCC \n\n<a name=\"ad5fc026\"></a>\n\n##  TCC \n\n TCC  TCC <br />\n![6.png](/img/blog/TCC6.png)<br />\n<a name=\"62b37e99\"></a>\n\n### \n\n TCC <br />\n![7.png](/img/blog/TCC7.png)<br /><br />\n\n TCC  TCC <br />\n![8.png](/img/blog/TCC8.png)\n\n Try  Try  Try  TCC \n\n Confirm \n\n\n\n<a name=\"827f0f82\"></a>\n\n##  TCC \n\n TCC <br />\n![9.png](/img/blog/TCC9.png)<br /><br /> TryConfirmCancel Try Confirm Cancel \n\n\n\n TCC \n\n<a name=\"62b37e99-1\"></a>\n\n### \n\n TCC <br />\n![10.png](/img/blog/TCC10.png)<br /><br />\n\n1. \n1. \n\n\n\nTCC<br />\n![11.png](/img/blog/TCC11.png)<br /><br /><br /> TCC \n\n<a name=\"69910d05\"></a>\n\n##  TCC \n\n TCC  TCC  Do  Compensate <br />\n![12.png](/img/blog/TCC12.png)<br /><br />Do Compensate Compensate<br />\n\n<a name=\"62b37e99-2\"></a>\n\n### \n\n TCC <br />\n![13.png](/img/blog/TCC13.png)<br /><br />\n\n\n\n TCC <br />\n![14.png](/img/blog/TCC14.png)\n\n Compensate \n\n Do  TCC  Compensate \n\n<a name=\"acfe75a0\"></a>\n\n## . \n\n\n\nTCC \n\nTCC <br />\n<a name=\"Roadmap\"></a>\n\n## Roadmap\n\n 0.4.0 0.5 ~ 1.0  ATTCC  1.0 <br /><br /><br />![1.png](/img/blog/roadmap.png)<br />"
        },
        {
          "id": "/tcc-mode-design-principle",
          "metadata": {
            "permalink": "/blog/tcc-mode-design-principle",
            "source": "@site/blog/tcc-mode-design-principle.md",
            "title": "TCC ",
            "description": "Fescar 0.4.0  TCC Sample https://github.com/fescar-group/fescar-samples/tree/master/tcc Roadmap",
            "date": "2019-03-26T00:00:00.000Z",
            "formattedDate": "March 26, 2019",
            "tags": [],
            "readingTime": 8.24,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "zhangthen"
              }
            ],
            "frontMatter": {
              "title": "TCC ",
              "author": "zhangthen",
              "date": "2019/03/26",
              "keywords": [
                "fescarTCCroadmap"
              ]
            },
            "prevItem": {
              "title": "TCC",
              "permalink": "/blog/tcc-mode-applicable-scenario-analysis"
            },
            "nextItem": {
              "title": "How to use Seata to ensure consistency between Dubbo Microservices",
              "permalink": "/blog/quick-start-use-seata-and-dubbo-services"
            }
          },
          "content": "Fescar 0.4.0  TCC <br />Sample [https://github.com/fescar-group/fescar-samples/tree/master/tcc](https://github.com/fescar-group/fescar-samples/tree/master/tcc)<br /> Roadmap\n\n<a name=\"f1d2fc6a\"></a>\n\n### TCC \n\n2PCTwo Phase Commitment ProtocolRM, resource manager 3 TM, transaction manager 2 \n\n TCCTry-Confirm-CancelTCC TCC  TryConfirmCancel 3  TCC \n\nTCC  Try Confirm Cancel \n\n TCC  TCC  2  TCC  TCC  Try  TCC  Confirm  Cancel  TCC \n\n![image.png](/img/blog/tcc.png)\n\n<a name=\"48153343\"></a>\n\n### TCC \n\n TCC  TCC  TCC TCC \n\n<a name=\"4226dc7c\"></a>\n\n#### 1****\n\n TCC  TCC  2  Try  Confirm \n\nA 100  30 \n\n TCC  SQLupdate  set  =  - 30 where  = A\n\n TCC  2 \n\n* Try \n\nTry  A  30 \n\n* Confirm \n\nConfirm A 30 \n\n* Cancel \n\nCancel  Try  30  A \n\n![image.png](/img/blog/tow_step.png)\n\n\n<a name=\"bce861f1\"></a>\n\n#### 2****\n\n TCC \n\nA A  100  T1  30  T2  30 \n\n Try  T1  T2  T1  T2  T1  T2 \n\n![image.png](/img/blog/conc.png) <br />\n\n<a name=\"e945e352\"></a>\n\n#### 3****\n\n TCC  Try  TCC  Cancel  Cancel \n\nTCC  Try  Cancel TCC\n\n![image.png](/img/blog/empty_rollback.png)\n\n<a name=\"e02f3ee9\"></a>\n\n#### 4\n\n TCC  Try  TCC  Cancel Cancel  Try  TCC  Cancel  Try  TCC  Try  Confirm  Cancel  TCC \n\n TCC  Try \n\n![image.png](/img/blog/susp.png)\n\n\n<a name=\"5322a3d5\"></a>\n\n#### 5\n\n TCC  TryConfirm  Cancel  TCC  TryConfirmCancel <br />![image.png](/img/blog/miden.png)<br /><br />\n\n<a name=\"Roadmap\"></a>\n\n### Roadmap\n\n 0.4.0  0.5 ~ 1.0  ATTCC  1.0 \n\n\n![1.png](/img/blog/roadmap.png)"
        },
        {
          "id": "/quick-start-use-seata-and-dubbo-services",
          "metadata": {
            "permalink": "/blog/quick-start-use-seata-and-dubbo-services",
            "source": "@site/i18n/en/docusaurus-plugin-content-blog/quick-start-use-seata-and-dubbo-services.md",
            "title": "How to use Seata to ensure consistency between Dubbo Microservices",
            "description": "This article will introduce you how to use Seata to ensure consistency between Dubbo Microservices.",
            "date": "2019-03-07T00:00:00.000Z",
            "formattedDate": "March 7, 2019",
            "tags": [],
            "readingTime": 2.84,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "slievrly"
              }
            ],
            "frontMatter": {
              "title": "How to use Seata to ensure consistency between Dubbo Microservices",
              "keywords": [
                "Dubbo",
                "Seata",
                "Consistency"
              ],
              "description": "This article will introduce you how to use Seata to ensure consistency between Dubbo Microservices.",
              "author": "slievrly",
              "date": "2019-03-07T00:00:00.000Z"
            },
            "prevItem": {
              "title": "TCC ",
              "permalink": "/blog/tcc-mode-design-principle"
            },
            "nextItem": {
              "title": "Fescar",
              "permalink": "/blog/seata-analysis-simple"
            }
          },
          "content": "## Use case\n\nA business logic for user purchasing commodities. The whole business logic is powered by 3 microservices:\n\n- Storage service: deduct storage count on given commodity.\n- Order service: create order according to purchase request.\n- Account service: debit the balance of user's account.\n\n### Architecture\n\n![Architecture](/img/blog/seata/seata-1.png) \n\n\n### StorageService\n\n```java\npublic interface StorageService {\n\n    /**\n     * deduct storage count\n     */\n    void deduct(String commodityCode, int count);\n}\n```\n\n### OrderService\n\n```java\npublic interface OrderService {\n\n    /**\n     * create order\n     */\n    Order create(String userId, String commodityCode, int orderCount);\n}\n```\n\n### AccountService\n\n```java\npublic interface AccountService {\n\n    /**\n     * debit balance of user's account\n     */\n    void debit(String userId, int money);\n}\n```\n\n### Main business logic\n\n```java\npublic class BusinessServiceImpl implements BusinessService {\n\n    private StorageService storageService;\n\n    private OrderService orderService;\n\n    /**\n     * purchase\n     */\n    public void purchase(String userId, String commodityCode, int orderCount) {\n\n        storageService.deduct(commodityCode, orderCount);\n\n        orderService.create(userId, commodityCode, orderCount);\n    }\n}\n```\n\n```java\npublic class StorageServiceImpl implements StorageService {\n\n  private StorageDAO storageDAO;\n  \n    @Override\n    public void deduct(String commodityCode, int count) {\n        Storage storage = new Storage();\n        storage.setCount(count);\n        storage.setCommodityCode(commodityCode);\n        storageDAO.update(storage);\n    }\n}\n```\n\n```java\npublic class OrderServiceImpl implements OrderService {\n\n    private OrderDAO orderDAO;\n\n    private AccountService accountService;\n\n    public Order create(String userId, String commodityCode, int orderCount) {\n\n        int orderMoney = calculate(commodityCode, orderCount);\n\n        accountService.debit(userId, orderMoney);\n\n        Order order = new Order();\n        order.userId = userId;\n        order.commodityCode = commodityCode;\n        order.count = orderCount;\n        order.money = orderMoney;\n\n        return orderDAO.insert(order);\n    }\n}\n```\n\n## Distributed Transaction Solution with Seata\n\n![undefined](/img/blog/seata/seata-2.png) \n\nWe just need an annotation `@GlobalTransactional` on business method: \n\n```java\n\n    @GlobalTransactional\n    public void purchase(String userId, String commodityCode, int orderCount) {\n        ......\n    }\n```\n\n## Example powered by Dubbo + Seata\n\n### Step 1: Setup database\n\n- Requirement: MySQL with InnoDB engine.\n\n**Note:** In fact, there should be 3 database for the 3 services in the example use case. However, we can just create one database and configure 3 data sources for simple. \n\nModify Spring XML with the database URL/username/password you just created.\n\ndubbo-account-service.xml\ndubbo-order-service.xml\ndubbo-storage-service.xml\n\n```xml\n    <property name=\"url\" value=\"jdbc:mysql://x.x.x.x:3306/xxx\" />\n    <property name=\"username\" value=\"xxx\" />\n    <property name=\"password\" value=\"xxx\" />\n```\n### Step 2: Create UNDO_LOG table for Seata\n\n`UNDO_LOG` table is required by Seata AT mode.\n\n```sql\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `idx_unionkey` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=159 DEFAULT CHARSET=utf8\n```\n\n### Step 3: Create tables for example business\n\n```sql\n\nDROP TABLE IF EXISTS `storage_tbl`;\nCREATE TABLE `storage_tbl` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `commodity_code` varchar(255) DEFAULT NULL,\n  `count` int(11) DEFAULT 0,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY (`commodity_code`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n\nDROP TABLE IF EXISTS `order_tbl`;\nCREATE TABLE `order_tbl` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(255) DEFAULT NULL,\n  `commodity_code` varchar(255) DEFAULT NULL,\n  `count` int(11) DEFAULT 0,\n  `money` int(11) DEFAULT 0,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n\nDROP TABLE IF EXISTS `account_tbl`;\nCREATE TABLE `account_tbl` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `user_id` varchar(255) DEFAULT NULL,\n  `money` int(11) DEFAULT 0,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n### Step 4: Start Seata-Server\n\n- Download server [package](https://github.com/seata/seata/releases), unzip it.\n- Start Seata-Server\n\n```shell\nsh seata-server.sh $LISTEN_PORT $PATH_FOR_PERSISTENT_DATA\n\ne.g.\n\nsh seata-server.sh 8091 /home/admin/seata/data/\n```\n\n### Step 5: Run example\n\n- Start AccountService ([DubboAccountServiceStarter](https://github.com/seata/seata-samples/blob/master/dubbo/src/main/java/com/seata/seata/samples/dubbo/starter/DubboAccountServiceStarter.java)).\n- Start StorageService ([DubboStorageServiceStarter](https://github.com/seata/seata-samples/blob/master/dubbo/src/main/java/com/seata/seata/samples/dubbo/starter/DubboStorageServiceStarter.java)).\n- Start OrderService ([DubboOrderServiceStarter](https://github.com/seata/seata-samples/blob/master/dubbo/src/main/java/com/seata/seata/samples/dubbo/starter/DubboOrderServiceStarter.java)).\n- Run BusinessService for test ([DubboBusinessTester](https://github.com/seata/seata-samples/blob/master/dubbo/src/main/java/com/seata/seata/samples/dubbo/starter/DubboBusinessTester.java)).\n\n### Related projects\n* seata:          https://github.com/seata/seata/\n* seata-samples : https://github.com/seata/seata-samples"
        },
        {
          "id": "/seata-analysis-simple",
          "metadata": {
            "permalink": "/blog/seata-analysis-simple",
            "source": "@site/blog/seata-analysis-simple.md",
            "title": "Fescar",
            "description": "fescarfescar5000starfescar",
            "date": "2019-02-18T00:00:00.000Z",
            "formattedDate": "February 18, 2019",
            "tags": [],
            "readingTime": 22.81,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": ""
              }
            ],
            "frontMatter": {
              "title": "Fescar",
              "author": "",
              "keywords": [
                "Fescar"
              ],
              "date": "2019/02/18"
            },
            "prevItem": {
              "title": "How to use Seata to ensure consistency between Dubbo Microservices",
              "permalink": "/blog/quick-start-use-seata-and-dubbo-services"
            },
            "nextItem": {
              "title": "MT mode",
              "permalink": "/blog/manual-transaction-mode"
            }
          },
          "content": "fescarfescar5000starfescar\n [LCN](https://github.com/codingapi/tx-lcn) 2pc\nlcn5.0fescarTCXTCC [hmily](https://github.com/yu199195/hmily) [tcc-transaction](https://github.com/changmingxie/tcc-transaction) \nfescarfescarGTSTXCXAfescartxcfescar30~60\n\n# \n\nfescarhttps://github.com/alibaba/fescar\n\nfescar0.1.2-SNAPSHOTfescar\n\n# fescarTXC\n\n![](/img/blog/c45496461bca15ecd522e497d98ba954f95.jpg)\n\nfescarTXCTXCTXC\n\n1.  TMfescarTC\n2.  TC\n3.  RM\n\nTCundo_logTCTCTCTCTCTC\n\nexamples\n\n# \n\nIDE\n\n![](/img/blog/a88cf147f489f913886ef1785d94183bf09.jpg)\n\n-   common \n-   config : nacos\n-   core : TMRMTCRPC\n-   dubbo dubbodubbodubbofilter\n-   examples \n-   rm-datasource :coreJDBCsql\n-   server : TC\n-   spring springaopfescar\n-   tm : \n\n# examples\n\nTCServermain8091\n\nexamplesmysqlzookeeperdubbozkclass\n\n```xml\n<dependency>\n    <groupId>com.101tec</groupId>\n    <artifactId>zkclient</artifactId>\n    <version>0.10</version>\n    <exclusions>\n        <exclusion>\n            <artifactId>slf4j-log4j12</artifactId>\n            <groupId>org.slf4j</groupId>\n        </exclusion>\n    </exclusions>\n</dependency>\n```\nBusinessServiceImplOrderServiceImplStorageServiceImplAccountServiceImplBusinessServiceImplaccount\\_tbl400599BusinessServiceImplaccount\\_tbl999\n\nfescar\n\n# fescar\n\n## \n\n\n\n```xml\n<bean class=\"com.alibaba.fescar.spring.annotation.GlobalTransactionScanner\">\n    <constructor-arg value=\"dubbo-demo-app\"/>\n    <constructor-arg value=\"my\\_test\\_tx_group\"/>\n</bean>\n```\nspring@GlobalTransactionalGlobalTransactionalInterceptorinvokeTMTmRpcClientRMRmRpcClientTCTMTransactionalTemplate\n\n## TM\n\nTransactionalTemplate\n\n```java\n\npublic Object execute(TransactionalExecutor business) throws TransactionalExecutor.ExecutionException {\n    // 1. get or create a transaction\n    GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n    // 2. begin transaction\n    try {\n        tx.begin(business.timeout(), business.name());\n    } catch (TransactionException txe) {\n        throw new TransactionalExecutor.ExecutionException(tx, txe,\n            TransactionalExecutor.Code.BeginFailure);\n    }\n    Object rs = null;\n    try {\n        // Do Your Business\n        rs = business.execute();\n    } catch (Throwable ex) {\n        // 3. any business exception, rollback.\n        try {\n            tx.rollback();\n            // 3.1 Successfully rolled back\n            throw new TransactionalExecutor.ExecutionException(tx, TransactionalExecutor.Code.RollbackDone, ex);\n        } catch (TransactionException txe) {\n            // 3.2 Failed to rollback\n            throw new TransactionalExecutor.ExecutionException(tx, txe,\n                TransactionalExecutor.Code.RollbackFailure, ex);\n        }\n    }\n    // 4. everything is fine, commit.\n    try {\n        tx.commit();\n    } catch (TransactionException txe) {\n        // 4.1 Failed to commit\n        throw new TransactionalExecutor.ExecutionException(tx, txe,\n            TransactionalExecutor.Code.CommitFailure);\n    }\n    return rs;\n}\n```\nTMClass\n\nDefaultGlobalTransaction \n\nDefaultTransactionManager TmRpcClientTCGlobalBeginRequestGlobalCommitRequestGlobalRollbackRequestGlobalStatusRequest\n\nTMTMiDxidRM\n\n## dubboxid\n\nxiddubbospring cloudmotanRPCfilterxidsqlfescardubbo\n\n```java\n@Activate(group = { Constants.PROVIDER, Constants.CONSUMER }, order = 100)\npublic class TransactionPropagationFilter implements Filter {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(TransactionPropagationFilter.class);\n\n    @Override\n    public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {\n        String xid = RootContext.getXID();\n        String rpcXid = RpcContext.getContext().getAttachment(RootContext.KEY_XID);\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"xid in RootContext\\[\" + xid + \"\\] xid in RpcContext\\[\" + rpcXid + \"\\]\");\n        }\n        boolean bind = false;\n        if (xid != null) {\n            RpcContext.getContext().setAttachment(RootContext.KEY_XID, xid);\n        } else {\n            if (rpcXid != null) {\n                RootContext.bind(rpcXid);\n                bind = true;\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\"bind\\[\" + rpcXid + \"\\] to RootContext\");\n                }\n            }\n        }\n        try {\n            return invoker.invoke(invocation);\n\n        } finally {\n            if (bind) {\n                String unbindXid = RootContext.unbind();\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\"unbind\\[\" + unbindXid + \"\\] from RootContext\");\n                }\n                if (!rpcXid.equalsIgnoreCase(unbindXid)) {\n                    LOGGER.warn(\"xid in change during RPC from \" + rpcXid + \" to \" + unbindXid);\n                    if (unbindXid != null) {\n                        RootContext.bind(unbindXid);\n                        LOGGER.warn(\"bind \\[\" + unbindXid + \"\\] back to RootContext\");\n                    }\n                }\n            }\n        }\n    }\n}\n```\nrpcXidRootContextContextCoreContextCoreThreadLocalContextCoreThreadLocalxidfescarcommonEnhancedServiceLoader@LoadLevelorder\n\n## RM\n\nfescarDataSourceProxyConnectionProxyStatementProxyfescarfescar\n\n![](/img/blog/af317255c71a5c1bf46f7140387acf365f8.jpg)\n\nDataSourceProxyxidxidRootContext\n\nStatementProxy\n\n![](/img/blog/17896deea47b9aee518812b039c39101d8f.jpg)\n\nExecuteTemplate\n\n![](/img/blog/04488a2745a5d564498462ed64c506174d2.jpg)\n\nTMTransactionlTemplateExecuteTemplateStatementStatementProxyJDBCexecuteUpdateExecuteTemplateexecutesqlRootCOntextxidRMsqlfescarUpdateExecutorDeleteExecutorInsertExecutorSelectForUpdateExecutorPlainExecutor\n\n![](/img/blog/bb9a2f07054f19bc21adc332671de4f7b75.jpg)\n\n### PlainExecutor\n\nJDBCselect\n\n### UpdateExecutorDeleteExecutorInsertExecutor\n\nDMLsqlsql\n\n```java\nprotected abstract TableRecords beforeImage() throws SQLException;\n\nprotected abstract TableRecords afterImage(TableRecords beforeImage) throws SQLException;\n```\nsqlundo_logmsyqlsql\n\n![](/img/blog/fd5c423815d3b84bdbc70d7efeb9cd16757.jpg)\n\nrollback\\_infoundo\\_loglongblob\n\n```json\n{\n\"branchId\":3958194,\n\"sqlUndoLogs\":[\n{\n\"afterImage\":{\n\"rows\":[\n{\n\"fields\":[\n{\n\"keyType\":\"PrimaryKey\",\n\"name\":\"ID\",\n\"type\":4,\n\"value\":10\n},\n{\n\"keyType\":\"NULL\",\n\"name\":\"COUNT\",\n\"type\":4,\n\"value\":98\n}\n]\n}\n],\n\"tableName\":\"storage_tbl\"\n},\n\"beforeImage\":{\n\"rows\":[\n{\n\"fields\":[\n{\n\"keyType\":\"PrimaryKey\",\n\"name\":\"ID\",\n\"type\":4,\n\"value\":10\n},\n{\n\"keyType\":\"NULL\",\n\"name\":\"COUNT\",\n\"type\":4,\n\"value\":100\n}\n]\n}\n],\n\"tableName\":\"storage_tbl\"\n},\n\"sqlType\":\"UPDATE\",\n\"tableName\":\"storage_tbl\"\n}\n],\n\"xid\":\"192.168.7.77:8091:3958193\"\n}\n\n\n```\n\nupdateundo\\_logxidbranchidsql=storage\\_tbl,sqlID=10count=100sqlid=10count=98\n\n```sql\nupdate storage_tbl set count = 100 where id = 10;\n```\nsql\n\n### SelectForUpdateExecutor\n\nfescarATSelectForUpdateExecutor\n\n```java\n@Override\npublic Object doExecute(Object... args) throws Throwable {\n    SQLSelectRecognizer recognizer = (SQLSelectRecognizer) sqlRecognizer;\n\n    Connection conn = statementProxy.getConnection();\n    ResultSet rs = null;\n    Savepoint sp = null;\n    LockRetryController lockRetryController = new LockRetryController();\n    boolean originalAutoCommit = conn.getAutoCommit();\n\n    StringBuffer selectSQLAppender = new StringBuffer(\"SELECT \");\n    selectSQLAppender.append(getTableMeta().getPkName());\n    selectSQLAppender.append(\" FROM \" + getTableMeta().getTableName());\n    String whereCondition = null;\n    ArrayList<Object> paramAppender = new ArrayList<>();\n    if (statementProxy instanceof ParametersHolder) {\n        whereCondition = recognizer.getWhereCondition((ParametersHolder) statementProxy, paramAppender);\n    } else {\n        whereCondition = recognizer.getWhereCondition();\n    }\n    if (!StringUtils.isEmpty(whereCondition)) {\n        selectSQLAppender.append(\" WHERE \" + whereCondition);\n    }\n    selectSQLAppender.append(\" FOR UPDATE\");\n    String selectPKSQL = selectSQLAppender.toString();\n\n    try {\n        if (originalAutoCommit) {\n            conn.setAutoCommit(false);\n        }\n        sp = conn.setSavepoint();\n        rs = statementCallback.execute(statementProxy.getTargetStatement(), args);\n\n        while (true) {\n            // Try to get global lock of those rows selected\n            Statement stPK = null;\n            PreparedStatement pstPK = null;\n            ResultSet rsPK = null;\n            try {\n                if (paramAppender.isEmpty()) {\n                    stPK = statementProxy.getConnection().createStatement();\n                    rsPK = stPK.executeQuery(selectPKSQL);\n                } else {\n                    pstPK = statementProxy.getConnection().prepareStatement(selectPKSQL);\n                    for (int i = 0; i < paramAppender.size(); i++) {\n                        pstPK.setObject(i + 1, paramAppender.get(i));\n                    }\n                    rsPK = pstPK.executeQuery();\n                }\n\n                TableRecords selectPKRows = TableRecords.buildRecords(getTableMeta(), rsPK);\n                statementProxy.getConnectionProxy().checkLock(selectPKRows);\n                break;\n\n            } catch (LockConflictException lce) {\n                conn.rollback(sp);\n                lockRetryController.sleep(lce);\n\n            } finally {\n                if (rsPK != null) {\n                    rsPK.close();\n                }\n                if (stPK != null) {\n                    stPK.close();\n                }\n                if (pstPK != null) {\n                    pstPK.close();\n                }\n            }\n        }\n\n    } finally {\n        if (sp != null) {\n            conn.releaseSavepoint(sp);\n        }\n        if (originalAutoCommit) {\n            conn.setAutoCommit(true);\n        }\n    }\n    return rs;\n}\n```\n\n\n```java\nTableRecords selectPKRows = TableRecords.buildRecords(getTableMeta(), rsPK);\nstatementProxy.getConnectionProxy().checkLock(selectPKRows);\n```\nselectPKRowslockKeysTC\n\n## \n\nfescarConnectionProxycommit\n\n```java\n@Override\npublic void commit() throws SQLException {\n    if (context.inGlobalTransaction()) {\n        try {\n            register();\n        } catch (TransactionException e) {\n            recognizeLockKeyConflictException(e);\n        }\n\n        try {\n            if (context.hasUndoLog()) { \n                UndoLogManager.flushUndoLogs(this);\n            }\n            targetConnection.commit();\n        } catch (Throwable ex) {\n            report(false);\n            if (ex instanceof SQLException) {\n                throw (SQLException) ex;\n            } else {\n                throw new SQLException(ex);\n            }\n        }\n        report(true);\n        context.reset();\n       \n    } else {\n        targetConnection.commit();\n    }\n}\n```\nTCTCundo_logTC\n\n## server\n\nserverDefaultCoordinatorAbstractTCInboundHandler\n\n![](/img/blog/3da6fd82debb9470eb4a5feb1eecac6d6a2.jpg)\n\nTransactionlTemplateTMTCTCdoGlobalRollbackTC\n\n```java\n@Override\npublic void doGlobalRollback(GlobalSession globalSession, boolean retrying) throws TransactionException {\n    for (BranchSession branchSession : globalSession.getReverseSortedBranches()) {\n        BranchStatus currentBranchStatus = branchSession.getStatus();\n        if (currentBranchStatus == BranchStatus.PhaseOne_Failed) {\n            continue;\n        }\n        try {\n            BranchStatus branchStatus = resourceManagerInbound.branchRollback(XID.generateXID(branchSession.getTransactionId()), branchSession.getBranchId(),\n                    branchSession.getResourceId(), branchSession.getApplicationData());\n\n            switch (branchStatus) {\n                case PhaseTwo_Rollbacked:\n                    globalSession.removeBranch(branchSession);\n                    LOGGER.error(\"Successfully rolled back branch \" + branchSession);\n                    continue;\n                case PhaseTwo\\_RollbackFailed\\_Unretryable:\n                    GlobalStatus currentStatus = globalSession.getStatus();\n                    if (currentStatus.name().startsWith(\"Timeout\")) {\n                        globalSession.changeStatus(GlobalStatus.TimeoutRollbackFailed);\n                    } else {\n                        globalSession.changeStatus(GlobalStatus.RollbackFailed);\n                    }\n                    globalSession.end();\n                    LOGGER.error(\"Failed to rollback global\\[\" + globalSession.getTransactionId() + \"\\] since branch\\[\" + branchSession.getBranchId() + \"\\] rollback failed\");\n                    return;\n                default:\n                    LOGGER.info(\"Failed to rollback branch \" + branchSession);\n                    if (!retrying) {\n                        queueToRetryRollback(globalSession);\n                    }\n                    return;\n\n            }\n        } catch (Exception ex) {\n            LOGGER.info(\"Exception rollbacking branch \" + branchSession, ex);\n            if (!retrying) {\n                queueToRetryRollback(globalSession);\n                if (ex instanceof TransactionException) {\n                    throw (TransactionException) ex;\n                } else {\n                    throw new TransactionException(ex);\n                }\n            }\n\n        }\n\n    }\n    GlobalStatus currentStatus = globalSession.getStatus();\n    if (currentStatus.name().startsWith(\"Timeout\")) {\n        globalSession.changeStatus(GlobalStatus.TimeoutRollbacked);\n    } else {\n        globalSession.changeStatus(GlobalStatus.Rollbacked);\n    }\n    globalSession.end();\n}\n```\nRMHandlerATdoBranchRollbackRMbranchRollback\n\n```java\n@Override\npublic BranchStatus branchRollback(String xid, long branchId, String resourceId, String applicationData) throws TransactionException {\n    DataSourceProxy dataSourceProxy = get(resourceId);\n    if (dataSourceProxy == null) {\n        throw new ShouldNeverHappenException();\n    }\n    try {\n        UndoLogManager.undo(dataSourceProxy, xid, branchId);\n    } catch (TransactionException te) {\n        if (te.getCode() == TransactionExceptionCode.BranchRollbackFailed_Unretriable) {\n            return BranchStatus.PhaseTwo\\_RollbackFailed\\_Unretryable;\n        } else {\n            return BranchStatus.PhaseTwo\\_RollbackFailed\\_Retryable;\n        }\n    }\n    return BranchStatus.PhaseTwo_Rollbacked;\n}\n```\nRMUndoLogManagerundoxidbranchidTCundo_log2\n\n# \n\nfescar1fescarsqlfescarTXC\n\n### \n\n20165&pmpMVPKL[http://www.kailing.pub](http://www.kailing.pub/)"
        },
        {
          "id": "/manual-transaction-mode",
          "metadata": {
            "permalink": "/blog/manual-transaction-mode",
            "source": "@site/i18n/en/docusaurus-plugin-content-blog/manual-transaction-mode.md",
            "title": "MT mode",
            "description": "introduce MT mode",
            "date": "2019-02-13T00:00:00.000Z",
            "formattedDate": "February 13, 2019",
            "tags": [],
            "readingTime": 1.12,
            "hasTruncateMarker": false,
            "authors": [
              {
                "name": "kmmshmily"
              }
            ],
            "frontMatter": {
              "title": "MT mode",
              "keywords": [
                "MT mode"
              ],
              "description": "introduce MT mode",
              "author": "kmmshmily",
              "date": "2019-02-13T00:00:00.000Z"
            },
            "prevItem": {
              "title": "Fescar",
              "permalink": "/blog/seata-analysis-simple"
            }
          },
          "content": "Review the description in the overview: a distributed global transaction, the whole is a model of **the two-phase commit**. A global transaction consists of several branch transactions that meet the model requirements of **the two-phase commit**, which requires each branch transaction to have its own:\n\n- One phase prepare behavior\n- Two phase commit or rollback behavior\n\n![Overview of a global transaction](https://upload-images.jianshu.io/upload_images/4420767-e48f0284a037d1df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nAccording to the two phase behavior patternWe divide the branch transaction into **Automatic (Branch) Transaction Mode** and **Manual (Branch) Transaction Mode**.\n\nThe AT mode is based on the **Relational Database** that **supports local ACID transactions**\n\n- One phase prepare behavior: In the local transaction, the business data update and the corresponding rollback log record are submitted together.\n- Two phase commit behavior: Immediately ended successfully, **Auto** asynchronous batch cleanup of the rollback log.\n- Two phase rollback behavior: By rolling back the log, **automatic** generates a compensation operation to complete the data rollback.\n\nAccordingly, the MT mode does not rely on transaction support for the underlying data resources:\n\n- One phase prepare behavior: Call the prepare logic of **custom** .\n- Two phase commit behavior:Call the commit logic of **custom** .\n- Two phase rollback behavior:Call the rollback logic of **custom** .\n\nThe so-called MT mode refers to the support of the branch transaction of **custom** into the management of global transactions."
        }
      ],
      "blogListPaginated": [
        {
          "items": [
            "/seata-observable-practice",
            "/seata-connect-data-and-application",
            "/seata-go-1.2.0",
            "/iscas2023",
            "/seata-1.6.0",
            "/seata-1.5.2",
            "/seata-tcc-fence",
            "/seata-tcc",
            "/seata-at-lock",
            "welcome"
          ],
          "metadata": {
            "permalink": "/blog",
            "page": 1,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "nextPage": "/blog/page/2",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        },
        {
          "items": [
            "/seata-snowflake-explain",
            "/seata-analysis-UUID-generator",
            "/seata-feature-undo-log-compress",
            "/seata-dsproxy-deadlock",
            "/seata-client-start-analysis-02",
            "/seata-client-start-analysis-01",
            "/integrate-seata-tcc-mode-with-spring-cloud",
            "/seata-config-manager",
            "/seata-golang-communication-mode",
            "/seata-datasource-proxy"
          ],
          "metadata": {
            "permalink": "/blog/page/2",
            "page": 2,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "previousPage": "/blog",
            "nextPage": "/blog/page/3",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        },
        {
          "items": [
            "/seata-sourcecode-client-bootstrap",
            "/seata-at-demo-in-mac",
            "/seata-rpc-refactor",
            "/seata-sourcecode-server-bootstrap",
            "/seata-xa-introduce",
            "/seata-quick-start",
            "/seata-ha-practice",
            "/seata-analysis-config-modular",
            "/seata-analysis-dubbo-transmit-xid",
            "/seata-meetup-hangzhou"
          ],
          "metadata": {
            "permalink": "/blog/page/3",
            "page": 3,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "previousPage": "/blog/page/2",
            "nextPage": "/blog/page/4",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        },
        {
          "items": [
            "/seata-analysis-tcc-modular",
            "/seata-analysis-core-modular",
            "/seata-spring-boot-aop-aspectj",
            "/seata-community-meetup-hangzhou-ready",
            "/seata-dynamic-config-and-dynamic-disable",
            "/seata-config-center",
            "/seata-nacos-docker",
            "/seata-nacos-analysis",
            "/seata-mybatisplus-analysis",
            "/springboot-dubbo-mybatisplus-seata"
          ],
          "metadata": {
            "permalink": "/blog/page/4",
            "page": 4,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "previousPage": "/blog/page/3",
            "nextPage": "/blog/page/5",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        },
        {
          "items": [
            "/seata-at-mode-start-rm-tm",
            "/seata-at-mode-start",
            "/design-more-flexable-application-by-saga",
            "/seata-at-tcc-saga",
            "/seata-at-mode-design",
            "/seata-analysis-go-server",
            "/how-to-support-spring-cloud",
            "/integrate-seata-with-spring-cloud",
            "/seata-analysis-java-client",
            "/seata-analysis-java-server"
          ],
          "metadata": {
            "permalink": "/blog/page/5",
            "page": 5,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "previousPage": "/blog/page/4",
            "nextPage": "/blog/page/6",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        },
        {
          "items": [
            "/tcc-mode-applicable-scenario-analysis",
            "/tcc-mode-design-principle",
            "/quick-start-use-seata-and-dubbo-services",
            "/seata-analysis-simple",
            "/manual-transaction-mode"
          ],
          "metadata": {
            "permalink": "/blog/page/6",
            "page": 6,
            "postsPerPage": 10,
            "totalPages": 6,
            "totalCount": 55,
            "previousPage": "/blog/page/5",
            "blogDescription": "Blog",
            "blogTitle": "Blog"
          }
        }
      ],
      "blogTags": {
        "/blog/tags/facebook": {
          "label": "facebook",
          "items": [
            "welcome"
          ],
          "permalink": "/blog/tags/facebook",
          "pages": [
            {
              "items": [
                "welcome"
              ],
              "metadata": {
                "permalink": "/blog/tags/facebook",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ]
        },
        "/blog/tags/hello": {
          "label": "hello",
          "items": [
            "welcome"
          ],
          "permalink": "/blog/tags/hello",
          "pages": [
            {
              "items": [
                "welcome"
              ],
              "metadata": {
                "permalink": "/blog/tags/hello",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ]
        },
        "/blog/tags/docusaurus": {
          "label": "docusaurus",
          "items": [
            "welcome"
          ],
          "permalink": "/blog/tags/docusaurus",
          "pages": [
            {
              "items": [
                "welcome"
              ],
              "metadata": {
                "permalink": "/blog/tags/docusaurus",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 1,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ]
        },
        "/blog/tags/seata": {
          "label": "Seata",
          "items": [
            "/seata-client-start-analysis-02",
            "/seata-client-start-analysis-01"
          ],
          "permalink": "/blog/tags/seata",
          "pages": [
            {
              "items": [
                "/seata-client-start-analysis-02",
                "/seata-client-start-analysis-01"
              ],
              "metadata": {
                "permalink": "/blog/tags/seata",
                "page": 1,
                "postsPerPage": 10,
                "totalPages": 1,
                "totalCount": 2,
                "blogDescription": "Blog",
                "blogTitle": "Blog"
              }
            }
          ]
        }
      },
      "blogTagsListPath": "/blog/tags"
    }
  },
  "docusaurus-plugin-content-pages": {
    "default": [
      {
        "type": "jsx",
        "permalink": "/",
        "source": "@site/src/pages/index.tsx"
      },
      {
        "type": "mdx",
        "permalink": "/markdown-page",
        "source": "@site/src/pages/markdown-page.md",
        "title": "Markdown page example",
        "description": "You don't need React to write simple standalone pages.",
        "frontMatter": {
          "title": "Markdown page example"
        }
      },
      {
        "type": "jsx",
        "permalink": "/community/contactItem",
        "source": "@site/src/pages/community/contactItem.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/community/contributorItem",
        "source": "@site/src/pages/community/contributorItem.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/community/eventCard",
        "source": "@site/src/pages/community/eventCard.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/community/",
        "source": "@site/src/pages/community/index.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/home/feature/",
        "source": "@site/src/pages/home/feature/index.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/home/introduction/",
        "source": "@site/src/pages/home/introduction/index.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/home/msemap/",
        "source": "@site/src/pages/home/msemap/index.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/home/top/",
        "source": "@site/src/pages/home/top/index.tsx"
      },
      {
        "type": "jsx",
        "permalink": "/home/users/",
        "source": "@site/src/pages/home/users/index.tsx"
      }
    ]
  },
  "docusaurus-plugin-debug": {},
  "docusaurus-theme-classic": {},
  "docusaurus-plugin-sass": {},
  "docusaurus-bootstrap-plugin": {},
  "docusaurus-mdx-fallback-plugin": {}
}